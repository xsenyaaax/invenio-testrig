<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="6" skipped="0" tests="302" time="71.839" timestamp="2025-12-10T09:54:17.680556+00:00" hostname="runnervmoqczp"><testcase classname="docs.conf" name="PYDOCSTYLE" time="0.012" /><testcase classname="docs.conf" name="ISORT" time="0.156" /><testcase classname="docs.conf" name="black" time="0.333" /><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.162" /><testcase classname="tests.conftest" name="ISORT" time="0.089" /><testcase classname="tests.conftest" name="black" time="0.259" /><testcase classname="tests.resources.test_resources_domains" name="ISORT" time="0.034" /><testcase classname="tests.resources.test_resources_domains" name="black" time="0.221" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_access" time="3.180" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_search" time="0.169" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_read" time="0.088" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_delete" time="0.139" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create" time="0.126" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json0]" time="0.058" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json1]" time="0.062" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json2]" time="0.219" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json3]" time="0.062" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_update" time="0.361" /><testcase classname="tests.resources.test_resources_groups" name="ISORT" time="0.007" /><testcase classname="tests.resources.test_resources_groups" name="black" time="0.176" /><testcase classname="tests.resources.test_resources_groups" name="test_group_avatar" time="2.196" /><testcase classname="tests.resources.test_resources_users" name="ISORT" time="0.053" /><testcase classname="tests.resources.test_resources_users" name="black" time="0.261" /><testcase classname="tests.resources.test_resources_users" name="test_read_self_serialization" time="2.005" /><testcase classname="tests.resources.test_resources_users" name="test_read_anon_serialization" time="0.033" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[pub]" time="0.280" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[pubres]" time="0.277" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[res]" time="0.059" /><testcase classname="tests.resources.test_resources_users" name="test_user_avatar" time="0.104" /><testcase classname="tests.resources.test_resources_users" name="test_user_avatar_non_ascii" time="0.062" /><testcase classname="tests.resources.test_resources_users" name="test_create_user" time="1.379" /><testcase classname="tests.resources.test_resources_users" name="test_approve_user" time="0.496" /><testcase classname="tests.resources.test_resources_users" name="test_block_user" time="0.795" /><testcase classname="tests.resources.test_resources_users" name="test_deactivate_user" time="0.613" /><testcase classname="tests.resources.test_resources_users" name="test_management_permissions" time="0.262" /><testcase classname="tests.resources.test_resources_users" name="test_impersonate_user" time="0.791" /><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_records_html-/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions]" time="0.033"><failure message="sqlalchemy.orm.exc.StaleDataError: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
link_name = 'admin_records_html'
expected_url = '/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_url = '/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions'
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
link_name  = 'admin_records_html'
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub   = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc588558180&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc588558180&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588470b80&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc588558180&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588470b80&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc588558180&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = StaleDataError("UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588470b80&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc58864c600&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc588558180&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = StaleDataError("UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588470b80&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:455: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        locations  = ('querystring', 'form', 'json')
        parsed_args = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:278: in post
    self.login_user(user)
        kwargs     = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;
        user       = &lt;User 8&gt;
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:268: in login_user
    return login_user(user)
           ^^^^^^^^^^^^^^^^
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5891a7260&gt;
        user       = &lt;User 8&gt;
.venv/lib/python3.12/site-packages/flask_security/utils.py:99: in login_user
    identity_changed.send(current_app._get_current_object(), identity=Identity(user.id))
        kwargs     = {}
        new_current_ip = '127.0.0.1'
        new_current_login = datetime.datetime(2025, 12, 10, 9, 54, 35, 408102)
        old_current_ip = None
        old_current_login = None
        remote_addr = '127.0.0.1'
        user       = &lt;User 8&gt;
.venv/lib/python3.12/site-packages/blinker/base.py:249: in send
    result = receiver(sender, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
        _async_wrapper = None
        kwargs     = {'identity': &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;}
        receiver   = &lt;bound method Principal._on_identity_changed of &lt;flask_principal.Principal object at 0x7fc5893e1d00&gt;&gt;
        results    = []
        self       = &lt;blinker.base.NamedSignal object at 0x7fc599cc31d0; 'identity-changed'&gt;
        sender     = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask_principal.py:469: in _on_identity_changed
    self.set_identity(identity)
        app        = &lt;Flask 'invenio'&gt;
        identity   = &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;
        self       = &lt;flask_principal.Principal object at 0x7fc5893e1d00&gt;
.venv/lib/python3.12/site-packages/flask_principal.py:418: in set_identity
    self._set_thread_identity(identity)
        identity   = &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;
        self       = &lt;flask_principal.Principal object at 0x7fc5893e1d00&gt;
.venv/lib/python3.12/site-packages/flask_principal.py:462: in _set_thread_identity
    identity_loaded.send(current_app._get_current_object(),
        identity   = &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;
        self       = &lt;flask_principal.Principal object at 0x7fc5893e1d00&gt;
.venv/lib/python3.12/site-packages/blinker/base.py:249: in send
    result = receiver(sender, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
        _async_wrapper = None
        kwargs     = {'identity': &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;}
        receiver   = &lt;function _on_identity_loaded at 0x7fc597c4e480&gt;
        results    = []
        self       = &lt;blinker.base.NamedSignal object at 0x7fc598575190; 'identity-loaded'&gt;
        sender     = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask_security/core.py:256: in _on_identity_loaded
    for role in getattr(current_user, "roles", []):
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        identity   = &lt;Identity id="8" auth_type="None" provides={Need(method='id', value=8)}&gt;
        sender     = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:569: in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        instance   = &lt;User 8&gt;
        owner      = &lt;class 'invenio_accounts.models.User'&gt;
        self       = &lt;sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x7fc59495f880&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:1096: in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        key        = 'roles'
        passive    = symbol('PASSIVE_OFF')
        self       = &lt;sqlalchemy.orm.attributes.CollectionAttributeImpl object at 0x7fc597435b10&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:1131: in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        key        = 'roles'
        passive    = symbol('PASSIVE_OFF')
        self       = &lt;sqlalchemy.orm.attributes.CollectionAttributeImpl object at 0x7fc597435b10&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py:978: in _load_for_state
    return self._emit_lazyload(
        alternate_effective_path = None
        execution_options = immutabledict({})
        extra_criteria = ()
        extra_options = ()
        loadopt    = None
        passive    = symbol('PASSIVE_OFF')
        pending    = False
        primary_key_identity = None
        self       = &lt;sqlalchemy.orm.strategies.LazyLoader object at 0x7fc597484820&gt;
        session    = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
        use_get    = False
.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py:1141: in _emit_lazyload
    result = session.execute(
        _lazyload_reverse = &lt;function LazyLoader._emit_lazyload.&lt;locals&gt;._lazyload_reverse at 0x7fc5884711c0&gt;
        alternate_effective_path = None
        clauseelement = Table('accounts_role', MetaData(), Column('id', String(length=80), table=&lt;accounts_role&gt;, primary_key=True, nullable=False, default=CallableColumnDefault(&lt;function Role.&lt;lambda&gt; at 0x7fc59499f9c0&gt;)), Column('name', String(length=80), table=&lt;accounts_role&gt;), Column('description', String(length=255), table=&lt;accounts_role&gt;), Column('is_managed', Boolean(), table=&lt;accounts_role&gt;, nullable=False, default=ScalarElementColumnDefault(True)), Column('version_id', Integer(), table=&lt;accounts_role&gt;, nullable=False), Column('created', DateTime(), table=&lt;accounts_role&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558ea0&gt;)), Column('updated', DateTime(), table=&lt;accounts_role&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558fe0&gt;)), schema=None)
        effective_path = PropRegistry((&lt;Mapper at 0x7fc596363b30; User&gt;, &lt;_RelationshipDeclared at 0x7fc59495d9f0; roles&gt;))
        execution_options = {'_sa_orm_load_options': default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;)}
        extra_criteria = ()
        extra_options = ()
        lazy_clause = &lt;sqlalchemy.sql.annotation.AnnotatedBooleanClauseList object at 0x7fc58d3abad0&gt;
        load_options = default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;)
        loadopt    = None
        params     = {'%(140486465528816 param)s': 8}
        passive    = symbol('PASSIVE_OFF')
        pending    = False
        primary_key_identity = None
        self       = &lt;sqlalchemy.orm.strategies.LazyLoader object at 0x7fc597484820&gt;
        session    = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
        stmt       = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;
        strategy_options = &lt;module 'sqlalchemy.orm.strategy_options' from '/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategy_options.py'&gt;
        use_get    = False
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;)}
        params     = {'%(140486465528816 param)s': 8}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2228: in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;,
 'mapper': &lt;Mapper at 0x7fc5963623c0; Role&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;)})
        params     = {'%(140486465528816 param)s': 8}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:577: in orm_pre_session_exec
    session._autoflush()
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;,
 'mapper': &lt;Mapper at 0x7fc5963623c0; Role&gt;}
        cls        = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;), '_result_disable_adapt_to_context': True})
        is_pre_event = False
        load_options = default_load_options(_invoke_all_eagers=False, _lazy_loaded_from=&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;)
        params     = {'%(140486465528816 param)s': 8}
        plugin_subject = &lt;Mapper at 0x7fc5963623c0; Role&gt;
        session    = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588550410&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:3040: in _autoflush
    self.flush()
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;,
 &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc588567ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7fc588542300&gt;
        exc_type   = &lt;class 'sqlalchemy.orm.exc.StaleDataError'&gt;
        exc_value  = StaleDataError("UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7fc588746470&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;,
 &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc588455df0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc588567ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[LoginInformation(accounts_user_login_information)]),
 DeleteAll(Mapper[User(accounts_user)]),
 ProcessAll(ManyToOneDP(LoginInformation.user), isdelete=False),
 ProcessAll(ManyToOneDP(LoginInformation.user), isdelete=True),
 ProcessAll(OneToManyDP(User.login_info), isdelete=False),
 ProcessAll(OneToManyDP(User.login_info), isdelete=True),
 SaveUpdateAll(Mapper[LoginInformation(accounts_user_login_information)]),
 SaveUpdateAll(Mapper[User(accounts_user)])]
        rec        = SaveUpdateAll(Mapper[User(accounts_user)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[User(accounts_user)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:85: in save_obj
    _emit_update_statements(
        base_mapper = &lt;Mapper at 0x7fc596363b30; User&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7fc588fc4d10&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
        has_identity = True
        insert     = &lt;generator object _collect_insert_commands at 0x7fc58907ad90&gt;
        mapper     = &lt;Mapper at 0x7fc596363b30; User&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7fc5884889a0&gt;
        states_to_insert = []
        states_to_update = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;},
  &lt;Mapper at 0x7fc596363b30; User&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7fc588fc4d10&gt;,
  2)]
        table      = Table('accounts_user', MetaData(), Column('id', Integer(), table=&lt;accounts_user&gt;, primary_key=True, nullable=False), Column('username', String(length=255), table=&lt;accounts_user&gt;), Column('displayname', String(length=255), table=&lt;accounts_user&gt;), Column('email', String(length=255), table=&lt;accounts_user&gt;), Column('domain', String(length=255), table=&lt;accounts_user&gt;), Column('password', String(length=255), table=&lt;accounts_user&gt;), Column('active', Boolean(name='active'), table=&lt;accounts_user&gt;), Column('confirmed_at', DateTime(), table=&lt;accounts_user&gt;), Column('version_id', Integer(), table=&lt;accounts_user&gt;, nullable=False), Column('profile', JSON(), table=&lt;accounts_user&gt;, default=CallableColumnDefault(&lt;function User.&lt;lambda&gt; at 0x7fc59495dbc0&gt;)), Column('preferences', JSON(), table=&lt;accounts_user&gt;, default=CallableColumnDefault(&lt;function User.&lt;lambda&gt; at 0x7fc59495dd00&gt;)), Column('blocked_at', DateTime(), table=&lt;accounts_user&gt;), Column('verified_at', DateTime(), table=&lt;accounts_user&gt;), Column('created', DateTime(), table=&lt;accounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558ea0&gt;)), Column('updated', DateTime(), table=&lt;accounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558fe0&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7fc588829300&gt;
        update_version_id = 2
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

base_mapper = &lt;Mapper at 0x7fc596363b30; User&gt;
uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
mapper = &lt;Mapper at 0x7fc596363b30; User&gt;
table = Table('accounts_user', MetaData(), Column('id', Integer(), table=&lt;accounts_user&gt;, primary_key=True, nullable=False), C...ounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558fe0&gt;)), schema=None)
update = &lt;generator object _collect_update_commands at 0x7fc588829300&gt;

    def _emit_update_statements(
        base_mapper,
        uowtransaction,
        mapper,
        table,
        update,
        *,
        bookkeeping=True,
        use_orm_update_stmt=None,
        enable_check_rowcount=True,
    ):
        """Emit UPDATE statements corresponding to value lists collected
        by _collect_update_commands()."""
    
        needs_version_id = (
            mapper.version_id_col is not None
            and mapper.version_id_col in mapper._cols_by_table[table]
        )
    
        execution_options = {"compiled_cache": base_mapper._compiled_cache}
    
        def update_stmt(existing_stmt=None):
            clauses = BooleanClauseList._construct_raw(operators.and_)
    
            for col in mapper._pks_by_table[table]:
                clauses._append_inplace(
                    col == sql.bindparam(col._label, type_=col.type)
                )
    
            if needs_version_id:
                clauses._append_inplace(
                    mapper.version_id_col
                    == sql.bindparam(
                        mapper.version_id_col._label,
                        type_=mapper.version_id_col.type,
                    )
                )
    
            if existing_stmt is not None:
                stmt = existing_stmt.where(clauses)
            else:
                stmt = table.update().where(clauses)
            return stmt
    
        if use_orm_update_stmt is not None:
            cached_stmt = update_stmt(use_orm_update_stmt)
    
        else:
            cached_stmt = base_mapper._memo(("update", table), update_stmt)
    
        for (
            (connection, paramkeys, hasvalue, has_all_defaults, has_all_pks),
            records,
        ) in groupby(
            update,
            lambda rec: (
                rec[4],  # connection
                set(rec[2]),  # set of parameter keys
                bool(rec[5]),  # whether or not we have "value" parameters
                rec[6],  # has_all_defaults
                rec[7],  # has all pks
            ),
        ):
            rows = 0
            records = list(records)
    
            statement = cached_stmt
    
            if use_orm_update_stmt is not None:
                statement = statement._annotate(
                    {
                        "_emit_update_table": table,
                        "_emit_update_mapper": mapper,
                    }
                )
    
            return_defaults = False
    
            if not has_all_pks:
                statement = statement.return_defaults(*mapper._pks_by_table[table])
                return_defaults = True
    
            if (
                bookkeeping
                and not has_all_defaults
                and mapper.base_mapper.eager_defaults is True
                # change as of #8889 - if RETURNING is not going to be used anyway,
                # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
                # we can do an executemany UPDATE which is more efficient
                and table.implicit_returning
                and connection.dialect.update_returning
            ):
                statement = statement.return_defaults(
                    *mapper._server_onupdate_default_cols[table]
                )
                return_defaults = True
    
            if mapper._version_id_has_server_side_value:
                statement = statement.return_defaults(mapper.version_id_col)
                return_defaults = True
    
            assert_singlerow = connection.dialect.supports_sane_rowcount
    
            assert_multirow = (
                assert_singlerow
                and connection.dialect.supports_sane_multi_rowcount
            )
    
            # change as of #8889 - if RETURNING is not going to be used anyway,
            # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
            # we can do an executemany UPDATE which is more efficient
            allow_executemany = not return_defaults and not needs_version_id
    
            if hasvalue:
                for (
                    state,
                    state_dict,
                    params,
                    mapper,
                    connection,
                    value_params,
                    has_all_defaults,
                    has_all_pks,
                ) in records:
                    c = connection.execute(
                        statement.values(value_params),
                        params,
                        execution_options=execution_options,
                    )
                    if bookkeeping:
                        _postfetch(
                            mapper,
                            uowtransaction,
                            table,
                            state,
                            state_dict,
                            c,
                            c.context.compiled_parameters[0],
                            value_params,
                            True,
                            c.returned_defaults,
                        )
                    rows += c.rowcount
                    check_rowcount = enable_check_rowcount and assert_singlerow
            else:
                if not allow_executemany:
                    check_rowcount = enable_check_rowcount and assert_singlerow
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        c = connection.execute(
                            statement, params, execution_options=execution_options
                        )
    
                        # TODO: why with bookkeeping=False?
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                c.returned_defaults,
                            )
                        rows += c.rowcount
                else:
                    multiparams = [rec[2] for rec in records]
    
                    check_rowcount = enable_check_rowcount and (
                        assert_multirow
                        or (assert_singlerow and len(multiparams) == 1)
                    )
    
                    c = connection.execute(
                        statement, multiparams, execution_options=execution_options
                    )
    
                    rows += c.rowcount
    
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                (
                                    c.returned_defaults
                                    if not c.context.executemany
                                    else None
                                ),
                            )
    
            if check_rowcount:
                if rows != len(records):
&gt;                   raise orm_exc.StaleDataError(
                        "UPDATE statement on table '%s' expected to "
                        "update %d row(s); %d were matched."
                        % (table.description, len(records), rows)
                    )
E                   sqlalchemy.orm.exc.StaleDataError: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.

allow_executemany = False
assert_multirow = True
assert_singlerow = True
base_mapper = &lt;Mapper at 0x7fc596363b30; User&gt;
bookkeeping = True
c          = &lt;sqlalchemy.engine.cursor.CursorResult object at 0x7fc5887f0d00&gt;
cached_stmt = &lt;sqlalchemy.sql.dml.Update object at 0x7fc58d39d580&gt;
check_rowcount = True
connection = &lt;sqlalchemy.engine.base.Connection object at 0x7fc588fc4d10&gt;
enable_check_rowcount = True
execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7fc58ca9b790&gt;}
has_all_defaults = True
has_all_pks = True
hasvalue   = False
mapper     = &lt;Mapper at 0x7fc596363b30; User&gt;
needs_version_id = True
paramkeys  = {'accounts_user_id', 'version_id', 'accounts_user_version_id', 'updated'}
params     = {'accounts_user_id': 8,
 'accounts_user_version_id': 2,
 'updated': datetime.datetime(2025, 12, 10, 9, 54, 35, 409943),
 'version_id': 3}
records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;},
  {'accounts_user_id': 8,
   'accounts_user_version_id': 2,
   'updated': datetime.datetime(2025, 12, 10, 9, 54, 35, 409943),
   'version_id': 3},
  &lt;Mapper at 0x7fc596363b30; User&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7fc588fc4d10&gt;,
  {},
  True,
  True)]
return_defaults = False
rows       = 0
state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;
state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7fc58922d310&gt;}
statement  = &lt;sqlalchemy.sql.dml.Update object at 0x7fc58d39d580&gt;
table      = Table('accounts_user', MetaData(), Column('id', Integer(), table=&lt;accounts_user&gt;, primary_key=True, nullable=False), Column('username', String(length=255), table=&lt;accounts_user&gt;), Column('displayname', String(length=255), table=&lt;accounts_user&gt;), Column('email', String(length=255), table=&lt;accounts_user&gt;), Column('domain', String(length=255), table=&lt;accounts_user&gt;), Column('password', String(length=255), table=&lt;accounts_user&gt;), Column('active', Boolean(name='active'), table=&lt;accounts_user&gt;), Column('confirmed_at', DateTime(), table=&lt;accounts_user&gt;), Column('version_id', Integer(), table=&lt;accounts_user&gt;, nullable=False), Column('profile', JSON(), table=&lt;accounts_user&gt;, default=CallableColumnDefault(&lt;function User.&lt;lambda&gt; at 0x7fc59495dbc0&gt;)), Column('preferences', JSON(), table=&lt;accounts_user&gt;, default=CallableColumnDefault(&lt;function User.&lt;lambda&gt; at 0x7fc59495dd00&gt;)), Column('blocked_at', DateTime(), table=&lt;accounts_user&gt;), Column('verified_at', DateTime(), table=&lt;accounts_user&gt;), Column('created', DateTime(), table=&lt;accounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558ea0&gt;)), Column('updated', DateTime(), table=&lt;accounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7fc596558fe0&gt;)), schema=None)
uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7fc58880f7a0&gt;
update     = &lt;generator object _collect_update_commands at 0x7fc588829300&gt;
update_stmt = &lt;function _emit_update_statements.&lt;locals&gt;.update_stmt at 0x7fc588471300&gt;
use_orm_update_stmt = None
value_params = {}

.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:948: StaleDataError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_drafts_html-/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
link_name = 'admin_drafts_html'
expected_url = '/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_url = '/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions'
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
link_name  = 'admin_drafts_html'
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub   = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc587582700&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc587582700&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5884e25c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc587582700&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5884e25c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc587582700&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5884e25c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc586bfce80&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc587582700&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5884e25c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5884e59d0&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5884e59d0&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5884e59d0&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc5884e59d0&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {}
        locations  = ('querystring', 'form', 'json')
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        data       = None
        error_headers = None
        error_status_code = None
        locations  = ('querystring', 'form', 'json')
        parsed     = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        parser     = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc5884e6fc0&gt;
        req        = &lt;Request 'http://localhost/' [GET]&gt;
        schema     = &lt;GeneratedSchema(many=False)&gt;
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
        validators = []
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        many       = None
        partial    = None
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5884e70e0&gt;
        errors     = {}
        many       = False
        partial    = None
        postprocess = True
        processed_data = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
        attr_name  = 'email'
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5884e70e0&gt;
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        getter     = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5884e3100&gt;
        index      = None
        index_errors = True
        many       = False
        partial    = None
        partial_is_collection = False
        raw_value  = 'user_moderator@inveniosoftware.org'
        ret_d      = {}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
        data       = 'user_moderator@inveniosoftware.org'
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5884e70e0&gt;
        field_name = 'email'
        getter_func = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5884e3100&gt;
        index      = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        val        = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
        attr       = 'email'
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        kwargs     = {}
        output     = 'user_moderator@inveniosoftware.org'
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
        errors     = []
        kwargs     = {}
        r          = 'user_moderator@inveniosoftware.org'
        self       = &lt;And(validators=(&lt;Email(error='Not a valid email address.')&gt;, &lt;function user_exists at 0x7fc58d494400&gt;), error='Invalid value.')&gt;
        validator  = &lt;function user_exists at 0x7fc58d494400&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        email      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        alchemyFn  = &lt;sqlalchemy.sql.functions._FunctionGenerator object at 0x7fc5977df050&gt;
        attr       = 'email'
        identifier = 'user_moderator@inveniosoftware.org'
        query      = &lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7fc588745f10&gt;
        self       = &lt;invenio_accounts.datastore.SessionAwareSQLAlchemyUserDatastore object at 0x7fc589304e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc58846f2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
        params     = immutabledict({})
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc588609bb0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc58846fef0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_legacy_uniquing=True)}
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc58846fef0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc58846fef0&gt;,
 'mapper': &lt;Mapper at 0x7fc596363b30; User&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_legacy_uniquing=True), '_result_disable_adapt_to_context': True})
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc58846fef0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        kw         = {}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
&lt;string&gt;:2: in _connection_for_bind
    ???
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
        arg        = (Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio), None)
        current_state = &lt;SessionTransactionState.DEACTIVE: 4&gt;
        expect_state_change = False
        fn         = &lt;function SessionTransaction._connection_for_bind at 0x7fc596668860&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;_StateChangeStates.NO_CHANGE: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

operation_name = '_connection_for_bind'
self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
state      = &lt;SessionTransactionState.DEACTIVE: 4&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_moderation_html-/administration/moderation?q=topic.user:{id}]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
link_name = 'admin_moderation_html'
expected_url = '/administration/moderation?q=topic.user:{id}'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_url = '/administration/moderation?q=topic.user:{id}'
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
link_name  = 'admin_moderation_html'
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
user_pub   = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58cac3010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58cac3010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5885172e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58cac3010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5885172e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58cac3010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5885172e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc5871df640&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58cac3010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5885172e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc588532360&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc588532360&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc588532360&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc588532360&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {}
        locations  = ('querystring', 'form', 'json')
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        data       = None
        error_headers = None
        error_status_code = None
        locations  = ('querystring', 'form', 'json')
        parsed     = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        parser     = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc588533770&gt;
        req        = &lt;Request 'http://localhost/' [GET]&gt;
        schema     = &lt;GeneratedSchema(many=False)&gt;
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
        validators = []
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        many       = None
        partial    = None
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc588533c80&gt;
        errors     = {}
        many       = False
        partial    = None
        postprocess = True
        processed_data = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
        attr_name  = 'email'
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc588533c80&gt;
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        getter     = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5884709a0&gt;
        index      = None
        index_errors = True
        many       = False
        partial    = None
        partial_is_collection = False
        raw_value  = 'user_moderator@inveniosoftware.org'
        ret_d      = {}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
        data       = 'user_moderator@inveniosoftware.org'
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc588533c80&gt;
        field_name = 'email'
        getter_func = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5884709a0&gt;
        index      = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        val        = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
        attr       = 'email'
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        kwargs     = {}
        output     = 'user_moderator@inveniosoftware.org'
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
        errors     = []
        kwargs     = {}
        r          = 'user_moderator@inveniosoftware.org'
        self       = &lt;And(validators=(&lt;Email(error='Not a valid email address.')&gt;, &lt;function user_exists at 0x7fc58d494400&gt;), error='Invalid value.')&gt;
        validator  = &lt;function user_exists at 0x7fc58d494400&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        email      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        alchemyFn  = &lt;sqlalchemy.sql.functions._FunctionGenerator object at 0x7fc5977df050&gt;
        attr       = 'email'
        identifier = 'user_moderator@inveniosoftware.org'
        query      = &lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7fc5885327b0&gt;
        self       = &lt;invenio_accounts.datastore.SessionAwareSQLAlchemyUserDatastore object at 0x7fc589304e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc588532f00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
        params     = immutabledict({})
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc588532a80&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588533110&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_legacy_uniquing=True)}
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588533110&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588533110&gt;,
 'mapper': &lt;Mapper at 0x7fc596363b30; User&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_legacy_uniquing=True), '_result_disable_adapt_to_context': True})
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588533110&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        kw         = {}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
&lt;string&gt;:2: in _connection_for_bind
    ???
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
        arg        = (Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio), None)
        current_state = &lt;SessionTransactionState.DEACTIVE: 4&gt;
        expect_state_change = False
        fn         = &lt;function SessionTransaction._connection_for_bind at 0x7fc596668860&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;_StateChangeStates.NO_CHANGE: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

operation_name = '_connection_for_bind'
self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
state      = &lt;SessionTransactionState.DEACTIVE: 4&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[user_moderator-True]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7fc589356240&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;, ...}
username = 'user_moderator', expected_admin_links = True

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_admin_links = True
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
user       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
username   = 'user_moderator'
users      = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;,
 'inactive': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893e0650&gt;,
 'notification_disabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589356240&gt;,
 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;,
 'pub': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;,
 'pubres': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892868d0&gt;,
 'res': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;,
 'unconfirmed': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928edb0&gt;,
 'user_moderator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;}

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'user_moderator@inveniosoftware.org',
          'password': 'user_moderator'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58856ef20&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58856ef20&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588ccb880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58856ef20&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588ccb880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58856ef20&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588ccb880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '64',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587da70c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc58856ef20&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc588ccb880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc58862b530&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc58862b530&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc58862b530&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc58862b530&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {}
        locations  = ('querystring', 'form', 'json')
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        data       = None
        error_headers = None
        error_status_code = None
        locations  = ('querystring', 'form', 'json')
        parsed     = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        parser     = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc589306480&gt;
        req        = &lt;Request 'http://localhost/' [GET]&gt;
        schema     = &lt;GeneratedSchema(many=False)&gt;
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
        validators = []
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        many       = None
        partial    = None
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58862b2f0&gt;
        errors     = {}
        many       = False
        partial    = None
        postprocess = True
        processed_data = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
        attr_name  = 'email'
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58862b2f0&gt;
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        getter     = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc589298720&gt;
        index      = None
        index_errors = True
        many       = False
        partial    = None
        partial_is_collection = False
        raw_value  = 'user_moderator@inveniosoftware.org'
        ret_d      = {}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
        data       = 'user_moderator@inveniosoftware.org'
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58862b2f0&gt;
        field_name = 'email'
        getter_func = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc589298720&gt;
        index      = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
        d_kwargs   = {}
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        val        = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
        attr       = 'email'
        data       = {'email': 'user_moderator@inveniosoftware.org', 'password': 'user_moderator'}
        kwargs     = {}
        output     = 'user_moderator@inveniosoftware.org'
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
        errors     = []
        kwargs     = {}
        r          = 'user_moderator@inveniosoftware.org'
        self       = &lt;And(validators=(&lt;Email(error='Not a valid email address.')&gt;, &lt;function user_exists at 0x7fc58d494400&gt;), error='Invalid value.')&gt;
        validator  = &lt;function user_exists at 0x7fc58d494400&gt;
        value      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        email      = 'user_moderator@inveniosoftware.org'
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        alchemyFn  = &lt;sqlalchemy.sql.functions._FunctionGenerator object at 0x7fc5977df050&gt;
        attr       = 'email'
        identifier = 'user_moderator@inveniosoftware.org'
        query      = &lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7fc588ce0f20&gt;
        self       = &lt;invenio_accounts.datastore.SessionAwareSQLAlchemyUserDatastore object at 0x7fc589304e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc588ce0c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
        params     = immutabledict({})
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc588ce0aa0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588ce0e30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_legacy_uniquing=True)}
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588ce0e30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588ce0e30&gt;,
 'mapper': &lt;Mapper at 0x7fc596363b30; User&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_legacy_uniquing=True), '_result_disable_adapt_to_context': True})
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc588ce0e30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        kw         = {}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
&lt;string&gt;:2: in _connection_for_bind
    ???
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
        arg        = (Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio), None)
        current_state = &lt;SessionTransactionState.DEACTIVE: 4&gt;
        expect_state_change = False
        fn         = &lt;function SessionTransaction._connection_for_bind at 0x7fc596668860&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;_StateChangeStates.NO_CHANGE: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

operation_name = '_connection_for_bind'
self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
state      = &lt;SessionTransactionState.DEACTIVE: 4&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[pub-False]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7fc589356240&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;, ...}
username = 'pub', expected_admin_links = False

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_admin_links = False
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
user       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
username   = 'pub'
users      = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;,
 'inactive': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893e0650&gt;,
 'notification_disabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589356240&gt;,
 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;,
 'pub': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;,
 'pubres': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892868d0&gt;,
 'res': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;,
 'unconfirmed': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928edb0&gt;,
 'user_moderator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;}

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'pub@inveniosoftware.org', 'password': 'pub'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'pub@inveniosoftware.org', 'password': 'pub'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589183010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589183010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5886402c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589183010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5886402c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589183010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5886402c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587b0a580&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589183010&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc5886402c0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5893a5040&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5893a5040&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc5893a5040&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc5893a5040&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {}
        locations  = ('querystring', 'form', 'json')
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        data       = None
        error_headers = None
        error_status_code = None
        locations  = ('querystring', 'form', 'json')
        parsed     = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        parser     = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc5893a7b90&gt;
        req        = &lt;Request 'http://localhost/' [GET]&gt;
        schema     = &lt;GeneratedSchema(many=False)&gt;
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
        validators = []
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
        data       = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        many       = None
        partial    = None
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
        data       = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5893a7800&gt;
        errors     = {}
        many       = False
        partial    = None
        postprocess = True
        processed_data = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
        attr_name  = 'email'
        d_kwargs   = {}
        data       = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5893a7800&gt;
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        getter     = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc588640400&gt;
        index      = None
        index_errors = True
        many       = False
        partial    = None
        partial_is_collection = False
        raw_value  = 'pub@inveniosoftware.org'
        ret_d      = {}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
        data       = 'pub@inveniosoftware.org'
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc5893a7800&gt;
        field_name = 'email'
        getter_func = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc588640400&gt;
        index      = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
        d_kwargs   = {}
        data       = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        val        = 'pub@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
        attr       = 'email'
        data       = {'email': 'pub@inveniosoftware.org', 'password': 'pub'}
        kwargs     = {}
        output     = 'pub@inveniosoftware.org'
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'pub@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'pub@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
        errors     = []
        kwargs     = {}
        r          = 'pub@inveniosoftware.org'
        self       = &lt;And(validators=(&lt;Email(error='Not a valid email address.')&gt;, &lt;function user_exists at 0x7fc58d494400&gt;), error='Invalid value.')&gt;
        validator  = &lt;function user_exists at 0x7fc58d494400&gt;
        value      = 'pub@inveniosoftware.org'
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        email      = 'pub@inveniosoftware.org'
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        alchemyFn  = &lt;sqlalchemy.sql.functions._FunctionGenerator object at 0x7fc5977df050&gt;
        attr       = 'email'
        identifier = 'pub@inveniosoftware.org'
        query      = &lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7fc5893a56a0&gt;
        self       = &lt;invenio_accounts.datastore.SessionAwareSQLAlchemyUserDatastore object at 0x7fc589304e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc589367860&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
        params     = immutabledict({})
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc589366990&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc589367c20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_legacy_uniquing=True)}
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc589367c20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc589367c20&gt;,
 'mapper': &lt;Mapper at 0x7fc596363b30; User&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_legacy_uniquing=True), '_result_disable_adapt_to_context': True})
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc589367c20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        kw         = {}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
&lt;string&gt;:2: in _connection_for_bind
    ???
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
        arg        = (Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio), None)
        current_state = &lt;SessionTransactionState.DEACTIVE: 4&gt;
        expect_state_change = False
        fn         = &lt;function SessionTransaction._connection_for_bind at 0x7fc596668860&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;_StateChangeStates.NO_CHANGE: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

operation_name = '_connection_for_bind'
self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
state      = &lt;SessionTransactionState.DEACTIVE: 4&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[res-False]" time="0.188"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7fc589356240&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;, ...}
username = 'res', expected_admin_links = False

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
expected_admin_links = False
headers    = {'accept': 'application/json', 'content-type': 'application/json'}
user       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;
username   = 'res'
users      = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589357260&gt;,
 'inactive': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893e0650&gt;,
 'notification_disabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589356240&gt;,
 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892eb170&gt;,
 'pub': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc589257620&gt;,
 'pubres': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5892868d0&gt;,
 'res': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;,
 'unconfirmed': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928edb0&gt;,
 'user_moderator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc58928c050&gt;}

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout_first = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
        base_path  = '/'
        client     = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
        logout     = False
        self       = &lt;pytest_invenio.user.UserFixtureBase object at 0x7fc5893a4140&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/login',)
        kw         = {'data': {'email': 'res@inveniosoftware.org', 'password': 'res'},
 'follow_redirects': True,
 'method': 'POST'}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/login',)
        buffered   = False
        follow_redirects = True
        kwargs     = {'data': {'email': 'res@inveniosoftware.org', 'password': 'res'},
 'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;},
 'method': 'POST'}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/login' [POST]&gt;
        args       = (&lt;Request 'http://localhost/login' [POST]&gt;,)
        buffered   = False
        follow_redirects = True
        kwargs     = {}
        request    = &lt;Request 'http://localhost/login' [POST]&gt;
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/login' [POST]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589180fe0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'invenio'&gt;
        buffer     = []
        buffered   = False
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589180fe0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc58cbe1760&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589180fe0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc58cbe1760&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589180fe0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc58cbe1760&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/login' [POST] of invenio&gt;
        environ    = {'CONTENT_LENGTH': '42',
 'CONTENT_TYPE': 'application/x-www-form-urlencoded',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.4',
 'PATH_INFO': '/login',
 'QUERY_STRING': '',
 'RAW_URI': '/login',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'POST',
 'REQUEST_URI': '/login',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fc587f6ca40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fc589180fe0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = PendingRollbackError("This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.")
        self       = &lt;Flask 'invenio'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fc58cbe1760&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'invenio'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/login' [POST]&gt;
        rule       = &lt;Rule '/login' (POST, OPTIONS) -&gt; invenio_accounts_rest_auth.login&gt;
        self       = &lt;Flask 'invenio'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc5892600e0&gt;
        kwargs     = {}
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        class_args = ()
        class_kwargs = {}
        kwargs     = {}
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc589366810&gt;
        view       = &lt;function View.as_view.&lt;locals&gt;.view at 0x7fc589280a40&gt;
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        kwargs     = {}
        meth       = &lt;bound method LoginView.post of &lt;invenio_accounts.views.rest.LoginView object at 0x7fc589366810&gt;&gt;
        self       = &lt;invenio_accounts.views.rest.LoginView object at 0x7fc589366810&gt;
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        args       = (&lt;invenio_accounts.views.rest.LoginView object at 0x7fc589366810&gt;,)
        as_kwargs  = True
        error_headers = None
        error_status_code = None
        func       = &lt;function LoginView.post at 0x7fc58d494fe0&gt;
        kwargs     = {}
        locations  = ('querystring', 'form', 'json')
        req_       = None
        req_obj    = None
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
        argmap     = &lt;GeneratedSchema(many=False)&gt;
        data       = None
        error_headers = None
        error_status_code = None
        locations  = ('querystring', 'form', 'json')
        parsed     = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        parser     = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc5884fb9e0&gt;
        req        = &lt;Request 'http://localhost/' [GET]&gt;
        schema     = &lt;GeneratedSchema(many=False)&gt;
        self       = &lt;invenio_accounts.views.rest.FlaskParser object at 0x7fc58d659df0&gt;
        validate   = None
        validators = []
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
        data       = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        many       = None
        partial    = None
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
        data       = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58931bad0&gt;
        errors     = {}
        many       = False
        partial    = None
        postprocess = True
        processed_data = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
        attr_name  = 'email'
        d_kwargs   = {}
        data       = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58931bad0&gt;
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        getter     = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5891653a0&gt;
        index      = None
        index_errors = True
        many       = False
        partial    = None
        partial_is_collection = False
        raw_value  = 'res@inveniosoftware.org'
        ret_d      = {}
        self       = &lt;GeneratedSchema(many=False)&gt;
        unknown    = 'raise'
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
        data       = 'res@inveniosoftware.org'
        error_store = &lt;marshmallow.error_store.ErrorStore object at 0x7fc58931bad0&gt;
        field_name = 'email'
        getter_func = &lt;function Schema._deserialize.&lt;locals&gt;.getter at 0x7fc5891653a0&gt;
        index      = None
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
        d_kwargs   = {}
        data       = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        field_name = 'email'
        field_obj  = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        val        = 'res@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
        attr       = 'email'
        data       = {'email': 'res@inveniosoftware.org', 'password': 'res'}
        kwargs     = {}
        output     = 'res@inveniosoftware.org'
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'res@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
        self       = &lt;fields.Email(dump_default=&lt;marshmallow.missing&gt;, attribute=None, validate=[&lt;function user_exists at 0x7fc58d494400&gt;], required=True, load_only=False, dump_only=False, load_default=&lt;marshmallow.missing&gt;, allow_none=False, error_messages={'required': 'Missing data for required field.', 'null': 'Field may not be null.', 'validator_failed': 'Invalid value.', 'invalid': 'Not a valid email address.', 'invalid_utf8': 'Not a valid utf-8 string.'})&gt;
        value      = 'res@inveniosoftware.org'
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
        errors     = []
        kwargs     = {}
        r          = 'res@inveniosoftware.org'
        self       = &lt;And(validators=(&lt;Email(error='Not a valid email address.')&gt;, &lt;function user_exists at 0x7fc58d494400&gt;), error='Invalid value.')&gt;
        validator  = &lt;function user_exists at 0x7fc58d494400&gt;
        value      = 'res@inveniosoftware.org'
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        email      = 'res@inveniosoftware.org'
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        alchemyFn  = &lt;sqlalchemy.sql.functions._FunctionGenerator object at 0x7fc5977df050&gt;
        attr       = 'email'
        identifier = 'res@inveniosoftware.org'
        query      = &lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7fc5884f99d0&gt;
        self       = &lt;invenio_accounts.datastore.SessionAwareSQLAlchemyUserDatastore object at 0x7fc589304e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc5884fbd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
        params     = immutabledict({})
        self       = &lt;flask_sqlalchemy.query.Query object at 0x7fc5884f92b0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc5884f9ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
        _add_event = None
        _parent_execute_state = None
        bind_arguments = None
        execution_options = {'_sa_orm_load_options': default_load_options(_legacy_uniquing=True)}
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc5884f9ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        _add_event = None
        _parent_execute_state = None
        _scalar_result = False
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        bind_arguments = {'clause': &lt;sqlalchemy.sql.selectable.Select object at 0x7fc5884f9ee0&gt;,
 'mapper': &lt;Mapper at 0x7fc596363b30; User&gt;}
        compile_state_cls = &lt;class 'sqlalchemy.orm.context.ORMSelectCompileState'&gt;
        events_todo = &lt;sqlalchemy.event.attr._EmptyListener object at 0x7fc58e552b40&gt;
        execution_options = immutabledict({'_sa_orm_load_options': default_load_options(_legacy_uniquing=True), '_result_disable_adapt_to_context': True})
        params     = immutabledict({})
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        statement  = &lt;sqlalchemy.sql.selectable.Select object at 0x7fc5884f9ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        kw         = {}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7fc5892ebef0&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
&lt;string&gt;:2: in _connection_for_bind
    ???
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        execution_options = None
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
        arg        = (Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio), None)
        current_state = &lt;SessionTransactionState.DEACTIVE: 4&gt;
        expect_state_change = False
        fn         = &lt;function SessionTransaction._connection_for_bind at 0x7fc596668860&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;_StateChangeStates.NO_CHANGE: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

operation_name = '_connection_for_bind'
self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7fc5891b0490&gt;
state      = &lt;SessionTransactionState.DEACTIVE: 4&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.services.test_generators" name="ISORT" time="0.014" /><testcase classname="tests.services.test_generators" name="black" time="0.181" /><testcase classname="tests.services.test_generators" name="test_group_not_managed_generator" time="1.999" /><testcase classname="tests.services.test_service_groups" name="ISORT" time="0.021" /><testcase classname="tests.services.test_service_groups" name="black" time="0.197" /><testcase classname="tests.services.test_service_groups" name="test_groups_sort" time="1.674" /><testcase classname="tests.services.test_service_groups" name="test_groups_no_facets" time="0.042" /><testcase classname="tests.services.test_service_groups" name="test_groups_fixed_pagination" time="0.043" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[id:it-dep]" time="0.066" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[name:IT Department]" time="0.045" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[+name:it]" time="0.045" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[IT]" time="0.043" /><testcase classname="tests.services.test_service_groups" name="test_groups_search" time="0.538" /><testcase classname="tests.services.test_service_groups" name="test_groups_read" time="0.287" /><testcase classname="tests.services.test_service_tasks_domains" name="ISORT" time="0.016" /><testcase classname="tests.services.test_service_tasks_domains" name="black" time="0.185" /><testcase classname="tests.services.test_service_tasks_domains" name="test_import_domain_blocklist" time="1.739" /><testcase classname="tests.services.test_service_tasks_domains" name="test_import_domain_blocklist_download_error" time="0.391" /><testcase classname="tests.services.users.test_service_users" name="ISORT" time="0.071" /><testcase classname="tests.services.users.test_service_users" name="black" time="0.260" /><testcase classname="tests.services.users.test_service_users" name="test_search_restricted" time="2.103" /><testcase classname="tests.services.users.test_service_users" name="test_search_public_users" time="0.411" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[affiliations:CERN]" time="0.398" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[affiliation:CERN]" time="0.391" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[name:Jose affiliation:CERN]" time="0.387" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[+name:Jose +affiliation:CERN]" time="0.170" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[CERN]" time="0.389" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Tim]" time="0.171" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Tim CERN]" time="0.379" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jose]" time="0.168" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jos]" time="0.172" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jose CERN]" time="0.386" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[email:pub@inveniosoftware.org]" time="0.169" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[username:pub]" time="0.276" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[res@inveniosoftware.org]" time="0.106" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[pubres@inveniosoftware.org]" time="0.089" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[Plazi0]" time="0.049" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[inactive]" time="0.058" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[unconfirmed]" time="0.058" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[restricted]" time="0.044" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[Plazi1]" time="0.039" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[test]" time="0.037" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[CERN]" time="0.419" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose CERN]" time="0.415" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose AND CERN]" time="0.414" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Tim]" time="0.258" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Tim CERN]" time="0.422" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose]" time="0.201" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jos]" time="0.182" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[pub@inveniosoftware.org]" time="0.224" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[pub]" time="0.402" /><testcase classname="tests.services.users.test_service_users" name="test_read_with_anon" time="0.086" /><testcase classname="tests.services.users.test_service_users" name="test_read_with_logged_in" time="0.558" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[pub]" time="0.186" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[pubres]" time="0.193" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[res]" time="0.192" /><testcase classname="tests.services.users.test_service_users" name="test_search_permissions" time="0.384" /><testcase classname="tests.services.users.test_service_users" name="test_create_permission_denied" time="0.772" /><testcase classname="tests.services.users.test_service_users" name="test_create_user" time="2.059" /><testcase classname="tests.services.users.test_service_users" name="test_create_user_errors" time="1.655" /><testcase classname="tests.services.users.test_service_users" name="test_block" time="1.190" /><testcase classname="tests.services.users.test_service_users" name="test_approve" time="1.123" /><testcase classname="tests.services.users.test_service_users" name="test_deactivate" time="0.519" /><testcase classname="tests.services.users.test_service_users" name="test_non_existent_user_management" time="0.213" /><testcase classname="tests.services.users.test_service_users" name="test_restore" time="0.793" /><testcase classname="tests.services.users.test_user_moderation" name="ISORT" time="0.038" /><testcase classname="tests.services.users.test_user_moderation" name="black" time="0.199" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_success" time="1.814" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_failure" time="0.257" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock" time="0.113" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock_renewal[1-10-True]" time="1.111" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock_renewal[2-2-False]" time="2.284" /><testcase classname="tests.test_invenio_users_resources" name="ISORT" time="0.013" /><testcase classname="tests.test_invenio_users_resources" name="black" time="0.175" /><testcase classname="tests.test_invenio_users_resources" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_users_resources" name="test_init" time="0.063" /><testcase classname="tests.test_notifications" name="ISORT" time="0.021" /><testcase classname="tests.test_notifications" name="black" time="0.185" /><testcase classname="tests.test_notifications" name="test_user_recipient_generator" time="1.655" /><testcase classname="tests.test_notifications" name="test_user_recipient_filter" time="0.182" /><testcase classname="invenio_users_resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_users_resources.__init__" name="black" time="0.177" /><testcase classname="invenio_users_resources.config" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_users_resources.config" name="ISORT" time="0.045" /><testcase classname="invenio_users_resources.config" name="black" time="0.215" /><testcase classname="invenio_users_resources.entity_resolvers" name="PYDOCSTYLE" time="0.020" /><testcase classname="invenio_users_resources.entity_resolvers" name="ISORT" time="0.037" /><testcase classname="invenio_users_resources.entity_resolvers" name="black" time="0.206" /><testcase classname="invenio_users_resources.ext" name="PYDOCSTYLE" time="0.380" /><testcase classname="invenio_users_resources.ext" name="ISORT" time="0.029" /><testcase classname="invenio_users_resources.ext" name="black" time="0.200" /><testcase classname="invenio_users_resources.forms" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.forms" name="ISORT" time="0.013" /><testcase classname="invenio_users_resources.forms" name="black" time="0.179" /><testcase classname="invenio_users_resources.models" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.models" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.models" name="black" time="0.179" /><testcase classname="invenio_users_resources.notifications.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.notifications.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.notifications.__init__" name="black" time="0.173" /><testcase classname="invenio_users_resources.notifications.filters" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.notifications.filters" name="ISORT" time="0.009" /><testcase classname="invenio_users_resources.notifications.filters" name="black" time="0.179" /><testcase classname="invenio_users_resources.notifications.generators" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_users_resources.notifications.generators" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.notifications.generators" name="black" time="0.191" /><testcase classname="invenio_users_resources.permissions" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.permissions" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.permissions" name="black" time="0.175" /><testcase classname="invenio_users_resources.proxies" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.proxies" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.proxies" name="black" time="0.183" /><testcase classname="invenio_users_resources.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.records.__init__" name="black" time="0.177" /><testcase classname="invenio_users_resources.records.api" name="PYDOCSTYLE" time="0.039" /><testcase classname="invenio_users_resources.records.api" name="ISORT" time="0.081" /><testcase classname="invenio_users_resources.records.api" name="black" time="0.270" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="black" time="0.178" /><testcase classname="invenio_users_resources.records.dumpers.email" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.records.dumpers.email" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.records.dumpers.email" name="black" time="0.182" /><testcase classname="invenio_users_resources.records.hooks" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.records.hooks" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.records.hooks" name="black" time="0.194" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="black" time="0.175" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="black" time="0.170" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="black" time="0.182" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="black" time="0.176" /><testcase classname="invenio_users_resources.records.models" name="PYDOCSTYLE" time="0.020" /><testcase classname="invenio_users_resources.records.models" name="ISORT" time="0.042" /><testcase classname="invenio_users_resources.records.models" name="black" time="0.216" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="PYDOCSTYLE" time="0.018" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="ISORT" time="0.033" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="black" time="0.202" /><testcase classname="invenio_users_resources.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.resources.__init__" name="black" time="0.180" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="black" time="0.182" /><testcase classname="invenio_users_resources.resources.domains.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.domains.config" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.resources.domains.config" name="black" time="0.174" /><testcase classname="invenio_users_resources.resources.domains.resource" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.domains.resource" name="ISORT" time="0.011" /><testcase classname="invenio_users_resources.resources.domains.resource" name="black" time="0.175" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="black" time="0.183" /><testcase classname="invenio_users_resources.resources.groups.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.groups.config" name="ISORT" time="0.013" /><testcase classname="invenio_users_resources.resources.groups.config" name="black" time="0.211" /><testcase classname="invenio_users_resources.resources.groups.resource" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_users_resources.resources.groups.resource" name="ISORT" time="0.021" /><testcase classname="invenio_users_resources.resources.groups.resource" name="black" time="0.195" /><testcase classname="invenio_users_resources.resources.users.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.users.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.resources.users.__init__" name="black" time="0.184" /><testcase classname="invenio_users_resources.resources.users.config" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_users_resources.resources.users.config" name="ISORT" time="0.020" /><testcase classname="invenio_users_resources.resources.users.config" name="black" time="0.196" /><testcase classname="invenio_users_resources.resources.users.errors" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.users.errors" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.resources.users.errors" name="black" time="0.177" /><testcase classname="invenio_users_resources.resources.users.resource" name="PYDOCSTYLE" time="0.018" /><testcase classname="invenio_users_resources.resources.users.resource" name="ISORT" time="0.038" /><testcase classname="invenio_users_resources.resources.users.resource" name="black" time="0.214" /><testcase classname="invenio_users_resources.services.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.services.__init__" name="black" time="0.178" /><testcase classname="invenio_users_resources.services.common" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.common" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.services.common" name="black" time="0.184" /><testcase classname="invenio_users_resources.services.domains.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.domains.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.services.domains.__init__" name="black" time="0.177" /><testcase classname="invenio_users_resources.services.domains.components" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.domains.components" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.services.domains.components" name="black" time="0.189" /><testcase classname="invenio_users_resources.services.domains.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.domains.config" name="ISORT" time="0.024" /><testcase classname="invenio_users_resources.services.domains.config" name="black" time="0.198" /><testcase classname="invenio_users_resources.services.domains.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.domains.facets" name="ISORT" time="0.014" /><testcase classname="invenio_users_resources.services.domains.facets" name="black" time="0.190" /><testcase classname="invenio_users_resources.services.domains.service" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.domains.service" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.services.domains.service" name="black" time="0.178" /><testcase classname="invenio_users_resources.services.domains.tasks" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_users_resources.services.domains.tasks" name="ISORT" time="0.024" /><testcase classname="invenio_users_resources.services.domains.tasks" name="black" time="0.198" /><testcase classname="invenio_users_resources.services.generators" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_users_resources.services.generators" name="ISORT" time="0.030" /><testcase classname="invenio_users_resources.services.generators" name="black" time="0.215" /><testcase classname="invenio_users_resources.services.groups.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.groups.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.services.groups.__init__" name="black" time="0.182" /><testcase classname="invenio_users_resources.services.groups.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.groups.config" name="ISORT" time="0.021" /><testcase classname="invenio_users_resources.services.groups.config" name="black" time="0.194" /><testcase classname="invenio_users_resources.services.groups.results" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_users_resources.services.groups.results" name="ISORT" time="0.024" /><testcase classname="invenio_users_resources.services.groups.results" name="black" time="0.209" /><testcase classname="invenio_users_resources.services.groups.service" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.groups.service" name="ISORT" time="0.016" /><testcase classname="invenio_users_resources.services.groups.service" name="black" time="0.182" /><testcase classname="invenio_users_resources.services.groups.tasks" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.groups.tasks" name="ISORT" time="0.013" /><testcase classname="invenio_users_resources.services.groups.tasks" name="black" time="0.185" /><testcase classname="invenio_users_resources.services.params" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.params" name="ISORT" time="0.011" /><testcase classname="invenio_users_resources.services.params" name="black" time="0.180" /><testcase classname="invenio_users_resources.services.permissions" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.services.permissions" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.services.permissions" name="black" time="0.193" /><testcase classname="invenio_users_resources.services.results" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.services.results" name="ISORT" time="0.017" /><testcase classname="invenio_users_resources.services.results" name="black" time="0.187" /><testcase classname="invenio_users_resources.services.schemas" name="PYDOCSTYLE" time="0.027" /><testcase classname="invenio_users_resources.services.schemas" name="ISORT" time="0.053" /><testcase classname="invenio_users_resources.services.schemas" name="black" time="0.243" /><testcase classname="invenio_users_resources.services.users.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.users.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.services.users.__init__" name="black" time="0.173" /><testcase classname="invenio_users_resources.services.users.config" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_users_resources.services.users.config" name="ISORT" time="0.045" /><testcase classname="invenio_users_resources.services.users.config" name="black" time="0.209" /><testcase classname="invenio_users_resources.services.users.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.users.facets" name="ISORT" time="0.014" /><testcase classname="invenio_users_resources.services.users.facets" name="black" time="0.182" /><testcase classname="invenio_users_resources.services.users.lock" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_users_resources.services.users.lock" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.services.users.lock" name="black" time="0.177" /><testcase classname="invenio_users_resources.services.users.results" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_users_resources.services.users.results" name="ISORT" time="0.030" /><testcase classname="invenio_users_resources.services.users.results" name="black" time="0.202" /><testcase classname="invenio_users_resources.services.users.search_params" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.services.users.search_params" name="ISORT" time="0.016" /><testcase classname="invenio_users_resources.services.users.search_params" name="black" time="0.192" /><testcase classname="invenio_users_resources.services.users.service" name="PYDOCSTYLE" time="0.026" /><testcase classname="invenio_users_resources.services.users.service" name="ISORT" time="0.055" /><testcase classname="invenio_users_resources.services.users.service" name="black" time="0.233" /><testcase classname="invenio_users_resources.services.users.tasks" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_users_resources.services.users.tasks" name="ISORT" time="0.028" /><testcase classname="invenio_users_resources.services.users.tasks" name="black" time="0.197" /><testcase classname="invenio_users_resources.views" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.views" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.views" name="black" time="0.177" /></testsuite></testsuites>