 redis Pulling 
 opensearch Pulling 
 postgresql Pulling 
 redis Pulled 
 postgresql Pulled 
 opensearch Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-redis-1  Creating
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-redis-1  Created
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-redis-1  Starting
 Container docker_services_cli-redis-1  Started
 Container docker_services_cli-postgresql-1  Started
 Container docker_services_cli-opensearch-1  Started
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/invenio-testrig/invenio-testrig/package-repo
configfile: setup.cfg
testpaths: docs, tests, invenio_requests
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, time-machine-2.19.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collected 418 items

docs/conf.py ...                                                         [  0%]
tests/conftest.py ...                                                    [  1%]
tests/customizations/test_request_types.py ....
.
                         [  2%]
tests/records/events/test_api.py ...
                                     [  3%]
tests/records/systemfields/conftest.py ...                               [  4%]
tests/records/systemfields/helpers.py ...                                [  4%]
tests/records/systemfields/test_calculated_systemfield.py ...
.
           [  5%]
tests/records/systemfields/test_last_activity_field.py ...
.
.
             [  6%]
tests/records/systemfields/test_last_reply_field.py ...
.
.
.
               [  8%]
tests/records/test_request_api.py ...
                                    [  9%]
tests/records/test_request_numberseq.py ...
                              [  9%]
tests/records/test_systemfield_relatedrecord.py ...
.
.
.
.
                  [ 11%]
tests/resources/events/conftest.py ...                                   [ 12%]
tests/resources/events/test_request_events_resources.py ...
.
.
            [ 13%]
tests/resources/requests/conftest.py ...                                 [ 14%]
tests/resources/requests/test_requests_resources.py ...
.
.
.
               [ 15%]
tests/resources/user_moderation/test_user_moderation_resources.py ...
.
.
. [ 16%]
.
.
.
.
.
.
.
                                                                  [ 18%]
tests/services/components/test_request_reviewers_component.py ...
.
.
.
.
.
.
. [ 21%]
.
.
.......                                                                [ 23%]
tests/services/conftest.py ...                                           [ 23%]
tests/services/events/conftest.py ...                                    [ 24%]
tests/services/events/test_event_permissions.py ...
.
.
.
.
                  [ 26%]
tests/services/events/test_request_events_service.py ...
.
.
.
.
.
.
.
.
.
        [ 29%]
tests/services/events/test_request_events_service_config.py ...
.         [ 30%]
tests/services/requests/test_request_permissions.py ...
.
.
.
.
.
.
.
.
.
.
.
       [ 33%]
tests/services/requests/test_request_search_permissions.py ...
           [ 34%]
tests/services/requests/test_requests_schemas.py ...
.
                    [ 35%]
tests/services/requests/test_requests_service.py ...
.
.
.
.
.
.
               [ 37%]
tests/services/requests/test_requests_service_config.py ...
.             [ 38%]
tests/services/requests/test_requests_tasks.py ...
                       [ 38%]
tests/services/user_moderation/test_user_moderation_service.py ...
.
.
.
.
.
. [ 41%]
                                                                         [ 41%]
tests/test_alembic.py ...
                                                [ 41%]
tests/test_invenio_requests.py ....                                      [ 42%]
tests/test_type_registry.py .....                                        [ 44%]
invenio_requests/__init__.py ...                                         [ 44%]
invenio_requests/alembic/1759321170_add_index_to_request_events_request_id_.py . [ 44%]
..                                                                       [ 45%]
invenio_requests/alembic/5cd30a3503c9_create_requests_branch.py ...      [ 46%]
invenio_requests/alembic/a14fa442680f_create_tables.py ...               [ 46%]
invenio_requests/config.py ...                                           [ 47%]
invenio_requests/customizations/__init__.py ...                          [ 48%]
invenio_requests/customizations/actions.py ...                           [ 49%]
invenio_requests/customizations/event_types.py ...                       [ 49%]
invenio_requests/customizations/request_types.py ...                     [ 50%]
invenio_requests/customizations/states.py ...                            [ 51%]
invenio_requests/customizations/user_moderation/__init__.py ...          [ 51%]
invenio_requests/customizations/user_moderation/user_moderation.py ...   [ 52%]
invenio_requests/errors.py ...                                           [ 53%]
invenio_requests/ext.py ...                                              [ 54%]
invenio_requests/notifications/__init__.py ...                           [ 54%]
invenio_requests/notifications/builders.py ...                           [ 55%]
invenio_requests/notifications/filters.py ...                            [ 56%]
invenio_requests/notifications/generators.py ...                         [ 56%]
invenio_requests/proxies.py ...                                          [ 57%]
invenio_requests/records/__init__.py ...                                 [ 58%]
invenio_requests/records/api.py ...                                      [ 59%]
invenio_requests/records/dumpers/__init__.py ...                         [ 59%]
invenio_requests/records/dumpers/calculated.py ...                       [ 60%]
invenio_requests/records/dumpers/granttokens.py ...                      [ 61%]
invenio_requests/records/jsonschemas/__init__.py ...                     [ 61%]
invenio_requests/records/mappings/__init__.py ...                        [ 62%]
invenio_requests/records/mappings/os-v1/__init__.py ...                  [ 63%]
invenio_requests/records/mappings/os-v2/__init__.py ...                  [ 64%]
invenio_requests/records/mappings/v7/__init__.py ...                     [ 64%]
invenio_requests/records/models.py ...                                   [ 65%]
invenio_requests/records/systemfields/__init__.py ...                    [ 66%]
invenio_requests/records/systemfields/computed.py ...                    [ 66%]
invenio_requests/records/systemfields/entity_reference.py ...            [ 67%]
invenio_requests/records/systemfields/event_type.py ...                  [ 68%]
invenio_requests/records/systemfields/expired_state.py ...               [ 69%]
invenio_requests/records/systemfields/identity.py ...                    [ 69%]
invenio_requests/records/systemfields/relatedrecord.py ...               [ 70%]
invenio_requests/records/systemfields/request_state.py ...               [ 71%]
invenio_requests/records/systemfields/request_type.py ...                [ 72%]
invenio_requests/records/systemfields/status.py ...                      [ 72%]
invenio_requests/registry.py ...                                         [ 73%]
invenio_requests/resolvers/__init__.py ...                               [ 74%]
invenio_requests/resolvers/registry.py ...                               [ 74%]
invenio_requests/resolvers/requests.py ...                               [ 75%]
invenio_requests/resources/__init__.py ...                               [ 76%]
invenio_requests/resources/events/__init__.py ...                        [ 77%]
invenio_requests/resources/events/config.py ...                          [ 77%]
invenio_requests/resources/events/resource.py ...                        [ 78%]
invenio_requests/resources/requests/__init__.py ...                      [ 79%]
invenio_requests/resources/requests/config.py ...                        [ 79%]
invenio_requests/resources/requests/fields.py ...                        [ 80%]
invenio_requests/resources/requests/resource.py ...                      [ 81%]
invenio_requests/services/__init__.py ...                                [ 82%]
invenio_requests/services/events/__init__.py ...                         [ 82%]
invenio_requests/services/events/config.py ...                           [ 83%]
invenio_requests/services/events/service.py ...                          [ 84%]
invenio_requests/services/generators.py ...                              [ 84%]
invenio_requests/services/permissions.py ...                             [ 85%]
invenio_requests/services/requests/__init__.py ...                       [ 86%]
invenio_requests/services/requests/components.py ...                     [ 87%]
invenio_requests/services/requests/config.py ...                         [ 87%]
invenio_requests/services/requests/facets.py ...                         [ 88%]
invenio_requests/services/requests/links.py ...                          [ 89%]
invenio_requests/services/requests/params.py ...                         [ 89%]
invenio_requests/services/requests/results.py ...                        [ 90%]
invenio_requests/services/requests/service.py ...                        [ 91%]
invenio_requests/services/results.py ...                                 [ 92%]
invenio_requests/services/schemas.py ...                                 [ 92%]
invenio_requests/services/user_moderation/__init__.py ...                [ 93%]
invenio_requests/services/user_moderation/errors.py ...                  [ 94%]
invenio_requests/services/user_moderation/service.py ...                 [ 94%]
invenio_requests/tasks.py ...                                            [ 95%]
invenio_requests/views/__init__.py ...                                   [ 96%]
invenio_requests/views/api.py ...                                        [ 97%]
invenio_requests/views/decorators.py ...                                 [ 97%]
invenio_requests/views/requests.py ...                                   [ 98%]
invenio_requests/views/ui.py ...                                         [ 99%]
invenio_requests/webpack.py ...                                          [100%]

=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
    from crypt import crypt as _crypt

.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
    from jsonschema import RefResolver as _RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/fs/__init__.py:4
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:3146
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

.venv/lib/python3.12/site-packages/fs/__init__.py:4
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/fs/opener/__init__.py:6
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:2558
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(parent)

.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
    from marshmallow import __version_info__ as marshmallow_version

.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154: RemovedInMarshmallow4Warning: The 'default' argument to fields is deprecated. Use 'dump_default' instead.
    storage_class = Str(default="L", dump_only=False)

    warnings.warn(

tests/customizations/test_request_types.py:33
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/customizations/test_request_types.py:33: PytestCollectionWarning: cannot collect test class 'TestAction' because it has a __init__ constructor (from: tests/customizations/test_request_types.py)
    class TestAction(RequestAction):

    self._confirmed = datetime.utcnow() if confirmed else None

    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py:235: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    return self.user_model.query.get(identifier)

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:90: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    valid_data = self.schema(context=context, **schema_args).load(data)

    target.updated = datetime.utcnow()

    self.init_app(app)

    self._set_cache(app, config)

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/marshmallow/fields.py:631: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    self._schema = schema_class(

tests/records/systemfields/test_calculated_systemfield.py::test_expired_systemfield
    now = datetime.utcnow()

tests/records/systemfields/test_calculated_systemfield.py::test_expired_systemfield
tests/services/requests/test_requests_tasks.py::test_check_expired_requests
    now = datetime.utcnow()

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    return self.schema(context=context, **schema_args).dump(data)

tests/records/test_systemfield_relatedrecord.py::test_no_assignment
tests/records/test_systemfield_relatedrecord.py::test_record_assignment
tests/records/test_systemfield_relatedrecord.py::test_id_assignment
tests/records/test_systemfield_relatedrecord.py::test_remove_assignment
tests/records/test_systemfield_relatedrecord.py::test_dump_created_by
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records/api.py:335: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():

    target.updated = datetime.utcnow()

    _security.datetime_factory(),

    created = datetime.utcnow()

    return cls(int(id_s, 16), datetime.utcfromtimestamp(int(created_s, 16)))

    now = now or datetime.utcnow()

    warn(

tests/resources/user_moderation/test_user_moderation_resources.py::test_moderate
tests/resources/user_moderation/test_user_moderation_resources.py::test_links
tests/resources/user_moderation/test_user_moderation_resources.py::test_links
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_accept
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_accept
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_decline
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_decline
    self._created = datetime.utcnow()

tests/resources/user_moderation/test_user_moderation_resources.py::test_moderate
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_accept
    now = datetime.utcnow()

tests/resources/user_moderation/test_user_moderation_resources.py::test_links
tests/services/user_moderation/test_user_moderation_service.py::test_moderation_decline
    now = datetime.utcnow()

tests/services/requests/test_requests_tasks.py::test_check_expired_requests
    now = datetime.utcnow()

tests/services/requests/test_requests_tasks.py::test_check_expired_requests
    now = datetime.utcnow().isoformat()

tests/test_alembic.py::test_alembic
    util.warn_deprecated(

tests/test_alembic.py::test_alembic
    current_date = datetime.utcnow()

tests/test_alembic.py::test_alembic
    super().alter_column(

tests/test_alembic.py::test_alembic
    insp = Inspector.from_engine(ctx.connection.engine)

tests/test_alembic.py::test_alembic
    insp = Inspector.from_engine(ctx.connection.engine)

- generated xml file: /home/runner/work/invenio-testrig/invenio-testrig/artifacts/test-report-patched.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                                                             Stmts   Miss  Cover   Missing
invenio_requests/__init__.py                                                         5      0   100%
invenio_requests/alembic/5cd30a3503c9_create_requests_branch.py                      8      0   100%
invenio_requests/alembic/1759321170_add_index_to_request_events_request_id_.py       9      0   100%
invenio_requests/alembic/a14fa442680f_create_tables.py                              18      0   100%
invenio_requests/config.py                                                          35      0   100%
invenio_requests/customizations/__init__.py                                          5      0   100%
invenio_requests/customizations/actions.py                                          64      1    98%   89
invenio_requests/customizations/event_types.py                                      65      5    92%   60-62, 67, 71
invenio_requests/customizations/request_types.py                                    84      9    89%   125, 171-176, 212-213, 256, 260
invenio_requests/customizations/states.py                                            5      0   100%
invenio_requests/customizations/user_moderation/__init__.py                          2      0   100%
invenio_requests/customizations/user_moderation/user_moderation.py                  29      0   100%
invenio_requests/errors.py                                                          14      0   100%
invenio_requests/ext.py                                                             66      2    97%   124, 133
invenio_requests/notifications/__init__.py                                           0      0   100%
invenio_requests/notifications/builders.py                                          18      0   100%
invenio_requests/notifications/filters.py                                           14      1    93%   28
invenio_requests/notifications/generators.py                                        33      1    97%   31
invenio_requests/proxies.py                                                         16      0   100%
invenio_requests/records/__init__.py                                                 3      0   100%
invenio_requests/records/api.py                                                     70      0   100%
invenio_requests/records/dumpers/__init__.py                                         3      0   100%
invenio_requests/records/dumpers/calculated.py                                      10      0   100%
invenio_requests/records/dumpers/granttokens.py                                     20      2    90%   36-37
invenio_requests/records/jsonschemas/__init__.py                                     0      0   100%
invenio_requests/records/mappings/__init__.py                                        0      0   100%
invenio_requests/records/mappings/os-v1/__init__.py                                  0      0   100%
invenio_requests/records/mappings/os-v2/__init__.py                                  0      0   100%
invenio_requests/records/mappings/v7/__init__.py                                     0      0   100%
invenio_requests/records/models.py                                                  45      0   100%
invenio_requests/records/systemfields/__init__.py                                    9      0   100%
invenio_requests/records/systemfields/computed.py                                   63      1    98%   120
invenio_requests/records/systemfields/entity_reference.py                           15      0   100%
invenio_requests/records/systemfields/event_type.py                                 48      2    96%   32, 62
invenio_requests/records/systemfields/expired_state.py                              14      1    93%   36
invenio_requests/records/systemfields/identity.py                                   11      2    82%   20-21
invenio_requests/records/systemfields/relatedrecord.py                              94     19    80%   32-34, 42-44, 52-53, 60-62, 131-132, 151-154, 165-166, 178
invenio_requests/records/systemfields/request_state.py                              10      0   100%
invenio_requests/records/systemfields/request_type.py                               30      1    97%   41
invenio_requests/records/systemfields/status.py                                     11      0   100%
invenio_requests/registry.py                                                        17      0   100%
invenio_requests/resolvers/__init__.py                                               1      0   100%
invenio_requests/resolvers/registry.py                                               6      0   100%
invenio_requests/resolvers/requests.py                                              15      4    73%   28, 37, 47, 56
invenio_requests/resources/__init__.py                                               3      0   100%
invenio_requests/resources/events/__init__.py                                        3      0   100%
invenio_requests/resources/events/config.py                                          9      0   100%
invenio_requests/resources/events/resource.py                                       49      0   100%
invenio_requests/resources/requests/__init__.py                                      3      0   100%
invenio_requests/resources/requests/config.py                                       22      0   100%
invenio_requests/resources/requests/fields.py                                       16      6    62%   30, 32, 41-46
invenio_requests/resources/requests/resource.py                                     57      6    89%   85-91, 113-119, 125-129
invenio_requests/services/__init__.py                                                4      0   100%
invenio_requests/services/events/__init__.py                                         3      0   100%
invenio_requests/services/events/config.py                                          37      0   100%
invenio_requests/services/events/service.py                                         99      3    97%   153, 287, 300
invenio_requests/services/generators.py                                             85      9    89%   48, 73, 111, 140, 171, 177, 184, 194, 198
invenio_requests/services/permissions.py                                            20      0   100%
invenio_requests/services/requests/__init__.py                                       6      0   100%
invenio_requests/services/requests/components.py                                    85      5    94%   171-180
invenio_requests/services/requests/config.py                                        39      0   100%
invenio_requests/services/requests/facets.py                                         5      0   100%
invenio_requests/services/requests/links.py                                         28      0   100%
invenio_requests/services/requests/params.py                                        57     11    81%   33, 59, 80, 82, 109-123, 136-137
invenio_requests/services/requests/results.py                                       84      9    89%   53, 63, 74, 88-90, 97, 103, 118
invenio_requests/services/requests/service.py                                       88      1    99%   49
invenio_requests/services/results.py                                                50     20    60%   32, 62-63, 67, 80-83, 88-90, 95-101, 105-107
invenio_requests/services/schemas.py                                                39      0   100%
invenio_requests/services/user_moderation/__init__.py                                2      0   100%
invenio_requests/services/user_moderation/errors.py                                  5      0   100%
invenio_requests/services/user_moderation/service.py                                36      1    97%   98
invenio_requests/tasks.py                                                           25      7    72%   47-49, 61-66
invenio_requests/views/__init__.py                                                   5      0   100%
invenio_requests/views/api.py                                                        6      0   100%
invenio_requests/views/decorators.py                                                13      9    31%   21-34
invenio_requests/views/requests.py                                                   0      0   100%
invenio_requests/views/ui.py                                                        19      5    74%   23, 28, 33-36
invenio_requests/webpack.py                                                          2      0   100%
TOTAL                                                                             1989    143    93%
================ 418 passed, 2112 warnings in 114.75s (0:01:54) ================
 Container docker_services_cli-redis-1  Stopping
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-redis-1  Stopped
 Container docker_services_cli-redis-1  Removing
 Container docker_services_cli-redis-1  Removed
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
