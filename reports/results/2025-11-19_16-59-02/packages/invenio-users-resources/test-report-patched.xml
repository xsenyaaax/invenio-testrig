<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="6" skipped="0" tests="302" time="65.854" timestamp="2025-11-19T17:06:04.668096+00:00" hostname="runnervmg1sw1"><testcase classname="docs.conf" name="PYDOCSTYLE" time="0.012" /><testcase classname="docs.conf" name="ISORT" time="0.150" /><testcase classname="docs.conf" name="black" time="0.311" /><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.039" /><testcase classname="tests.conftest" name="ISORT" time="0.088" /><testcase classname="tests.conftest" name="black" time="0.244" /><testcase classname="tests.resources.test_resources_domains" name="ISORT" time="0.034" /><testcase classname="tests.resources.test_resources_domains" name="black" time="0.204" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_access" time="2.955" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_search" time="0.156" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_read" time="0.078" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_delete" time="0.114" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create" time="0.141" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json0]" time="0.056" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json1]" time="0.053" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json2]" time="0.058" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_create_failure[400-json3]" time="0.057" /><testcase classname="tests.resources.test_resources_domains" name="test_domains_update" time="0.343" /><testcase classname="tests.resources.test_resources_groups" name="ISORT" time="0.007" /><testcase classname="tests.resources.test_resources_groups" name="black" time="0.161" /><testcase classname="tests.resources.test_resources_groups" name="test_group_avatar" time="1.976" /><testcase classname="tests.resources.test_resources_users" name="ISORT" time="0.052" /><testcase classname="tests.resources.test_resources_users" name="black" time="0.237" /><testcase classname="tests.resources.test_resources_users" name="test_read_self_serialization" time="2.043" /><testcase classname="tests.resources.test_resources_users" name="test_read_anon_serialization" time="0.029" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[pub]" time="0.270" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[pubres]" time="0.260" /><testcase classname="tests.resources.test_resources_users" name="test_read_logged_in_serialization[res]" time="0.049" /><testcase classname="tests.resources.test_resources_users" name="test_user_avatar" time="0.088" /><testcase classname="tests.resources.test_resources_users" name="test_user_avatar_non_ascii" time="0.054" /><testcase classname="tests.resources.test_resources_users" name="test_create_user" time="1.255" /><testcase classname="tests.resources.test_resources_users" name="test_approve_user" time="0.458" /><testcase classname="tests.resources.test_resources_users" name="test_block_user" time="0.578" /><testcase classname="tests.resources.test_resources_users" name="test_deactivate_user" time="0.723" /><testcase classname="tests.resources.test_resources_users" name="test_management_permissions" time="0.238" /><testcase classname="tests.resources.test_resources_users" name="test_impersonate_user" time="0.735" /><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_records_html-/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions]" time="0.027"><failure message="sqlalchemy.orm.exc.StaleDataError: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b0507620&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b47e7b90&gt;
link_name = 'admin_records_html'
expected_url = '/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:455: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:278: in post
    self.login_user(user)
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:268: in login_user
    return login_user(user)
           ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/utils.py:99: in login_user
    identity_changed.send(current_app._get_current_object(), identity=Identity(user.id))
.venv/lib/python3.12/site-packages/blinker/base.py:249: in send
    result = receiver(sender, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_principal.py:469: in _on_identity_changed
    self.set_identity(identity)
.venv/lib/python3.12/site-packages/flask_principal.py:418: in set_identity
    self._set_thread_identity(identity)
.venv/lib/python3.12/site-packages/flask_principal.py:462: in _set_thread_identity
    identity_loaded.send(current_app._get_current_object(),
.venv/lib/python3.12/site-packages/blinker/base.py:249: in send
    result = receiver(sender, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/core.py:256: in _on_identity_loaded
    for role in getattr(current_user, "roles", []):
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:569: in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:1096: in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py:1131: in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py:978: in _load_for_state
    return self._emit_lazyload(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py:1141: in _emit_lazyload
    result = session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2228: in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:577: in orm_pre_session_exec
    session._autoflush()
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:3040: in _autoflush
    self.flush()
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:85: in save_obj
    _emit_update_statements(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

base_mapper = &lt;Mapper at 0x7f83bd53b890; User&gt;
uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f83af8c7800&gt;
mapper = &lt;Mapper at 0x7f83bd53b890; User&gt;
table = Table('accounts_user', MetaData(), Column('id', Integer(), table=&lt;accounts_user&gt;, primary_key=True, nullable=False), C...ounts_user&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f83bd767a60&gt;)), schema=None)
update = &lt;generator object _collect_update_commands at 0x7f83af7f09a0&gt;

    def _emit_update_statements(
        base_mapper,
        uowtransaction,
        mapper,
        table,
        update,
        *,
        bookkeeping=True,
        use_orm_update_stmt=None,
        enable_check_rowcount=True,
    ):
        """Emit UPDATE statements corresponding to value lists collected
        by _collect_update_commands()."""
    
        needs_version_id = (
            mapper.version_id_col is not None
            and mapper.version_id_col in mapper._cols_by_table[table]
        )
    
        execution_options = {"compiled_cache": base_mapper._compiled_cache}
    
        def update_stmt(existing_stmt=None):
            clauses = BooleanClauseList._construct_raw(operators.and_)
    
            for col in mapper._pks_by_table[table]:
                clauses._append_inplace(
                    col == sql.bindparam(col._label, type_=col.type)
                )
    
            if needs_version_id:
                clauses._append_inplace(
                    mapper.version_id_col
                    == sql.bindparam(
                        mapper.version_id_col._label,
                        type_=mapper.version_id_col.type,
                    )
                )
    
            if existing_stmt is not None:
                stmt = existing_stmt.where(clauses)
            else:
                stmt = table.update().where(clauses)
            return stmt
    
        if use_orm_update_stmt is not None:
            cached_stmt = update_stmt(use_orm_update_stmt)
    
        else:
            cached_stmt = base_mapper._memo(("update", table), update_stmt)
    
        for (
            (connection, paramkeys, hasvalue, has_all_defaults, has_all_pks),
            records,
        ) in groupby(
            update,
            lambda rec: (
                rec[4],  # connection
                set(rec[2]),  # set of parameter keys
                bool(rec[5]),  # whether or not we have "value" parameters
                rec[6],  # has_all_defaults
                rec[7],  # has all pks
            ),
        ):
            rows = 0
            records = list(records)
    
            statement = cached_stmt
    
            if use_orm_update_stmt is not None:
                statement = statement._annotate(
                    {
                        "_emit_update_table": table,
                        "_emit_update_mapper": mapper,
                    }
                )
    
            return_defaults = False
    
            if not has_all_pks:
                statement = statement.return_defaults(*mapper._pks_by_table[table])
                return_defaults = True
    
            if (
                bookkeeping
                and not has_all_defaults
                and mapper.base_mapper.eager_defaults is True
                # change as of #8889 - if RETURNING is not going to be used anyway,
                # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
                # we can do an executemany UPDATE which is more efficient
                and table.implicit_returning
                and connection.dialect.update_returning
            ):
                statement = statement.return_defaults(
                    *mapper._server_onupdate_default_cols[table]
                )
                return_defaults = True
    
            if mapper._version_id_has_server_side_value:
                statement = statement.return_defaults(mapper.version_id_col)
                return_defaults = True
    
            assert_singlerow = connection.dialect.supports_sane_rowcount
    
            assert_multirow = (
                assert_singlerow
                and connection.dialect.supports_sane_multi_rowcount
            )
    
            # change as of #8889 - if RETURNING is not going to be used anyway,
            # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
            # we can do an executemany UPDATE which is more efficient
            allow_executemany = not return_defaults and not needs_version_id
    
            if hasvalue:
                for (
                    state,
                    state_dict,
                    params,
                    mapper,
                    connection,
                    value_params,
                    has_all_defaults,
                    has_all_pks,
                ) in records:
                    c = connection.execute(
                        statement.values(value_params),
                        params,
                        execution_options=execution_options,
                    )
                    if bookkeeping:
                        _postfetch(
                            mapper,
                            uowtransaction,
                            table,
                            state,
                            state_dict,
                            c,
                            c.context.compiled_parameters[0],
                            value_params,
                            True,
                            c.returned_defaults,
                        )
                    rows += c.rowcount
                    check_rowcount = enable_check_rowcount and assert_singlerow
            else:
                if not allow_executemany:
                    check_rowcount = enable_check_rowcount and assert_singlerow
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        c = connection.execute(
                            statement, params, execution_options=execution_options
                        )
    
                        # TODO: why with bookkeeping=False?
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                c.returned_defaults,
                            )
                        rows += c.rowcount
                else:
                    multiparams = [rec[2] for rec in records]
    
                    check_rowcount = enable_check_rowcount and (
                        assert_multirow
                        or (assert_singlerow and len(multiparams) == 1)
                    )
    
                    c = connection.execute(
                        statement, multiparams, execution_options=execution_options
                    )
    
                    rows += c.rowcount
    
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                (
                                    c.returned_defaults
                                    if not c.context.executemany
                                    else None
                                ),
                            )
    
            if check_rowcount:
                if rows != len(records):
&gt;                   raise orm_exc.StaleDataError(
                        "UPDATE statement on table '%s' expected to "
                        "update %d row(s); %d were matched."
                        % (table.description, len(records), rows)
                    )
E                   sqlalchemy.orm.exc.StaleDataError: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched.

.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:948: StaleDataError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_drafts_html-/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b0507620&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b47e7b90&gt;
link_name = 'admin_drafts_html'
expected_url = '/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;string&gt;:2: in _connection_for_bind
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f83b004b410&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links[admin_moderation_html-/administration/moderation?q=topic.user:{id}]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
user_moderator = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b0507620&gt;
user_pub = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b47e7b90&gt;
link_name = 'admin_moderation_html'
expected_url = '/administration/moderation?q=topic.user:{id}'

    @pytest.mark.parametrize(
        "link_name,expected_url",
        [
            (
                "admin_records_html",
                "/administration/records?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            (
                "admin_drafts_html",
                "/administration/drafts?q=parent.access.owned_by.user:{id}&amp;f=allversions",
            ),
            ("admin_moderation_html", "/administration/moderation?q=topic.user:{id}"),
        ],
    )
    def test_admin_links(
        client, headers, user_moderator, user_pub, link_name, expected_url
    ):
        """Test admin links."""
&gt;       client = user_moderator.login(client)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;string&gt;:2: in _connection_for_bind
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f83b004b410&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[user_moderator-True]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b055ae40&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7f83b3d4b6e0&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b05053a0&gt;, ...}
username = 'user_moderator', expected_admin_links = True

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;string&gt;:2: in _connection_for_bind
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f83b004b410&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[pub-False]" time="0.004"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b055ae40&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7f83b3d4b6e0&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b05053a0&gt;, ...}
username = 'pub', expected_admin_links = False

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;string&gt;:2: in _connection_for_bind
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f83b004b410&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.resources.test_resources_users" name="test_admin_links_visibility[res-False]" time="0.169"><failure message="sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
users = {'accented': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b055ae40&gt;, 'inactive': &lt;pytest_invenio.user.UserFixt...object at 0x7f83b3d4b6e0&gt;, 'notification_enabled': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f83b05053a0&gt;, ...}
username = 'res', expected_admin_links = False

    @pytest.mark.parametrize(
        "username,expected_admin_links",
        [
            ("user_moderator", True),  # user_moderator should have admin links
            ("pub", False),  # regular user should not have admin links
            ("res", False),  # regular user should not have admin links
        ],
    )
    def test_admin_links_visibility(client, headers, users, username, expected_admin_links):
        """Test admin links visibility based on user permissions."""
        user = users[username]
&gt;       client = user.login(client)
                 ^^^^^^^^^^^^^^^^^^

tests/resources/test_resources_users.py:303: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:152: in login
    return self._login(client, "/", logout_first)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/pytest_invenio/user.py:170: in _login
    res = client.post(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:61: in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:110: in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/views.py:191: in dispatch_request
    return current_app.ensure_sync(meth)(**kwargs)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/webargs/core.py:445: in wrapper
    parsed_args = self.parse(
.venv/lib/python3.12/site-packages/webargs/core.py:356: in parse
    result = schema.load(parsed)
             ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:792: in load
    return self._do_load(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:951: in _do_load
    result = self._deserialize(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:734: in _deserialize
    value = self._call_and_store(
.venv/lib/python3.12/site-packages/marshmallow/schema.py:570: in _call_and_store
    value = getter_func(data)
            ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:727: in getter
    return field_obj.deserialize(
.venv/lib/python3.12/site-packages/marshmallow/fields.py:375: in deserialize
    self._validate(output)
.venv/lib/python3.12/site-packages/marshmallow/fields.py:276: in _validate
    self._validate_all(value)
.venv/lib/python3.12/site-packages/marshmallow/validate.py:82: in __call__
    r = validator(value)
        ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_accounts/views/rest.py:187: in user_exists
    if not current_datastore.get_user(email):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: in get_user
    rv = self.user_model.query.filter(query).first()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;string&gt;:2: in _connection_for_bind
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f83b004b410&gt;
operation_name = '_connection_for_bind'
state = &lt;SessionTransactionState.DEACTIVE: 4&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
&gt;               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: UPDATE statement on table 'accounts_user' expected to update 1 row(s); 0 were matched. (Background on this error at: https://sqlalche.me/e/20/7s2a)

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:971: PendingRollbackError</failure></testcase><testcase classname="tests.services.test_generators" name="ISORT" time="0.013" /><testcase classname="tests.services.test_generators" name="black" time="0.167" /><testcase classname="tests.services.test_generators" name="test_group_not_managed_generator" time="1.865" /><testcase classname="tests.services.test_service_groups" name="ISORT" time="0.020" /><testcase classname="tests.services.test_service_groups" name="black" time="0.184" /><testcase classname="tests.services.test_service_groups" name="test_groups_sort" time="1.339" /><testcase classname="tests.services.test_service_groups" name="test_groups_no_facets" time="0.039" /><testcase classname="tests.services.test_service_groups" name="test_groups_fixed_pagination" time="0.037" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[id:it-dep]" time="0.057" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[name:IT Department]" time="0.041" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[+name:it]" time="0.037" /><testcase classname="tests.services.test_service_groups" name="test_groups_search_field[IT]" time="0.037" /><testcase classname="tests.services.test_service_groups" name="test_groups_search" time="0.476" /><testcase classname="tests.services.test_service_groups" name="test_groups_read" time="0.259" /><testcase classname="tests.services.test_service_tasks_domains" name="ISORT" time="0.015" /><testcase classname="tests.services.test_service_tasks_domains" name="black" time="0.170" /><testcase classname="tests.services.test_service_tasks_domains" name="test_import_domain_blocklist" time="1.842" /><testcase classname="tests.services.test_service_tasks_domains" name="test_import_domain_blocklist_download_error" time="0.364" /><testcase classname="tests.services.users.test_service_users" name="ISORT" time="0.068" /><testcase classname="tests.services.users.test_service_users" name="black" time="0.242" /><testcase classname="tests.services.users.test_service_users" name="test_search_restricted" time="1.949" /><testcase classname="tests.services.users.test_service_users" name="test_search_public_users" time="0.382" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[affiliations:CERN]" time="0.370" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[affiliation:CERN]" time="0.349" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[name:Jose affiliation:CERN]" time="0.349" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[+name:Jose +affiliation:CERN]" time="0.163" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[CERN]" time="0.354" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Tim]" time="0.157" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Tim CERN]" time="0.366" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jose]" time="0.153" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jos]" time="0.163" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[Jose CERN]" time="0.369" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[email:pub@inveniosoftware.org]" time="0.153" /><testcase classname="tests.services.users.test_service_users" name="test_admin_search_field[username:pub]" time="0.252" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[res@inveniosoftware.org]" time="0.129" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[pubres@inveniosoftware.org]" time="0.067" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[Plazi0]" time="0.037" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[inactive]" time="0.045" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[unconfirmed]" time="0.063" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[restricted]" time="0.050" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[Plazi1]" time="0.033" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field_not_searchable[test]" time="0.032" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[CERN]" time="0.383" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose CERN]" time="0.386" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose AND CERN]" time="0.380" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Tim]" time="0.246" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Tim CERN]" time="0.387" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jose]" time="0.179" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[Jos]" time="0.178" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[pub@inveniosoftware.org]" time="0.212" /><testcase classname="tests.services.users.test_service_users" name="test_user_search_field[pub]" time="0.379" /><testcase classname="tests.services.users.test_service_users" name="test_read_with_anon" time="0.077" /><testcase classname="tests.services.users.test_service_users" name="test_read_with_logged_in" time="0.513" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[pub]" time="0.172" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[pubres]" time="0.178" /><testcase classname="tests.services.users.test_service_users" name="test_read_self[res]" time="0.184" /><testcase classname="tests.services.users.test_service_users" name="test_search_permissions" time="0.353" /><testcase classname="tests.services.users.test_service_users" name="test_create_permission_denied" time="0.697" /><testcase classname="tests.services.users.test_service_users" name="test_create_user" time="1.741" /><testcase classname="tests.services.users.test_service_users" name="test_create_user_errors" time="1.542" /><testcase classname="tests.services.users.test_service_users" name="test_block" time="1.335" /><testcase classname="tests.services.users.test_service_users" name="test_approve" time="0.999" /><testcase classname="tests.services.users.test_service_users" name="test_deactivate" time="0.487" /><testcase classname="tests.services.users.test_service_users" name="test_non_existent_user_management" time="0.187" /><testcase classname="tests.services.users.test_service_users" name="test_restore" time="0.696" /><testcase classname="tests.services.users.test_user_moderation" name="ISORT" time="0.034" /><testcase classname="tests.services.users.test_user_moderation" name="black" time="0.183" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_success" time="1.628" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_failure" time="0.231" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock" time="0.096" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock_renewal[1-10-True]" time="1.099" /><testcase classname="tests.services.users.test_user_moderation" name="test_moderation_callbacks_lock_renewal[2-2-False]" time="2.260" /><testcase classname="tests.test_invenio_users_resources" name="ISORT" time="0.012" /><testcase classname="tests.test_invenio_users_resources" name="black" time="0.162" /><testcase classname="tests.test_invenio_users_resources" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_users_resources" name="test_init" time="0.064" /><testcase classname="tests.test_notifications" name="ISORT" time="0.021" /><testcase classname="tests.test_notifications" name="black" time="0.172" /><testcase classname="tests.test_notifications" name="test_user_recipient_generator" time="1.511" /><testcase classname="tests.test_notifications" name="test_user_recipient_filter" time="0.153" /><testcase classname="invenio_users_resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_users_resources.__init__" name="black" time="0.160" /><testcase classname="invenio_users_resources.config" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_users_resources.config" name="ISORT" time="0.045" /><testcase classname="invenio_users_resources.config" name="black" time="0.199" /><testcase classname="invenio_users_resources.entity_resolvers" name="PYDOCSTYLE" time="0.020" /><testcase classname="invenio_users_resources.entity_resolvers" name="ISORT" time="0.036" /><testcase classname="invenio_users_resources.entity_resolvers" name="black" time="0.193" /><testcase classname="invenio_users_resources.ext" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_users_resources.ext" name="ISORT" time="0.028" /><testcase classname="invenio_users_resources.ext" name="black" time="0.188" /><testcase classname="invenio_users_resources.forms" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.forms" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.forms" name="black" time="0.164" /><testcase classname="invenio_users_resources.models" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.models" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.models" name="black" time="0.166" /><testcase classname="invenio_users_resources.notifications.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.notifications.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.notifications.__init__" name="black" time="0.157" /><testcase classname="invenio_users_resources.notifications.filters" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.notifications.filters" name="ISORT" time="0.009" /><testcase classname="invenio_users_resources.notifications.filters" name="black" time="0.160" /><testcase classname="invenio_users_resources.notifications.generators" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_users_resources.notifications.generators" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.notifications.generators" name="black" time="0.173" /><testcase classname="invenio_users_resources.permissions" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.permissions" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.permissions" name="black" time="0.160" /><testcase classname="invenio_users_resources.proxies" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.proxies" name="ISORT" time="0.011" /><testcase classname="invenio_users_resources.proxies" name="black" time="0.166" /><testcase classname="invenio_users_resources.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.records.__init__" name="black" time="0.158" /><testcase classname="invenio_users_resources.records.api" name="PYDOCSTYLE" time="0.046" /><testcase classname="invenio_users_resources.records.api" name="ISORT" time="0.081" /><testcase classname="invenio_users_resources.records.api" name="black" time="0.252" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.records.dumpers.__init__" name="black" time="0.159" /><testcase classname="invenio_users_resources.records.dumpers.email" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.records.dumpers.email" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.records.dumpers.email" name="black" time="0.166" /><testcase classname="invenio_users_resources.records.hooks" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.records.hooks" name="ISORT" time="0.018" /><testcase classname="invenio_users_resources.records.hooks" name="black" time="0.175" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.__init__" name="black" time="0.159" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.os-v1.__init__" name="black" time="0.159" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.os-v2.__init__" name="black" time="0.161" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_users_resources.records.mappings.v7.__init__" name="black" time="0.164" /><testcase classname="invenio_users_resources.records.models" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_users_resources.records.models" name="ISORT" time="0.041" /><testcase classname="invenio_users_resources.records.models" name="black" time="0.200" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="ISORT" time="0.032" /><testcase classname="invenio_users_resources.records.systemfields.__init__" name="black" time="0.191" /><testcase classname="invenio_users_resources.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.resources.__init__" name="black" time="0.162" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.resources.domains.__init__" name="black" time="0.160" /><testcase classname="invenio_users_resources.resources.domains.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.domains.config" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.resources.domains.config" name="black" time="0.162" /><testcase classname="invenio_users_resources.resources.domains.resource" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.domains.resource" name="ISORT" time="0.011" /><testcase classname="invenio_users_resources.resources.domains.resource" name="black" time="0.165" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.resources.groups.__init__" name="black" time="0.159" /><testcase classname="invenio_users_resources.resources.groups.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.resources.groups.config" name="ISORT" time="0.013" /><testcase classname="invenio_users_resources.resources.groups.config" name="black" time="0.164" /><testcase classname="invenio_users_resources.resources.groups.resource" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.resources.groups.resource" name="ISORT" time="0.019" /><testcase classname="invenio_users_resources.resources.groups.resource" name="black" time="0.170" /><testcase classname="invenio_users_resources.resources.users.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.users.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.resources.users.__init__" name="black" time="0.161" /><testcase classname="invenio_users_resources.resources.users.config" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_users_resources.resources.users.config" name="ISORT" time="0.019" /><testcase classname="invenio_users_resources.resources.users.config" name="black" time="0.168" /><testcase classname="invenio_users_resources.resources.users.errors" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.resources.users.errors" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.resources.users.errors" name="black" time="0.160" /><testcase classname="invenio_users_resources.resources.users.resource" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_users_resources.resources.users.resource" name="ISORT" time="0.036" /><testcase classname="invenio_users_resources.resources.users.resource" name="black" time="0.192" /><testcase classname="invenio_users_resources.services.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_users_resources.services.__init__" name="black" time="0.159" /><testcase classname="invenio_users_resources.services.common" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.common" name="ISORT" time="0.008" /><testcase classname="invenio_users_resources.services.common" name="black" time="0.162" /><testcase classname="invenio_users_resources.services.domains.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.domains.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.services.domains.__init__" name="black" time="0.157" /><testcase classname="invenio_users_resources.services.domains.components" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.domains.components" name="ISORT" time="0.015" /><testcase classname="invenio_users_resources.services.domains.components" name="black" time="0.169" /><testcase classname="invenio_users_resources.services.domains.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.domains.config" name="ISORT" time="0.023" /><testcase classname="invenio_users_resources.services.domains.config" name="black" time="0.171" /><testcase classname="invenio_users_resources.services.domains.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.domains.facets" name="ISORT" time="0.013" /><testcase classname="invenio_users_resources.services.domains.facets" name="black" time="0.163" /><testcase classname="invenio_users_resources.services.domains.service" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.domains.service" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.services.domains.service" name="black" time="0.164" /><testcase classname="invenio_users_resources.services.domains.tasks" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_users_resources.services.domains.tasks" name="ISORT" time="0.023" /><testcase classname="invenio_users_resources.services.domains.tasks" name="black" time="0.181" /><testcase classname="invenio_users_resources.services.generators" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_users_resources.services.generators" name="ISORT" time="0.030" /><testcase classname="invenio_users_resources.services.generators" name="black" time="0.189" /><testcase classname="invenio_users_resources.services.groups.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.groups.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.services.groups.__init__" name="black" time="0.161" /><testcase classname="invenio_users_resources.services.groups.config" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_users_resources.services.groups.config" name="ISORT" time="0.021" /><testcase classname="invenio_users_resources.services.groups.config" name="black" time="0.172" /><testcase classname="invenio_users_resources.services.groups.results" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_users_resources.services.groups.results" name="ISORT" time="0.024" /><testcase classname="invenio_users_resources.services.groups.results" name="black" time="0.182" /><testcase classname="invenio_users_resources.services.groups.service" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.groups.service" name="ISORT" time="0.015" /><testcase classname="invenio_users_resources.services.groups.service" name="black" time="0.166" /><testcase classname="invenio_users_resources.services.groups.tasks" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.groups.tasks" name="ISORT" time="0.012" /><testcase classname="invenio_users_resources.services.groups.tasks" name="black" time="0.166" /><testcase classname="invenio_users_resources.services.params" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_users_resources.services.params" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.services.params" name="black" time="0.164" /><testcase classname="invenio_users_resources.services.permissions" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.permissions" name="ISORT" time="0.017" /><testcase classname="invenio_users_resources.services.permissions" name="black" time="0.171" /><testcase classname="invenio_users_resources.services.results" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_users_resources.services.results" name="ISORT" time="0.017" /><testcase classname="invenio_users_resources.services.results" name="black" time="0.174" /><testcase classname="invenio_users_resources.services.schemas" name="PYDOCSTYLE" time="0.026" /><testcase classname="invenio_users_resources.services.schemas" name="ISORT" time="0.052" /><testcase classname="invenio_users_resources.services.schemas" name="black" time="0.224" /><testcase classname="invenio_users_resources.services.users.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_users_resources.services.users.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_users_resources.services.users.__init__" name="black" time="0.161" /><testcase classname="invenio_users_resources.services.users.config" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_users_resources.services.users.config" name="ISORT" time="0.045" /><testcase classname="invenio_users_resources.services.users.config" name="black" time="0.193" /><testcase classname="invenio_users_resources.services.users.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.services.users.facets" name="ISORT" time="0.014" /><testcase classname="invenio_users_resources.services.users.facets" name="black" time="0.172" /><testcase classname="invenio_users_resources.services.users.lock" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_users_resources.services.users.lock" name="ISORT" time="0.011" /><testcase classname="invenio_users_resources.services.users.lock" name="black" time="0.165" /><testcase classname="invenio_users_resources.services.users.results" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_users_resources.services.users.results" name="ISORT" time="0.024" /><testcase classname="invenio_users_resources.services.users.results" name="black" time="0.180" /><testcase classname="invenio_users_resources.services.users.search_params" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_users_resources.services.users.search_params" name="ISORT" time="0.016" /><testcase classname="invenio_users_resources.services.users.search_params" name="black" time="0.172" /><testcase classname="invenio_users_resources.services.users.service" name="PYDOCSTYLE" time="0.025" /><testcase classname="invenio_users_resources.services.users.service" name="ISORT" time="0.054" /><testcase classname="invenio_users_resources.services.users.service" name="black" time="0.213" /><testcase classname="invenio_users_resources.services.users.tasks" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_users_resources.services.users.tasks" name="ISORT" time="0.028" /><testcase classname="invenio_users_resources.services.users.tasks" name="black" time="0.179" /><testcase classname="invenio_users_resources.views" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_users_resources.views" name="ISORT" time="0.010" /><testcase classname="invenio_users_resources.views" name="black" time="0.163" /></testsuite></testsuites>