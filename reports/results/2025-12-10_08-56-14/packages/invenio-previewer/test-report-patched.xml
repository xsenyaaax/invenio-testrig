<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="3" skipped="0" tests="112" time="103.083" timestamp="2025-12-10T08:57:52.129515+00:00" hostname="runnervmoqczp"><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.021" /><testcase classname="tests.conftest" name="ISORT" time="0.159" /><testcase classname="tests.conftest" name="black" time="0.357" /><testcase classname="tests.test_invenio_previewer" name="ISORT" time="0.033" /><testcase classname="tests.test_invenio_previewer" name="black" time="0.271"><failure message="--- /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_invenio_previewer.py&#09;2025-12-10 08:57:22.031140+00:00&#10;+++ /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_invenio_previewer.py&#09;2025-12-10 08:57:53.624395+00:00&#10;@@ -107,10 +107,11 @@&#10; &#10; &#10; @patch(&quot;importlib.metadata.entry_points&quot;, lambda group=None: [])&#10; def test_iter_container_previewers():&#10;     &quot;&quot;&quot;Test iter_container_previewers with CONTAINER_PREVIEWER_PREFERENCE.&quot;&quot;&quot;&#10;+&#10;     # Mock previewer modules&#10;     class MockPreviewer1:&#10;         previewable_extensions = [&quot;.txt&quot;]&#10; &#10;     class MockPreviewer2:&#10;">--- /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_invenio_previewer.py	2025-12-10 08:57:22.031140+00:00
+++ /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_invenio_previewer.py	2025-12-10 08:57:53.624395+00:00
@@ -107,10 +107,11 @@
 
 
 @patch("importlib.metadata.entry_points", lambda group=None: [])
 def test_iter_container_previewers():
     """Test iter_container_previewers with CONTAINER_PREVIEWER_PREFERENCE."""
+
     # Mock previewer modules
     class MockPreviewer1:
         previewable_extensions = [".txt"]
 
     class MockPreviewer2:
</failure></testcase><testcase classname="tests.test_invenio_previewer" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_previewer" name="test_init" time="0.004" /><testcase classname="tests.test_invenio_previewer" name="test_entrypoint_previewer" time="0.005" /><testcase classname="tests.test_invenio_previewer" name="test_register_previewer_duplicate" time="0.006" /><testcase classname="tests.test_invenio_previewer" name="test_iter_container_previewers" time="0.009" /><testcase classname="tests.test_macros" name="ISORT" time="0.056" /><testcase classname="tests.test_macros" name="black" time="0.241" /><testcase classname="tests.test_macros" name="test_default_extension" time="90.362" /><testcase classname="tests.test_macros" name="test_markdown_extension" time="0.135" /><testcase classname="tests.test_macros" name="test_pdf_extension" time="0.068" /><testcase classname="tests.test_macros" name="test_csv_papaparsejs_extension" time="0.054" /><testcase classname="tests.test_macros" name="test_csv_papaparsejs_delimiter" time="0.052" /><testcase classname="tests.test_macros" name="test_zip_extension" time="0.998" /><testcase classname="tests.test_macros" name="test_json_extension_valid_file" time="0.058" /><testcase classname="tests.test_macros" name="test_json_extension_invalid_file" time="0.052" /><testcase classname="tests.test_macros" name="test_max_file_size" time="0.053" /><testcase classname="tests.test_macros" name="test_xml_extension" time="0.106" /><testcase classname="tests.test_macros" name="test_ipynb_extension" time="0.632" /><testcase classname="tests.test_macros" name="test_simple_image_extension" time="0.053" /><testcase classname="tests.test_macros" name="test_txt_extension_valid_file" time="0.058" /><testcase classname="tests.test_macros" name="test_txt_extension_large_file" time="0.059" /><testcase classname="tests.test_macros" name="test_wacz_extensions_range_requests_enabled" time="0.052"><failure message="assert '&lt;script src=&quot;/static/js/replaywebpage/ui.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;' in '\n&lt;!DOCTYPE html&gt;\n&lt;html &gt;\n  &lt;head&gt;\n    &lt;title&gt;Preview&lt;/title&gt;\n    &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;meta name=&quot;viewpor...&gt;\n&lt;script src=&quot;/static/dist/js/previewer_theme.f60373f3c5d3b745f63e.js&quot;&gt;&lt;/script&gt;\n        \n    \n  &lt;/body&gt;\n&lt;/html&gt;'">testapp = &lt;Flask 'conftest'&gt;, webassets = &lt;Flask 'conftest'&gt;
record = {'control_number': '15', 'title': 'TestDefault', '_bucket': '7501c28a-8595-48cb-a6d2-eea2054d7700', '_files': [{'bucke...'size': 12, 'checksum': 'md5:9473fdd0d880a43c21b7778d34872157', 'version_id': '833f5382-4bb2-4ef7-8874-6c010a5c3b80'}]}

    def test_wacz_extensions_range_requests_enabled(testapp, webassets, record):
        """Test .wacz previewer."""
        testapp.config.update(
            dict(
                PREVIEWER_PREFERENCE=["web_archive"],
                PREVIEWER_WEB_ARCHIVE_RANGE_REQUESTS=True,
            )
        )
    
        create_file(record, "test.wacz", BytesIO(b"test content"))
    
        with testapp.test_client() as client:
            res = client.get(preview_url(record["control_number"], "test.wacz"))
            text = res.get_data(as_text=True)
    
            print(text)
&gt;           assert (
                '&lt;script src="/static/js/replaywebpage/ui.js" type="module"&gt;&lt;/script&gt;'
                in text
            )
E           assert '&lt;script src="/static/js/replaywebpage/ui.js" type="module"&gt;&lt;/script&gt;' in '\n&lt;!DOCTYPE html&gt;\n&lt;html &gt;\n  &lt;head&gt;\n    &lt;title&gt;Preview&lt;/title&gt;\n    &lt;meta charset="utf-8"&gt;\n    &lt;meta name="viewpor...&gt;\n&lt;script src="/static/dist/js/previewer_theme.f60373f3c5d3b745f63e.js"&gt;&lt;/script&gt;\n        \n    \n  &lt;/body&gt;\n&lt;/html&gt;'

/home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_macros.py:280: AssertionError</failure></testcase><testcase classname="tests.test_macros" name="test_wacz_extensions_range_requests_disabled" time="0.052"><failure message="assert '&lt;script src=&quot;/static/js/replaywebpage/ui.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;' in '\n&lt;!DOCTYPE html&gt;\n&lt;html &gt;\n  &lt;head&gt;\n    &lt;title&gt;Preview&lt;/title&gt;\n    &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;meta name=&quot;viewpor...&gt;\n&lt;script src=&quot;/static/dist/js/previewer_theme.f60373f3c5d3b745f63e.js&quot;&gt;&lt;/script&gt;\n        \n    \n  &lt;/body&gt;\n&lt;/html&gt;'">testapp = &lt;Flask 'conftest'&gt;, webassets = &lt;Flask 'conftest'&gt;
record = {'control_number': '16', 'title': 'TestDefault', '_bucket': '538205a3-732c-44c7-b366-5d3b1fb6800d', '_files': [{'bucke...'size': 12, 'checksum': 'md5:9473fdd0d880a43c21b7778d34872157', 'version_id': '3578d2bd-9961-4b5e-aec8-e01050e4f9f9'}]}

    def test_wacz_extensions_range_requests_disabled(testapp, webassets, record):
        """Test .wacz previewer."""
        testapp.config.update(
            dict(
                PREVIEWER_PREFERENCE=["web_archive"],
                PREVIEWER_WEB_ARCHIVE_RANGE_REQUESTS=False,
            )
        )
    
        create_file(record, "test.wacz", BytesIO(b"test content"))
    
        with testapp.test_client() as client:
            res = client.get(preview_url(record["control_number"], "test.wacz"))
            text = res.get_data(as_text=True)
    
&gt;           assert (
                '&lt;script src="/static/js/replaywebpage/ui.js" type="module"&gt;&lt;/script&gt;'
                in text
            )
E           assert '&lt;script src="/static/js/replaywebpage/ui.js" type="module"&gt;&lt;/script&gt;' in '\n&lt;!DOCTYPE html&gt;\n&lt;html &gt;\n  &lt;head&gt;\n    &lt;title&gt;Preview&lt;/title&gt;\n    &lt;meta charset="utf-8"&gt;\n    &lt;meta name="viewpor...&gt;\n&lt;script src="/static/dist/js/previewer_theme.f60373f3c5d3b745f63e.js"&gt;&lt;/script&gt;\n        \n    \n  &lt;/body&gt;\n&lt;/html&gt;'

/home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/test_macros.py:302: AssertionError</failure></testcase><testcase classname="tests.test_macros" name="test_view_macro_file_list" time="2.024" /><testcase classname="tests.test_utils" name="ISORT" time="0.121" /><testcase classname="tests.test_utils" name="black" time="0.197" /><testcase classname="tests.test_utils" name="test_default_file_reader" time="0.489" /><testcase classname="tests.test_utils" name="test_detect_encoding[\xce\x93\xce\xba\xcf\x81\xce\xae\xce\xba \xce\xa3\xcf\x84\xcf\x81\xce\xaf\xce\xbd\xce\xb3\xce\xba-0.99-UTF-8-UTF-8]" time="0.007" /><testcase classname="tests.test_utils" name="test_detect_encoding[dh\xc7\xbek: kjd k\xc3\xb6d, dd\xc8\xaaj@dd.k-0.87625-UTF-8-None]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[\xe0\xa4\x95\xe0\xa5\x8d\xe0\xa4\xaf\xe0\xa4\xbe \xe0\xa4\xb9\xe0\xa4\xbe\xe0\xa4\xb2 \xe0\xa4\xa4\xe0\xa5\x81\xe0\xa4\xae \xe0\xa4\xaf\xe0\xa4\xbe \xe0\xa4\x95\xe0\xa4\xb0 \xe0\xa4\xb0\xe0\xa4\xb9\xe0\xa5\x87 \xe0\xa4\xb9\xe0\xa5\x8b?-0.99-UTF-8-UTF-8]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[\xc0\xd0\xb8\xb6\xbb\xe1 \xb0\xdc\xc5\xbe\xa4\xcf\xa1\xd6\xb4\xfb\xc4\xea\xcf\xa9\xc0\xfe\xa1\xd7-0.46666-EUC-JP-None]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[Hi bye sigh die-1.0-UTF-8-UTF-8]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[Monkey donkey cow crow-0.0-ASCII-None]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[Monkey donkey cow crow-0.9-EUC-JP-None]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[Monkey donkey cow crow-0.90001-EUC-JP-EUC-JP]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding[Monkey donkey cow crow-0.5-UTF-8-None]" time="0.002" /><testcase classname="tests.test_utils" name="test_detect_encoding_exception" time="0.044" /><testcase classname="tests.test_views" name="ISORT" time="0.015" /><testcase classname="tests.test_views" name="black" time="0.188" /><testcase classname="tests.test_views" name="test_view_macro_file_list" time="0.245" /><testcase classname="tests.test_views" name="test_previewable_test" time="0.051" /><testcase classname="invenio_previewer.__init__" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_previewer.__init__" name="ISORT" time="0.033" /><testcase classname="invenio_previewer.__init__" name="black" time="0.195" /><testcase classname="invenio_previewer.api" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_previewer.api" name="ISORT" time="0.015" /><testcase classname="invenio_previewer.api" name="black" time="0.184" /><testcase classname="invenio_previewer.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_previewer.config" name="ISORT" time="0.014" /><testcase classname="invenio_previewer.config" name="black" time="0.193" /><testcase classname="invenio_previewer.ext" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_previewer.ext" name="ISORT" time="0.033" /><testcase classname="invenio_previewer.ext" name="black" time="0.218" /><testcase classname="invenio_previewer.extensions.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_previewer.extensions.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_previewer.extensions.__init__" name="black" time="0.176" /><testcase classname="invenio_previewer.extensions.audio_videojs" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_previewer.extensions.audio_videojs" name="ISORT" time="0.012" /><testcase classname="invenio_previewer.extensions.audio_videojs" name="black" time="0.180" /><testcase classname="invenio_previewer.extensions.csv_papaparsejs" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_previewer.extensions.csv_papaparsejs" name="ISORT" time="0.011" /><testcase classname="invenio_previewer.extensions.csv_papaparsejs" name="black" time="0.186" /><testcase classname="invenio_previewer.extensions.default" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_previewer.extensions.default" name="ISORT" time="0.010" /><testcase classname="invenio_previewer.extensions.default" name="black" time="0.176" /><testcase classname="invenio_previewer.extensions.ipynb" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_previewer.extensions.ipynb" name="ISORT" time="0.020" /><testcase classname="invenio_previewer.extensions.ipynb" name="black" time="0.190" /><testcase classname="invenio_previewer.extensions.json_prismjs" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_previewer.extensions.json_prismjs" name="ISORT" time="0.015" /><testcase classname="invenio_previewer.extensions.json_prismjs" name="black" time="0.185" /><testcase classname="invenio_previewer.extensions.mistune" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_previewer.extensions.mistune" name="ISORT" time="0.012" /><testcase classname="invenio_previewer.extensions.mistune" name="black" time="0.179" /><testcase classname="invenio_previewer.extensions.pdfjs" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_previewer.extensions.pdfjs" name="ISORT" time="0.009" /><testcase classname="invenio_previewer.extensions.pdfjs" name="black" time="0.179" /><testcase classname="invenio_previewer.extensions.simple_image" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_previewer.extensions.simple_image" name="ISORT" time="0.011" /><testcase classname="invenio_previewer.extensions.simple_image" name="black" time="0.182" /><testcase classname="invenio_previewer.extensions.txt" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_previewer.extensions.txt" name="ISORT" time="0.012" /><testcase classname="invenio_previewer.extensions.txt" name="black" time="0.180" /><testcase classname="invenio_previewer.extensions.video_videojs" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_previewer.extensions.video_videojs" name="ISORT" time="0.011" /><testcase classname="invenio_previewer.extensions.video_videojs" name="black" time="0.181" /><testcase classname="invenio_previewer.extensions.web_archive" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_previewer.extensions.web_archive" name="ISORT" time="0.011" /><testcase classname="invenio_previewer.extensions.web_archive" name="black" time="0.187" /><testcase classname="invenio_previewer.extensions.xml_prismjs" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_previewer.extensions.xml_prismjs" name="ISORT" time="0.016" /><testcase classname="invenio_previewer.extensions.xml_prismjs" name="black" time="0.187" /><testcase classname="invenio_previewer.extensions.zip" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_previewer.extensions.zip" name="ISORT" time="0.021" /><testcase classname="invenio_previewer.extensions.zip" name="black" time="0.199" /><testcase classname="invenio_previewer.proxies" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_previewer.proxies" name="ISORT" time="0.008" /><testcase classname="invenio_previewer.proxies" name="black" time="0.182" /><testcase classname="invenio_previewer.utils" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_previewer.utils" name="ISORT" time="0.013" /><testcase classname="invenio_previewer.utils" name="black" time="0.183" /><testcase classname="invenio_previewer.views" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_previewer.views" name="ISORT" time="0.016" /><testcase classname="invenio_previewer.views" name="black" time="0.182" /><testcase classname="invenio_previewer.webpack" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_previewer.webpack" name="ISORT" time="0.026" /><testcase classname="invenio_previewer.webpack" name="black" time="0.192" /></testsuite></testsuites>