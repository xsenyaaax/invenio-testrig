running extract_messages
extracting messages from invenio_drafts_resources/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/auditlog/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/auditlog/actions.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/auditlog/context.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/api.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/models.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/systemfields/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/systemfields/parent.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/records/systemfields/versions.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/records/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/records/args.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/records/config.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/records/errors.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/resources/records/resource.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/config.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/permissions.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/schema.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/search_params.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/service.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/tasks.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/uow.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/__init__.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/base.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/files.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/media_files.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/metadata.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/pid.py (encoding="utf-8")
extracting messages from invenio_drafts_resources/services/records/components/relations.py (encoding="utf-8")
writing PO template file to /dev/null
 opensearch Pulling 
 postgresql Pulling 
 postgresql Pulled 
 opensearch Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-postgresql-1  Started
 Container docker_services_cli-opensearch-1  Started
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0 -- /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/invenio-testrig/invenio-testrig/package-repo
configfile: setup.cfg
testpaths: docs, tests, invenio_drafts_resources
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collecting ... collected 263 items

docs/conf.py::PYDOCSTYLE PASSED
docs/conf.py::ISORT PASSED
docs/conf.py::black PASSED
tests/conftest.py::PYDOCSTYLE PASSED
tests/conftest.py::ISORT PASSED
tests/conftest.py::black PASSED
tests/mock_module/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/__init__.py::ISORT PASSED
tests/mock_module/__init__.py::black PASSED
tests/mock_module/api.py::PYDOCSTYLE PASSED
tests/mock_module/api.py::ISORT PASSED
tests/mock_module/api.py::black PASSED
tests/mock_module/jsonschemas/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/jsonschemas/__init__.py::ISORT PASSED
tests/mock_module/jsonschemas/__init__.py::black PASSED
tests/mock_module/mappings/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/__init__.py::ISORT PASSED
tests/mock_module/mappings/__init__.py::black PASSED
tests/mock_module/mappings/os-v1/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/os-v1/__init__.py::ISORT PASSED
tests/mock_module/mappings/os-v1/__init__.py::black PASSED
tests/mock_module/mappings/os-v1/draftsresources/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/os-v1/draftsresources/__init__.py::ISORT PASSED
tests/mock_module/mappings/os-v1/draftsresources/__init__.py::black PASSED
tests/mock_module/mappings/os-v2/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/os-v2/__init__.py::ISORT PASSED
tests/mock_module/mappings/os-v2/__init__.py::black PASSED
tests/mock_module/mappings/os-v2/draftsresources/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/os-v2/draftsresources/__init__.py::ISORT PASSED
tests/mock_module/mappings/os-v2/draftsresources/__init__.py::black PASSED
tests/mock_module/mappings/v7/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/v7/__init__.py::ISORT PASSED
tests/mock_module/mappings/v7/__init__.py::black PASSED
tests/mock_module/mappings/v7/draftsresources/__init__.py::PYDOCSTYLE PASSED
tests/mock_module/mappings/v7/draftsresources/__init__.py::ISORT PASSED
tests/mock_module/mappings/v7/draftsresources/__init__.py::black PASSED
tests/mock_module/models.py::PYDOCSTYLE PASSED
tests/mock_module/models.py::ISORT PASSED
tests/mock_module/models.py::black PASSED
tests/mock_module/permissions.py::PYDOCSTYLE PASSED
tests/mock_module/permissions.py::ISORT PASSED
tests/mock_module/permissions.py::black PASSED
tests/mock_module/resource.py::PYDOCSTYLE PASSED
tests/mock_module/resource.py::ISORT PASSED
tests/mock_module/resource.py::black PASSED
tests/mock_module/schemas.py::PYDOCSTYLE PASSED
tests/mock_module/schemas.py::ISORT PASSED
tests/mock_module/schemas.py::black PASSED
tests/mock_module/service.py::PYDOCSTYLE PASSED
tests/mock_module/service.py::ISORT PASSED
tests/mock_module/service.py::black PASSED
tests/records/conftest.py::PYDOCSTYLE PASSED
tests/records/conftest.py::ISORT PASSED
tests/records/conftest.py::black PASSED
tests/records/test_api.py::ISORT PASSED
tests/records/test_api.py::black PASSED
tests/records/test_api.py::test_draft_create_empty JSONSCHEMAS_HOST is set to localhost
PASSED
tests/records/test_api.py::test_draft_create_parent PASSED

tests/records/test_api.py::test_draft_create_parent_state PASSED

tests/records/test_api.py::test_record_create_parent_state PASSED

tests/records/test_api.py::test_draft_create_new_version PASSED

tests/records/test_api.py::test_draft_parent_state_hard_delete PASSED

tests/records/test_api.py::test_new_draft_of_published_record_doesnt_override_next_draft_id PASSED

tests/records/test_api.py::test_draft_parent_state_hard_delete_with_parent PASSED

tests/records/test_api.py::test_draft_parent_state_soft_delete PASSED

tests/records/test_api.py::test_create_record_from_draft PASSED

tests/records/test_api.py::test_draft_get_record PASSED

tests/records/test_api.py::test_draft_force_delete PASSED

tests/records/test_api.py::test_draft_soft_delete PASSED

tests/records/test_api.py::test_draft_undelete PASSED

tests/records/test_api.py::test_draft_dump_load_idempotence PASSED

tests/records/test_api.py::test_draft_indexing PASSED

tests/records/test_api.py::test_draft_delete_reindex PASSED

tests/records/test_api.py::test_get_records_by_parent PASSED

tests/records/test_api.py::test_get_latest_by_parent PASSED

tests/resources/conftest.py::PYDOCSTYLE PASSED
tests/resources/conftest.py::ISORT PASSED
tests/resources/conftest.py::black PASSED
tests/resources/test_files_resource.py::ISORT PASSED
tests/resources/test_files_resource.py::black PASSED
tests/resources/test_files_resource.py::test_files_publish_flow JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:32:59,688] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/resources/test_files_resource.py::test_metadata_only_record PASSED

tests/resources/test_files_resource.py::test_import_files PASSED

tests/resources/test_files_resource.py::test_import_files_metadata_only PASSED

tests/resources/test_files_resource.py::test_import_files_no_version PASSED

tests/resources/test_record_resource.py::ISORT PASSED
tests/resources/test_record_resource.py::black PASSED
tests/resources/test_record_resource.py::test_create_draft JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:08,534] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/resources/test_record_resource.py::test_read_draft PASSED

tests/resources/test_record_resource.py::test_update_draft PASSED

tests/resources/test_record_resource.py::test_delete_draft PASSED

tests/resources/test_record_resource.py::test_publish_draft Tried to build event emitter for unregistered event 'record-view'
[2025-12-10 10:33:13,676] WARNING in receivers: Tried to build event emitter for unregistered event 'record-view'
Tried to build event emitter for unregistered event 'record-view'
Tried to build event emitter for unregistered event 'record-view'
PASSED

tests/resources/test_record_resource.py::test_search_versions PASSED

tests/resources/test_record_resource.py::test_create_publish_new_revision PASSED

tests/resources/test_record_resource.py::test_multiple_edit PASSED

tests/resources/test_record_resource.py::test_redirect_to_latest_version PASSED

tests/resources/test_resource_links.py::ISORT PASSED
tests/resources/test_resource_links.py::black PASSED
tests/resources/test_resource_links.py::test_create_draft JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:19,134] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/resources/test_resource_links.py::test_read_draft PASSED

tests/resources/test_resource_links.py::test_update_draft PASSED

tests/resources/test_resource_links.py::test_publish_draft PASSED

tests/services/__init__.py::PYDOCSTYLE PASSED
tests/services/__init__.py::ISORT PASSED
tests/services/__init__.py::black PASSED
tests/services/conftest.py::PYDOCSTYLE PASSED
tests/services/conftest.py::ISORT PASSED
tests/services/conftest.py::black PASSED
tests/services/test_record_service.py::ISORT PASSED
tests/services/test_record_service.py::black PASSED
tests/services/test_record_service.py::test_create_draft JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:22,068] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_record_service.py::test_create_empty_draft PASSED

tests/services/test_record_service.py::test_read_draft PASSED

tests/services/test_record_service.py::test_update_draft PASSED

tests/services/test_record_service.py::test_update_draft_invalid_field PASSED

tests/services/test_record_service.py::test_delete_draft PASSED

tests/services/test_record_service.py::test_publish_draft PASSED

tests/services/test_record_service.py::test_fail_to_publish_invalid_draft PASSED

tests/services/test_record_service.py::test_create_publish_new_revision PASSED

tests/services/test_record_service.py::test_multiple_edit PASSED

tests/services/test_record_service.py::test_create_publish_new_version PASSED

tests/services/test_record_service.py::test_multi_version_delete_draft PASSED

tests/services/test_record_service.py::test_read_latest_version PASSED

tests/services/test_record_service_files.py::ISORT PASSED
tests/services/test_record_service_files.py::black PASSED
tests/services/test_record_service_files.py::test_create_delete_draft JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:27,763] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_record_service_files.py::test_create_publish PASSED

tests/services/test_record_service_files.py::test_edit_delete PASSED

tests/services/test_record_service_files.py::test_edit_delete_media_files Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:30,314] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
PASSED

tests/services/test_record_service_files.py::test_edit_publish PASSED

tests/services/test_record_service_files.py::test_edit_draft_files Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:31,411] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:31,683] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
PASSED

tests/services/test_record_service_files.py::test_publish_draft_media_files_no_bucket PASSED

tests/services/test_record_service_files.py::test_new_version PASSED

tests/services/test_record_service_files.py::test_new_version_with_media_files Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:32,554] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:32,936] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
PASSED

tests/services/test_record_service_files.py::test_new_version_delete PASSED

tests/services/test_record_service_files.py::test_new_version_with_media_files_delete Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:33,760] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
[2025-12-10 10:33:34,128] ERROR in tasks: Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
Failed to extract file metadata.
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 27, in extract_file_metadata
    service.extract_file_metadata(system_identity, record_id, file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py", line 251, in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 223, in extract_file_metadata
    record = self._get_record(id_, identity, "create_files", file_key=file_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/service.py", line 126, in _get_record
    self.require_permission(identity, action, record=record, file_key=file_key)
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py", line 51, in require_permission
    raise PermissionDeniedError(action_name)
invenio_records_resources.services.errors.PermissionDeniedError: create_files
PASSED

tests/services/test_record_service_files.py::test_import_files PASSED

tests/services/test_record_service_files.py::test_import_files_disabled PASSED

tests/services/test_record_service_files.py::test_edit_publish_default_preview PASSED

tests/services/test_record_service_files.py::test_update_draft_set_default_file_preview PASSED

tests/services/test_record_service_files.py::test_update_draft_set_default_file_preview_reports_error PASSED

tests/services/test_record_service_files.py::test_publish_with_fetch_files 'files'
[2025-12-10 10:33:35,815] ERROR in tasks: 'files'
'files'
'files'
'files'
'files'
'files'
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/tasks.py", line 33, in fetch_file
    service = current_service_registry.get(service_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/registry.py", line 31, in get
    return self._services[service_id]
           ~~~~~~~~~~~~~~^^^^^^^^^^^^
KeyError: 'files'
PASSED

tests/services/test_record_service_files.py::test_missing_files PASSED

tests/services/test_record_service_files.py::test_disable_files_error PASSED

tests/services/test_record_service_files.py::test_fail_to_publish_draft_with_no_files PASSED

tests/services/test_record_service_files.py::test_fail_to_add_files_to_draft_with_files_disabled PASSED

tests/services/test_record_service_files.py::test_manage_files_permissions PASSED

tests/services/test_record_service_files.py::test_publish_with_remote_files PASSED

tests/services/test_record_service_files.py::test_enable_files_after_publish PASSED

tests/services/test_record_service_search.py::ISORT PASSED
tests/services/test_record_service_search.py::black PASSED
tests/services/test_record_service_search.py::test_search_versions JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:38,383] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_record_service_search.py::test_search_versions_for_record PASSED

tests/services/test_record_service_tasks.py::ISORT PASSED
tests/services/test_record_service_tasks.py::black PASSED
tests/services/test_record_service_tasks.py::test_hard_delete_soft_deleted_task JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:41,127] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_records_uow.py::ISORT PASSED
tests/services/test_records_uow.py::black PASSED
tests/services/test_records_uow.py::test_parent_record_uow_params JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:43,193] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_records_uow.py::test_parent_record_commit PASSED

tests/services/test_services.py::ISORT PASSED
tests/services/test_services.py::black PASSED
tests/services/test_services.py::test_hard_delete_soft_deleted JSONSCHEMAS_HOST is set to localhost
[2025-12-10 10:33:45,680] WARNING in ext: JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
JSONSCHEMAS_HOST is set to localhost
PASSED

tests/services/test_services.py::test_hard_delete_soft_deleted_not_enough_time PASSED

tests/services/utils.py::PYDOCSTYLE PASSED
tests/services/utils.py::ISORT PASSED
tests/services/utils.py::black PASSED
invenio_drafts_resources/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/__init__.py::ISORT PASSED
invenio_drafts_resources/__init__.py::black PASSED
invenio_drafts_resources/auditlog/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/auditlog/__init__.py::ISORT PASSED
invenio_drafts_resources/auditlog/__init__.py::black PASSED
invenio_drafts_resources/auditlog/actions.py::PYDOCSTYLE PASSED
invenio_drafts_resources/auditlog/actions.py::ISORT PASSED
invenio_drafts_resources/auditlog/actions.py::black PASSED
invenio_drafts_resources/auditlog/context.py::PYDOCSTYLE PASSED
invenio_drafts_resources/auditlog/context.py::ISORT PASSED
invenio_drafts_resources/auditlog/context.py::black PASSED
invenio_drafts_resources/records/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/__init__.py::ISORT PASSED
invenio_drafts_resources/records/__init__.py::black PASSED
invenio_drafts_resources/records/api.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/api.py::ISORT PASSED
invenio_drafts_resources/records/api.py::black PASSED
invenio_drafts_resources/records/models.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/models.py::ISORT PASSED
invenio_drafts_resources/records/models.py::black PASSED
invenio_drafts_resources/records/systemfields/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/systemfields/__init__.py::ISORT PASSED
invenio_drafts_resources/records/systemfields/__init__.py::black PASSED
invenio_drafts_resources/records/systemfields/parent.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/systemfields/parent.py::ISORT PASSED
invenio_drafts_resources/records/systemfields/parent.py::black PASSED
invenio_drafts_resources/records/systemfields/versions.py::PYDOCSTYLE PASSED
invenio_drafts_resources/records/systemfields/versions.py::ISORT PASSED
invenio_drafts_resources/records/systemfields/versions.py::black PASSED
invenio_drafts_resources/resources/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/__init__.py::ISORT PASSED
invenio_drafts_resources/resources/__init__.py::black PASSED
invenio_drafts_resources/resources/records/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/records/__init__.py::ISORT PASSED
invenio_drafts_resources/resources/records/__init__.py::black PASSED
invenio_drafts_resources/resources/records/args.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/records/args.py::ISORT PASSED
invenio_drafts_resources/resources/records/args.py::black PASSED
invenio_drafts_resources/resources/records/config.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/records/config.py::ISORT PASSED
invenio_drafts_resources/resources/records/config.py::black PASSED
invenio_drafts_resources/resources/records/errors.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/records/errors.py::ISORT PASSED
invenio_drafts_resources/resources/records/errors.py::black PASSED
invenio_drafts_resources/resources/records/resource.py::PYDOCSTYLE PASSED
invenio_drafts_resources/resources/records/resource.py::ISORT PASSED
invenio_drafts_resources/resources/records/resource.py::black PASSED
invenio_drafts_resources/services/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/__init__.py::ISORT PASSED
invenio_drafts_resources/services/__init__.py::black PASSED
invenio_drafts_resources/services/records/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/__init__.py::ISORT PASSED
invenio_drafts_resources/services/records/__init__.py::black PASSED
invenio_drafts_resources/services/records/components/__init__.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/__init__.py::ISORT PASSED
invenio_drafts_resources/services/records/components/__init__.py::black PASSED
invenio_drafts_resources/services/records/components/base.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/base.py::ISORT PASSED
invenio_drafts_resources/services/records/components/base.py::black PASSED
invenio_drafts_resources/services/records/components/files.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/files.py::ISORT PASSED
invenio_drafts_resources/services/records/components/files.py::black PASSED
invenio_drafts_resources/services/records/components/media_files.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/media_files.py::ISORT PASSED
invenio_drafts_resources/services/records/components/media_files.py::black PASSED
invenio_drafts_resources/services/records/components/metadata.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/metadata.py::ISORT PASSED
invenio_drafts_resources/services/records/components/metadata.py::black PASSED
invenio_drafts_resources/services/records/components/pid.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/pid.py::ISORT PASSED
invenio_drafts_resources/services/records/components/pid.py::black PASSED
invenio_drafts_resources/services/records/components/relations.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/components/relations.py::ISORT PASSED
invenio_drafts_resources/services/records/components/relations.py::black PASSED
invenio_drafts_resources/services/records/config.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/config.py::ISORT PASSED
invenio_drafts_resources/services/records/config.py::black PASSED
invenio_drafts_resources/services/records/permissions.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/permissions.py::ISORT PASSED
invenio_drafts_resources/services/records/permissions.py::black PASSED
invenio_drafts_resources/services/records/schema.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/schema.py::ISORT PASSED
invenio_drafts_resources/services/records/schema.py::black PASSED
invenio_drafts_resources/services/records/search_params.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/search_params.py::ISORT PASSED
invenio_drafts_resources/services/records/search_params.py::black PASSED
invenio_drafts_resources/services/records/service.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/service.py::ISORT PASSED
invenio_drafts_resources/services/records/service.py::black PASSED
invenio_drafts_resources/services/records/tasks.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/tasks.py::ISORT PASSED
invenio_drafts_resources/services/records/tasks.py::black PASSED
invenio_drafts_resources/services/records/uow.py::PYDOCSTYLE PASSED
invenio_drafts_resources/services/records/uow.py::ISORT PASSED
invenio_drafts_resources/services/records/uow.py::black PASSED

=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
    from crypt import crypt as _crypt

.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
    from jsonschema import RefResolver as _RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/fs/__init__.py:4
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:3146
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

.venv/lib/python3.12/site-packages/fs/__init__.py:4
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/fs/opener/__init__.py:6
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:2558
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(parent)

.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
    from marshmallow import __version_info__ as marshmallow_version

.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154: RemovedInMarshmallow4Warning: The 'default' argument to fields is deprecated. Use 'dump_default' instead.
    storage_class = Str(default="L", dump_only=False)

    warnings.warn(

.venv/lib/python3.12/site-packages/marshmallow/fields.py:1218
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/marshmallow/fields.py:1218: RemovedInMarshmallow4Warning: The 'missing' argument to fields is deprecated. Use 'load_default' instead.
    super().__init__(**kwargs)

    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

    target.updated = datetime.utcnow()

tests/records/test_api.py::test_new_draft_of_published_record_doesnt_override_next_draft_id
tests/services/test_record_service_tasks.py::test_hard_delete_soft_deleted_task
tests/services/test_services.py::test_hard_delete_soft_deleted
tests/services/test_services.py::test_hard_delete_soft_deleted_not_enough_time
    timestamp = datetime.utcnow() - td - timedelta(seconds=search_gc_deletes)

    target.updated = datetime.utcnow()

tests/records/test_api.py::test_draft_indexing
tests/records/test_api.py::test_draft_delete_reindex
tests/records/test_api.py::test_draft_delete_reindex
tests/records/test_api.py::test_draft_delete_reindex
    warnings.warn(

tests/resources/test_files_resource.py::test_files_publish_flow
tests/resources/test_record_resource.py::test_create_draft
tests/resources/test_resource_links.py::test_create_draft
tests/services/test_record_service.py::test_create_draft
tests/services/test_record_service_files.py::test_create_delete_draft
tests/services/test_record_service_search.py::test_search_versions
tests/services/test_record_service_tasks.py::test_hard_delete_soft_deleted_task
tests/services/test_records_uow.py::test_parent_record_uow_params
tests/services/test_services.py::test_hard_delete_soft_deleted
    self.init_app(app)

tests/resources/test_files_resource.py::test_files_publish_flow
tests/resources/test_record_resource.py::test_create_draft
tests/resources/test_resource_links.py::test_create_draft
tests/services/test_record_service.py::test_create_draft
tests/services/test_record_service_files.py::test_create_delete_draft
tests/services/test_record_service_search.py::test_search_versions
tests/services/test_record_service_tasks.py::test_hard_delete_soft_deleted_task
tests/services/test_records_uow.py::test_parent_record_uow_params
tests/services/test_services.py::test_hard_delete_soft_deleted
    self._set_cache(app, config)

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:90: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    valid_data = self.schema(context=context, **schema_args).load(data)

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/marshmallow/fields.py:631: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    self._schema = schema_class(

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    return self.schema(context=context, **schema_args).dump(data)

    target.updated = datetime.utcnow()

    "created": datetime.utcnow(),

    "updated": datetime.utcnow(),

tests/resources/test_record_resource.py::test_publish_draft
    current_app.logger.warn(

tests/services/test_record_service_files.py::test_publish_with_remote_files
tests/services/test_record_service_files.py::test_enable_files_after_publish
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_files_rest/models.py:750: SAWarning: Object of type <ObjectVersion> not in session, add operation along 'Bucket.objects' will not proceed (This warning originated from the Session 'autoflush' process, which was invoked automatically in response to a user-initiated operation. Consider using ``no_autoflush`` context manager if this warning happened while initializing objects.)
    return db.session.query(cls).filter_by(id=file_id).one_or_none()

- generated xml file: /home/runner/work/invenio-testrig/invenio-testrig/artifacts/test-report-patched.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                                                  Stmts   Miss  Cover   Missing
invenio_drafts_resources/__init__.py                                      2      0   100%
invenio_drafts_resources/auditlog/__init__.py                             0      0   100%
invenio_drafts_resources/auditlog/actions.py                             21      0   100%
invenio_drafts_resources/auditlog/context.py                             31     19    39%   26-29, 37-42, 51-62
invenio_drafts_resources/records/__init__.py                              3      0   100%
invenio_drafts_resources/records/api.py                                  93      1    99%   125
invenio_drafts_resources/records/models.py                               36      0   100%
invenio_drafts_resources/records/systemfields/__init__.py                 3      0   100%
invenio_drafts_resources/records/systemfields/parent.py                  50      1    98%   80
invenio_drafts_resources/records/systemfields/versions.py               130      1    99%   173
invenio_drafts_resources/resources/__init__.py                            2      0   100%
invenio_drafts_resources/resources/records/__init__.py                    3      0   100%
invenio_drafts_resources/resources/records/args.py                        5      0   100%
invenio_drafts_resources/resources/records/config.py                      6      0   100%
invenio_drafts_resources/resources/records/errors.py                     16      0   100%
invenio_drafts_resources/resources/records/resource.py                   85      2    98%   101-107
invenio_drafts_resources/services/__init__.py                             2      0   100%
invenio_drafts_resources/services/records/__init__.py                     3      0   100%
invenio_drafts_resources/services/records/components/__init__.py          7      0   100%
invenio_drafts_resources/services/records/components/base.py            126     12    90%   32, 36, 40, 44, 48, 52, 56, 115-123, 139, 295, 301
invenio_drafts_resources/services/records/components/files.py             4      0   100%
invenio_drafts_resources/services/records/components/media_files.py      58      5    91%   52-56, 76-77
invenio_drafts_resources/services/records/components/metadata.py         10      0   100%
invenio_drafts_resources/services/records/components/pid.py              12      0   100%
invenio_drafts_resources/services/records/components/relations.py         4      1    75%   20
invenio_drafts_resources/services/records/config.py                      49      0   100%
invenio_drafts_resources/services/records/permissions.py                 11      0   100%
invenio_drafts_resources/services/records/schema.py                      15      0   100%
invenio_drafts_resources/services/records/search_params.py               13      0   100%
invenio_drafts_resources/services/records/service.py                    227     47    79%   64, 77, 112, 124-148, 174-175, 180, 266, 452-453, 462, 547, 579-590, 594-595, 619-623, 671-674, 678-681, 708-736
invenio_drafts_resources/services/records/tasks.py                        8      0   100%
invenio_drafts_resources/services/records/uow.py                         36      4    89%   74-75, 80-81
TOTAL                                                                  1071     93    91%
================ 263 passed, 4345 warnings in 66.46s (0:01:06) =================
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
