<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="69" failures="0" skipped="17" tests="2070" time="1489.244" timestamp="2025-11-18T10:44:01.934511+00:00" hostname="runnervmg1sw1"><testcase classname="docs.conf" name="PYDOCSTYLE" time="0.011" /><testcase classname="docs.conf" name="ISORT" time="0.124" /><testcase classname="docs.conf" name="black" time="0.298" /><testcase classname="tests.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.__init__" name="ISORT" time="0.003" /><testcase classname="tests.__init__" name="black" time="0.151" /><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.137" /><testcase classname="tests.conftest" name="ISORT" time="0.312" /><testcase classname="tests.conftest" name="black" time="0.516" /><testcase classname="tests.contrib.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.contrib.__init__" name="ISORT" time="0.004" /><testcase classname="tests.contrib.__init__" name="black" time="0.159" /><testcase classname="tests.contrib.codemeta.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.contrib.codemeta.__init__" name="ISORT" time="0.004" /><testcase classname="tests.contrib.codemeta.__init__" name="black" time="0.150" /><testcase classname="tests.contrib.codemeta.conftest" name="PYDOCSTYLE" time="0.013" /><testcase classname="tests.contrib.codemeta.conftest" name="ISORT" time="0.027" /><testcase classname="tests.contrib.codemeta.conftest" name="black" time="0.173" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="ISORT" time="0.018" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="black" time="0.167" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_not_loaded_by_default" time="9.677" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_load_on_demand" time="0.971" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_mappings" time="1.014" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_record_creation_with_codemeta_fields" time="2.129" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_codemeta_facets" time="2.089" /><testcase classname="tests.contrib.codemeta.test_codemeta_custom_fields" name="test_codemeta_fields_search" time="2.324" /><testcase classname="tests.fake_datacite_client" name="PYDOCSTYLE" time="0.020" /><testcase classname="tests.fake_datacite_client" name="ISORT" time="0.019" /><testcase classname="tests.fake_datacite_client" name="black" time="0.167" /><testcase classname="tests.fixtures.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.__init__" name="black" time="0.151" /><testcase classname="tests.fixtures.conftest" name="PYDOCSTYLE" time="0.007" /><testcase classname="tests.fixtures.conftest" name="ISORT" time="0.018" /><testcase classname="tests.fixtures.conftest" name="black" time="0.160" /><testcase classname="tests.fixtures.load_error.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.load_error.__init__" name="ISORT" time="0.003" /><testcase classname="tests.fixtures.load_error.__init__" name="black" time="0.149" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.__init__" name="black" time="0.150" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.fixtures.vocabularies.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.fixtures.vocabularies.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.load_error.conflicting_module_A.fixtures.vocabularies.__init__" name="black" time="0.149" /><testcase classname="tests.fixtures.load_error.conflicting_module_B.fixtures.vocabularies.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.load_error.conflicting_module_B.fixtures.vocabularies.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.load_error.conflicting_module_B.fixtures.vocabularies.__init__" name="black" time="0.149" /><testcase classname="tests.fixtures.load_error.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.fixtures.load_error.conftest" name="ISORT" time="0.009" /><testcase classname="tests.fixtures.load_error.conftest" name="black" time="0.154" /><testcase classname="tests.fixtures.load_error.test_vocabularies_load_error" name="ISORT" time="0.010" /><testcase classname="tests.fixtures.load_error.test_vocabularies_load_error" name="black" time="0.154" /><testcase classname="tests.fixtures.load_error.test_vocabularies_load_error" name="test_conflicting_load" time="4.996" /><testcase classname="tests.fixtures.mock_module_A.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.mock_module_A.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.mock_module_A.__init__" name="black" time="0.153" /><testcase classname="tests.fixtures.mock_module_A.fixtures.vocabularies.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.fixtures.mock_module_A.fixtures.vocabularies.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.mock_module_A.fixtures.vocabularies.__init__" name="black" time="0.150" /><testcase classname="tests.fixtures.mock_module_B.fixtures.vocabularies.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.fixtures.mock_module_B.fixtures.vocabularies.__init__" name="ISORT" time="0.004" /><testcase classname="tests.fixtures.mock_module_B.fixtures.vocabularies.__init__" name="black" time="0.150" /><testcase classname="tests.fixtures.test_cli" name="ISORT" time="0.028" /><testcase classname="tests.fixtures.test_cli" name="black" time="0.177" /><testcase classname="tests.fixtures.test_cli" name="test_create_fake_demo_draft_record" time="10.259" /><testcase classname="tests.fixtures.test_cli" name="test_create_fake_demo_communities" time="3.625" /><testcase classname="tests.fixtures.test_cli" name="test_create_fake_demo_inclusion_requests" time="4.718" /><testcase classname="tests.fixtures.test_cli" name="test_create_fake_demo_invitation_requests" time="4.737" /><testcase classname="tests.fixtures.test_cli" name="test_create_records_custom_fields" time="1.331" /><testcase classname="tests.fixtures.test_fixtures" name="ISORT" time="0.048" /><testcase classname="tests.fixtures.test_fixtures" name="black" time="0.200" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_languages" time="5.807" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_resource_types" time="2.713" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_community_types" time="0.908" /><testcase classname="tests.fixtures.test_fixtures" name="test_loading_paths_traversal" time="2.334" /><testcase classname="tests.fixtures.test_fixtures" name="test_reloading_paths_traversal" time="2.316" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_users" time="0.527" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_communities" time="1.373" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_records" time="4.478" /><testcase classname="tests.fixtures.test_fixtures" name="test_load_affiliations" time="1.235" /><testcase classname="tests.helpers" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.helpers" name="ISORT" time="0.009" /><testcase classname="tests.helpers" name="black" time="0.165" /><testcase classname="tests.mock_module.__init__" name="PYDOCSTYLE" time="0.010" /><testcase classname="tests.mock_module.__init__" name="ISORT" time="0.017" /><testcase classname="tests.mock_module.__init__" name="black" time="0.169" /><testcase classname="tests.oaiserver.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.oaiserver.__init__" name="ISORT" time="0.004" /><testcase classname="tests.oaiserver.__init__" name="black" time="0.161" /><testcase classname="tests.oaiserver.test_oaipmh" name="ISORT" time="0.017" /><testcase classname="tests.oaiserver.test_oaipmh" name="black" time="0.173" /><testcase classname="tests.oaiserver.test_oaipmh" name="test_identify" time="6.530" /><testcase classname="tests.oaiserver.test_oaipmh" name="test_list_sets" time="1.550" /><testcase classname="tests.oaiserver.test_oaipmh" name="test_harvest" time="6.257" /><testcase classname="tests.records.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.records.__init__" name="ISORT" time="0.007" /><testcase classname="tests.records.__init__" name="black" time="0.168" /><testcase classname="tests.records.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.records.conftest" name="ISORT" time="0.011" /><testcase classname="tests.records.conftest" name="black" time="0.156" /><testcase classname="tests.records.dumpers.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.records.dumpers.__init__" name="ISORT" time="0.005" /><testcase classname="tests.records.dumpers.__init__" name="black" time="0.153" /><testcase classname="tests.records.dumpers.conftest" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.records.dumpers.conftest" name="ISORT" time="0.004" /><testcase classname="tests.records.dumpers.conftest" name="black" time="0.152" /><testcase classname="tests.records.dumpers.test_access_dumpers" name="ISORT" time="0.022" /><testcase classname="tests.records.dumpers.test_access_dumpers" name="black" time="0.172" /><testcase classname="tests.records.dumpers.test_access_dumpers" name="test_grant_tokens_dumper" time="3.695" /><testcase classname="tests.records.dumpers.test_access_dumpers" name="test_grant_tokens_dumper_query" time="0.535"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/records/dumpers/test_access_dumpers.py:53: unconditional skip</skipped></testcase><testcase classname="tests.records.dumpers.test_combined_subjects_dumper" name="ISORT" time="0.011" /><testcase classname="tests.records.dumpers.test_combined_subjects_dumper" name="black" time="0.159" /><testcase classname="tests.records.dumpers.test_combined_subjects_dumper" name="test_combined_subjects_dumper" time="5.418" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="ISORT" time="0.028" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="black" time="0.181" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext[2021-01-01-2021-01-01-2021-01-01]" time="5.412" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext[2021-01-2021-01-01-2021-01-31]" time="0.560" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext[2021-2021-01-01-2021-12-31]" time="0.544" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext[1776-1776-01-01-1776-12-31]" time="0.544" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext[2021-01/2021-03-2021-01-01-2021-03-31]" time="0.568" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext_not_defined" time="0.535" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_eslistdumper_with_edtfext_not_defined" time="0.545" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_esdumper_with_edtfext_parse_error" time="1.215" /><testcase classname="tests.records.dumpers.test_edtf_dumpers" name="test_eslistdumper_with_edtfext_parse_error" time="1.091" /><testcase classname="tests.records.dumpers.test_files_dumpers" name="ISORT" time="0.020" /><testcase classname="tests.records.dumpers.test_files_dumpers" name="black" time="0.170" /><testcase classname="tests.records.dumpers.test_files_dumpers" name="test_files_dumper" time="8.893" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="ISORT" time="0.025" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="black" time="0.177" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="test_locationsdumper_with_point_geometry" time="3.624" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="test_locationsdumper_with_no_featurecollection" time="0.425" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="test_locationsdumper_with_polygon_and_no_shapely" time="0.415" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="test_locationsdumper_with_polygon_and_mock_shapely" time="0.413" /><testcase classname="tests.records.dumpers.test_location_dumpers" name="test_locationsdumper_with_polygon_and_shapely" time="1.720"><skipped type="pytest.skip" message="could not import 'shapely': No module named 'shapely'">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/records/dumpers/test_location_dumpers.py:125: could not import 'shapely': No module named 'shapely'</skipped></testcase><testcase classname="tests.records.dumpers.test_pids_dumper" name="ISORT" time="0.013" /><testcase classname="tests.records.dumpers.test_pids_dumper" name="black" time="0.160" /><testcase classname="tests.records.dumpers.test_pids_dumper" name="test_esdumper_with_externalpidsext" time="4.235" /><testcase classname="tests.records.systemfields.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.records.systemfields.__init__" name="ISORT" time="0.004" /><testcase classname="tests.records.systemfields.__init__" name="black" time="0.151" /><testcase classname="tests.records.systemfields.conftest" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.records.systemfields.conftest" name="ISORT" time="0.005" /><testcase classname="tests.records.systemfields.conftest" name="black" time="0.151" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="ISORT" time="0.052" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="black" time="0.231" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_protection_valid" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_protection_invalid_values" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_embargo_creation" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_embargo_from_dict" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_embargo_lift" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_creation" time="3.633" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_from_dict" time="0.447" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_to_need" time="0.435" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_to_token" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_from_token" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grant_to_and_from_token" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grants_creation" time="0.434" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grants_dump" time="0.437" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_grants_needs" time="0.431" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_owner_creation" time="0.433" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_owner_resolve" time="1.328" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_owner_system_user" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_owner_resolve_invalid" time="0.007" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_owner_dump" time="0.001" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_on_record" time="1.613" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_update_embargo" time="0.606" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_clear_embargo" time="0.423" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_lift_embargo" time="0.420" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_update_protection" time="0.604" /><testcase classname="tests.records.systemfields.test_access_systemfield" name="test_access_field_update_owner" time="1.126" /><testcase classname="tests.records.systemfields.test_permission_flags" name="ISORT" time="0.021" /><testcase classname="tests.records.systemfields.test_permission_flags" name="black" time="0.165" /><testcase classname="tests.records.systemfields.test_permission_flags" name="test_permission_flags_valid" time="4.812" /><testcase classname="tests.records.systemfields.test_permission_flags" name="test_get_set_permission_flags_from_db" time="0.604" /><testcase classname="tests.records.systemfields.test_permission_flags" name="test_cant_get_field_via_rest" time="1.916" /><testcase classname="tests.records.systemfields.test_tombstone" name="ISORT" time="0.026" /><testcase classname="tests.records.systemfields.test_tombstone" name="black" time="0.176" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_tombstone_creation" time="4.127" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_tombstone_invalid_removed_by" time="0.002" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_tombstone_valid_removed_by" time="0.503" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_record_deletion_status_default" time="0.002" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_record_deletion_status_valid_values" time="0.002" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_record_deletion_status_invalid_values" time="0.002" /><testcase classname="tests.records.systemfields.test_tombstone" name="test_record_deletion_status" time="0.551" /><testcase classname="tests.records.test_api" name="ISORT" time="0.008" /><testcase classname="tests.records.test_api" name="black" time="0.153" /><testcase classname="tests.records.test_api" name="test_idempotence_dumps_loads" time="5.309" /><testcase classname="tests.records.test_jsonschema" name="ISORT" time="0.078" /><testcase classname="tests.records.test_jsonschema" name="black" time="0.249" /><testcase classname="tests.records.test_jsonschema" name="test_full_record" time="1.260" /><testcase classname="tests.records.test_jsonschema" name="test_tombstone_record" time="0.007" /><testcase classname="tests.records.test_jsonschema" name="test_id" time="0.006" /><testcase classname="tests.records.test_jsonschema" name="test_pids" time="0.013" /><testcase classname="tests.records.test_jsonschema" name="test_metadata" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_resource_type" time="0.007" /><testcase classname="tests.records.test_jsonschema" name="test_creators" time="0.031" /><testcase classname="tests.records.test_jsonschema" name="test_title" time="0.006" /><testcase classname="tests.records.test_jsonschema" name="test_additional_titles" time="0.014" /><testcase classname="tests.records.test_jsonschema" name="test_publisher" time="0.009" /><testcase classname="tests.records.test_jsonschema" name="test_publication_date" time="0.011" /><testcase classname="tests.records.test_jsonschema" name="test_subjects" time="0.014" /><testcase classname="tests.records.test_jsonschema" name="test_contributors" time="0.036" /><testcase classname="tests.records.test_jsonschema" name="test_dates" time="0.014" /><testcase classname="tests.records.test_jsonschema" name="test_languages" time="0.013" /><testcase classname="tests.records.test_jsonschema" name="test_identifiers" time="0.015" /><testcase classname="tests.records.test_jsonschema" name="test_related_identifiers" time="0.019" /><testcase classname="tests.records.test_jsonschema" name="test_sizes" time="0.009" /><testcase classname="tests.records.test_jsonschema" name="test_formats" time="0.008" /><testcase classname="tests.records.test_jsonschema" name="test_version" time="0.009" /><testcase classname="tests.records.test_jsonschema" name="test_rights" time="0.018" /><testcase classname="tests.records.test_jsonschema" name="test_description" time="0.008" /><testcase classname="tests.records.test_jsonschema" name="test_additional_descriptions" time="0.013" /><testcase classname="tests.records.test_jsonschema" name="test_locations_valid[features0]" time="0.005" /><testcase classname="tests.records.test_jsonschema" name="test_locations_valid[features1]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_valid[features2]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_valid[features3]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_valid[features4]" time="0.005" /><testcase classname="tests.records.test_jsonschema" name="test_locations_invalid[None]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_invalid[locations1]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_invalid[locations2]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_invalid[locations3]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_locations_invalid[locations4]" time="0.004" /><testcase classname="tests.records.test_jsonschema" name="test_funding" time="0.018" /><testcase classname="tests.records.test_jsonschema" name="test_reference" time="0.007" /><testcase classname="tests.records.test_jsonschema" name="test_tombstones" time="0.008" /><testcase classname="tests.records.test_jsonschema" name="test_no_external_resolution" time="0.016" /><testcase classname="tests.records.test_quotas" name="ISORT" time="0.017" /><testcase classname="tests.records.test_quotas" name="black" time="0.167" /><testcase classname="tests.records.test_quotas" name="test_user_quota" time="4.019" /><testcase classname="tests.records.test_quotas" name="test_record_quota" time="1.868" /><testcase classname="tests.records.test_records_communities" name="ISORT" time="0.014" /><testcase classname="tests.records.test_records_communities" name="black" time="0.163" /><testcase classname="tests.records.test_records_communities" name="test_community_integration" time="5.506" /><testcase classname="tests.records.test_relations_affiliations" name="ISORT" time="0.036" /><testcase classname="tests.records.test_relations_affiliations" name="black" time="0.199" /><testcase classname="tests.records.test_relations_affiliations" name="test_affiliations_field" time="4.734" /><testcase classname="tests.records.test_relations_affiliations" name="test_creator_affiliations_validation" time="1.653" /><testcase classname="tests.records.test_relations_affiliations" name="test_creator_affiliations_with_name_validation" time="0.563" /><testcase classname="tests.records.test_relations_affiliations" name="test_creator_affiliations_with_name_cleanup_validation" time="0.565" /><testcase classname="tests.records.test_relations_affiliations" name="test_creator_affiliations_indexing" time="0.610" /><testcase classname="tests.records.test_relations_affiliations" name="test_creator_affiliations_invalid" time="0.616" /><testcase classname="tests.records.test_relations_affiliations" name="test_contributor_affiliations_validation" time="0.551" /><testcase classname="tests.records.test_relations_affiliations" name="test_contributor_affiliations_indexing" time="0.565" /><testcase classname="tests.records.test_relations_affiliations" name="test_contributor_affiliations_invalid" time="1.123" /><testcase classname="tests.records.test_relations_languages" name="ISORT" time="0.027" /><testcase classname="tests.records.test_relations_languages" name="black" time="0.169" /><testcase classname="tests.records.test_relations_languages" name="test_languages_field" time="4.693" /><testcase classname="tests.records.test_relations_languages" name="test_languages_validation" time="0.573" /><testcase classname="tests.records.test_relations_languages" name="test_languages_indexing" time="0.585" /><testcase classname="tests.records.test_relations_languages" name="test_languages_invalid" time="1.155" /><testcase classname="tests.records.test_relations_resource_types" name="ISORT" time="0.014" /><testcase classname="tests.records.test_relations_resource_types" name="black" time="0.162" /><testcase classname="tests.records.test_relations_resource_types" name="test_resource_types_field" time="4.716" /><testcase classname="tests.records.test_relations_resource_types" name="test_resource_type_validation" time="1.925" /><testcase classname="tests.records.test_relations_resource_types" name="test_resource_types_indexing" time="1.106" /><testcase classname="tests.records.test_relations_subjects" name="ISORT" time="0.020" /><testcase classname="tests.records.test_relations_subjects" name="black" time="0.165" /><testcase classname="tests.records.test_relations_subjects" name="test_subjects_field" time="4.739" /><testcase classname="tests.records.test_relations_subjects" name="test_subjects_validation" time="0.624" /><testcase classname="tests.records.test_relations_subjects" name="test_subjects_indexing" time="1.111" /><testcase classname="tests.requests.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.requests.__init__" name="ISORT" time="0.005" /><testcase classname="tests.requests.__init__" name="black" time="0.150" /><testcase classname="tests.requests.conftest" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.requests.conftest" name="ISORT" time="0.013" /><testcase classname="tests.requests.conftest" name="black" time="0.154" /><testcase classname="tests.requests.test_record_deletion" name="ISORT" time="0.023" /><testcase classname="tests.requests.test_record_deletion" name="black" time="0.168" /><testcase classname="tests.requests.test_record_deletion" name="test_request_create" time="7.478" /><testcase classname="tests.requests.test_record_deletion" name="test_request_create_exisiting_open_request" time="1.839" /><testcase classname="tests.requests.test_record_deletion" name="test_request_submit" time="1.727" /><testcase classname="tests.requests.test_record_deletion" name="test_request_accept" time="2.751" /><testcase classname="tests.requests.test_user_moderation_actions" name="ISORT" time="0.023" /><testcase classname="tests.requests.test_user_moderation_actions" name="black" time="0.174" /><testcase classname="tests.requests.test_user_moderation_actions" name="test_user_moderation_approve" time="9.512" /><testcase classname="tests.requests.test_user_moderation_actions" name="test_user_moderation_decline" time="2.220" /><testcase classname="tests.requests.test_user_moderation_actions" name="test_is_verified_system_user" time="3.343" /><testcase classname="tests.resources.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.resources.__init__" name="ISORT" time="0.004" /><testcase classname="tests.resources.__init__" name="black" time="0.152" /><testcase classname="tests.resources.conftest" name="PYDOCSTYLE" time="0.010" /><testcase classname="tests.resources.conftest" name="ISORT" time="0.015" /><testcase classname="tests.resources.conftest" name="black" time="0.165" /><testcase classname="tests.resources.serializers.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.resources.serializers.__init__" name="ISORT" time="0.004" /><testcase classname="tests.resources.serializers.__init__" name="black" time="0.150" /><testcase classname="tests.resources.serializers.conftest" name="PYDOCSTYLE" time="0.028" /><testcase classname="tests.resources.serializers.conftest" name="ISORT" time="0.083" /><testcase classname="tests.resources.serializers.conftest" name="black" time="0.243" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="ISORT" time="0.077" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="black" time="0.224" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_bibtex_serializer_minimal_record" time="4.763" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_bibtex_serializer_full_record" time="0.525" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_bibtex_serializer_record_all_versions" time="0.517" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication]" time="0.501" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-annotationcollection]" time="0.512" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-datamanagementplan]" time="0.507" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-journal]" time="0.502" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-patent]" time="0.504" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-peerreview]" time="0.505" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-deliverable]" time="0.498" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-milestone]" time="0.518" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-proposal]" time="0.500" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-report]" time="0.501" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-softwaredocumentation]" time="0.498" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-taxonomictreatment]" time="0.504" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-datapaper]" time="0.503" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-dissertation]" time="0.528" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-standard]" time="0.504" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[publication-other]" time="2.306" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[poster]" time="0.535" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[presentation]" time="0.509" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[event]" time="0.510" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image]" time="0.499" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-figure]" time="0.506" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-plot]" time="0.507" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-drawing]" time="0.505" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-diagram]" time="0.506" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-photo]" time="0.502" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[image-other]" time="0.510" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[model]" time="0.503" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[video]" time="0.498" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[lesson]" time="0.503" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[software-computationalnotebook]" time="0.500" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[other]" time="0.506" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[physicalobject]" time="0.513" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_misc_types[workflow]" time="0.515" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_conferencepaper" time="0.502" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_conferenceproceeding" time="0.517" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_booksection" time="2.474" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_book" time="0.503" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_article" time="0.506" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_preprint" time="0.500" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_thesis" time="0.502" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_technicalnote" time="0.500" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_publication_workingpaper" time="0.496" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_software" time="0.502" /><testcase classname="tests.resources.serializers.test_bibtex_serializer" name="test_serialize_dataset" time="1.070" /><testcase classname="tests.resources.serializers.test_cff_serializer" name="ISORT" time="0.014" /><testcase classname="tests.resources.serializers.test_cff_serializer" name="black" time="0.158" /><testcase classname="tests.resources.serializers.test_cff_serializer" name="test_cff_serializer" time="5.203" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="ISORT" time="0.028" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="black" time="0.180" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="test_csl_json_serializer" time="4.796" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="test_citation_string_serializer_records_list" time="4.080" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="test_citation_string_serializer_record" time="2.442" /><testcase classname="tests.resources.serializers.test_csl_serializer" name="test_citation_string_serializer_empty_record" time="1.014" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="ISORT" time="0.073" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="black" time="0.233" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer" time="4.733" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_xml_serializer" time="0.697" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_identifiers" time="0.530" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_access_right" time="0.521" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer_with_unknown_id_schemes" time="2.623" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_xml_serializer_with_unknown_id_schemes" time="0.608" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer_with_box" time="0.636" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer_with_polygon" time="0.623" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer_updated_date" time="0.636" /><testcase classname="tests.resources.serializers.test_datacite43_serializer" name="test_datacite43_serializer_empty_record" time="1.036" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="ISORT" time="0.079" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="black" time="0.238" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer" time="4.846" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_xml_serializer" time="0.619" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_alternate_identifiers" time="0.513" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_access_right" time="0.522" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer_with_unknown_id_schemes" time="0.631" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_xml_serializer_with_unknown_id_schemes" time="0.594" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer_with_box" time="0.601" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer_with_polygon" time="0.606" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer_updated_date" time="0.603" /><testcase classname="tests.resources.serializers.test_datacite45_serializer" name="test_datacite45_serializer_empty_record" time="1.072" /><testcase classname="tests.resources.serializers.test_datapackage_serializer" name="ISORT" time="0.019" /><testcase classname="tests.resources.serializers.test_datapackage_serializer" name="black" time="0.168" /><testcase classname="tests.resources.serializers.test_datapackage_serializer" name="test_data_package_serializer_empty_record" time="0.002" /><testcase classname="tests.resources.serializers.test_datapackage_serializer" name="test_data_package_serializer_minimal_record" time="0.002" /><testcase classname="tests.resources.serializers.test_datapackage_serializer" name="test_data_package_serializer_full_record" time="0.002" /><testcase classname="tests.resources.serializers.test_dcat_serializer" name="ISORT" time="0.041" /><testcase classname="tests.resources.serializers.test_dcat_serializer" name="black" time="0.178" /><testcase classname="tests.resources.serializers.test_dcat_serializer" name="test_dcat_serializer" time="5.319" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="ISORT" time="0.038" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="black" time="0.183" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorejson_serializer" time="4.758" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorejson_serializer_minimal" time="0.524" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorejson_serializer_empty_record" time="2.634" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_vocabulary_type_error" time="0.519" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorexml_serializer" time="0.517" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorexml_serializer_minimal" time="0.517" /><testcase classname="tests.resources.serializers.test_dublincore_serializer" name="test_dublincorexml_serializer_list" time="1.040" /><testcase classname="tests.resources.serializers.test_geojson_serializer" name="ISORT" time="0.029" /><testcase classname="tests.resources.serializers.test_geojson_serializer" name="black" time="0.184" /><testcase classname="tests.resources.serializers.test_geojson_serializer" name="test_geojson_serializer_no_records" time="0.001" /><testcase classname="tests.resources.serializers.test_geojson_serializer" name="test_geojson_serializer_single_records" time="0.001" /><testcase classname="tests.resources.serializers.test_geojson_serializer" name="test_geojson_serializer_multiple_records" time="0.001" /><testcase classname="tests.resources.serializers.test_marcxml_serializer" name="ISORT" time="0.041" /><testcase classname="tests.resources.serializers.test_marcxml_serializer" name="black" time="0.183" /><testcase classname="tests.resources.serializers.test_marcxml_serializer" name="test_marcxml_serializer_minimal_record" time="5.723" /><testcase classname="tests.resources.serializers.test_marcxml_serializer" name="test_marcxml_serializer_full_record" time="1.030" /><testcase classname="tests.resources.serializers.test_schemaorg_serializer" name="ISORT" time="0.029" /><testcase classname="tests.resources.serializers.test_schemaorg_serializer" name="black" time="0.180" /><testcase classname="tests.resources.serializers.test_schemaorg_serializer" name="test_schemaorg_serializer_full_record" time="4.754" /><testcase classname="tests.resources.serializers.test_schemaorg_serializer" name="test_schemaorg_serializer_minimal_record" time="0.531" /><testcase classname="tests.resources.serializers.test_schemaorg_serializer" name="test_schemaorg_serializer_empty_record" time="1.022" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="ISORT" time="0.069" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="black" time="0.227" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="test_signposting_serializer_full" time="4.817" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="test_signposting_lvl1_serializer_full_collections_too_big" time="0.523" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="test_signposting_lvl1_serializer_full_collections_size_ok" time="0.506" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="test_signposting_serializer_minimal" time="0.520" /><testcase classname="tests.resources.serializers.test_signposting_serializer" name="test_signposting_lvl1_serializer_minimal" time="1.051" /><testcase classname="tests.resources.serializers.test_ui_serializer" name="ISORT" time="0.043" /><testcase classname="tests.resources.serializers.test_ui_serializer" name="black" time="0.210" /><testcase classname="tests.resources.serializers.test_ui_serializer" name="test_ui_serializer" time="3.674" /><testcase classname="tests.resources.test_access_requests" name="ISORT" time="0.051" /><testcase classname="tests.resources.test_access_requests" name="black" time="0.218" /><testcase classname="tests.resources.test_access_requests" name="test_simple_guest_access_request_flow" time="8.317" /><testcase classname="tests.resources.test_access_requests" name="test_simple_user_access_request_flow" time="3.983" /><testcase classname="tests.resources.test_access_requests" name="test_access_grant_for_user" time="1.306" /><testcase classname="tests.resources.test_access_requests" name="test_access_grant_for_system_role" time="1.262" /><testcase classname="tests.resources.test_access_requests" name="test_access_grant_for_role" time="4.227" /><testcase classname="tests.resources.test_draft_file_permissions" name="ISORT" time="0.077" /><testcase classname="tests.resources.test_draft_file_permissions" name="black" time="0.246" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_init_file_upload" time="5.235" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_no_one_can_init_remote_file" time="0.881" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_no_one_can_init_file_fetch" time="0.873" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_upload_file" time="0.977" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_commit_file" time="1.000" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_list_restricted_files" time="1.071" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_read_restricted_file_metadata" time="1.085" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_download_restricted_file" time="1.100" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_import_files" time="2.548" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_delete_file" time="1.081" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_delete_all_files" time="1.111" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_update_file_options" time="1.200" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_only_owners_can_list_draft_w_public_files" time="1.104" /><testcase classname="tests.resources.test_draft_file_permissions" name="test_metadata_only_records_disabled" time="1.638" /><testcase classname="tests.resources.test_files" name="ISORT" time="0.047" /><testcase classname="tests.resources.test_files" name="black" time="0.214" /><testcase classname="tests.resources.test_files" name="test_published_record_files_allow_edit" time="8.166" /><testcase classname="tests.resources.test_files" name="test_published_record_files_deny_edit" time="2.458" /><testcase classname="tests.resources.test_files" name="test_files_api_flow_for_deleted_record" time="2.787" /><testcase classname="tests.resources.test_files" name="test_filename_with_slash_flow_for_deleted_record_" time="2.870" /><testcase classname="tests.resources.test_files" name="test_upload_and_access_filename_with_slash" time="2.688" /><testcase classname="tests.resources.test_iiif_image_api" name="ISORT" time="0.047" /><testcase classname="tests.resources.test_iiif_image_api" name="black" time="0.212" /><testcase classname="tests.resources.test_iiif_image_api" name="test_file_links_depending_on_file_extensions" time="13.335" /><testcase classname="tests.resources.test_iiif_image_api" name="test_iiif_base" time="4.044" /><testcase classname="tests.resources.test_iiif_image_api" name="test_iiif_info" time="4.023" /><testcase classname="tests.resources.test_iiif_image_api" name="test_api_info_not_found" time="0.739" /><testcase classname="tests.resources.test_iiif_image_api" name="test_iiif_base_restricted_files" time="4.522" /><testcase classname="tests.resources.test_iiif_image_api" name="test_iiif_info_restricted_files" time="4.474" /><testcase classname="tests.resources.test_iiif_image_api" name="test_iiif_image_api" time="5.266" /><testcase classname="tests.resources.test_iiif_presentation_api" name="ISORT" time="0.033" /><testcase classname="tests.resources.test_iiif_presentation_api" name="black" time="0.194" /><testcase classname="tests.resources.test_iiif_presentation_api" name="test_iiif_manifest_schema" time="6.854" /><testcase classname="tests.resources.test_iiif_presentation_api" name="test_iiif_manifest" time="2.408" /><testcase classname="tests.resources.test_iiif_presentation_api" name="test_empty_iiif_manifest" time="2.355" /><testcase classname="tests.resources.test_iiif_presentation_api" name="test_empty_iiif_manifest_filename_with_slash" time="2.351" /><testcase classname="tests.resources.test_iiif_presentation_api" name="test_iiif_manifest_restricted_files" time="3.327" /><testcase classname="tests.resources.test_media_files" name="ISORT" time="0.036" /><testcase classname="tests.resources.test_media_files" name="black" time="0.202" /><testcase classname="tests.resources.test_media_files" name="test_upload_media_files" time="5.503" /><testcase classname="tests.resources.test_media_files" name="test_only_owners_can_delete_media_file" time="1.141" /><testcase classname="tests.resources.test_media_files" name="test_only_owners_can_delete_all_files" time="1.129" /><testcase classname="tests.resources.test_media_files" name="test_only_owners_can_list_draft_w_public_files" time="1.115" /><testcase classname="tests.resources.test_media_files" name="test_list_media_files_for_deleted_record" time="3.398" /><testcase classname="tests.resources.test_publish_errors" name="ISORT" time="0.026" /><testcase classname="tests.resources.test_publish_errors" name="black" time="0.170" /><testcase classname="tests.resources.test_publish_errors" name="test_simple_field_error" time="5.450" /><testcase classname="tests.resources.test_publish_errors" name="test_nested_field_error" time="1.157" /><testcase classname="tests.resources.test_publish_errors" name="test_multiple_errors" time="0.521"><skipped type="pytest.skip" message="currently don't know how to test this">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/resources/test_publish_errors.py:83: currently don't know how to test this</skipped></testcase><testcase classname="tests.resources.test_record_file_permissions" name="ISORT" time="0.034" /><testcase classname="tests.resources.test_record_file_permissions" name="black" time="0.195" /><testcase classname="tests.resources.test_record_file_permissions" name="test_only_owners_can_list_restricted_files" time="6.566" /><testcase classname="tests.resources.test_record_file_permissions" name="test_only_owners_can_read_restricted_file_metadata" time="2.206" /><testcase classname="tests.resources.test_record_file_permissions" name="test_only_owners_can_download_restricted_file" time="5.211" /><testcase classname="tests.resources.test_record_file_permissions" name="test_record_files_cannot_be_deleted" time="2.110" /><testcase classname="tests.resources.test_record_file_permissions" name="test_files_cannot_be_uploaded_to_records" time="2.114" /><testcase classname="tests.resources.test_record_file_permissions" name="test_record_files_options_cannot_be_modified" time="2.142" /><testcase classname="tests.resources.test_record_file_permissions" name="test_record_files_cannot_be_imported" time="2.094" /><testcase classname="tests.resources.test_record_file_permissions" name="test_everybody_can_download_public_files" time="2.281" /><testcase classname="tests.resources.test_request_deletion" name="ISORT" time="0.024" /><testcase classname="tests.resources.test_request_deletion" name="black" time="0.180" /><testcase classname="tests.resources.test_request_deletion" name="test_success" time="7.018" /><testcase classname="tests.resources.test_request_deletion" name="test_request_flow" time="2.727" /><testcase classname="tests.resources.test_request_deletion" name="test_feature_disabled" time="1.792" /><testcase classname="tests.resources.test_request_deletion" name="test_invalid_record" time="0.502" /><testcase classname="tests.resources.test_request_deletion" name="test_already_deleted" time="2.679" /><testcase classname="tests.resources.test_resources" name="ISORT" time="0.124" /><testcase classname="tests.resources.test_resources" name="black" time="0.339" /><testcase classname="tests.resources.test_resources" name="test_simple_flow" time="6.767" /><testcase classname="tests.resources.test_resources" name="test_create_draft" time="1.000" /><testcase classname="tests.resources.test_resources" name="test_create_partial_draft" time="1.007" /><testcase classname="tests.resources.test_resources" name="test_create_draft_w_extra_fields_reports_error_doesnt_save_field" time="1.013" /><testcase classname="tests.resources.test_resources" name="test_read_draft" time="1.120" /><testcase classname="tests.resources.test_resources" name="test_update_draft" time="1.281" /><testcase classname="tests.resources.test_resources" name="test_update_partial_draft" time="1.295" /><testcase classname="tests.resources.test_resources" name="test_delete_draft" time="1.121" /><testcase classname="tests.resources.test_resources" name="test_publish_draft" time="1.975" /><testcase classname="tests.resources.test_resources" name="test_publish_draft_w_dates" time="2.112" /><testcase classname="tests.resources.test_resources" name="test_user_records_and_drafts" time="2.833" /><testcase classname="tests.resources.test_resources" name="test_multiple_files_record" time="2.510" /><testcase classname="tests.resources.test_resources" name="test_restricted_records_disabled" time="1.505" /><testcase classname="tests.resources.test_resources" name="test_create_publish_new_revision" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/resources/test_resources.py:517: unconditional skip</skipped></testcase><testcase classname="tests.resources.test_resources" name="test_ui_data_in_record" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/resources/test_resources.py:576: unconditional skip</skipped></testcase><testcase classname="tests.resources.test_resources" name="test_link_creation" time="2.054" /><testcase classname="tests.resources.test_resources" name="test_link_deletion" time="2.017" /><testcase classname="tests.resources.test_resources" name="test_link_update" time="5.510" /><testcase classname="tests.resources.test_resources" name="test_response_handlers" time="4.945" /><testcase classname="tests.resources.test_resources" name="test_reserve_pid_with_login" time="1.182" /><testcase classname="tests.resources.test_resources" name="test_discard_pid_with_login" time="1.359" /><testcase classname="tests.resources.test_resources" name="test_publish_pid_flow" time="2.043" /><testcase classname="tests.resources.test_resources" name="test_search_community_records" time="2.926" /><testcase classname="tests.resources.test_resources" name="test_search_internal_notes_fields" time="3.059" /><testcase classname="tests.resources.test_resources_communities" name="ISORT" time="0.139" /><testcase classname="tests.resources.test_resources_communities" name="black" time="0.350" /><testcase classname="tests.resources.test_resources_communities" name="test_uploader_add_record_to_communities" time="7.700" /><testcase classname="tests.resources.test_resources_communities" name="test_community_owner_add_record_to_communities" time="4.026" /><testcase classname="tests.resources.test_resources_communities" name="test_community_owner_add_record_to_communities_forcing_review_with_comment" time="2.943" /><testcase classname="tests.resources.test_resources_communities" name="test_restrict_community_before_accepting_inclusion" time="2.420" /><testcase classname="tests.resources.test_resources_communities" name="test_create_new_version_after_inclusion_request" time="4.475" /><testcase classname="tests.resources.test_resources_communities" name="test_accept_public_record_in_restricted_community" time="2.215" /><testcase classname="tests.resources.test_resources_communities" name="test_include_community_already_in" time="1.819" /><testcase classname="tests.resources.test_resources_communities" name="test_include_community_already_request_open" time="2.292" /><testcase classname="tests.resources.test_resources_communities" name="test_invalid_record_or_draft" time="0.979" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_community" time="3.681" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_missing_permission" time="2.044" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_existing_non_existing_community" time="1.980" /><testcase classname="tests.resources.test_resources_communities" name="test_add_remove_non_existing_community[payload0]" time="2.067" /><testcase classname="tests.resources.test_resources_communities" name="test_add_remove_non_existing_community[payload1]" time="2.149" /><testcase classname="tests.resources.test_resources_communities" name="test_add_remove_non_existing_community[payload2]" time="2.108" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_another_community" time="2.139" /><testcase classname="tests.resources.test_resources_communities" name="test_add_remove_exceeded_max_number_of_communities" time="1.800" /><testcase classname="tests.resources.test_resources_communities" name="test_search_communities" time="2.822" /><testcase classname="tests.resources.test_resources_communities" name="test_add_record_to_community_submission_closed_non_member" time="2.244" /><testcase classname="tests.resources.test_resources_communities" name="test_add_record_to_community_submission_closed_member" time="5.819" /><testcase classname="tests.resources.test_resources_communities" name="test_add_record_to_community_submission_open_non_member" time="2.176" /><testcase classname="tests.resources.test_resources_communities" name="test_add_record_to_restricted_community_submission_open_non_member" time="1.908" /><testcase classname="tests.resources.test_resources_communities" name="test_add_record_to_restricted_community_submission_open_member" time="2.196" /><testcase classname="tests.resources.test_resources_communities" name="test_restricted_record_creation" time="3.972" /><testcase classname="tests.resources.test_resources_communities" name="test_republish_with_mulitple_communities" time="3.849" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_last_existing_non_existing_community" time="1.971" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_last_community_api_error_handling" time="2.943" /><testcase classname="tests.resources.test_resources_communities" name="test_remove_record_last_community_with_multiple_communities" time="3.401" /><testcase classname="tests.resources.test_resources_community_records" name="ISORT" time="0.018" /><testcase classname="tests.resources.test_resources_community_records" name="black" time="0.168" /><testcase classname="tests.resources.test_resources_community_records" name="test_remove_community" time="6.192" /><testcase classname="tests.resources.test_resources_community_records" name="test_permission_denied" time="1.893" /><testcase classname="tests.resources.test_resources_community_records" name="test_error_data" time="0.935" /><testcase classname="tests.resources.test_resources_community_records" name="test_removal_of_multiple_communities_success" time="4.695" /><testcase classname="tests.resources.test_resources_community_records" name="test_exceeded_max_number_of_records" time="1.544" /><testcase classname="tests.resources.test_resources_oai" name="ISORT" time="0.049" /><testcase classname="tests.resources.test_resources_oai" name="black" time="0.211" /><testcase classname="tests.resources.test_resources_oai" name="test_create_set" time="3.956" /><testcase classname="tests.resources.test_resources_oai" name="test_create_set_duplicate" time="0.598" /><testcase classname="tests.resources.test_resources_oai" name="test_create_set_invalid_data" time="1.028" /><testcase classname="tests.resources.test_resources_oai" name="test_get_set" time="0.745" /><testcase classname="tests.resources.test_resources_oai" name="test_get_set_not_existing" time="0.555" /><testcase classname="tests.resources.test_resources_oai" name="test_update_set" time="0.602" /><testcase classname="tests.resources.test_resources_oai" name="test_update_set_invalid_data" time="0.593" /><testcase classname="tests.resources.test_resources_oai" name="test_delete_set" time="0.628" /><testcase classname="tests.resources.test_resources_oai" name="test_delete_set_not_existing" time="0.558" /><testcase classname="tests.resources.test_resources_oai" name="test_search_sets" time="0.773" /><testcase classname="tests.resources.test_resources_oai" name="test_search_metadata_formats" time="0.541" /><testcase classname="tests.resources.test_resources_oai" name="test_links" time="1.031" /><testcase classname="tests.resources.test_resources_pids" name="ISORT" time="0.028" /><testcase classname="tests.resources.test_resources_pids" name="black" time="0.190" /><testcase classname="tests.resources.test_resources_pids" name="test_external_doi_cleanup" time="12.575" /><testcase classname="tests.resources.test_resources_pids" name="test_external_doi_duplicate_detection" time="2.899" /><testcase classname="tests.resources.test_resources_pids" name="test_external_doi_blocked_prefix" time="1.057" /><testcase classname="tests.resources.test_resources_pids" name="test_external_doi_required" time="1.061" /><testcase classname="tests.resources.test_resources_pids" name="test_pids_publish_validation_error" time="1.350" /><testcase classname="tests.resources.test_resources_pids" name="test_required_pids_removed" time="3.722" /><testcase classname="tests.resources.test_resources_record_communities" name="ISORT" time="0.024" /><testcase classname="tests.resources.test_resources_record_communities" name="black" time="0.183" /><testcase classname="tests.resources.test_resources_record_communities" name="test_search_record_suggested_communities" time="8.212" /><testcase classname="tests.resources.test_resources_record_communities" name="test_set_default_community" time="4.264" /><testcase classname="tests.resources.test_resources_review" name="ISORT" time="0.071" /><testcase classname="tests.resources.test_resources_review" name="black" time="0.240" /><testcase classname="tests.resources.test_resources_review" name="test_simple_flow" time="8.013" /><testcase classname="tests.resources.test_resources_review" name="test_review_endpoints" time="2.067" /><testcase classname="tests.resources.test_resources_review" name="test_review_errors" time="1.199" /><testcase classname="tests.resources.test_resources_review" name="test_delete_no_review" time="1.820" /><testcase classname="tests.resources.test_resources_review" name="test_submission_closed_non_member" time="1.274" /><testcase classname="tests.resources.test_resources_review" name="test_submission_closed_member" time="1.393" /><testcase classname="tests.resources.test_resources_review" name="test_submission_open_non_member" time="1.490" /><testcase classname="tests.resources.test_resources_review" name="test_submission_open_member" time="1.377" /><testcase classname="tests.resources.test_resources_review" name="test_submission_open_in_restricted_community_non_member" time="1.249" /><testcase classname="tests.resources.test_resources_review" name="test_submission_open_in_restricted_community_member" time="1.910" /><testcase classname="tests.resources.test_resources_search" name="ISORT" time="0.014" /><testcase classname="tests.resources.test_resources_search" name="black" time="0.164" /><testcase classname="tests.resources.test_resources_search" name="test_advance_record_search" time="7.228" /><testcase classname="tests.resources.test_resources_user_access" name="ISORT" time="0.042" /><testcase classname="tests.resources.test_resources_user_access" name="black" time="0.210" /><testcase classname="tests.resources.test_resources_user_access" name="test_read_by_subject_found" time="5.210" /><testcase classname="tests.resources.test_resources_user_access" name="test_read_by_subject_not_found" time="0.995" /><testcase classname="tests.resources.test_resources_user_access" name="test_delete_by_subject_found" time="1.095" /><testcase classname="tests.resources.test_resources_user_access" name="test_delete_by_subject_id_not_found" time="0.807" /><testcase classname="tests.resources.test_resources_user_access" name="test_search_grants_by_subject" time="1.400" /><testcase classname="tests.resources.test_resources_user_access" name="test_search_grants_by_subject_not_found" time="0.822" /><testcase classname="tests.resources.test_resources_user_access" name="test_patch_grants_by_subject" time="4.623" /><testcase classname="tests.resources.test_resources_user_access" name="test_patch_grants_by_subject_not_found" time="1.292" /><testcase classname="tests.resources.test_rocrate" name="ISORT" time="0.033" /><testcase classname="tests.resources.test_rocrate" name="black" time="0.189" /><testcase classname="tests.resources.test_rocrate" name="test_rocrate_content_type" time="5.193" /><testcase classname="tests.resources.test_rocrate" name="test_invalid_rocrate" time="1.287" /><testcase classname="tests.resources.test_serialized_links" name="ISORT" time="0.027" /><testcase classname="tests.resources.test_serialized_links" name="black" time="0.188" /><testcase classname="tests.resources.test_serialized_links" name="test_draft_links" time="5.238" /><testcase classname="tests.resources.test_serialized_links" name="test_record_links" time="1.837" /><testcase classname="tests.resources.test_serialized_links" name="test_record_search_links" time="1.885" /><testcase classname="tests.resources.test_serialized_links" name="test_versions_search_links" time="2.307" /><testcase classname="tests.resources.test_signposting" name="ISORT" time="0.012" /><testcase classname="tests.resources.test_signposting" name="black" time="0.161" /><testcase classname="tests.resources.test_signposting" name="test_link_in_metadata_resource_response_headers" time="6.155" /><testcase classname="tests.resources.test_signposting" name="test_signposting_link_permissions" time="1.338" /><testcase classname="tests.resources.test_signposting" name="test_linkset_endpoint" time="2.424" /><testcase classname="tests.resources.vocabularies.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.resources.vocabularies.__init__" name="ISORT" time="0.007" /><testcase classname="tests.resources.vocabularies.__init__" name="black" time="0.153" /><testcase classname="tests.resources.vocabularies.conftest" name="PYDOCSTYLE" time="0.007" /><testcase classname="tests.resources.vocabularies.conftest" name="ISORT" time="0.017" /><testcase classname="tests.resources.vocabularies.conftest" name="black" time="0.164" /><testcase classname="tests.resources.vocabularies.test_affiliations_vocabulary" name="ISORT" time="0.013" /><testcase classname="tests.resources.vocabularies.test_affiliations_vocabulary" name="black" time="0.162" /><testcase classname="tests.resources.vocabularies.test_affiliations_vocabulary" name="test_affiliations_get" time="3.810" /><testcase classname="tests.resources.vocabularies.test_affiliations_vocabulary" name="test_affiliations_search" time="1.230" /><testcase classname="tests.resources.vocabularies.test_awards_vocabulary" name="ISORT" time="0.009" /><testcase classname="tests.resources.vocabularies.test_awards_vocabulary" name="black" time="0.156" /><testcase classname="tests.resources.vocabularies.test_awards_vocabulary" name="test_awards_get" time="3.903" /><testcase classname="tests.resources.vocabularies.test_awards_vocabulary" name="test_awards_search" time="1.331" /><testcase classname="tests.resources.vocabularies.test_funders_vocabulary" name="ISORT" time="0.006" /><testcase classname="tests.resources.vocabularies.test_funders_vocabulary" name="black" time="0.158" /><testcase classname="tests.resources.vocabularies.test_funders_vocabulary" name="test_funders_get" time="3.703" /><testcase classname="tests.resources.vocabularies.test_funders_vocabulary" name="test_funders_search" time="1.243" /><testcase classname="tests.resources.vocabularies.test_names_vocabulary" name="ISORT" time="0.014" /><testcase classname="tests.resources.vocabularies.test_names_vocabulary" name="black" time="0.163" /><testcase classname="tests.resources.vocabularies.test_names_vocabulary" name="test_names_get" time="3.912" /><testcase classname="tests.resources.vocabularies.test_names_vocabulary" name="test_names_search" time="1.332" /><testcase classname="tests.resources.vocabularies.test_subjects_vocabulary" name="ISORT" time="0.013" /><testcase classname="tests.resources.vocabularies.test_subjects_vocabulary" name="black" time="0.162" /><testcase classname="tests.resources.vocabularies.test_subjects_vocabulary" name="test_subjects_get" time="0.000"><skipped type="pytest.skip" message="resolving does not work due to url econding. Tried encode/quote, fails.">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/resources/vocabularies/test_subjects_vocabulary.py:34: resolving does not work due to url econding. Tried encode/quote, fails.</skipped></testcase><testcase classname="tests.resources.vocabularies.test_subjects_vocabulary" name="test_subjects_search" time="2.938"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f90b3c50&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f90b3c50&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8f5bc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f9548220&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8f59ac0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f954a740&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f90ce150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f90b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8f58740&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f90b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8f5bc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f9548220&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8f59ac0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f954a740&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8f434d0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f93fe690&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8f42330&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.secret_links.__init__" name="ISORT" time="0.003" /><testcase classname="tests.secret_links.__init__" name="black" time="0.154" /><testcase classname="tests.secret_links.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.secret_links.conftest" name="ISORT" time="0.007" /><testcase classname="tests.secret_links.conftest" name="black" time="0.153" /><testcase classname="tests.secret_links.test_secret_links" name="ISORT" time="0.018" /><testcase classname="tests.secret_links.test_secret_links" name="black" time="0.170" /><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_creation" time="2.651"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_not_expired" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_expired" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_revoke" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_get_by_token" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_get_by_invalid_token" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_get_by_old_token" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_validate_token" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_secret_links" name="test_secret_link_validate_token_expired" time="0.364"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f92fcd40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f8d44540&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f952ef30&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d45000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8824dc0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f8d44840&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8826c80&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8d1b020&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f884bd10&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8d1b770&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_sharing" name="ISORT" time="0.036" /><testcase classname="tests.secret_links.test_sharing" name="black" time="0.197" /><testcase classname="tests.secret_links.test_sharing" name="test_invalid_level" time="2.646"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f831dfd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f86de180&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_sharing" name="test_permission_levels" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f831dfd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f86de180&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_sharing" name="test_read_restricted_record_with_secret_link" time="0.346"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f831dfd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f86de180&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f8bbed50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86df140&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43790&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f86dfc40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f8f43be0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f8b43e00&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f8b2be90&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f8b43e60&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.secret_links.test_token_serializers" name="ISORT" time="0.019" /><testcase classname="tests.secret_links.test_token_serializers" name="black" time="0.171" /><testcase classname="tests.secret_links.test_token_serializers" name="test_serializer" time="5.049" /><testcase classname="tests.secret_links.test_token_serializers" name="test_serializer_validate_token" time="0.002" /><testcase classname="tests.secret_links.test_token_serializers" name="test_serializer_validate_invalid_token" time="0.001" /><testcase classname="tests.secret_links.test_token_serializers" name="test_timed_serializer" time="0.002" /><testcase classname="tests.secret_links.test_token_serializers" name="test_timed_serializer_expired" time="0.003" /><testcase classname="tests.services.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.services.__init__" name="ISORT" time="0.004" /><testcase classname="tests.services.__init__" name="black" time="0.151" /><testcase classname="tests.services.components.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.services.components.__init__" name="ISORT" time="0.004" /><testcase classname="tests.services.components.__init__" name="black" time="0.151" /><testcase classname="tests.services.components.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.services.components.conftest" name="ISORT" time="0.007" /><testcase classname="tests.services.components.conftest" name="black" time="0.153" /><testcase classname="tests.services.components.test_access_component" name="ISORT" time="0.025" /><testcase classname="tests.services.components.test_access_component" name="black" time="0.177" /><testcase classname="tests.services.components.test_access_component" name="test_access_component_valid" time="3.556" /><testcase classname="tests.services.components.test_access_component" name="test_access_component_unknown_owner" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/components/test_access_component.py:32: unconditional skip</skipped></testcase><testcase classname="tests.services.components.test_access_component" name="test_access_component_unknown_owner_with_system_process" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/components/test_access_component.py:45: unconditional skip</skipped></testcase><testcase classname="tests.services.components.test_access_component" name="test_access_component_unknown_grant_subject" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/components/test_access_component.py:61: unconditional skip</skipped></testcase><testcase classname="tests.services.components.test_access_component" name="test_access_component_set_owner" time="0.000"><skipped type="pytest.skip" message="unconditional skip">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/components/test_access_component.py:79: unconditional skip</skipped></testcase><testcase classname="tests.services.components.test_access_component" name="test_access_component_update_access_via_json" time="1.065" /><testcase classname="tests.services.components.test_internal_notes_component" name="ISORT" time="0.021" /><testcase classname="tests.services.components.test_internal_notes_component" name="black" time="0.175" /><testcase classname="tests.services.components.test_internal_notes_component" name="test_notes_component" time="4.444" /><testcase classname="tests.services.components.test_metadata_component" name="ISORT" time="0.011" /><testcase classname="tests.services.components.test_metadata_component" name="black" time="0.160" /><testcase classname="tests.services.components.test_metadata_component" name="test_metadata_component" time="4.239" /><testcase classname="tests.services.components.test_pids_component" name="ISORT" time="0.068" /><testcase classname="tests.services.components.test_pids_component" name="black" time="0.238" /><testcase classname="tests.services.components.test_pids_component" name="test_create_no_pids" time="3.653" /><testcase classname="tests.services.components.test_pids_component" name="test_create_pid_type_not_supported" time="0.515" /><testcase classname="tests.services.components.test_pids_component" name="test_create_no_required_pids[pids0]" time="0.508" /><testcase classname="tests.services.components.test_pids_component" name="test_create_no_required_pids[pids1]" time="0.516" /><testcase classname="tests.services.components.test_pids_component" name="test_create_no_required_pids[pids2]" time="0.515" /><testcase classname="tests.services.components.test_pids_component" name="test_create_with_required_managed[pids0]" time="0.518" /><testcase classname="tests.services.components.test_pids_component" name="test_create_with_required_managed[pids1]" time="0.534" /><testcase classname="tests.services.components.test_pids_component" name="test_create_with_incomplete_payload[pids0-expected_errors0]" time="0.517" /><testcase classname="tests.services.components.test_pids_component" name="test_create_with_incomplete_payload[pids1-expected_errors1]" time="0.519" /><testcase classname="tests.services.components.test_pids_component" name="test_publish_no_pids" time="0.571" /><testcase classname="tests.services.components.test_pids_component" name="test_publish_no_required_pids[pids0]" time="0.561" /><testcase classname="tests.services.components.test_pids_component" name="test_publish_no_required_pids[pids1]" time="0.614" /><testcase classname="tests.services.components.test_pids_component" name="test_publish_non_existing_required_managed" time="0.625" /><testcase classname="tests.services.components.test_pids_component" name="test_publish_non_existing_required_external" time="0.591" /><testcase classname="tests.services.components.test_pids_component" name="test_delete_pids_from_draft" time="0.531" /><testcase classname="tests.services.components.test_pids_component" name="test_update_external_to_empty" time="0.601" /><testcase classname="tests.services.components.test_pids_component" name="test_update_managed_to_empty" time="0.587" /><testcase classname="tests.services.components.test_pids_component" name="test_update_external_to_managed" time="0.584" /><testcase classname="tests.services.components.test_pids_component" name="test_update_managed_to_external" time="1.108" /><testcase classname="tests.services.components.test_relations_component" name="ISORT" time="0.011" /><testcase classname="tests.services.components.test_relations_component" name="black" time="0.159" /><testcase classname="tests.services.components.test_relations_component" name="test_dereferencing" time="3.072"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f66c92e0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f66c92e0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f6520c40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539720&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f65201c0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539f90&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7827bcad20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f66c92e0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f6521600&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f66c92e0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f6520c40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539720&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f65201c0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539f90&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f653a990&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7829b17dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a810&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.components.test_signal_component" name="ISORT" time="0.017" /><testcase classname="tests.services.components.test_signal_component" name="black" time="0.165" /><testcase classname="tests.services.components.test_signal_component" name="test_publish_signal_fired" time="2.994"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5de0aa0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5de0aa0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f60e8e00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f651ff70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f60eae40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f651e6b0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f65398e0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5de0aa0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f60eb900&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5de0aa0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f60e8e00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f651ff70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f60eae40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f651e6b0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f6539910&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f64b7d70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f653a420&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.components.test_verified_component" name="ISORT" time="0.012" /><testcase classname="tests.services.components.test_verified_component" name="black" time="0.158" /><testcase classname="tests.services.components.test_verified_component" name="test_verified_content" time="2.677"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad6cc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539000&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad7300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f653bfa0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f59f4c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f5ad5ec0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad6cc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539000&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad7300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f653bfa0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.components.test_verified_component" name="test_unverified_content" time="0.359"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad6cc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539000&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad7300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f653bfa0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f59f4c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f5ad5ec0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6126e10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad6cc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f6539000&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5ad7300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f653bfa0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5a9a870&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5a93ad0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5a98d10&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.conftest" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.services.conftest" name="ISORT" time="0.011" /><testcase classname="tests.services.conftest" name="black" time="0.158" /><testcase classname="tests.services.files.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.services.files.__init__" name="ISORT" time="0.003" /><testcase classname="tests.services.files.__init__" name="black" time="0.151" /><testcase classname="tests.services.files.conftest" name="PYDOCSTYLE" time="0.007" /><testcase classname="tests.services.files.conftest" name="ISORT" time="0.011" /><testcase classname="tests.services.files.conftest" name="black" time="0.162" /><testcase classname="tests.services.files.test_deleted_record_files" name="ISORT" time="0.021" /><testcase classname="tests.services.files.test_deleted_record_files" name="black" time="0.169" /><testcase classname="tests.services.files.test_deleted_record_files" name="test_deleted_records_file_flow" time="1.246"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f625d2b0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f625d2b0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f56d3040&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5652a40&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f56d0dc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5a9a830&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f5aafdd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f625d2b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f5b794c0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f625d2b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f56d3040&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5652a40&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f56d0dc0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5a9a830&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5bf5ee0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5696150&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f56ff0b0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.files.test_metadata_files" name="ISORT" time="0.015" /><testcase classname="tests.services.files.test_metadata_files" name="black" time="0.165" /><testcase classname="tests.services.files.test_metadata_files" name="test_valid_metadata_set" time="1.238"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6386ed0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6386ed0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5e1f5c0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5f3ceb0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f6383000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5f3ec50&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f5b8ac60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6386ed0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f635ac80&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f6386ed0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f5e1f5c0&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5f3ceb0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f6383000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5f3ec50&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f63f01a0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f634b050&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f63f1010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.files.test_metadata_files" name="test_invalid_metadata_set" time="0.001"><skipped type="pytest.skip" message="We're not validating metadata correctly anyways.">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/files/test_metadata_files.py:55: We're not validating metadata correctly anyways.</skipped></testcase><testcase classname="tests.services.files.test_revert_of_deleted_files_in_published_record" name="ISORT" time="0.015" /><testcase classname="tests.services.files.test_revert_of_deleted_files_in_published_record" name="black" time="0.172" /><testcase classname="tests.services.files.test_revert_of_deleted_files_in_published_record" name="test_revert_of_deleted_files_in_published_record" time="3.130"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5ce69c0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5ce69c0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f57ad000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5218550&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f57afb40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5219d50&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f5c4ea50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5ce69c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f57ad500&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f5ce69c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f57ad000&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5218550&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f57afb40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5219d50&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f5797200&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f57bf7d0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f57942c0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.services.pids.__init__" name="ISORT" time="0.004" /><testcase classname="tests.services.pids.__init__" name="black" time="0.151" /><testcase classname="tests.services.pids.providers.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.services.pids.providers.__init__" name="ISORT" time="0.004" /><testcase classname="tests.services.pids.providers.__init__" name="black" time="0.151" /><testcase classname="tests.services.pids.providers.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.services.pids.providers.conftest" name="ISORT" time="0.008" /><testcase classname="tests.services.pids.providers.conftest" name="black" time="0.154" /><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="ISORT" time="0.045" /><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="black" time="0.209" /><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_create" time="1.238"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_get" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_reserve" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_register" time="1.434"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_update" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_unregister_new" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_unregister_reserved" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_unregister_registered" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_configuration" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_datacite_provider_validation" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_datacite_pid_provider" name="test_log_error_msg" time="0.362"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f77f53cc2c0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f54b7bc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f77f54d6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f53a9b00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e82110&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f54acd80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f77f5e827d0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f77f545acc0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f77f5403dd0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f77f5459010&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="ISORT" time="0.017" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="black" time="0.171" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="test_external_provider_create" time="2.142" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="test_external_provider_get" time="0.537" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="test_external_provider_register" time="0.543" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="test_external_provider_validate" time="3.331" /><testcase classname="tests.services.pids.providers.test_external_pid_provider" name="test_external_provider_validate_failure" time="1.184" /><testcase classname="tests.services.pids.providers.test_oai_invenio_pid_provider" name="ISORT" time="0.015" /><testcase classname="tests.services.pids.providers.test_oai_invenio_pid_provider" name="black" time="0.164" /><testcase classname="tests.services.pids.providers.test_oai_invenio_pid_provider" name="test_invenio_provider_create" time="1.702" /><testcase classname="tests.services.pids.providers.test_oai_invenio_pid_provider" name="test_invenio_provider_get" time="0.269" /><testcase classname="tests.services.pids.providers.test_oai_invenio_pid_provider" name="test_invenio_provider_reserve" time="0.525" /><testcase classname="tests.services.pids.test_pids_service" name="ISORT" time="0.108" /><testcase classname="tests.services.pids.test_pids_service" name="black" time="0.329" /><testcase classname="tests.services.pids.test_pids_service" name="test_resolve_pid" time="6.394" /><testcase classname="tests.services.pids.test_pids_service" name="test_resolve_non_existing_pid" time="1.805" /><testcase classname="tests.services.pids.test_pids_service" name="test_reserve_pid" time="1.098" /><testcase classname="tests.services.pids.test_pids_service" name="test_discard_existing_pid" time="1.218" /><testcase classname="tests.services.pids.test_pids_service" name="test_discard_non_exisisting_pid" time="0.909" /><testcase classname="tests.services.pids.test_pids_service" name="test_oai_pid_default_created" time="1.852" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_basic_flow" time="1.971" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_duplicates" time="4.826" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_creation_invalid_external_payload" time="0.858" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_reserve_managed" time="1.060" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_reserve_fail_existing_managed" time="1.102" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_reserve_fail_existing_external" time="0.934" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_drafts_updates_external_to_managed" time="1.358" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_drafts_updates_managed_to_external" time="1.493" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_drafts_updates_managed_to_no_pid" time="1.234" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_drafts_updates_no_pid_to_external" time="1.194" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_drafts_updates_no_pid_to_managed" time="1.177" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_records_updates_external_to_managed" time="3.093" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_records_updates_managed_to_external_fail" time="2.221" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_records_updates_managed_to_no_pid_fail" time="2.231" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_publish_managed" time="5.813" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_publish_external" time="1.713" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_delete_external_pid_from_draft" time="0.952" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_delete_managed_pid_from_draft" time="1.165" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_delete_external_pid_from_record" time="2.008" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_delete_managed_pid_from_record" time="2.353" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_versioning" time="3.551" /><testcase classname="tests.services.pids.test_pids_service" name="test_pids_versioning_external_doi" time="3.917" /><testcase classname="tests.services.pids.test_pids_tasks" name="ISORT" time="0.109" /><testcase classname="tests.services.pids.test_pids_tasks" name="black" time="0.306" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_register_pid" time="5.762" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_register_restricted_pid" time="1.498" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_update_pid" time="2.771" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_invalidate_pid" time="2.196" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_invalidate_versions_pid" time="4.166" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_restore_pid" time="2.585" /><testcase classname="tests.services.pids.test_pids_tasks" name="test_full_record_register" time="2.269" /><testcase classname="tests.services.schemas.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.services.schemas.__init__" name="ISORT" time="0.006" /><testcase classname="tests.services.schemas.__init__" name="black" time="0.154" /><testcase classname="tests.services.schemas.conftest" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.services.schemas.conftest" name="ISORT" time="0.009" /><testcase classname="tests.services.schemas.conftest" name="black" time="0.158" /><testcase classname="tests.services.schemas.test_access" name="ISORT" time="0.021" /><testcase classname="tests.services.schemas.test_access" name="black" time="0.172" /><testcase classname="tests.services.schemas.test_access" name="test_embargo_load_no_until_is_valid" time="0.001" /><testcase classname="tests.services.schemas.test_access" name="test_embargo_dump_no_until_is_valid" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_valid_full" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access0-record]" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access1-files]" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access2-embargo]" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access3-embargo]" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access4-record]" time="0.002" /><testcase classname="tests.services.schemas.test_access" name="test_invalid[invalid_access5-files]" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="ISORT" time="0.016" /><testcase classname="tests.services.schemas.test_additional_description" name="black" time="0.168" /><testcase classname="tests.services.schemas.test_additional_description" name="test_valid_full" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="test_valid_minimal" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="test_invalid_no_description" time="0.001" /><testcase classname="tests.services.schemas.test_additional_description" name="test_invalid_description_empty" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="test_invalid_too_short" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="test_invalid_description_type" time="0.002" /><testcase classname="tests.services.schemas.test_additional_description" name="test_invalid_lang" time="0.000"><skipped type="pytest.skip" message="currently don't know how to test this">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/schemas/test_additional_description.py:78: currently don't know how to test this</skipped></testcase><testcase classname="tests.services.schemas.test_additional_title" name="ISORT" time="0.017" /><testcase classname="tests.services.schemas.test_additional_title" name="black" time="0.169" /><testcase classname="tests.services.schemas.test_additional_title" name="test_valid_full" time="0.002" /><testcase classname="tests.services.schemas.test_additional_title" name="test_valid_minimal" time="0.001" /><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_no_type" time="0.001" /><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_no_title" time="0.003" /><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_title_empty" time="0.001" /><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_too_short" time="0.001" /><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_title_type" time="0.000"><skipped type="pytest.skip" message="currently don't know how to test this">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/schemas/test_additional_title.py:73: currently don't know how to test this</skipped></testcase><testcase classname="tests.services.schemas.test_additional_title" name="test_invalid_lang" time="0.000"><skipped type="pytest.skip" message="currently don't know how to test this">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/schemas/test_additional_title.py:85: currently don't know how to test this</skipped></testcase><testcase classname="tests.services.schemas.test_creator_contributor" name="ISORT" time="0.052" /><testcase classname="tests.services.schemas.test_creator_contributor" name="black" time="0.210" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_person_valid_minimal" time="2.867" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_organization_valid_minimal" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_person_valid_full" time="0.003" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_person_valid_no_given_name" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_organization_valid_full" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creatibutor_name_edge_cases" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_valid_role" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_person_invalid_no_family_name" time="0.005" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_invalid_no_type" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_invalid_type" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_invalid_identifiers_scheme" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_invalid_identifiers_orcid" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_creator_invalid_identifiers_ror" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_person_valid_full" time="0.003" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_person_valid_minimal" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_person_invalid_no_family_name_nor_given_name" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_invalid_no_role" time="0.002" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_invalid_role" time="0.003" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_contributor_duplicated_affiliation" time="0.003" /><testcase classname="tests.services.schemas.test_creator_contributor" name="test_metadata_requires_non_empty_creators" time="0.503" /><testcase classname="tests.services.schemas.test_dates" name="ISORT" time="0.015" /><testcase classname="tests.services.schemas.test_dates" name="black" time="0.166" /><testcase classname="tests.services.schemas.test_dates" name="test_valid_full_date" time="0.002" /><testcase classname="tests.services.schemas.test_dates" name="test_minimal_date" time="0.001" /><testcase classname="tests.services.schemas.test_dates" name="test_valid_range" time="0.018" /><testcase classname="tests.services.schemas.test_dates" name="test_invalid_no_type" time="0.001" /><testcase classname="tests.services.schemas.test_dates" name="test_invalid_type" time="0.001" /><testcase classname="tests.services.schemas.test_dates" name="test_invalid_no_date" time="0.001" /><testcase classname="tests.services.schemas.test_dates" name="test_invalid_range" time="0.019" /><testcase classname="tests.services.schemas.test_dates" name="test_dates_in_metadata_schema" time="0.017" /><testcase classname="tests.services.schemas.test_formats" name="ISORT" time="0.010" /><testcase classname="tests.services.schemas.test_formats" name="black" time="0.159" /><testcase classname="tests.services.schemas.test_formats" name="test_valid_size[format0]" time="3.003" /><testcase classname="tests.services.schemas.test_formats" name="test_valid_size[format1]" time="0.004" /><testcase classname="tests.services.schemas.test_formats" name="test_invalid_size[format0]" time="0.004" /><testcase classname="tests.services.schemas.test_formats" name="test_invalid_size[jpeg]" time="0.004" /><testcase classname="tests.services.schemas.test_formats" name="test_invalid_size[format2]" time="0.540" /><testcase classname="tests.services.schemas.test_funding" name="ISORT" time="0.012" /><testcase classname="tests.services.schemas.test_funding" name="black" time="0.165" /><testcase classname="tests.services.schemas.test_funding" name="test_valid_funder_funding" time="2.942" /><testcase classname="tests.services.schemas.test_funding" name="test_valid_award_funder_funding" time="0.003" /><testcase classname="tests.services.schemas.test_funding" name="test_valid_award_id" time="0.002" /><testcase classname="tests.services.schemas.test_funding" name="test_invalid_empty_funding" time="0.002" /><testcase classname="tests.services.schemas.test_funding" name="test_valid_funding[funding0]" time="0.005" /><testcase classname="tests.services.schemas.test_funding" name="test_valid_funding[funding1]" time="0.476" /><testcase classname="tests.services.schemas.test_identifier" name="ISORT" time="0.017" /><testcase classname="tests.services.schemas.test_identifier" name="black" time="0.169" /><testcase classname="tests.services.schemas.test_identifier" name="test_valid_identifier" time="0.001" /><testcase classname="tests.services.schemas.test_identifier" name="test_valid_no_schema" time="0.001" /><testcase classname="tests.services.schemas.test_identifier" name="test_invalid_no_identifier" time="0.001" /><testcase classname="tests.services.schemas.test_identifier" name="test_valid_empty_list" time="2.934" /><testcase classname="tests.services.schemas.test_identifier" name="test_valid_multiple_identifiers" time="0.004" /><testcase classname="tests.services.schemas.test_identifier" name="test_invalid_duplicate_scheme_and_value" time="0.007" /><testcase classname="tests.services.schemas.test_identifier" name="test_valid_duplicate_scheme_with_different_values" time="0.487" /><testcase classname="tests.services.schemas.test_languages" name="ISORT" time="0.009" /><testcase classname="tests.services.schemas.test_languages" name="black" time="0.158" /><testcase classname="tests.services.schemas.test_languages" name="test_valid_languages" time="2.947" /><testcase classname="tests.services.schemas.test_languages" name="test_invalid_no_list_languages" time="0.483" /><testcase classname="tests.services.schemas.test_location" name="ISORT" time="0.016" /><testcase classname="tests.services.schemas.test_location" name="black" time="0.166" /><testcase classname="tests.services.schemas.test_location" name="test_valid_full" time="2.893" /><testcase classname="tests.services.schemas.test_location" name="test_valid_minimal[valid_minimal_location0]" time="0.003" /><testcase classname="tests.services.schemas.test_location" name="test_valid_minimal[valid_minimal_location1]" time="0.002" /><testcase classname="tests.services.schemas.test_location" name="test_valid_minimal[valid_minimal_location2]" time="0.002" /><testcase classname="tests.services.schemas.test_location" name="test_valid_minimal[valid_minimal_location3]" time="0.002" /><testcase classname="tests.services.schemas.test_location" name="test_invalid_geometry_type" time="0.003" /><testcase classname="tests.services.schemas.test_location" name="test_invalid_wrong_geometry_type" time="0.003" /><testcase classname="tests.services.schemas.test_location" name="test_invalid_empty" time="0.002" /><testcase classname="tests.services.schemas.test_location" name="test_valid_single_location" time="0.006" /><testcase classname="tests.services.schemas.test_location" name="test_valid_multiple_locations" time="0.007" /><testcase classname="tests.services.schemas.test_location" name="test_invalid_no_list_location" time="0.516" /><testcase classname="tests.services.schemas.test_metadata" name="ISORT" time="0.012" /><testcase classname="tests.services.schemas.test_metadata" name="black" time="0.154" /><testcase classname="tests.services.schemas.test_metadata" name="test_full_metadata_schema" time="3.500" /><testcase classname="tests.services.schemas.test_metadata" name="test_minimal_metadata_schema" time="0.004" /><testcase classname="tests.services.schemas.test_metadata" name="test_additional_field_raises" time="0.467" /><testcase classname="tests.services.schemas.test_pids" name="ISORT" time="0.012" /><testcase classname="tests.services.schemas.test_pids" name="black" time="0.159" /><testcase classname="tests.services.schemas.test_pids" name="test_valid_pid" time="0.001" /><testcase classname="tests.services.schemas.test_pids" name="test_valid_minimal_pid" time="0.001" /><testcase classname="tests.services.schemas.test_pids" name="test_invalid_no_identifier" time="0.001" /><testcase classname="tests.services.schemas.test_pids" name="test_invalid_no_provider" time="0.001" /><testcase classname="tests.services.schemas.test_pids" name="test_invalid_extra_field" time="0.002" /><testcase classname="tests.services.schemas.test_publication_date" name="ISORT" time="0.013" /><testcase classname="tests.services.schemas.test_publication_date" name="black" time="0.162" /><testcase classname="tests.services.schemas.test_publication_date" name="test_date" time="2.968" /><testcase classname="tests.services.schemas.test_publication_date" name="test_early_date" time="0.000"><skipped type="pytest.skip" message="Not supported">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/schemas/test_publication_date.py:34: Not supported</skipped></testcase><testcase classname="tests.services.schemas.test_publication_date" name="test_bc_date" time="0.000"><skipped type="pytest.skip" message="Not supported">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/services/schemas/test_publication_date.py:39: Not supported</skipped></testcase><testcase classname="tests.services.schemas.test_publication_date" name="test_invalid_date" time="0.006" /><testcase classname="tests.services.schemas.test_publication_date" name="test_year_range" time="0.013" /><testcase classname="tests.services.schemas.test_publication_date" name="test_month_range" time="0.014" /><testcase classname="tests.services.schemas.test_publication_date" name="test_interval" time="0.019" /><testcase classname="tests.services.schemas.test_publication_date" name="test_asymmetric_interval" time="0.042" /><testcase classname="tests.services.schemas.test_publication_date" name="test_unknown_bound_interval" time="0.027" /><testcase classname="tests.services.schemas.test_publication_date" name="test_invalid_interval" time="0.496" /><testcase classname="tests.services.schemas.test_rdm_record_schema" name="ISORT" time="0.011" /><testcase classname="tests.services.schemas.test_rdm_record_schema" name="black" time="0.158" /><testcase classname="tests.services.schemas.test_rdm_record_schema" name="test_valid_pid" time="3.339" /><testcase classname="tests.services.schemas.test_rdm_record_schema" name="test_valid_external" time="0.878" /><testcase classname="tests.services.schemas.test_reference" name="ISORT" time="0.016" /><testcase classname="tests.services.schemas.test_reference" name="black" time="0.163" /><testcase classname="tests.services.schemas.test_reference" name="test_valid_reference" time="3.045" /><testcase classname="tests.services.schemas.test_reference" name="test_valid_minimal_reference" time="0.002" /><testcase classname="tests.services.schemas.test_reference" name="test_invalid_no_reference" time="0.002" /><testcase classname="tests.services.schemas.test_reference" name="test_invalid_scheme_reference" time="0.002" /><testcase classname="tests.services.schemas.test_reference" name="test_invalid_extra_right" time="0.002" /><testcase classname="tests.services.schemas.test_reference" name="test_valid_rights[references0]" time="0.005" /><testcase classname="tests.services.schemas.test_reference" name="test_valid_rights[references1]" time="0.484" /><testcase classname="tests.services.schemas.test_related_identifier" name="ISORT" time="0.022" /><testcase classname="tests.services.schemas.test_related_identifier" name="black" time="0.175" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_valid_related_identifiers" time="2.872" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_valid_minimal_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_valid_no_scheme_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_no_identifiers_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_scheme_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_no_type_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_relation_type_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_extra_field_related_identifiers" time="0.002" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_valid_related_identifiers_in_schema" time="0.004" /><testcase classname="tests.services.schemas.test_related_identifier" name="test_invalid_related_identifiers" time="0.500" /><testcase classname="tests.services.schemas.test_resource_type" name="ISORT" time="0.011" /><testcase classname="tests.services.schemas.test_resource_type" name="black" time="0.160" /><testcase classname="tests.services.schemas.test_resource_type" name="test_valid_type_and_subtype" time="0.003" /><testcase classname="tests.services.schemas.test_resource_type" name="test_valid_no_subtype" time="0.003" /><testcase classname="tests.services.schemas.test_resource_type" name="test_invalid_no_resource_type" time="0.004" /><testcase classname="tests.services.schemas.test_rights" name="ISORT" time="0.025" /><testcase classname="tests.services.schemas.test_rights" name="black" time="0.175" /><testcase classname="tests.services.schemas.test_rights" name="test_valid_full_free_text" time="4.773" /><testcase classname="tests.services.schemas.test_rights" name="test_valid_minimal_free_text" time="0.539" /><testcase classname="tests.services.schemas.test_rights" name="test_valid_minimal_vocab" time="0.527" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_extra_right" time="0.524" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_url" time="0.530" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_title" time="0.528" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_multiple_title" time="0.523" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_description" time="4.570" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_multiple_description" time="0.535" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_id_and_title" time="0.545" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_vocab" time="0.557" /><testcase classname="tests.services.schemas.test_rights" name="test_invalid_structure" time="0.568" /><testcase classname="tests.services.schemas.test_rights" name="test_valid_rights[rights0]" time="0.543" /><testcase classname="tests.services.schemas.test_rights" name="test_valid_rights[rights1]" time="1.032" /><testcase classname="tests.services.schemas.test_sizes" name="ISORT" time="0.011" /><testcase classname="tests.services.schemas.test_sizes" name="black" time="0.157" /><testcase classname="tests.services.schemas.test_sizes" name="test_valid_size[size0]" time="2.971" /><testcase classname="tests.services.schemas.test_sizes" name="test_valid_size[size1]" time="0.004" /><testcase classname="tests.services.schemas.test_sizes" name="test_invalid_size[size0]" time="0.004" /><testcase classname="tests.services.schemas.test_sizes" name="test_invalid_size[11 pages]" time="0.004" /><testcase classname="tests.services.schemas.test_sizes" name="test_invalid_size[size2]" time="0.473" /><testcase classname="tests.services.schemas.test_utils" name="ISORT" time="0.008" /><testcase classname="tests.services.schemas.test_utils" name="black" time="0.155" /><testcase classname="tests.services.schemas.test_version" name="ISORT" time="0.010" /><testcase classname="tests.services.schemas.test_version" name="black" time="0.156" /><testcase classname="tests.services.schemas.test_version" name="test_valid_version[v1.0.0]" time="2.992" /><testcase classname="tests.services.schemas.test_version" name="test_invalid_version[1]" time="0.004" /><testcase classname="tests.services.schemas.test_version" name="test_invalid_version[version1]" time="0.003" /><testcase classname="tests.services.schemas.test_version" name="test_invalid_version[version2]" time="0.492" /><testcase classname="tests.services.schemas.test_vocabulary" name="ISORT" time="0.011" /><testcase classname="tests.services.schemas.test_vocabulary" name="black" time="0.158" /><testcase classname="tests.services.schemas.test_vocabulary" name="test_valid_vocabulary" time="0.001" /><testcase classname="tests.services.schemas.test_vocabulary" name="test_invalid_vocabulary" time="0.001" /><testcase classname="tests.services.test_deletion_policy" name="ISORT" time="0.019" /><testcase classname="tests.services.test_deletion_policy" name="black" time="0.173" /><testcase classname="tests.services.test_deletion_policy" name="test_grace_period_policy" time="6.696" /><testcase classname="tests.services.test_deletion_policy" name="test_deletion_policy_evaluation_feature_flags" time="1.961" /><testcase classname="tests.services.test_deletion_policy" name="test_deletion_policy_immediate_deletion" time="1.990" /><testcase classname="tests.services.test_deletion_policy" name="test_deletion_policy_fallback_to_request" time="2.027" /><testcase classname="tests.services.test_deletion_policy" name="test_deletion_policy_non_owner" time="2.540" /><testcase classname="tests.services.test_generators" name="ISORT" time="0.035" /><testcase classname="tests.services.test_generators" name="black" time="0.181" /><testcase classname="tests.services.test_generators" name="test_ifrestricted_needs[record-_public_record-_else_needs]" time="0.001" /><testcase classname="tests.services.test_generators" name="test_ifrestricted_needs[record-_restricted_record-_then_needs]" time="0.001" /><testcase classname="tests.services.test_generators" name="test_ifrestricted_needs[files-_public_record-_else_needs]" time="0.001" /><testcase classname="tests.services.test_generators" name="test_ifrestricted_needs[files-_restricted_record-_then_needs]" time="0.001" /><testcase classname="tests.services.test_generators" name="test_ifrestricted_query" time="0.001" /><testcase classname="tests.services.test_generators" name="test_record_owner" time="3.010" /><testcase classname="tests.services.test_generators" name="test_request_reviewers" time="2.050"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea3e60&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea3e60&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7814669880&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781bd52140&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7814668100&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781b821e70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
        cparams    = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=invenio user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'invenio', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=invenio user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
db_session_options = {}

    @pytest.fixture(scope="function")
    def db(database, db_session_options):
        """Creates a new database session for a test.
    
        Scope: function
    
        You must use this fixture if your test connects to the database. The
        fixture will set a save point and rollback all changes performed during
        the test (this is much faster than recreating the entire database).
        """
        from flask_sqlalchemy.session import Session as FlaskSQLAlchemySession
    
        from pytest_invenio.database_tools import (
            purge_database_values,
            store_database_values,
        )
    
        class PytestInvenioSession(FlaskSQLAlchemySession):
            def get_bind(self, mapper=None, clause=None, bind=None, **kwargs):
                if self.bind:
                    return self.bind
                return super().get_bind(mapper=mapper, clause=clause, bind=bind, **kwargs)
    
            def rollback(self) -&gt; None:
                if self._transaction is None:
                    pass
                else:
                    self._transaction.rollback(_to_root=False)
    
        # the session.rollback() does not always clean everything, if the test
        # used db.session.commit() and has not cleaned up after itself. We can not
        # use nested transactions because a lot of Invenio code would need to be updated
        # so that it is aware of the nested transaction concept. Instead, we store
        # the database values here and purge any new rows after the test.
        #
        # We do it in explicit connection to avoid issues in tests that drop all tables
        # (causes deadlock in alembic tests of invenio-pages on github actions, not
        # reproducible locally).
        print("MS PATCH Storing database values", file=sys.stderr, flush=True)
        connection = database.engine.connect()
        connection.begin()
&gt;       stored_values = store_database_values(database.engine, connection)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

FlaskSQLAlchemySession = &lt;class 'flask_sqlalchemy.session.Session'&gt;
PytestInvenioSession = &lt;class 'pytest_invenio.fixtures.db.&lt;locals&gt;.PytestInvenioSession'&gt;
connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f7816d62330&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
db_session_options = {}
purge_database_values = &lt;function purge_database_values at 0x7f7836a4ee80&gt;
store_database_values = &lt;function store_database_values at 0x7f7836a4f7e0&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:583: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/database_tools.py:17: in store_database_values
    metadata.reflect(engine)
        conn       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7816d62330&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        metadata   = MetaData()
.venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5817: in reflect
    with inspection.inspect(bind)._inspection_context() as insp:
         ^^^^^^^^^^^^^^^^^^^^^^^^
        autoload_replace = True
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        dialect_kwargs = {}
        extend_existing = False
        only       = None
        resolve_fks = True
        schema     = None
        self       = MetaData()
        views      = False
.venv/lib/python3.12/site-packages/sqlalchemy/inspection.py:140: in inspect
    ret = reg(subject)
          ^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.engine.base.Engine'&gt;
        raiseerr   = True
        reg        = &lt;function Inspector._engine_insp at 0x7f78461d0cc0&gt;
        subject    = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        type_      = &lt;class 'sqlalchemy.engine.base.Engine'&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/reflection.py:313: in _engine_insp
    return Inspector._construct(Inspector._init_engine, bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/reflection.py:246: in _construct
    init(self, bind)
        bind       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        cls        = &lt;class 'sqlalchemy.dialects.postgresql.base.PGInspector'&gt;
        init       = &lt;function Inspector._init_engine at 0x7f78461d0900&gt;
        self       = &lt;sqlalchemy.dialects.postgresql.base.PGInspector object at 0x7f781eea1d60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/reflection.py:257: in _init_engine
    engine.connect().close()
    ^^^^^^^^^^^^^^^^
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        self       = &lt;sqlalchemy.dialects.postgresql.base.PGInspector object at 0x7f781eea1d60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea3e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f781ff16ac0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea3e60&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/invenio)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7814669880&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781bd52140&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7814668100&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781b821e70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7813d4f770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f78256e6930&gt;
        cparams    = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7813d4db20&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=invenio user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'invenio', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=invenio user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'invenio',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error><error message="failed on teardown with &quot;ExceptionGroup: errors while tearing down &lt;Module test_generators.py&gt; (2 sub-exceptions)&quot;">+ Exception Group Traceback (most recent call last):
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
  |     result: TResult | None = func()
  |                              ^^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 246, in &lt;lambda&gt;
  |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
  |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
  |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_callers.py", line 167, in _multicall
  |     raise exception
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/logging.py", line 858, in pytest_runtest_teardown
  |     yield
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/capture.py", line 905, in pytest_runtest_teardown
  |     return (yield)
  |             ^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
  |     res = hook_impl.function(*args)
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 193, in pytest_runtest_teardown
  |     item.session._setupstate.teardown_exact(nextitem)
  |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 557, in teardown_exact
  |     raise exceptions[0]
  | ExceptionGroup: errors while tearing down &lt;Module test_generators.py&gt; (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    |     fairy = _ConnectionRecord.checkout(pool)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    |     rec = pool._do_get()
    |           ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 175, in _do_get
    |     return self._create_connection()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    |     return _ConnectionRecord(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    |     self.__connect()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    |     self.dbapi_connection = connection = pool._invoke_creator(self)
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    |     return dialect.connect(*cargs, **cparams)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    |     return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/psycopg2/__init__.py", line 122, in connect
    |     conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
    | 	Is the server running on that host and accepting TCP/IP connections?
    | connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
    | 
    | 
    | The above exception was the direct cause of the following exception:
    | 
    | Traceback (most recent call last):
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py", line 522, in database
    |     db_.drop_all()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_sqlalchemy/extension.py", line 917, in drop_all
    |     self._call_for_binds(bind_key, "drop_all")
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_sqlalchemy/extension.py", line 881, in _call_for_binds
    |     getattr(metadata, op_name)(bind=engine)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 5956, in drop_all
    |     bind._run_ddl_visitor(
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3251, in _run_ddl_visitor
    |     with self.begin() as conn:
    |          ^^^^^^^^^^^^
    |   File "/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py", line 137, in __enter__
    |     return next(self.gen)
    |            ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3241, in begin
    |     with self.connect() as conn:
    |          ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 145, in __init__
    |     Connection._handle_dbapi_exception_noconnection(
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    |     fairy = _ConnectionRecord.checkout(pool)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    |     rec = pool._do_get()
    |           ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 175, in _do_get
    |     return self._create_connection()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    |     return _ConnectionRecord(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    |     self.__connect()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    |     self.dbapi_connection = connection = pool._invoke_creator(self)
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    |     return dialect.connect(*cargs, **cparams)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    |     return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/psycopg2/__init__.py", line 122, in connect
    |     conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
    | 	Is the server running on that host and accepting TCP/IP connections?
    | connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
    | 
    | (Background on this error at: https://sqlalche.me/e/20/e3q8)
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    |     fairy = _ConnectionRecord.checkout(pool)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    |     rec = pool._do_get()
    |           ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 175, in _do_get
    |     return self._create_connection()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    |     return _ConnectionRecord(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    |     self.__connect()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    |     self.dbapi_connection = connection = pool._invoke_creator(self)
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    |     return dialect.connect(*cargs, **cparams)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    |     return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/psycopg2/__init__.py", line 122, in connect
    |     conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
    | 	Is the server running on that host and accepting TCP/IP connections?
    | connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
    | 
    | 
    | The above exception was the direct cause of the following exception:
    | 
    | Traceback (most recent call last):
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py", line 768, in location
    |     shutil.rmtree(location_obj.uri)
    |                   ^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    |     return self.impl.get(state, dict_)  # type: ignore[no-any-return]
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    |     value = self._fire_loader_callables(state, key, passive)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    |     return state._load_expired(state, passive)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    |     self.manager.expired_attribute_loader(self, toload, passive)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1674, in load_scalar_attributes
    |     result = load_on_ident(
    |              ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 510, in load_on_ident
    |     return load_on_pk_identity(
    |            ^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 695, in load_on_pk_identity
    |     session.execute(
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2239, in _execute_internal
    |     conn = self._connection_for_bind(bind)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2108, in _connection_for_bind
    |     return trans._connection_for_bind(engine, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "&lt;string&gt;", line 2, in _connection_for_bind
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 145, in __init__
    |     Connection._handle_dbapi_exception_noconnection(
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    |     fairy = _ConnectionRecord.checkout(pool)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    |     rec = pool._do_get()
    |           ^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 175, in _do_get
    |     return self._create_connection()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    |     return _ConnectionRecord(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    |     self.__connect()
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    |     self.dbapi_connection = connection = pool._invoke_creator(self)
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    |     return dialect.connect(*cargs, **cparams)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    |     return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/psycopg2/__init__.py", line 122, in connect
    |     conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
    | 	Is the server running on that host and accepting TCP/IP connections?
    | connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
    | 
    | (Background on this error at: https://sqlalche.me/e/20/e3q8)
    +------------------------------------</error></testcase><testcase classname="tests.services.test_oai_service" name="ISORT" time="0.030" /><testcase classname="tests.services.test_oai_service" name="black" time="0.171" /><testcase classname="tests.services.test_oai_service" name="test_minimal_set_creation_and_edit" time="2.646"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7817e75fd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7823d7ecc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_oai_service" name="test_raise_error_on_edit_and_delete" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7817e75fd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7823d7ecc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_oai_service" name="test_reserved_prefixes" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7817e75fd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7823d7ecc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_oai_service" name="test_rebuild_index" time="0.364"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7817e75fd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7823d7ecc0&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f781eea0170&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7d940&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c089ae0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7823d7ce80&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a680&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781c08a180&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781a643bf0&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781c08ad50&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_permissions_policy" name="ISORT" time="0.025" /><testcase classname="tests.services.test_permissions_policy" name="black" time="0.182" /><testcase classname="tests.services.test_permissions_policy" name="test_permission_policy_generators" time="2.726"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f7519f40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a590&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f751a800&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7818b83700&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7818a2ac00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f7519b80&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f7519f40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a590&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f751a800&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7818b83700&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_permissions_policy" name="test_permission_policy_needs_excludes" time="0.358"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f7519f40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a590&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f751a800&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7818b83700&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7818a2ac00&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f77f7519b80&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7817a2b260&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f7519f40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781c08a590&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f751a800&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7818b83700&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f7818588770&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f781e3b3c50&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781858ad80&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="ISORT" time="0.061" /><testcase classname="tests.services.test_rdm_service" name="black" time="0.251" /><testcase classname="tests.services.test_rdm_service" name="test_minimal_draft_creation" time="2.634"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_draft_w_languages_creation" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_public_record_with_default_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_public_record_with_optional_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_public_record_versions_no_or_external_doi_managed_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_public_record_versions_managed_doi_external_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_public_record_versions_managed_doi_no_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_edit_published_record_change_doi_when_optional" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_delete_draft_discard_managed_pids_when_doi_optional" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_restricted_record_without_default_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_publish_restricted_record_with_external_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_embargo_lift_creates_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_public_record_to_restricted_keeps_doi" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_embargo_lift_without_draft" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_embargo_lift_with_draft" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_embargo_lift_with_updated_draft" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_embargo_lift_with_error" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_rdm_service" name="test_search_sort_verified_enabled" time="0.345"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f7813c25220&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f7818198700&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78158ab7d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937ef40&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f78237c2a70&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781937fc00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f782027e410&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f781bc91130&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f7825788710&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f781bc90e90&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_record_deletion" name="ISORT" time="0.038" /><testcase classname="tests.services.test_record_deletion" name="black" time="0.196" /><testcase classname="tests.services.test_record_deletion" name="test_record_deletion" time="2.646"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f78241de3f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f78164c9000&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_record_deletion" name="test_invalid_record_deletion_workflows" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f78241de3f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f78164c9000&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_record_deletion" name="test_record_deletion_of_specific_version" time="0.362"><error message="failed on setup with &quot;sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at &quot;localhost&quot; (::1), port 5432 failed: Connection refused&#10;&#09;Is the server running on that host and accepting TCP/IP connections?&#10;connection to server at &quot;localhost&quot; (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already&#10;&#10;(Background on this error at: https://sqlalche.me/e/20/e3q8)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
engine = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
connection = None, _has_events = None, _allow_revalidate = True
_allow_autobegin = True

    def __init__(
        self,
        engine: Engine,
        connection: Optional[PoolProxiedConnection] = None,
        _has_events: Optional[bool] = None,
        _allow_revalidate: bool = True,
        _allow_autobegin: bool = True,
    ):
        """Construct a new Connection."""
        self.engine = engine
        self.dialect = dialect = engine.dialect
    
        if connection is None:
            try:
&gt;               self._dbapi_connection = engine.raw_connection()
                                         ^^^^^^^^^^^^^^^^^^^^^^^

_allow_autobegin = True
_allow_revalidate = True
_has_events = None
connection = None
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError

The above exception was the direct cause of the following exception:

appctx = &lt;Flask 'invenio'&gt;

    @pytest.fixture(scope="module")
    def database(appctx):
        """Setup database.
    
        Scope: module
    
        Normally, tests should use the function-scoped :py:data:`db` fixture
        instead. This fixture takes care of creating the database/tables and
        removing the tables once tests are done.
        """
        from invenio_db import db as db_
        from sqlalchemy_utils.functions import create_database, database_exists
    
        if not database_exists(str(db_.engine.url.render_as_string(hide_password=False))):
&gt;           create_database(str(db_.engine.url.render_as_string(hide_password=False)))

appctx     = &lt;Flask 'invenio'&gt;
create_database = &lt;function create_database at 0x7f7845458900&gt;
database_exists = &lt;function database_exists at 0x7f7845458860&gt;
db_        = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:503: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy_utils/functions/database.py:568: in create_database
    with engine.begin() as conn:
         ^^^^^^^^^^^^^^
        database   = 'invenio'
        dialect_driver = 'psycopg2'
        dialect_name = 'postgresql'
        encoding   = 'utf8'
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        template   = 'template1'
        url        = postgresql+psycopg2://invenio:***@localhost:5432/postgres
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
        self       = &lt;contextlib._GeneratorContextManager object at 0x7f78241de3f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3241: in begin
    with self.connect() as conn:
         ^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:145: in __init__
    Connection._handle_dbapi_exception_noconnection(
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2440: in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        cls        = &lt;class 'sqlalchemy.engine.base.Connection'&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        e          = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        exc_info   = (&lt;class 'psycopg2.OperationalError'&gt;,
 OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n'),
 &lt;traceback object at 0x7f78164c9000&gt;)
        invalidate_pool_on_disconnect = True
        is_disconnect = False
        is_pre_ping = False
        newraise   = None
        should_wrap = True
        sqlalchemy_exception = OperationalError('(psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
        _allow_autobegin = True
        _allow_revalidate = True
        _has_events = None
        connection = None
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
        engine     = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f7824b6df40&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
        self       = Engine(postgresql+psycopg2://invenio:***@localhost:5432/postgres)
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionFairy'&gt;
        fairy      = None
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        threadconns = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
        cls        = &lt;class 'sqlalchemy.pool.base._ConnectionRecord'&gt;
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f781172d300&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f7812b3e2c0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        use_overflow = True
        wait       = False
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
        connect    = True
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f7816dd2a00&gt;
        exc_type   = &lt;class 'psycopg2.OperationalError'&gt;
        exc_value  = OperationalError('connection to server at "localhost" (::1), port 5432 failed: Connection refused\n\tIs the server running on that host and accepting TCP/IP connections?\nconnection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781866ee60&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool       = &lt;sqlalchemy.pool.impl.QueuePool object at 0x7f782bacd1f0&gt;
        self       = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = []
        connection_record = &lt;sqlalchemy.pool.base._ConnectionRecord object at 0x7f782642bd70&gt;
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        cargs      = ()
        cparams    = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
        self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f782bacc2f0&gt;
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dsn = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
connection_factory = None, cursor_factory = None
kwargs = {'dbname': 'postgres', 'host': 'localhost', 'password': 'invenio', 'port': 5432, ...}
kwasync = {}

    def connect(dsn=None, connection_factory=None, cursor_factory=None, **kwargs):
        """
        Create a new database connection.
    
        The connection parameters can be specified as a string:
    
            conn = psycopg2.connect("dbname=test user=postgres password=secret")
    
        or using a set of keyword arguments:
    
            conn = psycopg2.connect(database="test", user="postgres", password="secret")
    
        Or as a mix of both. The basic connection parameters are:
    
        - *dbname*: the database name
        - *database*: the database name (only as keyword argument)
        - *user*: user name used to authenticate
        - *password*: password used to authenticate
        - *host*: database host address (defaults to UNIX socket if not provided)
        - *port*: connection port number (defaults to 5432 if not provided)
    
        Using the *connection_factory* parameter a different class or connections
        factory can be specified. It should be a callable object taking a dsn
        argument.
    
        Using the *cursor_factory* parameter, a new default cursor factory will be
        used by cursor().
    
        Using *async*=True an asynchronous connection will be created. *async_* is
        a valid alias (for Python versions where ``async`` is a keyword).
    
        Any other keyword parameter will be passed to the underlying client
        library: the list of supported parameters depends on the library version.
    
        """
        kwasync = {}
        if 'async' in kwargs:
            kwasync['async'] = kwargs.pop('async')
        if 'async_' in kwargs:
            kwasync['async_'] = kwargs.pop('async_')
    
        dsn = _ext.make_dsn(dsn, **kwargs)
&gt;       conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused
E       	Is the server running on that host and accepting TCP/IP connections?
E       connection to server at "localhost" (127.0.0.1), port 5432 failed: FATAL:  sorry, too many clients already
E       
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

connection_factory = None
cursor_factory = None
dsn        = 'host=localhost dbname=postgres user=invenio password=invenio port=5432'
kwargs     = {'dbname': 'postgres',
 'host': 'localhost',
 'password': 'invenio',
 'port': 5432,
 'user': 'invenio'}
kwasync    = {}

.venv/lib/python3.12/site-packages/psycopg2/__init__.py:122: OperationalError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="ISORT" time="0.033" /><testcase classname="tests.services.test_record_deletion_request" name="black" time="0.189" /><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_feature_disabled" time="1.309"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_immediate_allowed" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_request_only" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_duplicate_prevention" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_invalid_reason" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_already_deleted_record" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_request_deletion_invalid_record" time="1.429"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_tombstone_deletion_policy_field_manual_deletion" time="0.001"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_record_deletion_request" name="test_tombstone_deletion_policy_serialization" time="0.498"><error message="failed on setup with &quot;sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint &quot;uq_files_location_name&quot;&#10;DETAIL:  Key (name)=(pytest-location) already exists.&#10;&#10;[SQL: INSERT INTO files_location (name, uri, &quot;default&quot;, created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]&#10;[parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]&#10;(Background on this error at: https://sqlalche.me/e/20/gkpj)&quot;">self = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
dialect = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
statement = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -&gt; CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
&gt;                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
evt_handled = False
parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: UniqueViolation

The above exception was the direct cause of the following exception:

database = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.yield_fixture(scope="module")
    def location(database):
        """Creates a simple default location for a test.
    
        Scope: function
    
        Use this fixture if your test requires a `files location &lt;https://invenio-
        files-rest.readthedocs.io/en/latest/api.html#invenio_files_rest.models.
        Location&gt;`_. The location will be a default location with the name
        ``pytest-location``.
        """
        from invenio_files_rest.models import Location
    
        uri = tempfile.mkdtemp()
        location_obj = Location(name="pytest-location", uri=uri, default=True)
    
        database.session.add(location_obj)
&gt;       database.session.commit()

Location   = &lt;class 'invenio_files_rest.models.Location'&gt;
database   = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
location_obj = pytest-location
uri        = '/tmp/tmp47ccgn65'

.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:764: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/sqlalchemy/orm/scoping.py:597: in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
        self       = &lt;sqlalchemy.orm.scoping.scoped_session object at 0x7f7843944560&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        trans      = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = None
        expect_state = &lt;SessionTransactionState.CLOSED: 5&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        has_prerequisite_states = True
        kw         = {'_to_root': True}
        moves_to   = &lt;SessionTransactionState.CLOSED: 5&gt;
        next_state = &lt;_StateChangeStates.ANY: 1&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;, &lt;SessionTransactionState.PREPARED: 2&gt;)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
        _to_root   = True
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
        arg        = ()
        current_state = &lt;SessionTransactionState.ACTIVE: 1&gt;
        existing_fn = &lt;function SessionTransaction.commit at 0x7f784553cae0&gt;
        expect_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        expect_state_change = True
        fn         = &lt;function SessionTransaction._prepare_impl at 0x7f784553c900&gt;
        has_prerequisite_states = True
        kw         = {}
        moves_to   = &lt;SessionTransactionState.PREPARED: 2&gt;
        next_state = &lt;SessionTransactionState.PREPARED: 2&gt;
        prerequisite_state_collection = (&lt;SessionTransactionState.ACTIVE: 1&gt;,)
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
        _flush_guard = 0
        self       = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
        stx        = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f7829e453d0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
        objects    = None
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
        exc_tb     = &lt;traceback object at 0x7f77f58d5300&gt;
        exc_type   = &lt;class 'sqlalchemy.exc.IntegrityError'&gt;
        exc_value  = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        self       = &lt;sqlalchemy.util.langhelpers.safe_reraise object at 0x7f781fd40ca0&gt;
        traceback  = None
        type_      = None
        value      = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
        _reg       = True
        deleted    = set()
        dirty      = set()
        flush_context = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        is_orphan  = False
        is_persistent_orphan = False
        new        = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        objects    = None
        objset     = None
        proc       = set()
        processed  = {&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;}
        self       = &lt;sqlalchemy.orm.session.Session object at 0x7f7828cfd250&gt;
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        transaction = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f78343b5510&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
        postsort_actions = [DeleteAll(Mapper[Location(files_location)]),
 SaveUpdateAll(Mapper[Location(files_location)])]
        rec        = SaveUpdateAll(Mapper[Location(files_location)])
        self       = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
        self       = SaveUpdateAll(Mapper[Location(files_location)])
        uow        = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        dict_      = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        has_identity = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        row_switch = None
        single     = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        states     = &lt;generator object UOWTransaction.states_for_mapper_hierarchy at 0x7f78181a6200&gt;
        states_to_insert = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;)]
        states_to_update = []
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        update     = &lt;generator object _collect_update_commands at 0x7f78278898a0&gt;
        update_version_id = None
.venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
        _          = {'name', 'default', 'uri'}
        base_mapper = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        bookkeeping = True
        cached_stmt = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        deterministic_results_reqd = True
        do_executemany = False
        exec_opt   = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        has_all_defaults = True
        has_all_pks = False
        hasvalue   = False
        insert     = &lt;generator object _collect_insert_commands at 0x7f7826778040&gt;
        mapper     = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        mapper_rec = &lt;Mapper at 0x7f7841689dc0; Location&gt;
        params     = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        records    = [(&lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
  {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
   'default': True,
   'name': 'pytest-location',
   'uri': '/tmp/tmp47ccgn65'},
  {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'},
  &lt;Mapper at 0x7f7841689dc0; Location&gt;,
  &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;,
  {},
  False,
  True)]
        return_result = None
        returning_is_required_anyway = False
        state      = &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;
        state_dict = {'_sa_instance_state': &lt;sqlalchemy.orm.state.InstanceState object at 0x7f7821470cb0&gt;,
 'default': True,
 'name': 'pytest-location',
 'uri': '/tmp/tmp47ccgn65'}
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        table      = Table('files_location', MetaData(), Column('id', Integer(), table=&lt;files_location&gt;, primary_key=True, nullable=False), Column('name', String(length=20), table=&lt;files_location&gt;, nullable=False), Column('uri', String(length=255), table=&lt;files_location&gt;, nullable=False), Column('default', Boolean(name='default'), table=&lt;files_location&gt;, nullable=False, default=ScalarElementColumnDefault(False)), Column('created', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171af20&gt;)), Column('updated', DateTime(), table=&lt;files_location&gt;, nullable=False, default=CallableColumnDefault(&lt;function datetime.utcnow at 0x7f784171b060&gt;)), schema=None)
        uowtransaction = &lt;sqlalchemy.orm.unitofwork.UOWTransaction object at 0x7f78202064b0&gt;
        use_orm_insert_stmt = None
        value_params = {}
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        meth       = &lt;bound method ClauseElement._execute_on_connection of &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;&gt;
        parameters = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
        connection = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        distilled_params = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        execution_options = {'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;}
        self       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
        cache_hit  = &lt;CacheStats.CACHE_MISS: 1&gt;
        compiled_cache = &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;
        compiled_sql = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        distilled_parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        elem       = &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;
        event_multiparams = []
        event_params = {'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        extracted_params = []
        for_executemany = False
        has_events = True
        keys       = ['default', 'name', 'uri']
        schema_translate_map = None
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
        args       = (&lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;,
 [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}],
 &lt;sqlalchemy.sql.dml.Insert object at 0x7f7836efebd0&gt;,
 [])
        conn       = &lt;sqlalchemy.pool.base._ConnectionFairy object at 0x7f7821471550&gt;
        constructor = &lt;bound method DefaultExecutionContext._init_compiled of &lt;class 'sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2'&gt;&gt;
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        execution_options = immutabledict({'compiled_cache': &lt;sqlalchemy.util._collections.LRUCache object at 0x7f7836c15df0&gt;})
        kw         = {'cache_hit': &lt;CacheStats.CACHE_MISS: 1&gt;}
        parameters = [{'default': True, 'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        yp         = None
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        e          = UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        exc_info   = (&lt;class 'psycopg2.errors.UniqueViolation'&gt;,
 UniqueViolation('duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n'),
 &lt;traceback object at 0x7f7824b20c00&gt;)
        invalidate_pool_on_disconnect = True
        is_exit_exception = False
        is_sub_exec = False
        ismulti    = False
        newraise   = None
        parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        should_wrap = True
        sqlalchemy_exception = IntegrityError('(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"\nDETAIL:  Key (name)=(pytest-location) already exists.\n')
        statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
        context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
        cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
        dialect    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
        effective_parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
        evt_handled = False
        parameters = [{'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
  'default': True,
  'name': 'pytest-location',
  'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
  'uri': '/tmp/tmp47ccgn65'}]
        self       = &lt;sqlalchemy.engine.base.Connection object at 0x7f78206ca240&gt;
        statement  = &lt;sqlalchemy.dialects.postgresql.base.PGCompiler object at 0x7f781a801370&gt;
        str_statement = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
cursor = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
statement = 'INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id'
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'default': True, 'name': 'pytest-location', 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814), ...}
context = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;

    def do_execute(self, cursor, statement, parameters, context=None):
&gt;       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "uq_files_location_name"
E       DETAIL:  Key (name)=(pytest-location) already exists.
E       
E       [SQL: INSERT INTO files_location (name, uri, "default", created, updated) VALUES (%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING files_location.id]
E       [parameters: {'name': 'pytest-location', 'uri': '/tmp/tmp47ccgn65', 'default': True, 'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808), 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814)}]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

context    = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGExecutionContext_psycopg2 object at 0x7f7819967860&gt;
cursor     = &lt;cursor object at 0x7f78181a4310; closed: -1&gt;
parameters = {'created': datetime.datetime(2025, 11, 18, 11, 3, 6, 351808),
 'default': True,
 'name': 'pytest-location',
 'updated': datetime.datetime(2025, 11, 18, 11, 3, 6, 351814),
 'uri': '/tmp/tmp47ccgn65'}
self       = &lt;sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x7f7824af9310&gt;
statement  = ('INSERT INTO files_location (name, uri, "default", created, updated) VALUES '
 '(%(name)s, %(uri)s, %(default)s, %(created)s, %(updated)s) RETURNING '
 'files_location.id')

.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: IntegrityError</error></testcase><testcase classname="tests.services.test_service_access" name="ISORT" time="0.088" /><testcase classname="tests.services.test_service_access" name="black" time="0.275" /><testcase classname="tests.services.test_service_access" name="test_cant_create_multiple_grants_for_same_user" time="6.257" /><testcase classname="tests.services.test_service_access" name="test_cant_create_multiple_grants_for_same_role" time="1.719" /><testcase classname="tests.services.test_service_access" name="test_create_multiple_grants" time="1.810" /><testcase classname="tests.services.test_service_access" name="test_create_multiple_grants_one_exists" time="1.787" /><testcase classname="tests.services.test_service_access" name="test_read_grant_by_subjectid_found" time="1.794" /><testcase classname="tests.services.test_service_access" name="test_read_grant_by_subjectid_not_found" time="1.774" /><testcase classname="tests.services.test_service_access" name="test_read_grant_by_subjectid_no_grants" time="1.681" /><testcase classname="tests.services.test_service_access" name="test_read_grant_by_subjectid_provide_role" time="1.753" /><testcase classname="tests.services.test_service_access" name="test_delete_grant_by_subjectid_found" time="1.824" /><testcase classname="tests.services.test_service_access" name="test_delete_grant_by_subjectid_not_found" time="1.734" /><testcase classname="tests.services.test_service_access" name="test_delete_grant_by_subjectid_no_grants" time="1.686" /><testcase classname="tests.services.test_service_access" name="test_delete_grant_by_subjectid_provide_role" time="1.703" /><testcase classname="tests.services.test_service_access" name="test_read_all_grants_by_subject_found" time="1.906" /><testcase classname="tests.services.test_service_access" name="test_read_all_grants_by_subject_not_found" time="1.773" /><testcase classname="tests.services.test_service_access" name="test_update_grant_by_subject_found" time="1.772" /><testcase classname="tests.services.test_service_access" name="test_update_grant_by_subject_not_found" time="1.716" /><testcase classname="tests.services.test_service_access" name="test_update_grant_by_subject_permissions" time="2.317" /><testcase classname="tests.services.test_service_access" name="test_delete_grant_by_subject_permissions" time="2.385" /><testcase classname="tests.services.test_service_access" name="test_preview_draft_link_in_email" time="1.777" /><testcase classname="tests.services.test_service_communities" name="ISORT" time="0.020" /><testcase classname="tests.services.test_service_communities" name="black" time="0.168" /><testcase classname="tests.services.test_service_communities" name="test_make_community_restricted_with_public_record" time="6.783" /><testcase classname="tests.services.test_service_communities" name="test_make_community_restricted_with_restricted_record" time="1.936" /><testcase classname="tests.services.test_service_communities" name="test_make_community_public_with_restricted_record" time="2.503" /><testcase classname="tests.services.test_service_community_records" name="ISORT" time="0.034" /><testcase classname="tests.services.test_service_community_records" name="black" time="0.184" /><testcase classname="tests.services.test_service_community_records" name="test_remove_record_from_community_success" time="10.874" /><testcase classname="tests.services.test_service_community_records" name="test_remove_records_from_community_success" time="6.183" /><testcase classname="tests.services.test_service_community_records" name="test_missing_permission" time="2.158" /><testcase classname="tests.services.test_service_community_records" name="test_curator_permission" time="2.332" /><testcase classname="tests.services.test_service_community_records" name="test_remove_non_existing_record" time="0.986" /><testcase classname="tests.services.test_service_community_records" name="test_remove_record_of_other_community" time="2.545" /><testcase classname="tests.services.test_service_community_records" name="test_remove_records_from_communities_success_w_errors" time="2.325" /><testcase classname="tests.services.test_service_community_records" name="test_remove_too_many_records" time="1.066" /><testcase classname="tests.services.test_service_community_records" name="test_remove_w_empty_payload" time="0.977" /><testcase classname="tests.services.test_service_community_records" name="test_search_community_records" time="6.976" /><testcase classname="tests.services.test_service_record_communities" name="ISORT" time="0.032" /><testcase classname="tests.services.test_service_record_communities" name="black" time="0.203" /><testcase classname="tests.services.test_service_record_communities" name="test_bulk_add_non_authorized_permission" time="6.550" /><testcase classname="tests.services.test_service_record_communities" name="test_bulk_add_by_system_permission" time="2.091" /><testcase classname="tests.services.test_service_record_communities" name="test_bulk_add" time="5.599" /><testcase classname="tests.services.test_service_record_communities" name="test_bulk_add_already_in_community" time="2.061" /><testcase classname="tests.services.test_service_record_communities" name="test_add_community_component_called" time="2.316" /><testcase classname="tests.services.test_service_record_communities" name="test_remove_community_component_called" time="2.415" /><testcase classname="tests.services.test_service_record_communities" name="test_set_default_component_called" time="2.335" /><testcase classname="tests.services.test_service_record_communities" name="test_bulk_add_component_called" time="5.957" /><testcase classname="tests.services.test_service_review" name="ISORT" time="0.151" /><testcase classname="tests.services.test_service_review" name="black" time="0.356" /><testcase classname="tests.services.test_service_review" name="test_simple_flow" time="7.927" /><testcase classname="tests.services.test_service_review" name="test_direct_include_to_open_review_community" time="3.400" /><testcase classname="tests.services.test_service_review" name="test_direct_include_to_open_review_community_with_require_review" time="1.356" /><testcase classname="tests.services.test_service_review" name="test_non_owner_direct_include_to_open_review_community" time="1.244" /><testcase classname="tests.services.test_service_review" name="test_direct_include_to_closed_review_community" time="1.434" /><testcase classname="tests.services.test_service_review" name="test_creation" time="1.245" /><testcase classname="tests.services.test_service_review" name="test_create_with_invalid_community" time="0.736" /><testcase classname="tests.services.test_service_review" name="test_create_review_after_draft" time="1.287" /><testcase classname="tests.services.test_service_review" name="test_accept_public_record_review_to_restricted_community" time="1.467" /><testcase classname="tests.services.test_service_review" name="test_submit_restricted_record_review_to_restricted_community" time="1.556" /><testcase classname="tests.services.test_service_review" name="test_create_when_already_published" time="2.247" /><testcase classname="tests.services.test_service_review" name="test_create_with_new_version" time="2.226" /><testcase classname="tests.services.test_service_review" name="test_update" time="1.512" /><testcase classname="tests.services.test_service_review" name="test_publish_when_review_exists" time="5.335" /><testcase classname="tests.services.test_service_review" name="test_delete" time="1.186" /><testcase classname="tests.services.test_service_review" name="test_delete_when_submitted" time="1.341" /><testcase classname="tests.services.test_service_review" name="test_delete_when_accepted" time="2.684" /><testcase classname="tests.services.test_service_review" name="test_read_delete_submit_no_review" time="0.734" /><testcase classname="tests.services.test_service_review" name="test_delete_draft_unsubmitted" time="1.324" /><testcase classname="tests.services.test_service_review" name="test_delete_draft_when_submitted" time="1.459" /><testcase classname="tests.services.test_service_review" name="test_submit_with_validation_errors" time="1.239" /><testcase classname="tests.services.test_service_review" name="test_accept_with_validation_errors" time="1.767" /><testcase classname="tests.services.test_service_review" name="test_review_gives_access_to_curator" time="1.542" /><testcase classname="tests.services.test_service_review" name="test_review_submit_notification" time="2.869" /><testcase classname="tests.services.test_service_review" name="test_review_accept_notification" time="3.579" /><testcase classname="tests.services.test_service_review" name="test_review_cancel_notification" time="2.975" /><testcase classname="tests.services.test_service_review" name="test_review_decline_notification" time="2.472" /><testcase classname="tests.services.test_service_review" name="test_review_expire_notification" time="2.325" /><testcase classname="tests.services.test_service_review" name="test_share_draft_gives_access_to_review_request" time="2.103" /><testcase classname="tests.services.test_service_review" name="test_share_draft_shows_up_in_shared_user_uploads" time="3.713" /><testcase classname="tests.services.test_service_review" name="test_share_draft_shows_up_in_shared_user_requests" time="2.950" /><testcase classname="tests.services.test_service_tasks" name="ISORT" time="0.017" /><testcase classname="tests.services.test_service_tasks" name="black" time="0.164" /><testcase classname="tests.services.test_service_tasks" name="test_embargo_lift_without_draft" time="6.914" /><testcase classname="tests.services.test_service_tasks" name="test_embargo_lift_with_draft" time="2.802" /><testcase classname="tests.services.test_service_tasks" name="test_embargo_lift_with_updated_draft" time="3.478" /><testcase classname="tests.services.test_sort" name="ISORT" time="0.012" /><testcase classname="tests.services.test_sort" name="black" time="0.158" /><testcase classname="tests.services.test_sort" name="test_sort_by_versions" time="10.322" /><testcase classname="tests.test_alembic" name="ISORT" time="0.013" /><testcase classname="tests.test_alembic" name="black" time="0.160" /><testcase classname="tests.test_alembic" name="test_alembic" time="0.000"><skipped type="pytest.skip" message="Caused by mergepoint">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_alembic.py:16: Caused by mergepoint</skipped></testcase><testcase classname="tests.test_invenio_rdm_records" name="ISORT" time="0.011" /><testcase classname="tests.test_invenio_rdm_records" name="black" time="0.153" /><testcase classname="tests.test_invenio_rdm_records" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_rdm_records" name="test_link_generation" time="6.678" /><testcase classname="tests.tokens.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.tokens.__init__" name="ISORT" time="0.004" /><testcase classname="tests.tokens.__init__" name="black" time="0.154" /><testcase classname="tests.tokens.conftest" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.tokens.conftest" name="ISORT" time="0.008" /><testcase classname="tests.tokens.conftest" name="black" time="0.151" /><testcase classname="tests.tokens.test_feature_flag" name="ISORT" time="0.008" /><testcase classname="tests.tokens.test_feature_flag" name="black" time="0.153" /><testcase classname="tests.tokens.test_feature_flag" name="test_rat_feature_disabled" time="5.445" /><testcase classname="tests.tokens.test_resource_access" name="ISORT" time="0.123" /><testcase classname="tests.tokens.test_resource_access" name="black" time="0.314" /><testcase classname="tests.tokens.test_resource_access" name="test_rat_validation_failed" time="3.706" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat" time="4.489" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_metadata_permissions_with_rat" time="3.059" /><testcase classname="tests.tokens.test_resource_access" name="test_draft_files_permissions_with_rat" time="5.407" /><testcase classname="tests.tokens.test_resource_access" name="test_draft_metadata_permissions_with_rat" time="1.447" /><testcase classname="tests.tokens.test_resource_access" name="test_fully_restricted_rec_files_permissions_with_rat" time="2.455" /><testcase classname="tests.tokens.test_resource_access" name="test_fully_restricted_draft_files_permissions_with_rat" time="1.472" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_invalid_token_error" time="2.959" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_missing_token_id_error" time="2.927" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_invalid_token_id_error" time="2.941" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_expired_token_error" time="2.993" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_wrong_file" time="3.056" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_wrong_access" time="3.039" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_wrong_recid" time="6.131" /><testcase classname="tests.tokens.test_resource_access" name="test_rec_files_permissions_with_rat_wrong_signer" time="3.623" /><testcase classname="invenio_rdm_records.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.__init__" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.access_requests_ui.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.access_requests_ui.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.access_requests_ui.__init__" name="black" time="0.149" /><testcase classname="invenio_rdm_records.access_requests_ui.views" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.access_requests_ui.views" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.access_requests_ui.views" name="black" time="0.165" /><testcase classname="invenio_rdm_records.administration.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.administration.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.administration.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.administration.views.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.administration.views.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.administration.views.__init__" name="black" time="0.150" /><testcase classname="invenio_rdm_records.administration.views.oai" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.administration.views.oai" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.administration.views.oai" name="black" time="0.177" /><testcase classname="invenio_rdm_records.alembic.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.alembic.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.alembic.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.alembic.0cf260eb8e97_create_table_for_secret_links" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.alembic.0cf260eb8e97_create_table_for_secret_links" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.alembic.0cf260eb8e97_create_table_for_secret_links" name="black" time="0.159" /><testcase classname="invenio_rdm_records.alembic.1746626978_drop_rdmrecordquota_user_id_unique_" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.alembic.1746626978_drop_rdmrecordquota_user_id_unique_" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.alembic.1746626978_drop_rdmrecordquota_user_id_unique_" name="black" time="0.156" /><testcase classname="invenio_rdm_records.alembic.2186256e8d9b_add_deletion_status_to_rdmrecords" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.alembic.2186256e8d9b_add_deletion_status_to_rdmrecords" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.alembic.2186256e8d9b_add_deletion_status_to_rdmrecords" name="black" time="0.164" /><testcase classname="invenio_rdm_records.alembic.4a15e8671f4d_create_rdm_records_tables" name="PYDOCSTYLE" time="0.023" /><testcase classname="invenio_rdm_records.alembic.4a15e8671f4d_create_rdm_records_tables" name="ISORT" time="0.046" /><testcase classname="invenio_rdm_records.alembic.4a15e8671f4d_create_rdm_records_tables" name="black" time="0.213" /><testcase classname="invenio_rdm_records.alembic.88d1463de5c0_create_parent_record_table" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.alembic.88d1463de5c0_create_parent_record_table" name="ISORT" time="0.025" /><testcase classname="invenio_rdm_records.alembic.88d1463de5c0_create_parent_record_table" name="black" time="0.178" /><testcase classname="invenio_rdm_records.alembic.8ed1a438601c_migrate_secret_links" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.alembic.8ed1a438601c_migrate_secret_links" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.alembic.8ed1a438601c_migrate_secret_links" name="black" time="0.155" /><testcase classname="invenio_rdm_records.alembic.9e0ac518b9df_create_records_communities_m2m_table" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.alembic.9e0ac518b9df_create_records_communities_m2m_table" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.alembic.9e0ac518b9df_create_records_communities_m2m_table" name="black" time="0.160" /><testcase classname="invenio_rdm_records.alembic.a2a6819f14f1_create_files_and_media_files_versioning_" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.alembic.a2a6819f14f1_create_files_and_media_files_versioning_" name="ISORT" time="0.031" /><testcase classname="invenio_rdm_records.alembic.a2a6819f14f1_create_files_and_media_files_versioning_" name="black" time="0.182" /><testcase classname="invenio_rdm_records.alembic.a3957490361d_remove_pidrelations_tables" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.alembic.a3957490361d_remove_pidrelations_tables" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.alembic.a3957490361d_remove_pidrelations_tables" name="black" time="0.154" /><testcase classname="invenio_rdm_records.alembic.a6bfa06b1a6d_add_origin_and_description_to_secret_links" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.alembic.a6bfa06b1a6d_add_origin_and_description_to_secret_links" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.alembic.a6bfa06b1a6d_add_origin_and_description_to_secret_links" name="black" time="0.155" /><testcase classname="invenio_rdm_records.alembic.b822ba22c688_create_rdm_records_branch" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.alembic.b822ba22c688_create_rdm_records_branch" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.alembic.b822ba22c688_create_rdm_records_branch" name="black" time="0.152" /><testcase classname="invenio_rdm_records.alembic.cfcb8cb78708_create_access_request_tokens_table" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.alembic.cfcb8cb78708_create_access_request_tokens_table" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.alembic.cfcb8cb78708_create_access_request_tokens_table" name="black" time="0.167" /><testcase classname="invenio_rdm_records.alembic.faf0cefa79a0_create_record_quota_tables" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.alembic.faf0cefa79a0_create_record_quota_tables" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.alembic.faf0cefa79a0_create_record_quota_tables" name="black" time="0.166" /><testcase classname="invenio_rdm_records.alembic.ff860d48fb4b_create_media_files_table" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.alembic.ff860d48fb4b_create_media_files_table" name="ISORT" time="0.031" /><testcase classname="invenio_rdm_records.alembic.ff860d48fb4b_create_media_files_table" name="black" time="0.186" /><testcase classname="invenio_rdm_records.alembic.ff9bec971d30_add_indexes" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.alembic.ff9bec971d30_add_indexes" name="ISORT" time="0.022" /><testcase classname="invenio_rdm_records.alembic.ff9bec971d30_add_indexes" name="black" time="0.172" /><testcase classname="invenio_rdm_records.alembic.ffd725001655_add_field_to_record_consent_to_share_" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.alembic.ffd725001655_add_field_to_record_consent_to_share_" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.alembic.ffd725001655_add_field_to_record_consent_to_share_" name="black" time="0.155" /><testcase classname="invenio_rdm_records.checks.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.checks.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.checks.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.checks.requests" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.checks.requests" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.checks.requests" name="black" time="0.179" /><testcase classname="invenio_rdm_records.cli" name="PYDOCSTYLE" time="0.031" /><testcase classname="invenio_rdm_records.cli" name="ISORT" time="0.063" /><testcase classname="invenio_rdm_records.cli" name="black" time="0.220" /><testcase classname="invenio_rdm_records.config" name="PYDOCSTYLE" time="0.030" /><testcase classname="invenio_rdm_records.config" name="ISORT" time="0.090" /><testcase classname="invenio_rdm_records.config" name="black" time="0.244" /><testcase classname="invenio_rdm_records.contrib.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.contrib.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.contrib.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.contrib.codemeta.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.contrib.codemeta.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.contrib.codemeta.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.contrib.codemeta.custom_fields" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.contrib.codemeta.custom_fields" name="ISORT" time="0.023" /><testcase classname="invenio_rdm_records.contrib.codemeta.custom_fields" name="black" time="0.169" /><testcase classname="invenio_rdm_records.contrib.codemeta.processors" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.contrib.codemeta.processors" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.contrib.codemeta.processors" name="black" time="0.159" /><testcase classname="invenio_rdm_records.contrib.imprint.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.contrib.imprint.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.contrib.imprint.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.contrib.imprint.custom_fields" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.contrib.imprint.custom_fields" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.contrib.imprint.custom_fields" name="black" time="0.172" /><testcase classname="invenio_rdm_records.contrib.imprint.processors" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.contrib.imprint.processors" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.contrib.imprint.processors" name="black" time="0.174" /><testcase classname="invenio_rdm_records.contrib.journal.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.contrib.journal.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.contrib.journal.__init__" name="black" time="0.156" /><testcase classname="invenio_rdm_records.contrib.journal.custom_fields" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.contrib.journal.custom_fields" name="ISORT" time="0.021" /><testcase classname="invenio_rdm_records.contrib.journal.custom_fields" name="black" time="0.170" /><testcase classname="invenio_rdm_records.contrib.journal.processors" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_rdm_records.contrib.journal.processors" name="ISORT" time="0.027" /><testcase classname="invenio_rdm_records.contrib.journal.processors" name="black" time="0.190" /><testcase classname="invenio_rdm_records.contrib.journal.sort" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.contrib.journal.sort" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.contrib.journal.sort" name="black" time="0.158" /><testcase classname="invenio_rdm_records.contrib.meeting.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.contrib.meeting.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.contrib.meeting.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.contrib.meeting.custom_fields" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.contrib.meeting.custom_fields" name="ISORT" time="0.026" /><testcase classname="invenio_rdm_records.contrib.meeting.custom_fields" name="black" time="0.177" /><testcase classname="invenio_rdm_records.contrib.meeting.processors" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.contrib.meeting.processors" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.contrib.meeting.processors" name="black" time="0.164" /><testcase classname="invenio_rdm_records.contrib.meeting.sort" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.contrib.meeting.sort" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.contrib.meeting.sort" name="black" time="0.153" /><testcase classname="invenio_rdm_records.contrib.thesis.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.contrib.thesis.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.contrib.thesis.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.contrib.thesis.custom_fields" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.contrib.thesis.custom_fields" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.contrib.thesis.custom_fields" name="black" time="0.166" /><testcase classname="invenio_rdm_records.ext" name="PYDOCSTYLE" time="0.025" /><testcase classname="invenio_rdm_records.ext" name="ISORT" time="0.046" /><testcase classname="invenio_rdm_records.ext" name="black" time="0.204" /><testcase classname="invenio_rdm_records.fixtures.__init__" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.fixtures.__init__" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.fixtures.__init__" name="black" time="0.161" /><testcase classname="invenio_rdm_records.fixtures.communities" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.fixtures.communities" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.fixtures.communities" name="black" time="0.157" /><testcase classname="invenio_rdm_records.fixtures.data.vocabularies.languages" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.fixtures.data.vocabularies.languages" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.fixtures.data.vocabularies.languages" name="black" time="0.195" /><testcase classname="invenio_rdm_records.fixtures.demo" name="PYDOCSTYLE" time="0.030" /><testcase classname="invenio_rdm_records.fixtures.demo" name="ISORT" time="0.053" /><testcase classname="invenio_rdm_records.fixtures.demo" name="black" time="0.206" /><testcase classname="invenio_rdm_records.fixtures.fixture" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.fixtures.fixture" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.fixtures.fixture" name="black" time="0.162" /><testcase classname="invenio_rdm_records.fixtures.records" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.fixtures.records" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.fixtures.records" name="black" time="0.152" /><testcase classname="invenio_rdm_records.fixtures.tasks" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_rdm_records.fixtures.tasks" name="ISORT" time="0.039" /><testcase classname="invenio_rdm_records.fixtures.tasks" name="black" time="0.190" /><testcase classname="invenio_rdm_records.fixtures.users" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.fixtures.users" name="ISORT" time="0.021" /><testcase classname="invenio_rdm_records.fixtures.users" name="black" time="0.167" /><testcase classname="invenio_rdm_records.fixtures.vocabularies" name="PYDOCSTYLE" time="0.040" /><testcase classname="invenio_rdm_records.fixtures.vocabularies" name="ISORT" time="0.056" /><testcase classname="invenio_rdm_records.fixtures.vocabularies" name="black" time="0.222" /><testcase classname="invenio_rdm_records.jobs.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.jobs.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.jobs.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.jobs.jobs" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.jobs.jobs" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.jobs.jobs" name="black" time="0.157" /><testcase classname="invenio_rdm_records.notifications.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.notifications.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.notifications.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.notifications.builders" name="PYDOCSTYLE" time="0.036" /><testcase classname="invenio_rdm_records.notifications.builders" name="ISORT" time="0.078" /><testcase classname="invenio_rdm_records.notifications.builders" name="black" time="0.231" /><testcase classname="invenio_rdm_records.oai" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.oai" name="ISORT" time="0.028" /><testcase classname="invenio_rdm_records.oai" name="black" time="0.176" /><testcase classname="invenio_rdm_records.oaiserver.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.oaiserver.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.oaiserver.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.oaiserver.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.oaiserver.resources.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.oaiserver.resources.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.oaiserver.resources.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.oaiserver.resources.config" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.oaiserver.resources.config" name="black" time="0.164" /><testcase classname="invenio_rdm_records.oaiserver.resources.resources" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.oaiserver.resources.resources" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.oaiserver.resources.resources" name="black" time="0.171" /><testcase classname="invenio_rdm_records.oaiserver.services.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.oaiserver.services.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.oaiserver.services.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.oaiserver.services.config" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.oaiserver.services.config" name="ISORT" time="0.027" /><testcase classname="invenio_rdm_records.oaiserver.services.config" name="black" time="0.175" /><testcase classname="invenio_rdm_records.oaiserver.services.errors" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.oaiserver.services.errors" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.oaiserver.services.errors" name="black" time="0.158" /><testcase classname="invenio_rdm_records.oaiserver.services.permissions" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.oaiserver.services.permissions" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.oaiserver.services.permissions" name="black" time="0.155" /><testcase classname="invenio_rdm_records.oaiserver.services.results" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.oaiserver.services.results" name="ISORT" time="0.022" /><testcase classname="invenio_rdm_records.oaiserver.services.results" name="black" time="0.180" /><testcase classname="invenio_rdm_records.oaiserver.services.schema" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.oaiserver.services.schema" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.oaiserver.services.schema" name="black" time="0.158" /><testcase classname="invenio_rdm_records.oaiserver.services.services" name="PYDOCSTYLE" time="0.023" /><testcase classname="invenio_rdm_records.oaiserver.services.services" name="ISORT" time="0.045" /><testcase classname="invenio_rdm_records.oaiserver.services.services" name="black" time="0.197" /><testcase classname="invenio_rdm_records.oaiserver.services.uow" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.oaiserver.services.uow" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.oaiserver.services.uow" name="black" time="0.156" /><testcase classname="invenio_rdm_records.proxies" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.proxies" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.proxies" name="black" time="0.158" /><testcase classname="invenio_rdm_records.records.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.records.__init__" name="black" time="0.161" /><testcase classname="invenio_rdm_records.records.api" name="PYDOCSTYLE" time="0.036" /><testcase classname="invenio_rdm_records.records.api" name="ISORT" time="0.087" /><testcase classname="invenio_rdm_records.records.api" name="black" time="0.244" /><testcase classname="invenio_rdm_records.records.dumpers.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.dumpers.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.records.dumpers.__init__" name="black" time="0.161" /><testcase classname="invenio_rdm_records.records.dumpers.access" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.records.dumpers.access" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.records.dumpers.access" name="black" time="0.165" /><testcase classname="invenio_rdm_records.records.dumpers.combined_subjects" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.records.dumpers.combined_subjects" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.records.dumpers.combined_subjects" name="black" time="0.165" /><testcase classname="invenio_rdm_records.records.dumpers.edtf" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.records.dumpers.edtf" name="ISORT" time="0.021" /><testcase classname="invenio_rdm_records.records.dumpers.edtf" name="black" time="0.175" /><testcase classname="invenio_rdm_records.records.dumpers.locations" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.records.dumpers.locations" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.records.dumpers.locations" name="black" time="0.165" /><testcase classname="invenio_rdm_records.records.dumpers.pids" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.records.dumpers.pids" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.records.dumpers.pids" name="black" time="0.161" /><testcase classname="invenio_rdm_records.records.dumpers.statistics" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.records.dumpers.statistics" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.records.dumpers.statistics" name="black" time="0.163" /><testcase classname="invenio_rdm_records.records.dumpers.subject_hierarchy" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.records.dumpers.subject_hierarchy" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.records.dumpers.subject_hierarchy" name="black" time="0.166" /><testcase classname="invenio_rdm_records.records.jsonschemas.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.jsonschemas.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.jsonschemas.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.records.mappings.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.mappings.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.records.mappings.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.mappings.os-v1.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.mappings.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.mappings.os-v1.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.records.mappings.os-v2.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.mappings.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.mappings.os-v2.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.records.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.mappings.v7.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.records.models" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.records.models" name="ISORT" time="0.034" /><testcase classname="invenio_rdm_records.records.models" name="black" time="0.182" /><testcase classname="invenio_rdm_records.records.processors.base" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.records.processors.base" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.records.processors.base" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.processors.tiles" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.records.processors.tiles" name="ISORT" time="0.030" /><testcase classname="invenio_rdm_records.records.processors.tiles" name="black" time="0.188" /><testcase classname="invenio_rdm_records.records.stats.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.records.stats.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.records.stats.api" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.records.stats.api" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.records.stats.api" name="black" time="0.169" /><testcase classname="invenio_rdm_records.records.stats.templates.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v1.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v1.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v2.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v2.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.os-v2.__init__" name="black" time="0.157" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.v7.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_file_download.v7.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v1.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v1.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v2.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.os-v2.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.v7.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.aggregations.aggr_record_view.v7.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.stats.templates.events.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v1.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v1.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v2.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.os-v2.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.v7.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.v7.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.records.stats.templates.events.file_download.v7.__init__" name="black" time="0.156" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v1.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v1.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v2.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.os-v2.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.v7.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.records.stats.templates.events.record_view.v7.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.records.systemfields.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.records.systemfields.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.records.systemfields.__init__" name="black" time="0.167" /><testcase classname="invenio_rdm_records.records.systemfields.access.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.records.systemfields.access.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.records.systemfields.access.__init__" name="black" time="0.157" /><testcase classname="invenio_rdm_records.records.systemfields.access.access_settings" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.records.systemfields.access.access_settings" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.records.systemfields.access.access_settings" name="black" time="0.162" /><testcase classname="invenio_rdm_records.records.systemfields.access.embargo" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.records.systemfields.access.embargo" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.records.systemfields.access.embargo" name="black" time="0.172" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.__init__" name="black" time="0.159" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.parent" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.parent" name="ISORT" time="0.032" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.parent" name="black" time="0.192" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.record" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.record" name="ISORT" time="0.029" /><testcase classname="invenio_rdm_records.records.systemfields.access.field.record" name="black" time="0.187" /><testcase classname="invenio_rdm_records.records.systemfields.access.grants" name="PYDOCSTYLE" time="0.027" /><testcase classname="invenio_rdm_records.records.systemfields.access.grants" name="ISORT" time="0.040" /><testcase classname="invenio_rdm_records.records.systemfields.access.grants" name="black" time="0.200" /><testcase classname="invenio_rdm_records.records.systemfields.access.links" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.records.systemfields.access.links" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.records.systemfields.access.links" name="black" time="0.178" /><testcase classname="invenio_rdm_records.records.systemfields.access.owners" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.records.systemfields.access.owners" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.records.systemfields.access.owners" name="black" time="0.177" /><testcase classname="invenio_rdm_records.records.systemfields.access.protection" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.records.systemfields.access.protection" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.records.systemfields.access.protection" name="black" time="0.170" /><testcase classname="invenio_rdm_records.records.systemfields.deletion_status" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.records.systemfields.deletion_status" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.records.systemfields.deletion_status" name="black" time="0.174" /><testcase classname="invenio_rdm_records.records.systemfields.draft_status" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.records.systemfields.draft_status" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.records.systemfields.draft_status" name="black" time="0.166" /><testcase classname="invenio_rdm_records.records.systemfields.has_draftcheck" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.records.systemfields.has_draftcheck" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.records.systemfields.has_draftcheck" name="black" time="0.160" /><testcase classname="invenio_rdm_records.records.systemfields.is_verified" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.records.systemfields.is_verified" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.records.systemfields.is_verified" name="black" time="0.157" /><testcase classname="invenio_rdm_records.records.systemfields.statistics" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.records.systemfields.statistics" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.records.systemfields.statistics" name="black" time="0.160" /><testcase classname="invenio_rdm_records.records.systemfields.tombstone" name="PYDOCSTYLE" time="0.024" /><testcase classname="invenio_rdm_records.records.systemfields.tombstone" name="ISORT" time="0.032" /><testcase classname="invenio_rdm_records.records.systemfields.tombstone" name="black" time="0.188" /><testcase classname="invenio_rdm_records.requests.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.requests.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.requests.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.requests.access.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.requests.access.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.requests.access.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.requests.access.models" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.requests.access.models" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.requests.access.models" name="black" time="0.174" /><testcase classname="invenio_rdm_records.requests.access.permissions" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.requests.access.permissions" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.requests.access.permissions" name="black" time="0.154" /><testcase classname="invenio_rdm_records.requests.access.requests" name="PYDOCSTYLE" time="0.028" /><testcase classname="invenio_rdm_records.requests.access.requests" name="ISORT" time="0.051" /><testcase classname="invenio_rdm_records.requests.access.requests" name="black" time="0.206" /><testcase classname="invenio_rdm_records.requests.access.tasks" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.requests.access.tasks" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.requests.access.tasks" name="black" time="0.155" /><testcase classname="invenio_rdm_records.requests.base" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.requests.base" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.requests.base" name="black" time="0.153" /><testcase classname="invenio_rdm_records.requests.community_inclusion" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.requests.community_inclusion" name="ISORT" time="0.023" /><testcase classname="invenio_rdm_records.requests.community_inclusion" name="black" time="0.173" /><testcase classname="invenio_rdm_records.requests.community_submission" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.requests.community_submission" name="ISORT" time="0.034" /><testcase classname="invenio_rdm_records.requests.community_submission" name="black" time="0.180" /><testcase classname="invenio_rdm_records.requests.decorators" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.requests.decorators" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.requests.decorators" name="black" time="0.157" /><testcase classname="invenio_rdm_records.requests.entity_resolvers" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_rdm_records.requests.entity_resolvers" name="ISORT" time="0.031" /><testcase classname="invenio_rdm_records.requests.entity_resolvers" name="black" time="0.180" /><testcase classname="invenio_rdm_records.requests.record_deletion" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.requests.record_deletion" name="ISORT" time="0.032" /><testcase classname="invenio_rdm_records.requests.record_deletion" name="black" time="0.184" /><testcase classname="invenio_rdm_records.requests.user_moderation.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.requests.user_moderation.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.requests.user_moderation.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.requests.user_moderation.actions" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.requests.user_moderation.actions" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.requests.user_moderation.actions" name="black" time="0.162" /><testcase classname="invenio_rdm_records.requests.user_moderation.tasks" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.requests.user_moderation.tasks" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.requests.user_moderation.tasks" name="black" time="0.160" /><testcase classname="invenio_rdm_records.requests.user_moderation.utils" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.requests.user_moderation.utils" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.requests.user_moderation.utils" name="black" time="0.163" /><testcase classname="invenio_rdm_records.resources.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.resources.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.resources.args" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.resources.args" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.resources.args" name="black" time="0.152" /><testcase classname="invenio_rdm_records.resources.config" name="PYDOCSTYLE" time="0.033" /><testcase classname="invenio_rdm_records.resources.config" name="ISORT" time="0.083" /><testcase classname="invenio_rdm_records.resources.config" name="black" time="0.239" /><testcase classname="invenio_rdm_records.resources.deserializers.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.resources.deserializers.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.resources.deserializers.__init__" name="black" time="0.149" /><testcase classname="invenio_rdm_records.resources.deserializers.errors" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.resources.deserializers.errors" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.resources.deserializers.errors" name="black" time="0.150" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.__init__" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.__init__" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.__init__" name="black" time="0.161" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.schema" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.schema" name="ISORT" time="0.023" /><testcase classname="invenio_rdm_records.resources.deserializers.rocrate.schema" name="black" time="0.178" /><testcase classname="invenio_rdm_records.resources.errors" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.resources.errors" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.resources.errors" name="black" time="0.160" /><testcase classname="invenio_rdm_records.resources.iiif" name="PYDOCSTYLE" time="0.031" /><testcase classname="invenio_rdm_records.resources.iiif" name="ISORT" time="0.057" /><testcase classname="invenio_rdm_records.resources.iiif" name="black" time="0.217" /><testcase classname="invenio_rdm_records.resources.resources" name="PYDOCSTYLE" time="0.068" /><testcase classname="invenio_rdm_records.resources.resources" name="ISORT" time="0.104" /><testcase classname="invenio_rdm_records.resources.resources" name="black" time="0.299" /><testcase classname="invenio_rdm_records.resources.serializers.__init__" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.resources.serializers.__init__" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.resources.serializers.__init__" name="black" time="0.159" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.__init__" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.__init__" name="black" time="0.157" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema" name="PYDOCSTYLE" time="0.035" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema" name="ISORT" time="0.047" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema" name="black" time="0.220" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema_formats" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema_formats" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.resources.serializers.bibtex.schema_formats" name="black" time="0.177" /><testcase classname="invenio_rdm_records.resources.serializers.cff.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.serializers.cff.__init__" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.resources.serializers.cff.__init__" name="black" time="0.157" /><testcase classname="invenio_rdm_records.resources.serializers.cff.schema" name="PYDOCSTYLE" time="0.025" /><testcase classname="invenio_rdm_records.resources.serializers.cff.schema" name="ISORT" time="0.034" /><testcase classname="invenio_rdm_records.resources.serializers.cff.schema" name="black" time="0.198" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.__init__" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.__init__" name="black" time="0.156" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.schema" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.schema" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.resources.serializers.codemeta.schema" name="black" time="0.164" /><testcase classname="invenio_rdm_records.resources.serializers.csl.__init__" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.resources.serializers.csl.__init__" name="ISORT" time="0.025" /><testcase classname="invenio_rdm_records.resources.serializers.csl.__init__" name="black" time="0.173" /><testcase classname="invenio_rdm_records.resources.serializers.csl.schema" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.resources.serializers.csl.schema" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.resources.serializers.csl.schema" name="black" time="0.177" /><testcase classname="invenio_rdm_records.resources.serializers.csv.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.serializers.csv.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.resources.serializers.csv.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.__init__" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.__init__" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.__init__" name="black" time="0.163" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.schema" name="PYDOCSTYLE" time="0.082" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.schema" name="ISORT" time="0.152" /><testcase classname="invenio_rdm_records.resources.serializers.datacite.schema" name="black" time="0.376" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.schema" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.schema" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.resources.serializers.datapackage.schema" name="black" time="0.176" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.__init__" name="PYDOCSTYLE" time="0.020" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.__init__" name="ISORT" time="0.036" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.__init__" name="black" time="0.191" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.schema" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.schema" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.resources.serializers.dcat.schema" name="black" time="0.169" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.__init__" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.__init__" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.__init__" name="black" time="0.160" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.schema" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.schema" name="ISORT" time="0.033" /><testcase classname="invenio_rdm_records.resources.serializers.dublincore.schema" name="black" time="0.191" /><testcase classname="invenio_rdm_records.resources.serializers.errors" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.resources.serializers.errors" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.resources.serializers.errors" name="black" time="0.153" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.schema" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.schema" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.resources.serializers.geojson.schema" name="black" time="0.158" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.__init__" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.__init__" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.__init__" name="black" time="0.160" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.schema" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.schema" name="ISORT" time="0.032" /><testcase classname="invenio_rdm_records.resources.serializers.iiif.schema" name="black" time="0.187" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.__init__" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.__init__" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.__init__" name="black" time="0.158" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.schema" name="PYDOCSTYLE" time="0.048" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.schema" name="ISORT" time="0.070" /><testcase classname="invenio_rdm_records.resources.serializers.marcxml.schema" name="black" time="0.254" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.__init__" name="black" time="0.158" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.schema" name="PYDOCSTYLE" time="0.046" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.schema" name="ISORT" time="0.070" /><testcase classname="invenio_rdm_records.resources.serializers.schemaorg.schema" name="black" time="0.247" /><testcase classname="invenio_rdm_records.resources.serializers.schemas" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.resources.serializers.schemas" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.resources.serializers.schemas" name="black" time="0.170" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.__init__" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.__init__" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.__init__" name="black" time="0.158" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.schema" name="PYDOCSTYLE" time="0.025" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.schema" name="ISORT" time="0.036" /><testcase classname="invenio_rdm_records.resources.serializers.signposting.schema" name="black" time="0.194" /><testcase classname="invenio_rdm_records.resources.serializers.ui.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.resources.serializers.ui.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.ui.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.resources.serializers.ui.fields" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.resources.serializers.ui.fields" name="ISORT" time="0.025" /><testcase classname="invenio_rdm_records.resources.serializers.ui.fields" name="black" time="0.175" /><testcase classname="invenio_rdm_records.resources.serializers.ui.schema" name="PYDOCSTYLE" time="0.039" /><testcase classname="invenio_rdm_records.resources.serializers.ui.schema" name="ISORT" time="0.069" /><testcase classname="invenio_rdm_records.resources.serializers.ui.schema" name="black" time="0.236" /><testcase classname="invenio_rdm_records.resources.serializers.utils" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.resources.serializers.utils" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.resources.serializers.utils" name="black" time="0.162" /><testcase classname="invenio_rdm_records.resources.stats.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.resources.stats.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.resources.stats.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.resources.stats.event_builders" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.resources.stats.event_builders" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.resources.stats.event_builders" name="black" time="0.168" /><testcase classname="invenio_rdm_records.secret_links.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.secret_links.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.secret_links.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.secret_links.errors" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.secret_links.errors" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.secret_links.errors" name="black" time="0.154" /><testcase classname="invenio_rdm_records.secret_links.models" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_rdm_records.secret_links.models" name="ISORT" time="0.026" /><testcase classname="invenio_rdm_records.secret_links.models" name="black" time="0.177" /><testcase classname="invenio_rdm_records.secret_links.permissions" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.secret_links.permissions" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.secret_links.permissions" name="black" time="0.152" /><testcase classname="invenio_rdm_records.secret_links.serializers" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.secret_links.serializers" name="ISORT" time="0.021" /><testcase classname="invenio_rdm_records.secret_links.serializers" name="black" time="0.166" /><testcase classname="invenio_rdm_records.secret_links.signals" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_rdm_records.secret_links.signals" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.secret_links.signals" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.services.__init__" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.access.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.access.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.access.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.services.access.service" name="PYDOCSTYLE" time="0.068" /><testcase classname="invenio_rdm_records.services.access.service" name="ISORT" time="0.136" /><testcase classname="invenio_rdm_records.services.access.service" name="black" time="0.347" /><testcase classname="invenio_rdm_records.services.communities.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.communities.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.communities.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.communities.components" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.services.communities.components" name="ISORT" time="0.017" /><testcase classname="invenio_rdm_records.services.communities.components" name="black" time="0.166" /><testcase classname="invenio_rdm_records.services.communities.moderation" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.communities.moderation" name="ISORT" time="0.017" /><testcase classname="invenio_rdm_records.services.communities.moderation" name="black" time="0.169" /><testcase classname="invenio_rdm_records.services.communities.service" name="PYDOCSTYLE" time="0.036" /><testcase classname="invenio_rdm_records.services.communities.service" name="ISORT" time="0.069" /><testcase classname="invenio_rdm_records.services.communities.service" name="black" time="0.236" /><testcase classname="invenio_rdm_records.services.community_inclusion.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.community_inclusion.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.community_inclusion.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.services.community_inclusion.service" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.services.community_inclusion.service" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.services.community_inclusion.service" name="black" time="0.167" /><testcase classname="invenio_rdm_records.services.community_records.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.community_records.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.community_records.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.services.community_records.service" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.services.community_records.service" name="ISORT" time="0.025" /><testcase classname="invenio_rdm_records.services.community_records.service" name="black" time="0.177" /><testcase classname="invenio_rdm_records.services.components.__init__" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.components.__init__" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.services.components.__init__" name="black" time="0.158" /><testcase classname="invenio_rdm_records.services.components.access" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.services.components.access" name="ISORT" time="0.016" /><testcase classname="invenio_rdm_records.services.components.access" name="black" time="0.169" /><testcase classname="invenio_rdm_records.services.components.custom_fields" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.components.custom_fields" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.components.custom_fields" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.components.files" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.components.files" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.components.files" name="black" time="0.159" /><testcase classname="invenio_rdm_records.services.components.internal_notes" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.components.internal_notes" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.services.components.internal_notes" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.components.metadata" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.services.components.metadata" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.services.components.metadata" name="black" time="0.166" /><testcase classname="invenio_rdm_records.services.components.pids" name="PYDOCSTYLE" time="0.031" /><testcase classname="invenio_rdm_records.services.components.pids" name="ISORT" time="0.046" /><testcase classname="invenio_rdm_records.services.components.pids" name="black" time="0.217" /><testcase classname="invenio_rdm_records.services.components.record_deletion" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.services.components.record_deletion" name="ISORT" time="0.015" /><testcase classname="invenio_rdm_records.services.components.record_deletion" name="black" time="0.167" /><testcase classname="invenio_rdm_records.services.components.record_files" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.components.record_files" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.components.record_files" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.components.review" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.components.review" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.services.components.review" name="black" time="0.160" /><testcase classname="invenio_rdm_records.services.components.signal" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.components.signal" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.services.components.signal" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.components.verified" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.services.components.verified" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.services.components.verified" name="black" time="0.169" /><testcase classname="invenio_rdm_records.services.config" name="PYDOCSTYLE" time="0.060" /><testcase classname="invenio_rdm_records.services.config" name="ISORT" time="0.128" /><testcase classname="invenio_rdm_records.services.config" name="black" time="0.297" /><testcase classname="invenio_rdm_records.services.customizations" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.customizations" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.services.customizations" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.decorators" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.decorators" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.services.decorators" name="black" time="0.156" /><testcase classname="invenio_rdm_records.services.deletion_policy" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_rdm_records.services.deletion_policy" name="ISORT" time="0.026" /><testcase classname="invenio_rdm_records.services.deletion_policy" name="black" time="0.176" /><testcase classname="invenio_rdm_records.services.dummy" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.dummy" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.dummy" name="black" time="0.159" /><testcase classname="invenio_rdm_records.services.errors" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_rdm_records.services.errors" name="ISORT" time="0.028" /><testcase classname="invenio_rdm_records.services.errors" name="black" time="0.178" /><testcase classname="invenio_rdm_records.services.facets" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.services.facets" name="ISORT" time="0.021" /><testcase classname="invenio_rdm_records.services.facets" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.files.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.files.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.files.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.files.service" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.files.service" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.services.files.service" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.generators" name="PYDOCSTYLE" time="0.044" /><testcase classname="invenio_rdm_records.services.generators" name="ISORT" time="0.058" /><testcase classname="invenio_rdm_records.services.generators" name="black" time="0.225" /><testcase classname="invenio_rdm_records.services.github.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.github.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_rdm_records.services.github.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.services.github.metadata" name="PYDOCSTYLE" time="0.018" /><testcase classname="invenio_rdm_records.services.github.metadata" name="ISORT" time="0.028" /><testcase classname="invenio_rdm_records.services.github.metadata" name="black" time="0.180" /><testcase classname="invenio_rdm_records.services.github.release" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_rdm_records.services.github.release" name="ISORT" time="0.038" /><testcase classname="invenio_rdm_records.services.github.release" name="black" time="0.190" /><testcase classname="invenio_rdm_records.services.github.utils" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.github.utils" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.services.github.utils" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.iiif.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.iiif.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.iiif.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.iiif.converter" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.iiif.converter" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.services.iiif.converter" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.iiif.service" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.services.iiif.service" name="ISORT" time="0.027" /><testcase classname="invenio_rdm_records.services.iiif.service" name="black" time="0.177" /><testcase classname="invenio_rdm_records.services.iiif.storage" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_rdm_records.services.iiif.storage" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.services.iiif.storage" name="black" time="0.177" /><testcase classname="invenio_rdm_records.services.iiif.tasks" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.iiif.tasks" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.services.iiif.tasks" name="black" time="0.162" /><testcase classname="invenio_rdm_records.services.permissions" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_rdm_records.services.permissions" name="ISORT" time="0.050" /><testcase classname="invenio_rdm_records.services.permissions" name="black" time="0.200" /><testcase classname="invenio_rdm_records.services.pids.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.pids.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.pids.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.pids.errors" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.pids.errors" name="ISORT" time="0.009" /><testcase classname="invenio_rdm_records.services.pids.errors" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.pids.manager" name="PYDOCSTYLE" time="0.031" /><testcase classname="invenio_rdm_records.services.pids.manager" name="ISORT" time="0.041" /><testcase classname="invenio_rdm_records.services.pids.manager" name="black" time="0.206" /><testcase classname="invenio_rdm_records.services.pids.providers.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.pids.providers.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.services.pids.providers.__init__" name="black" time="0.154" /><testcase classname="invenio_rdm_records.services.pids.providers.base" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_rdm_records.services.pids.providers.base" name="ISORT" time="0.030" /><testcase classname="invenio_rdm_records.services.pids.providers.base" name="black" time="0.180" /><testcase classname="invenio_rdm_records.services.pids.providers.datacite" name="PYDOCSTYLE" time="0.029" /><testcase classname="invenio_rdm_records.services.pids.providers.datacite" name="ISORT" time="0.042" /><testcase classname="invenio_rdm_records.services.pids.providers.datacite" name="black" time="0.206" /><testcase classname="invenio_rdm_records.services.pids.providers.external" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_rdm_records.services.pids.providers.external" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.services.pids.providers.external" name="black" time="0.167" /><testcase classname="invenio_rdm_records.services.pids.providers.oai" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.pids.providers.oai" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.services.pids.providers.oai" name="black" time="0.158" /><testcase classname="invenio_rdm_records.services.pids.service" name="PYDOCSTYLE" time="0.024" /><testcase classname="invenio_rdm_records.services.pids.service" name="ISORT" time="0.038" /><testcase classname="invenio_rdm_records.services.pids.service" name="black" time="0.196" /><testcase classname="invenio_rdm_records.services.pids.tasks" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.pids.tasks" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.pids.tasks" name="black" time="0.164" /><testcase classname="invenio_rdm_records.services.queryparser" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.queryparser" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.queryparser" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.requests.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.requests.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.requests.__init__" name="black" time="0.150" /><testcase classname="invenio_rdm_records.services.requests.service" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.requests.service" name="ISORT" time="0.013" /><testcase classname="invenio_rdm_records.services.requests.service" name="black" time="0.158" /><testcase classname="invenio_rdm_records.services.result_items" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_rdm_records.services.result_items" name="ISORT" time="0.032" /><testcase classname="invenio_rdm_records.services.result_items" name="black" time="0.183" /><testcase classname="invenio_rdm_records.services.results" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_rdm_records.services.results" name="ISORT" time="0.024" /><testcase classname="invenio_rdm_records.services.results" name="black" time="0.169" /><testcase classname="invenio_rdm_records.services.review.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.review.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.review.__init__" name="black" time="0.151" /><testcase classname="invenio_rdm_records.services.review.links" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.review.links" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.services.review.links" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.review.service" name="PYDOCSTYLE" time="0.020" /><testcase classname="invenio_rdm_records.services.review.service" name="ISORT" time="0.035" /><testcase classname="invenio_rdm_records.services.review.service" name="black" time="0.187" /><testcase classname="invenio_rdm_records.services.schemas.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.schemas.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.schemas.__init__" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.schemas.access" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.schemas.access" name="ISORT" time="0.017" /><testcase classname="invenio_rdm_records.services.schemas.access" name="black" time="0.166" /><testcase classname="invenio_rdm_records.services.schemas.community_records" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.schemas.community_records" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.services.schemas.community_records" name="black" time="0.162" /><testcase classname="invenio_rdm_records.services.schemas.files" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.services.schemas.files" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.services.schemas.files" name="black" time="0.177" /><testcase classname="invenio_rdm_records.services.schemas.metadata" name="PYDOCSTYLE" time="0.034" /><testcase classname="invenio_rdm_records.services.schemas.metadata" name="ISORT" time="0.055" /><testcase classname="invenio_rdm_records.services.schemas.metadata" name="black" time="0.222" /><testcase classname="invenio_rdm_records.services.schemas.parent.__init__" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_rdm_records.services.schemas.parent.__init__" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.services.schemas.parent.__init__" name="black" time="0.165" /><testcase classname="invenio_rdm_records.services.schemas.parent.access" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.schemas.parent.access" name="ISORT" time="0.018" /><testcase classname="invenio_rdm_records.services.schemas.parent.access" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.schemas.parent.communities" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_rdm_records.services.schemas.parent.communities" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.parent.communities" name="black" time="0.158" /><testcase classname="invenio_rdm_records.services.schemas.pids" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.schemas.pids" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.pids" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.schemas.quota" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.schemas.quota" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.services.schemas.quota" name="black" time="0.154" /><testcase classname="invenio_rdm_records.services.schemas.record" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.services.schemas.record" name="ISORT" time="0.027" /><testcase classname="invenio_rdm_records.services.schemas.record" name="black" time="0.173" /><testcase classname="invenio_rdm_records.services.schemas.record_communities" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.record_communities" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.services.schemas.record_communities" name="black" time="0.158" /><testcase classname="invenio_rdm_records.services.schemas.stats" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.schemas.stats" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.stats" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.schemas.tombstone" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.tombstone" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.services.schemas.tombstone" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.schemas.utils" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.schemas.utils" name="ISORT" time="0.010" /><testcase classname="invenio_rdm_records.services.schemas.utils" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.schemas.versions" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.schemas.versions" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.schemas.versions" name="black" time="0.155" /><testcase classname="invenio_rdm_records.services.search_params" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_rdm_records.services.search_params" name="ISORT" time="0.020" /><testcase classname="invenio_rdm_records.services.search_params" name="black" time="0.168" /><testcase classname="invenio_rdm_records.services.services" name="PYDOCSTYLE" time="0.060" /><testcase classname="invenio_rdm_records.services.services" name="ISORT" time="0.107" /><testcase classname="invenio_rdm_records.services.services" name="black" time="0.283" /><testcase classname="invenio_rdm_records.services.signals.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.signals.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.signals.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.signals.signals" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.signals.signals" name="ISORT" time="0.006" /><testcase classname="invenio_rdm_records.services.signals.signals" name="black" time="0.153" /><testcase classname="invenio_rdm_records.services.sort" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_rdm_records.services.sort" name="ISORT" time="0.008" /><testcase classname="invenio_rdm_records.services.sort" name="black" time="0.154" /><testcase classname="invenio_rdm_records.services.stats.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.services.stats.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.services.stats.__init__" name="black" time="0.152" /><testcase classname="invenio_rdm_records.services.stats.permissions" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_rdm_records.services.stats.permissions" name="ISORT" time="0.011" /><testcase classname="invenio_rdm_records.services.stats.permissions" name="black" time="0.157" /><testcase classname="invenio_rdm_records.services.tasks" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_rdm_records.services.tasks" name="ISORT" time="0.022" /><testcase classname="invenio_rdm_records.services.tasks" name="black" time="0.169" /><testcase classname="invenio_rdm_records.tokens.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.tokens.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_rdm_records.tokens.__init__" name="black" time="0.153" /><testcase classname="invenio_rdm_records.tokens.errors" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.tokens.errors" name="ISORT" time="0.012" /><testcase classname="invenio_rdm_records.tokens.errors" name="black" time="0.162" /><testcase classname="invenio_rdm_records.tokens.permissions" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.tokens.permissions" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.tokens.permissions" name="black" time="0.155" /><testcase classname="invenio_rdm_records.tokens.resource_access" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_rdm_records.tokens.resource_access" name="ISORT" time="0.017" /><testcase classname="invenio_rdm_records.tokens.resource_access" name="black" time="0.167" /><testcase classname="invenio_rdm_records.tokens.scopes" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_rdm_records.tokens.scopes" name="ISORT" time="0.007" /><testcase classname="invenio_rdm_records.tokens.scopes" name="black" time="0.154" /><testcase classname="invenio_rdm_records.utils" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_rdm_records.utils" name="ISORT" time="0.029" /><testcase classname="invenio_rdm_records.utils" name="black" time="0.177" /><testcase classname="invenio_rdm_records.views" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_rdm_records.views" name="ISORT" time="0.019" /><testcase classname="invenio_rdm_records.views" name="black" time="0.169" /><testcase classname="invenio_rdm_records.webpack" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_rdm_records.webpack" name="ISORT" time="0.014" /><testcase classname="invenio_rdm_records.webpack" name="black" time="0.182" /></testsuite></testsuites>