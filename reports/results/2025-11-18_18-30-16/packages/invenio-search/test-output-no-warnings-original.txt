 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-postgresql-1  Started
 Container docker_services_cli-opensearch-1  Started
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo
configfile: setup.cfg
testpaths: docs, tests, invenio_search
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collected 140 items

docs/conf.py ...                                                         [  2%]
tests/conftest.py ...                                                    [  4%]
tests/mock_module/__init__.py ...                                        [  6%]
tests/mock_module/component_templates/__init__.py ...                    [  8%]
tests/mock_module/component_templates/os-v2/__init__.py ...              [ 10%]
tests/mock_module/component_templates/v7/__init__.py ...                 [ 12%]
tests/mock_module/index_templates/__init__.py ...                        [ 15%]
tests/mock_module/index_templates/os-v2/__init__.py ...                  [ 17%]
tests/mock_module/index_templates/v7/__init__.py ...                     [ 19%]
tests/mock_module/mappings/__init__.py ...                               [ 21%]
tests/mock_module/mappings/os-v1/__init__.py ...                         [ 23%]
tests/mock_module/mappings/os-v2/__init__.py ...                         [ 25%]
tests/mock_module/mappings/v7/__init__.py ...                            [ 27%]
tests/mock_module/templates/__init__.py ...                              [ 30%]
tests/mock_module/templates/os-v1/__init__.py ...                        [ 32%]
tests/mock_module/templates/os-v2/__init__.py ...                        [ 34%]
tests/mock_module/templates/v7/__init__.py ...                           [ 36%]
tests/test_cli.py ....::error file=package-repo/tests/test_cli.py,line=155::test_check%0A%0Aassert 0 > 0%0A +  where 0 = <Result okay>.exit_code
F.                                                 [ 40%]
tests/test_invenio_search.py ................................            [ 63%]
tests/test_query.py .................                                    [ 75%]
tests/test_utils.py .......                                              [ 80%]
invenio_search/__init__.py ...                                           [ 82%]
invenio_search/api.py ...                                                [ 85%]
invenio_search/cli.py ...                                                [ 87%]
invenio_search/config.py ...                                             [ 89%]
invenio_search/engine.py ...                                             [ 91%]
invenio_search/errors.py ...                                             [ 93%]
invenio_search/ext.py ...                                                [ 95%]
invenio_search/proxies.py ...                                            [ 97%]
invenio_search/utils.py ...                                              [100%]

=================================== FAILURES ===================================
__________________________________ test_check __________________________________

app = <Flask 'testapp'>

    def test_check(app):
        runner = CliRunner()
        script_info = ScriptInfo(create_app=lambda: app)
    
        result = runner.invoke(cmd, ["check"], obj=script_info)
        assert result.exit_code == 0
    
        wrong_version = search.VERSION[0] + 1
        with patch(
            "invenio_search.cli.search.VERSION",
            return_value=(wrong_version, 0, 0),
        ):
            result = runner.invoke(cmd, ["check"], obj=script_info)
>           assert result.exit_code > 0
E           assert 0 > 0
E            +  where 0 = <Result okay>.exit_code

tests/test_cli.py:155: AssertionError
- generated xml file: /home/runner/work/invenio-bug-verification/invenio-bug-verification/artifacts/test-report-original.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                         Stmts   Miss  Cover   Missing
----------------------------------------------------------
invenio_search/__init__.py       5      0   100%
invenio_search/api.py          129      8    94%   50, 54, 58, 62, 106, 114, 250, 258
invenio_search/cli.py          122      7    94%   27, 41, 60, 120-126, 184-185
invenio_search/config.py        12      0   100%
invenio_search/engine.py        33     16    52%   26-28, 34-37, 48, 65-71, 76, 81, 86-87
invenio_search/errors.py         2      0   100%
invenio_search/ext.py          275     13    95%   119, 127-136, 225, 344, 373, 443-444, 460, 532, 536, 546
invenio_search/proxies.py        8      0   100%
invenio_search/utils.py         23      0   100%
----------------------------------------------------------
TOTAL                          609     44    93%
=========================== short test summary info ============================
FAILED tests/test_cli.py::test_check - assert 0 > 0
 +  where 0 = <Result okay>.exit_code
======================== 1 failed, 139 passed in 10.65s ========================
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
