<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="6" skipped="1" tests="152" time="38.909" timestamp="2025-11-18T12:40:11.838885+00:00" hostname="runnervmg1sw1"><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.039" /><testcase classname="tests.conftest" name="ISORT" time="0.211" /><testcase classname="tests.conftest" name="black" time="0.423" /><testcase classname="tests.helpers" name="PYDOCSTYLE" time="0.012" /><testcase classname="tests.helpers" name="ISORT" time="0.026" /><testcase classname="tests.helpers" name="black" time="0.183" /><testcase classname="tests.test_admin" name="ISORT" time="0.020" /><testcase classname="tests.test_admin" name="black" time="0.178" /><testcase classname="tests.test_admin" name="test_admin" time="0.993" /><testcase classname="tests.test_alembic" name="ISORT" time="0.011" /><testcase classname="tests.test_alembic" name="black" time="0.162" /><testcase classname="tests.test_alembic" name="test_alembic" time="0.000"><skipped type="pytest.skip" message="Caused by mergepoint">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_alembic.py:16: Caused by mergepoint</skipped></testcase><testcase classname="tests.test_cli" name="ISORT" time="0.014" /><testcase classname="tests.test_cli" name="black" time="0.165" /><testcase classname="tests.test_cli" name="test_cli_tokens" time="0.535" /><testcase classname="tests.test_decorators" name="ISORT" time="0.037" /><testcase classname="tests.test_decorators" name="black" time="0.205" /><testcase classname="tests.test_decorators" name="test_require_api_auth_oauthlib_urldecode_issue" time="0.543" /><testcase classname="tests.test_decorators" name="test_require_api_auth_test1" time="0.513" /><testcase classname="tests.test_decorators" name="test_require_api_auth_test2" time="0.512" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_test1" time="0.513" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_test2" time="0.534" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_allow_anonymous" time="0.514" /><testcase classname="tests.test_decorators" name="test_rest_extension" time="0.515" /><testcase classname="tests.test_decorators" name="test_access_login_required" time="0.570" /><testcase classname="tests.test_decorators" name="test_jwt_client" time="0.666" /><testcase classname="tests.test_invenio_oauth2server" name="ISORT" time="0.021" /><testcase classname="tests.test_invenio_oauth2server" name="black" time="0.169" /><testcase classname="tests.test_invenio_oauth2server" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_oauth2server" name="test_init" time="0.348" /><testcase classname="tests.test_invenio_oauth2server" name="test_init_rest" time="0.004" /><testcase classname="tests.test_invenio_oauth2server" name="test_init_rest_with_oauthlib_monkeypatch" time="0.002" /><testcase classname="tests.test_models" name="ISORT" time="0.053" /><testcase classname="tests.test_models" name="black" time="0.220" /><testcase classname="tests.test_models" name="test_empty_redirect_uri_and_scope" time="0.520" /><testcase classname="tests.test_models" name="test_token_scopes" time="0.534" /><testcase classname="tests.test_models" name="test_registering_invalid_scope" time="0.513" /><testcase classname="tests.test_models" name="test_deletion_of_consumer_resource_owner" time="0.552" /><testcase classname="tests.test_models" name="test_deletion_of_resource_owner_consumer" time="0.534" /><testcase classname="tests.test_models" name="test_deletion_of_client1" time="0.540" /><testcase classname="tests.test_models" name="test_deletion_of_token1" time="0.519" /><testcase classname="tests.test_models" name="test_deletion_of_token2" time="0.520" /><testcase classname="tests.test_provider" name="ISORT" time="0.152" /><testcase classname="tests.test_provider" name="black" time="0.372" /><testcase classname="tests.test_provider" name="test_client_salt" time="0.537" /><testcase classname="tests.test_provider" name="test_invalid_authorize_requests" time="0.762" /><testcase classname="tests.test_provider" name="test_refresh_flow" time="0.622"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_refresh_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            base_url = "https://{0}".format(app.config["SERVER_NAME"])
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                data = dict(
                    redirect_uri=redirect_uri,
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
base_url   = 'https://None'
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': '4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'expires_in': 3600,
 'refresh_token': 'nZgLxhKt4MlKDf5oQ8jhrzxgSWwx9n',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = '4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
redirect_uri = 'http://localhost/oauth2test/authorized'
refresh_token = 'nZgLxhKt4MlKDf5oQ8jhrzxgSWwx9n'
res_data   = {'code': ['af5LB2HlS6ZwOKNbfJcj50nSigNlc4'], 'state': ['mystate']}

tests/test_provider.py:223: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd17d92d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd17d92d300&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7fd181e37d40&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd17d92d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd17d92d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'RAW_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181502f40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d752200&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd17d92d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (HEAD, GET, OPTIONS) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7fd183b10360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
        uri        = 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7fd187ade160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=934ba44faa5f7264_691c693c.FiBefmkH8dAfwZHh1lnm8eusXAw',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        uri        = 'http://localhost/oauth/info?access_token=4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        token      = '4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
token = '4xDGDDlJIsNv0stqk2PQSCdnOHTAd7', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
tok        = &lt;Token 3&gt;
token      = '4xDGDDlJIsNv0stqk2PQSCdnOHTAd7'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_implicit_flow" time="0.635"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_implicit_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                for client_id in ["dev", "confidential"]:
                    data = dict(
                        redirect_uri=redirect_uri,
                        response_type="token",  # For implicit grant type
                        client_id=client_id,
                        scope="test:scope",
                        state="teststate",
                    )
    
                    # Authorize page
                    r = client.get(
                        url_for("invenio_oauth2server.authorize", **data),
                        follow_redirects=True,
                    )
                    assert r.status_code == 200
    
                    # User confirms request
                    data["confirm"] = "yes"
                    data["scope"] = "test:scope"
                    data["state"] = "teststate"
    
                    r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                    assert r.status_code == 302
                    # Important - access token exists in URI fragment and must not
                    # be sent to the client.
                    next_url, data = parse_redirect(r.location, parse_fragment=True)
    
                    assert data["access_token"]
                    assert data["token_type"] == ["Bearer"]
                    assert data["state"] == ["teststate"]
                    assert data["scope"] == ["test:scope"]
                    assert data.get("refresh_token") is None
                    assert next_url == redirect_uri
    
                    # Authentication flow has now been completed, and the client
                    # can use the access token to make request to the provider.
&gt;                   r = client.get(
                        url_for(
                            "invenio_oauth2server.info", access_token=data["access_token"]
                        )
                    )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
client_id  = 'dev'
data       = {'access_token': ['8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'],
 'expires_in': ['3600'],
 'scope': ['test:scope'],
 'state': ['teststate'],
 'token_type': ['Bearer'],
 'user': ["{'id': '1'}"]}
next_url   = 'http://localhost/oauth2test/authorized'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse streamed [302 FOUND]&gt;
redirect_uri = 'http://localhost/oauth2test/authorized'

tests/test_provider.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181cf3880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181cf3880&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7fd181af3ad0&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181cf3880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181cf3880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'RAW_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd1815cd5c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd181cd8630&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181cf3880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (HEAD, GET, OPTIONS) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7fd183b10360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
        uri        = 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7fd187ade160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=e5205f25514d9710_691c693d.LEfpiKPME7wHf_lMkiNkYsGwmsM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        uri        = 'http://localhost/oauth/info?access_token=8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        token      = '8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
token = '8QpfQm5t0XtuiRwyYSGcJCMFtASLAS', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
tok        = &lt;Token 3&gt;
token      = '8QpfQm5t0XtuiRwyYSGcJCMFtASLAS'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_client_flow" time="0.539"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_client_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data["user"]["id"]
                assert data.get("refresh_token") is None
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'access_token': 'iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 138 bytes [200 OK]&gt;

tests/test_provider.py:433: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd18159c5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd18159c5e0&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7fd182b1d190&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd18159c5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd18159c5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'RAW_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181af74c0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd18158e480&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd18159c5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (HEAD, GET, OPTIONS) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7fd183b10360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
        uri        = 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7fd187ade160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=3e0f906b9f267a33_691c693e.mB1QKWeZJY3UgpWk3bO__hItCMM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        uri        = 'http://localhost/oauth/info?access_token=iOkhNmaIDbsb7iofDJiaN2wc94xo9D'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        token      = 'iOkhNmaIDbsb7iofDJiaN2wc94xo9D'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
token = 'iOkhNmaIDbsb7iofDJiaN2wc94xo9D', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
tok        = &lt;Token 3&gt;
token      = 'iOkhNmaIDbsb7iofDJiaN2wc94xo9D'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_auth_flow_denied" time="0.585" /><testcase classname="tests.test_provider" name="test_personal_access_token" time="0.530" /><testcase classname="tests.test_provider" name="test_resource_auth_methods" time="0.529" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=RegularArg-True]" time="0.466" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[a=1&amp;b=2&amp;c=3-True]" time="0.469" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=text+with+spaces-True]" time="0.578" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=title:TheTitle-True]" time="0.471" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=properly%20encoded%24-True]" time="0.474" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[$type=search-False]" time="0.490" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=Joan+D'Arc-False]" time="0.478" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[with regular spaces-False]" time="0.478" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[json_data={a: 42}-False]" time="0.477" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[array=[1, 2, 3]-False]" time="0.479" /><testcase classname="tests.test_provider" name="test_oauthlib_monkeypatch" time="0.479" /><testcase classname="tests.test_provider" name="test_settings_index" time="0.688" /><testcase classname="tests.test_provider" name="test_info_not_accessible_in_production" time="0.546"><failure message="assert 500 == 404&#10; +  where 500 = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;.status_code">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_info_not_accessible_in_production(provider_fixture):
        """Info route should not be available in production mode."""
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                app.config.update(
                    DEBUG=False,
                    TESTING=False,
                )
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data.get("refresh_token") is None
                assert data["user"]["id"]
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
                r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )
&gt;               assert r.status_code == 404
E               assert 500 == 404
E                +  where 500 = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;.status_code

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'access_token': 'UT2ppwrzMMu1PvkmRgt1dxf23l0N9u',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;

tests/test_provider.py:739: AssertionError</failure></testcase><testcase classname="tests.test_provider" name="test_expired_refresh_flow" time="0.624"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_expired_refresh_flow(provider_fixture):
        """Test refresh flow with an expired token."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                assert json.loads(r.get_data())["access_token"]
                assert json.loads(r.get_data())["refresh_token"]
                assert json.loads(r.get_data())["expires_in"] &gt; 0
                assert json.loads(r.get_data())["scope"] == "test:scope"
                assert json.loads(r.get_data())["token_type"] == "Bearer"
                assert json.loads(r.get_data())["user"]["id"]
                refresh_token = json.loads(r.get_data())["refresh_token"]
                old_access_token = json.loads(r.get_data())["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'XRog8f2p9umiM9CPby8mVnQnb5oHWV'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
refresh_token = '5WBuFXlApt8JtKtvWDwZTTyNmg7TOF'
res_data   = {'code': ['2Kh2VOY4fA3EbkoYUrOlssZyMAPTD7'], 'state': ['mystate']}

tests/test_provider.py:793: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181a92020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181a92020&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7fd17da96a80&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181a92020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181a92020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'RAW_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd181d49480&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd17d5e7920&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181a92020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (HEAD, GET, OPTIONS) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7fd183b10360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
        uri        = 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7fd187ade160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=5f3a1869009f5008_691c6947.LTieGG4Pw0D5916OVKMPsEKBYCs',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        uri        = 'http://localhost/oauth/info?access_token=XRog8f2p9umiM9CPby8mVnQnb5oHWV'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        token      = 'XRog8f2p9umiM9CPby8mVnQnb5oHWV'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
token = 'XRog8f2p9umiM9CPby8mVnQnb5oHWV', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
tok        = &lt;Token 3&gt;
token      = 'XRog8f2p9umiM9CPby8mVnQnb5oHWV'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_not_allowed_public_refresh_flow" time="0.767"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_not_allowed_public_refresh_flow(provider_fixture):
        """Public token should not allow refreshing."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="dev",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="dev",
                        client_secret="dev",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["expires_in"] &gt; 0
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'dev',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': 'k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'expires_in': 3600,
 'refresh_token': '1hEPmApaAkBFLGSPXR44mlQveWJ3ZE',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
refresh_token = '1hEPmApaAkBFLGSPXR44mlQveWJ3ZE'
res_data   = {'code': ['OeX2vyl7QMtejk4lgRH7M4lYt1Zpj3'], 'state': ['mystate']}

tests/test_provider.py:897: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181c28400&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181c28400&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7fd17d3e76e0&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181c28400&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181c28400&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'RAW_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7fd187228e00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7fd182584e00&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7fd181c28400&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (HEAD, GET, OPTIONS) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7fd183b10360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7fd1843db350&gt;
        uri        = 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7fd187ade160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=71db44c0e80e303d_691c6948.ylBPidJLpjV0bLHTu7YsPwA6_fc',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7fd181d0a120&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        uri        = 'http://localhost/oauth/info?access_token=k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7fd181fe9d40&gt;
        token      = 'k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
token = 'k1Pgsqy9BljeAVI8ONoQopWYLa1VkW', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7fd181d9e630&gt;
tok        = &lt;Token 3&gt;
token      = 'k1Pgsqy9BljeAVI8ONoQopWYLa1VkW'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_password_grant_type" time="0.557" /><testcase classname="tests.test_provider" name="test_email_scope" time="0.542" /><testcase classname="tests.test_server" name="ISORT" time="0.009" /><testcase classname="tests.test_server" name="black" time="0.163" /><testcase classname="tests.test_server" name="test_user_identity_init" time="0.541" /><testcase classname="tests.test_settings" name="ISORT" time="0.039" /><testcase classname="tests.test_settings" name="black" time="0.206" /><testcase classname="tests.test_settings" name="test_personal_token_management" time="0.656" /><testcase classname="tests.test_settings" name="test_authorized_app_revocation" time="0.636" /><testcase classname="tests.test_settings" name="test_client_management" time="0.689" /><testcase classname="tests.test_utils" name="ISORT" time="0.014" /><testcase classname="tests.test_utils" name="black" time="0.165" /><testcase classname="tests.test_utils" name="test_rebuilding_access_tokens" time="0.546" /><testcase classname="tests.test_validators" name="ISORT" time="0.016" /><testcase classname="tests.test_validators" name="black" time="0.170" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[example.org/-expected0]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[http://-expected1]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[http://example.org/-expected2]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://example.org/-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://localhost/-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://127.0.0.1-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_url_validator" time="0.586" /><testcase classname="invenio_oauth2server.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_oauth2server.__init__" name="ISORT" time="0.015" /><testcase classname="invenio_oauth2server.__init__" name="black" time="0.164" /><testcase classname="invenio_oauth2server.admin" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_oauth2server.admin" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.admin" name="black" time="0.168" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="ISORT" time="0.022" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="black" time="0.180" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="ISORT" time="0.024" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="black" time="0.177" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="ISORT" time="0.006" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="black" time="0.159" /><testcase classname="invenio_oauth2server.cli" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_oauth2server.cli" name="ISORT" time="0.023" /><testcase classname="invenio_oauth2server.cli" name="black" time="0.179" /><testcase classname="invenio_oauth2server.config" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.config" name="ISORT" time="0.012" /><testcase classname="invenio_oauth2server.config" name="black" time="0.164" /><testcase classname="invenio_oauth2server.decorators" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_oauth2server.decorators" name="ISORT" time="0.016" /><testcase classname="invenio_oauth2server.decorators" name="black" time="0.170" /><testcase classname="invenio_oauth2server.errors" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_oauth2server.errors" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.errors" name="black" time="0.172" /><testcase classname="invenio_oauth2server.ext" name="PYDOCSTYLE" time="0.029" /><testcase classname="invenio_oauth2server.ext" name="ISORT" time="0.058" /><testcase classname="invenio_oauth2server.ext" name="black" time="0.211" /><testcase classname="invenio_oauth2server.forms" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_oauth2server.forms" name="ISORT" time="0.038" /><testcase classname="invenio_oauth2server.forms" name="black" time="0.191" /><testcase classname="invenio_oauth2server.models" name="PYDOCSTYLE" time="0.033" /><testcase classname="invenio_oauth2server.models" name="ISORT" time="0.071" /><testcase classname="invenio_oauth2server.models" name="black" time="0.230" /><testcase classname="invenio_oauth2server.provider" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_oauth2server.provider" name="ISORT" time="0.031" /><testcase classname="invenio_oauth2server.provider" name="black" time="0.187" /><testcase classname="invenio_oauth2server.proxies" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_oauth2server.proxies" name="ISORT" time="0.008" /><testcase classname="invenio_oauth2server.proxies" name="black" time="0.159" /><testcase classname="invenio_oauth2server.scopes" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_oauth2server.scopes" name="ISORT" time="0.008" /><testcase classname="invenio_oauth2server.scopes" name="black" time="0.160" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="ISORT" time="0.012" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="black" time="0.166" /><testcase classname="invenio_oauth2server.utils" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_oauth2server.utils" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.utils" name="black" time="0.168" /><testcase classname="invenio_oauth2server.validators" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_oauth2server.validators" name="ISORT" time="0.015" /><testcase classname="invenio_oauth2server.validators" name="black" time="0.168" /><testcase classname="invenio_oauth2server.views.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.views.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_oauth2server.views.__init__" name="black" time="0.159" /><testcase classname="invenio_oauth2server.views.server" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_oauth2server.views.server" name="ISORT" time="0.029" /><testcase classname="invenio_oauth2server.views.server" name="black" time="0.185" /><testcase classname="invenio_oauth2server.views.settings" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_oauth2server.views.settings" name="ISORT" time="0.045" /><testcase classname="invenio_oauth2server.views.settings" name="black" time="0.209" /></testsuite></testsuites>