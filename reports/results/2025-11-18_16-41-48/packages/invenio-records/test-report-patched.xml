<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="1" skipped="1" tests="232" time="22.607" timestamp="2025-11-18T15:55:29.001270+00:00" hostname="runnervmg1sw1"><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.014" /><testcase classname="tests.conftest" name="ISORT" time="0.138" /><testcase classname="tests.conftest" name="black" time="0.344" /><testcase classname="tests.demo.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.demo.__init__" name="ISORT" time="0.004" /><testcase classname="tests.demo.__init__" name="black" time="0.159" /><testcase classname="tests.demo.json_resolver" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.demo.json_resolver" name="ISORT" time="0.009" /><testcase classname="tests.demo.json_resolver" name="black" time="0.171" /><testcase classname="tests.test_alembic" name="ISORT" time="0.010" /><testcase classname="tests.test_alembic" name="black" time="0.162" /><testcase classname="tests.test_alembic" name="test_alembic" time="0.000"><skipped type="pytest.skip" message="Caused by mergepoint">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_alembic.py:15: Caused by mergepoint</skipped></testcase><testcase classname="tests.test_api" name="ISORT" time="0.086" /><testcase classname="tests.test_api" name="black" time="0.262" /><testcase classname="tests.test_api" name="test_get_records" time="3.271" /><testcase classname="tests.test_api" name="test_revision_id_created_updated_properties" time="0.016" /><testcase classname="tests.test_api" name="test_delete" time="0.055" /><testcase classname="tests.test_api" name="test_revisions" time="0.060" /><testcase classname="tests.test_api" name="test_retrieve_proper_revision" time="0.048" /><testcase classname="tests.test_api" name="test_record_update_mutable" time="0.028" /><testcase classname="tests.test_api" name="test_missing_model" time="0.009" /><testcase classname="tests.test_api" name="test_record_replace_refs" time="0.014" /><testcase classname="tests.test_api" name="test_replace_refs_deepcopy" time="0.001" /><testcase classname="tests.test_api" name="test_record_dump" time="0.009" /><testcase classname="tests.test_api" name="test_default_format_checker" time="0.004" /><testcase classname="tests.test_api" name="test_validate_with_format" time="0.031" /><testcase classname="tests.test_api" name="test_validate_partial" time="0.023" /><testcase classname="tests.test_api" name="test_reversed_works_for_revisions" time="0.031" /><testcase classname="tests.test_api" name="test_clear_none" time="0.002" /><testcase classname="tests.test_api" name="test_undelete_no_get" time="0.024" /><testcase classname="tests.test_api" name="test_undelete_with_get" time="0.049" /><testcase classname="tests.test_api_dumpers" name="ISORT" time="0.155" /><testcase classname="tests.test_api_dumpers" name="black" time="0.213" /><testcase classname="tests.test_api_dumpers" name="test_esdumper_without_model" time="0.167" /><testcase classname="tests.test_api_dumpers" name="test_esdumper_with_model" time="0.035" /><testcase classname="tests.test_api_dumpers" name="test_esdumper_with_extensions" time="0.011" /><testcase classname="tests.test_api_dumpers" name="test_esdumper_sa_datatypes" time="0.006" /><testcase classname="tests.test_api_dumpers" name="test_relations_dumper" time="0.036" /><testcase classname="tests.test_api_dumpers" name="test_indexedtime_dumper" time="0.034" /><testcase classname="tests.test_custom_db" name="ISORT" time="0.019" /><testcase classname="tests.test_custom_db" name="black" time="0.168" /><testcase classname="tests.test_custom_db" name="test_class_model" time="0.218" /><testcase classname="tests.test_dictutils" name="ISORT" time="0.021" /><testcase classname="tests.test_dictutils" name="black" time="0.188" /><testcase classname="tests.test_dictutils" name="test_clear_none" time="0.001" /><testcase classname="tests.test_dictutils" name="test_dict_lookup" time="0.001" /><testcase classname="tests.test_dictutils" name="test_dict_merge" time="0.001" /><testcase classname="tests.test_dictutils" name="test_filter_dict_keys" time="0.001" /><testcase classname="tests.test_encoder" name="ISORT" time="0.031" /><testcase classname="tests.test_encoder" name="black" time="0.191" /><testcase classname="tests.test_encoder" name="test_noencoding" time="0.185" /><testcase classname="tests.test_encoder" name="test_encoding" time="0.014" /><testcase classname="tests.test_encoder" name="test_encoding_with_versioning" time="0.033" /><testcase classname="tests.test_encoder" name="test_encoding_with_schema" time="0.025" /><testcase classname="tests.test_encoder" name="test_encoding_with_schema_fail" time="0.042" /><testcase classname="tests.test_field_model" name="ISORT" time="0.022" /><testcase classname="tests.test_field_model" name="black" time="0.176" /><testcase classname="tests.test_field_model" name="test_model_field" time="0.237" /><testcase classname="tests.test_invenio_records" name="ISORT" time="0.034" /><testcase classname="tests.test_invenio_records" name="black" time="0.188" /><testcase classname="tests.test_invenio_records" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_records" name="test_init" time="0.029" /><testcase classname="tests.test_invenio_records" name="test_db" time="0.238"><failure message="sqlalchemy.exc.ResourceClosedError: This transaction is closed">testapp = &lt;Flask 'conftest'&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    def test_db(testapp, db):
        """Test database backend."""
        with testapp.app_context():
            assert "records_metadata" in db.metadata.tables
            assert "records_metadata_version" in db.metadata.tables
            assert "transaction" in db.metadata.tables
    
        schema = {
            "type": "object",
            "properties": {
                "title": {"type": "string"},
                "field": {"type": "boolean"},
                "hello": {"type": "array"},
            },
            "required": ["title"],
        }
        data = {"title": "Test", "$schema": schema}
        from invenio_records.models import RecordMetadata as RM
    
        # Create a record
        with testapp.app_context():
            assert RM.query.count() == 0
    
            record_uuid = Record.create(data).id
            db.session.commit()
    
            assert RM.query.count() == 1
            db.session.commit()
    
        # Retrieve created record
        with testapp.app_context():
            record = Record.get_record(record_uuid)
            assert record.dumps() == data
            with pytest.raises(NoResultFound):
                Record.get_record(uuid.uuid4())
            record["field"] = True
            record = record.patch([{"op": "add", "path": "/hello", "value": ["world"]}])
            assert record["hello"] == ["world"]
            record.commit()
&gt;           db.session.commit()

tests/test_invenio_records.py:84: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:611: in commit
    self._nested_transaction.commit()
&lt;string&gt;:2: in commit
    ???
.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:101: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;sqlalchemy.orm.session.SessionTransaction object at 0x7f14c8429bd0&gt;
operation_name = 'commit', state = &lt;SessionTransactionState.CLOSED: 5&gt;

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -&gt; NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
                raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
            else:
                raise sa_exc.InvalidRequestError(
                    "This session is in 'inactive' state, due to the "
                    "SQL transaction being rolled back; no further SQL "
                    "can be emitted within this transaction."
                )
        elif state is SessionTransactionState.CLOSED:
&gt;           raise sa_exc.ResourceClosedError("This transaction is closed")
E           sqlalchemy.exc.ResourceClosedError: This transaction is closed

.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:986: ResourceClosedError</failure></testcase><testcase classname="tests.test_relations_field" name="ISORT" time="0.037" /><testcase classname="tests.test_relations_field" name="black" time="0.203" /><testcase classname="tests.test_relations_field" name="test_multirelations_field" time="0.306" /><testcase classname="tests.test_relations_modelfield" name="ISORT" time="0.029" /><testcase classname="tests.test_relations_modelfield" name="black" time="0.190" /><testcase classname="tests.test_relations_modelfield" name="test_model_relation" time="0.258" /><testcase classname="tests.test_relations_systemfield" name="ISORT" time="0.213" /><testcase classname="tests.test_relations_systemfield" name="black" time="0.514" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_relation" time="0.278" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_list_relation" time="0.091" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_list_relation_of_objects" time="0.094" /><testcase classname="tests.test_relations_systemfield" name="test_nested_relations_field" time="0.058" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_nested_list_of_objects_w_related_field" time="0.096" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_nested_list_of_objects_wo_related_field" time="0.098" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_relation_with_value_check" time="0.095" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_list_relation_with_value_check" time="0.103" /><testcase classname="tests.test_relations_systemfield" name="test_relations_field_pk_nested_list_of_obj_w_related_field_w_value_check" time="0.084" /><testcase classname="tests.test_relations_systemfield" name="test_nested_field_dereferencing" time="0.073" /><testcase classname="tests.test_resolver" name="ISORT" time="0.020" /><testcase classname="tests.test_resolver" name="black" time="0.182" /><testcase classname="tests.test_resolver" name="test_invenio_refresolver_with_local_store" time="0.224" /><testcase classname="tests.test_resolver" name="test_urljoin_with_custom_scheme[local://books.json-local://books.json#-local://books.json]" time="0.001" /><testcase classname="tests.test_resolver" name="test_urljoin_with_custom_scheme[local://books.json#-local://books.json-local://books.json]" time="0.001" /><testcase classname="tests.test_resolver" name="test_urljoin_with_custom_scheme[local://books.json#-#-local://books.json]" time="0.001" /><testcase classname="tests.test_resolver" name="test_urljoin_with_custom_scheme[local://books.json-local://books.json#/definitions/price-local://books.json#/definitions/price]" time="0.001" /><testcase classname="tests.test_resolver" name="test_urljoin_with_custom_scheme[local://books.json-#/definitions/price-local://books.json#/definitions/price]" time="0.032" /><testcase classname="tests.test_signals" name="ISORT" time="0.023" /><testcase classname="tests.test_signals" name="black" time="0.186" /><testcase classname="tests.test_signals" name="test_signals" time="0.239" /><testcase classname="tests.test_signals" name="test_signals_disabled" time="0.080" /><testcase classname="tests.test_systemfields" name="ISORT" time="0.068" /><testcase classname="tests.test_systemfields" name="black" time="0.241" /><testcase classname="tests.test_systemfields" name="test_constant_field" time="0.201" /><testcase classname="tests.test_systemfields" name="test_constant_field_deletion" time="0.026" /><testcase classname="tests.test_systemfields" name="test_field_overwriting" time="0.021" /><testcase classname="tests.test_systemfields" name="test_field_inheritance" time="0.020" /><testcase classname="tests.test_systemfields" name="test_field_class_access" time="0.002" /><testcase classname="tests.test_systemfields" name="test_attrname_injection" time="0.001" /><testcase classname="tests.test_systemfields" name="test_systemfields_mro" time="0.002" /><testcase classname="tests.test_systemfields" name="test_extension_pre_init" time="0.002" /><testcase classname="tests.test_systemfields" name="test_extension_post_create" time="0.012" /><testcase classname="tests.test_systemfields" name="test_extension_pre_dump" time="0.003" /><testcase classname="tests.test_systemfields" name="test_extension_post_load" time="0.003" /><testcase classname="tests.test_systemfields" name="test_extension_commit" time="0.020" /><testcase classname="tests.test_systemfields" name="test_extension_delete" time="0.019" /><testcase classname="tests.test_systemfields" name="test_extension_revert" time="0.038" /><testcase classname="tests.test_systemfields" name="test_base_systemfield_base" time="0.001" /><testcase classname="tests.test_systemfields" name="test_systemfield_initialization" time="0.009" /><testcase classname="tests.test_systemfields" name="test_default_key" time="0.001" /><testcase classname="tests.test_systemfields" name="test_dict_field_simple" time="0.001" /><testcase classname="tests.test_systemfields" name="test_dictfield_default_key" time="0.001" /><testcase classname="tests.test_systemfields" name="test_dict_field_complex_key" time="0.002" /><testcase classname="tests.test_systemfields" name="test_dict_field_create_if_missing" time="0.001" /><testcase classname="tests.test_systemfields" name="test_dict_field_clear_none" time="0.001" /><testcase classname="tests.test_systemfields" name="test_dict_field_deleted" time="0.053" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="ISORT" time="0.034" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="black" time="0.196" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_field" time="0.001" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_setting_related_obj" time="0.195" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_change_key" time="0.002" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_custom_dump_load" time="0.002" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_serialize_on_commit" time="0.021" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_required" time="0.029" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_field_context" time="0.001" /><testcase classname="tests.test_systemfields_relatedmodelfield" name="test_ctx_session_merge" time="0.032" /><testcase classname="invenio_records.__init__" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_records.__init__" name="ISORT" time="0.032" /><testcase classname="invenio_records.__init__" name="black" time="0.167" /><testcase classname="invenio_records.__init__" name="invenio_records" time="0.357" /><testcase classname="invenio_records.admin" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_records.admin" name="ISORT" time="0.023" /><testcase classname="invenio_records.admin" name="black" time="0.176" /><testcase classname="invenio_records.alembic.07fb52561c5c_alter_column_from_json_to_jsonb" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_records.alembic.07fb52561c5c_alter_column_from_json_to_jsonb" name="ISORT" time="0.012" /><testcase classname="invenio_records.alembic.07fb52561c5c_alter_column_from_json_to_jsonb" name="black" time="0.164" /><testcase classname="invenio_records.alembic.1095cdf9f350_create_records_branch" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_records.alembic.1095cdf9f350_create_records_branch" name="ISORT" time="0.009" /><testcase classname="invenio_records.alembic.1095cdf9f350_create_records_branch" name="black" time="0.161" /><testcase classname="invenio_records.alembic.428b919be0ea_alter_column_from_json_to_jsonb_for_version" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_records.alembic.428b919be0ea_alter_column_from_json_to_jsonb_for_version" name="ISORT" time="0.011" /><testcase classname="invenio_records.alembic.428b919be0ea_alter_column_from_json_to_jsonb_for_version" name="black" time="0.163" /><testcase classname="invenio_records.alembic.862037093962_create_records_tables" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_records.alembic.862037093962_create_records_tables" name="ISORT" time="0.022" /><testcase classname="invenio_records.alembic.862037093962_create_records_tables" name="black" time="0.180" /><testcase classname="invenio_records.api" name="PYDOCSTYLE" time="0.044" /><testcase classname="invenio_records.api" name="ISORT" time="0.087" /><testcase classname="invenio_records.api" name="black" time="0.252" /><testcase classname="invenio_records.api" name="invenio_records.api.RecordBase.validate" time="0.010" /><testcase classname="invenio_records.config" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_records.config" name="ISORT" time="0.006" /><testcase classname="invenio_records.config" name="black" time="0.160" /><testcase classname="invenio_records.dictutils" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_records.dictutils" name="ISORT" time="0.025" /><testcase classname="invenio_records.dictutils" name="black" time="0.191" /><testcase classname="invenio_records.dumpers.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_records.dumpers.__init__" name="ISORT" time="0.010" /><testcase classname="invenio_records.dumpers.__init__" name="black" time="0.160" /><testcase classname="invenio_records.dumpers.base" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_records.dumpers.base" name="ISORT" time="0.009" /><testcase classname="invenio_records.dumpers.base" name="black" time="0.166" /><testcase classname="invenio_records.dumpers.indexedat" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_records.dumpers.indexedat" name="ISORT" time="0.009" /><testcase classname="invenio_records.dumpers.indexedat" name="black" time="0.160" /><testcase classname="invenio_records.dumpers.relations" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_records.dumpers.relations" name="ISORT" time="0.009" /><testcase classname="invenio_records.dumpers.relations" name="black" time="0.161" /><testcase classname="invenio_records.dumpers.search" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_records.dumpers.search" name="ISORT" time="0.043" /><testcase classname="invenio_records.dumpers.search" name="black" time="0.199" /><testcase classname="invenio_records.errors" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_records.errors" name="ISORT" time="0.006" /><testcase classname="invenio_records.errors" name="black" time="0.158" /><testcase classname="invenio_records.ext" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_records.ext" name="ISORT" time="0.026" /><testcase classname="invenio_records.ext" name="black" time="0.180" /><testcase classname="invenio_records.extensions" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_records.extensions" name="ISORT" time="0.013" /><testcase classname="invenio_records.extensions" name="black" time="0.169" /><testcase classname="invenio_records.models" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_records.models" name="ISORT" time="0.030" /><testcase classname="invenio_records.models" name="black" time="0.184" /><testcase classname="invenio_records.resolver" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_records.resolver" name="ISORT" time="0.011" /><testcase classname="invenio_records.resolver" name="black" time="0.165" /><testcase classname="invenio_records.signals" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_records.signals" name="ISORT" time="0.015" /><testcase classname="invenio_records.signals" name="black" time="0.166" /><testcase classname="invenio_records.systemfields.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_records.systemfields.__init__" name="ISORT" time="0.014" /><testcase classname="invenio_records.systemfields.__init__" name="black" time="0.164" /><testcase classname="invenio_records.systemfields.base" name="PYDOCSTYLE" time="0.035" /><testcase classname="invenio_records.systemfields.base" name="ISORT" time="0.054" /><testcase classname="invenio_records.systemfields.base" name="black" time="0.222" /><testcase classname="invenio_records.systemfields.constant" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_records.systemfields.constant" name="ISORT" time="0.010" /><testcase classname="invenio_records.systemfields.constant" name="black" time="0.165" /><testcase classname="invenio_records.systemfields.dict" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_records.systemfields.dict" name="ISORT" time="0.009" /><testcase classname="invenio_records.systemfields.dict" name="black" time="0.161" /><testcase classname="invenio_records.systemfields.model" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_records.systemfields.model" name="ISORT" time="0.015" /><testcase classname="invenio_records.systemfields.model" name="black" time="0.172" /><testcase classname="invenio_records.systemfields.relatedmodelfield" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_records.systemfields.relatedmodelfield" name="ISORT" time="0.022" /><testcase classname="invenio_records.systemfields.relatedmodelfield" name="black" time="0.176" /><testcase classname="invenio_records.systemfields.relations.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_records.systemfields.relations.__init__" name="ISORT" time="0.011" /><testcase classname="invenio_records.systemfields.relations.__init__" name="black" time="0.162" /><testcase classname="invenio_records.systemfields.relations.errors" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_records.systemfields.relations.errors" name="ISORT" time="0.007" /><testcase classname="invenio_records.systemfields.relations.errors" name="black" time="0.157" /><testcase classname="invenio_records.systemfields.relations.field" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_records.systemfields.relations.field" name="ISORT" time="0.025" /><testcase classname="invenio_records.systemfields.relations.field" name="black" time="0.181" /><testcase classname="invenio_records.systemfields.relations.mapping" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_records.systemfields.relations.mapping" name="ISORT" time="0.012" /><testcase classname="invenio_records.systemfields.relations.mapping" name="black" time="0.171" /><testcase classname="invenio_records.systemfields.relations.modelrelations" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_records.systemfields.relations.modelrelations" name="ISORT" time="0.019" /><testcase classname="invenio_records.systemfields.relations.modelrelations" name="black" time="0.174" /><testcase classname="invenio_records.systemfields.relations.relations" name="PYDOCSTYLE" time="0.031" /><testcase classname="invenio_records.systemfields.relations.relations" name="ISORT" time="0.051" /><testcase classname="invenio_records.systemfields.relations.relations" name="black" time="0.229" /><testcase classname="invenio_records.systemfields.relations.results" name="PYDOCSTYLE" time="0.029" /><testcase classname="invenio_records.systemfields.relations.results" name="ISORT" time="0.046" /><testcase classname="invenio_records.systemfields.relations.results" name="black" time="0.219" /><testcase classname="invenio_records.validators" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_records.validators" name="ISORT" time="0.012" /><testcase classname="invenio_records.validators" name="black" time="0.164" /></testsuite></testsuites>