<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="12" failures="31" skipped="1" tests="714" time="206.961" timestamp="2025-11-18T15:55:36.452206+00:00" hostname="runnervmg1sw1"><testcase classname="invenio_communities.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.__init__" name="ISORT" time="0.012" /><testcase classname="invenio_communities.__init__" name="black" time="0.284" /><testcase classname="invenio_communities.administration.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.administration.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.administration.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.administration.communities" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_communities.administration.communities" name="ISORT" time="0.129" /><testcase classname="invenio_communities.administration.communities" name="black" time="0.180" /><testcase classname="invenio_communities.alembic.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.alembic.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.alembic.__init__" name="black" time="0.157" /><testcase classname="invenio_communities.alembic.02cd82910727_update_role_id_type_upgrade" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.alembic.02cd82910727_update_role_id_type_upgrade" name="ISORT" time="0.015" /><testcase classname="invenio_communities.alembic.02cd82910727_update_role_id_type_upgrade" name="black" time="0.166" /><testcase classname="invenio_communities.alembic.37b21951084c_update_role_id_type_downgrade" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.alembic.37b21951084c_update_role_id_type_downgrade" name="ISORT" time="0.014" /><testcase classname="invenio_communities.alembic.37b21951084c_update_role_id_type_downgrade" name="black" time="0.166" /><testcase classname="invenio_communities.alembic.5b478fe7ef7f_create_featured_communities_table" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.alembic.5b478fe7ef7f_create_featured_communities_table" name="ISORT" time="0.015" /><testcase classname="invenio_communities.alembic.5b478fe7ef7f_create_featured_communities_table" name="black" time="0.171" /><testcase classname="invenio_communities.alembic.5c68d45c80f0_add_deletion_status_to_communities" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.alembic.5c68d45c80f0_add_deletion_status_to_communities" name="ISORT" time="0.020" /><testcase classname="invenio_communities.alembic.5c68d45c80f0_add_deletion_status_to_communities" name="black" time="0.168" /><testcase classname="invenio_communities.alembic.72b37bb4119c_create_indeces_for_bucket_id" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.alembic.72b37bb4119c_create_indeces_for_bucket_id" name="ISORT" time="0.011" /><testcase classname="invenio_communities.alembic.72b37bb4119c_create_indeces_for_bucket_id" name="black" time="0.164" /><testcase classname="invenio_communities.alembic.90642d415317_create_communities_branch" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.alembic.90642d415317_create_communities_branch" name="ISORT" time="0.006" /><testcase classname="invenio_communities.alembic.90642d415317_create_communities_branch" name="black" time="0.161" /><testcase classname="invenio_communities.alembic.a3f5a8635cbb_remove_version_table" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_communities.alembic.a3f5a8635cbb_remove_version_table" name="ISORT" time="0.025" /><testcase classname="invenio_communities.alembic.a3f5a8635cbb_remove_version_table" name="black" time="0.180" /><testcase classname="invenio_communities.alembic.de9c14cbb0b2_create_communities_tables" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_communities.alembic.de9c14cbb0b2_create_communities_tables" name="ISORT" time="0.037" /><testcase classname="invenio_communities.alembic.de9c14cbb0b2_create_communities_tables" name="black" time="0.202" /><testcase classname="invenio_communities.alembic.f701a32e6fbe_create_communities_members_table" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_communities.alembic.f701a32e6fbe_create_communities_members_table" name="ISORT" time="0.019" /><testcase classname="invenio_communities.alembic.f701a32e6fbe_create_communities_members_table" name="black" time="0.173" /><testcase classname="invenio_communities.alembic.fbe746957cfc_create_member_tables" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_communities.alembic.fbe746957cfc_create_member_tables" name="ISORT" time="0.039" /><testcase classname="invenio_communities.alembic.fbe746957cfc_create_member_tables" name="black" time="0.201" /><testcase classname="invenio_communities.cache.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_communities.cache.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.cache.__init__" name="black" time="0.157" /><testcase classname="invenio_communities.cache.cache" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.cache.cache" name="ISORT" time="0.013" /><testcase classname="invenio_communities.cache.cache" name="black" time="0.162" /><testcase classname="invenio_communities.cache.redis" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_communities.cache.redis" name="ISORT" time="0.016" /><testcase classname="invenio_communities.cache.redis" name="black" time="0.170" /><testcase classname="invenio_communities.cli" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_communities.cli" name="ISORT" time="0.035" /><testcase classname="invenio_communities.cli" name="black" time="0.187" /><testcase classname="invenio_communities.communities.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_communities.communities.__init__" name="black" time="0.162" /><testcase classname="invenio_communities.communities.dumpers.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.dumpers.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.dumpers.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.communities.dumpers.featured" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.communities.dumpers.featured" name="ISORT" time="0.014" /><testcase classname="invenio_communities.communities.dumpers.featured" name="black" time="0.168" /><testcase classname="invenio_communities.communities.entity_resolvers" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_communities.communities.entity_resolvers" name="ISORT" time="0.021" /><testcase classname="invenio_communities.communities.entity_resolvers" name="black" time="0.179" /><testcase classname="invenio_communities.communities.records.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_communities.communities.records.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.communities.records.api" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_communities.communities.records.api" name="ISORT" time="0.038" /><testcase classname="invenio_communities.communities.records.api" name="black" time="0.184" /><testcase classname="invenio_communities.communities.records.jsonschemas.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.records.jsonschemas.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_communities.communities.records.jsonschemas.__init__" name="black" time="0.158" /><testcase classname="invenio_communities.communities.records.mappings.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.records.mappings.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.mappings.__init__" name="black" time="0.158" /><testcase classname="invenio_communities.communities.records.mappings.os-v1.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_communities.communities.records.mappings.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.mappings.os-v1.__init__" name="black" time="0.162" /><testcase classname="invenio_communities.communities.records.mappings.os-v2.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_communities.communities.records.mappings.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.mappings.os-v2.__init__" name="black" time="0.166" /><testcase classname="invenio_communities.communities.records.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.records.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.mappings.v7.__init__" name="black" time="0.157" /><testcase classname="invenio_communities.communities.records.models" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.communities.records.models" name="ISORT" time="0.018" /><testcase classname="invenio_communities.communities.records.models" name="black" time="0.172" /><testcase classname="invenio_communities.communities.records.systemfields.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.records.systemfields.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.communities.records.systemfields.__init__" name="black" time="0.160" /><testcase classname="invenio_communities.communities.records.systemfields.access" name="PYDOCSTYLE" time="0.034" /><testcase classname="invenio_communities.communities.records.systemfields.access" name="ISORT" time="0.049" /><testcase classname="invenio_communities.communities.records.systemfields.access" name="black" time="0.210" /><testcase classname="invenio_communities.communities.records.systemfields.children" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_communities.communities.records.systemfields.children" name="ISORT" time="0.019" /><testcase classname="invenio_communities.communities.records.systemfields.children" name="black" time="0.179" /><testcase classname="invenio_communities.communities.records.systemfields.deletion_status" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_communities.communities.records.systemfields.deletion_status" name="ISORT" time="0.022" /><testcase classname="invenio_communities.communities.records.systemfields.deletion_status" name="black" time="0.179" /><testcase classname="invenio_communities.communities.records.systemfields.is_verified" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.communities.records.systemfields.is_verified" name="ISORT" time="0.012" /><testcase classname="invenio_communities.communities.records.systemfields.is_verified" name="black" time="0.172" /><testcase classname="invenio_communities.communities.records.systemfields.parent_community" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_communities.communities.records.systemfields.parent_community" name="ISORT" time="0.024" /><testcase classname="invenio_communities.communities.records.systemfields.parent_community" name="black" time="0.179" /><testcase classname="invenio_communities.communities.records.systemfields.pidslug" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_communities.communities.records.systemfields.pidslug" name="ISORT" time="0.020" /><testcase classname="invenio_communities.communities.records.systemfields.pidslug" name="black" time="0.176" /><testcase classname="invenio_communities.communities.records.systemfields.tombstone" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_communities.communities.records.systemfields.tombstone" name="ISORT" time="0.032" /><testcase classname="invenio_communities.communities.records.systemfields.tombstone" name="black" time="0.190" /><testcase classname="invenio_communities.communities.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.resources.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_communities.communities.resources.__init__" name="black" time="0.158" /><testcase classname="invenio_communities.communities.resources.args" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.resources.args" name="ISORT" time="0.009" /><testcase classname="invenio_communities.communities.resources.args" name="black" time="0.160" /><testcase classname="invenio_communities.communities.resources.config" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_communities.communities.resources.config" name="ISORT" time="0.028" /><testcase classname="invenio_communities.communities.resources.config" name="black" time="0.176" /><testcase classname="invenio_communities.communities.resources.resource" name="PYDOCSTYLE" time="0.023" /><testcase classname="invenio_communities.communities.resources.resource" name="ISORT" time="0.044" /><testcase classname="invenio_communities.communities.resources.resource" name="black" time="0.208" /><testcase classname="invenio_communities.communities.resources.serializer" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.communities.resources.serializer" name="ISORT" time="0.010" /><testcase classname="invenio_communities.communities.resources.serializer" name="black" time="0.165" /><testcase classname="invenio_communities.communities.resources.ui_schema" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_communities.communities.resources.ui_schema" name="ISORT" time="0.037" /><testcase classname="invenio_communities.communities.resources.ui_schema" name="black" time="0.195" /><testcase classname="invenio_communities.communities.schema" name="PYDOCSTYLE" time="0.026" /><testcase classname="invenio_communities.communities.schema" name="ISORT" time="0.060" /><testcase classname="invenio_communities.communities.schema" name="black" time="0.216" /><testcase classname="invenio_communities.communities.services.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.communities.services.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_communities.communities.services.__init__" name="black" time="0.160" /><testcase classname="invenio_communities.communities.services.components" name="PYDOCSTYLE" time="0.038" /><testcase classname="invenio_communities.communities.services.components" name="ISORT" time="0.069" /><testcase classname="invenio_communities.communities.services.components" name="black" time="0.243" /><testcase classname="invenio_communities.communities.services.config" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.communities.services.config" name="ISORT" time="0.041" /><testcase classname="invenio_communities.communities.services.config" name="black" time="0.190" /><testcase classname="invenio_communities.communities.services.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.communities.services.facets" name="ISORT" time="0.014" /><testcase classname="invenio_communities.communities.services.facets" name="black" time="0.166" /><testcase classname="invenio_communities.communities.services.links" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_communities.communities.services.links" name="ISORT" time="0.016" /><testcase classname="invenio_communities.communities.services.links" name="black" time="0.178" /><testcase classname="invenio_communities.communities.services.results" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.communities.services.results" name="ISORT" time="0.022" /><testcase classname="invenio_communities.communities.services.results" name="black" time="0.183" /><testcase classname="invenio_communities.communities.services.search_params" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.communities.services.search_params" name="ISORT" time="0.012" /><testcase classname="invenio_communities.communities.services.search_params" name="black" time="0.171" /><testcase classname="invenio_communities.communities.services.service" name="PYDOCSTYLE" time="0.057" /><testcase classname="invenio_communities.communities.services.service" name="ISORT" time="0.127" /><testcase classname="invenio_communities.communities.services.service" name="black" time="0.313" /><testcase classname="invenio_communities.communities.services.sort" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.communities.services.sort" name="ISORT" time="0.010" /><testcase classname="invenio_communities.communities.services.sort" name="black" time="0.169" /><testcase classname="invenio_communities.communities.services.uow" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.communities.services.uow" name="ISORT" time="0.011" /><testcase classname="invenio_communities.communities.services.uow" name="black" time="0.166" /><testcase classname="invenio_communities.config" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_communities.config" name="ISORT" time="0.053" /><testcase classname="invenio_communities.config" name="black" time="0.207" /><testcase classname="invenio_communities.errors" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_communities.errors" name="ISORT" time="0.020" /><testcase classname="invenio_communities.errors" name="black" time="0.174" /><testcase classname="invenio_communities.ext" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_communities.ext" name="ISORT" time="0.042" /><testcase classname="invenio_communities.ext" name="black" time="0.200" /><testcase classname="invenio_communities.fixtures.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.fixtures.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.fixtures.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.fixtures.demo" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.fixtures.demo" name="ISORT" time="0.010" /><testcase classname="invenio_communities.fixtures.demo" name="black" time="0.171" /><testcase classname="invenio_communities.fixtures.tasks" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_communities.fixtures.tasks" name="ISORT" time="0.020" /><testcase classname="invenio_communities.fixtures.tasks" name="black" time="0.174" /><testcase classname="invenio_communities.generators" name="PYDOCSTYLE" time="0.042" /><testcase classname="invenio_communities.generators" name="ISORT" time="0.066" /><testcase classname="invenio_communities.generators" name="black" time="0.247" /><testcase classname="invenio_communities.members.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.__init__" name="ISORT" time="0.008" /><testcase classname="invenio_communities.members.__init__" name="black" time="0.162" /><testcase classname="invenio_communities.members.errors" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.members.errors" name="ISORT" time="0.006" /><testcase classname="invenio_communities.members.errors" name="black" time="0.161" /><testcase classname="invenio_communities.members.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.records.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_communities.members.records.__init__" name="black" time="0.162" /><testcase classname="invenio_communities.members.records.api" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_communities.members.records.api" name="ISORT" time="0.043" /><testcase classname="invenio_communities.members.records.api" name="black" time="0.196" /><testcase classname="invenio_communities.members.records.mappings.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.records.mappings.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.members.records.mappings.__init__" name="black" time="0.161" /><testcase classname="invenio_communities.members.records.mappings.os-v1.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.records.mappings.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.members.records.mappings.os-v1.__init__" name="black" time="0.162" /><testcase classname="invenio_communities.members.records.mappings.os-v2.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.records.mappings.os-v2.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_communities.members.records.mappings.os-v2.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.members.records.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.records.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.members.records.mappings.v7.__init__" name="black" time="0.159" /><testcase classname="invenio_communities.members.records.models" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_communities.members.records.models" name="ISORT" time="0.032" /><testcase classname="invenio_communities.members.records.models" name="black" time="0.187" /><testcase classname="invenio_communities.members.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.resources.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_communities.members.resources.__init__" name="black" time="0.158" /><testcase classname="invenio_communities.members.resources.config" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.members.resources.config" name="ISORT" time="0.017" /><testcase classname="invenio_communities.members.resources.config" name="black" time="0.168" /><testcase classname="invenio_communities.members.resources.resource" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_communities.members.resources.resource" name="ISORT" time="0.028" /><testcase classname="invenio_communities.members.resources.resource" name="black" time="0.186" /><testcase classname="invenio_communities.members.services.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.members.services.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_communities.members.services.__init__" name="black" time="0.161" /><testcase classname="invenio_communities.members.services.components" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_communities.members.services.components" name="ISORT" time="0.021" /><testcase classname="invenio_communities.members.services.components" name="black" time="0.180" /><testcase classname="invenio_communities.members.services.config" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.members.services.config" name="ISORT" time="0.042" /><testcase classname="invenio_communities.members.services.config" name="black" time="0.197" /><testcase classname="invenio_communities.members.services.facets" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.members.services.facets" name="ISORT" time="0.013" /><testcase classname="invenio_communities.members.services.facets" name="black" time="0.174" /><testcase classname="invenio_communities.members.services.fields" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.members.services.fields" name="ISORT" time="0.012" /><testcase classname="invenio_communities.members.services.fields" name="black" time="0.172" /><testcase classname="invenio_communities.members.services.request" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_communities.members.services.request" name="ISORT" time="0.030" /><testcase classname="invenio_communities.members.services.request" name="black" time="0.188" /><testcase classname="invenio_communities.members.services.schemas" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_communities.members.services.schemas" name="ISORT" time="0.038" /><testcase classname="invenio_communities.members.services.schemas" name="black" time="0.198" /><testcase classname="invenio_communities.members.services.service" name="PYDOCSTYLE" time="0.057" /><testcase classname="invenio_communities.members.services.service" name="ISORT" time="0.130" /><testcase classname="invenio_communities.members.services.service" name="black" time="0.319" /><testcase classname="invenio_communities.notifications.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.notifications.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.notifications.__init__" name="black" time="0.172" /><testcase classname="invenio_communities.notifications.builders" name="PYDOCSTYLE" time="0.023" /><testcase classname="invenio_communities.notifications.builders" name="ISORT" time="0.057" /><testcase classname="invenio_communities.notifications.builders" name="black" time="0.218" /><testcase classname="invenio_communities.notifications.generators" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.notifications.generators" name="ISORT" time="0.018" /><testcase classname="invenio_communities.notifications.generators" name="black" time="0.187" /><testcase classname="invenio_communities.permissions" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_communities.permissions" name="ISORT" time="0.036" /><testcase classname="invenio_communities.permissions" name="black" time="0.201" /><testcase classname="invenio_communities.proxies" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.proxies" name="ISORT" time="0.010" /><testcase classname="invenio_communities.proxies" name="black" time="0.169" /><testcase classname="invenio_communities.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.records.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.records.__init__" name="black" time="0.165" /><testcase classname="invenio_communities.records.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.records.records.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.records.records.__init__" name="black" time="0.166" /><testcase classname="invenio_communities.records.records.models" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.records.records.models" name="ISORT" time="0.015" /><testcase classname="invenio_communities.records.records.models" name="black" time="0.184" /><testcase classname="invenio_communities.records.records.systemfields.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.records.records.systemfields.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_communities.records.records.systemfields.__init__" name="black" time="0.173" /><testcase classname="invenio_communities.records.records.systemfields.communities.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.records.records.systemfields.communities.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_communities.records.records.systemfields.communities.__init__" name="black" time="0.169" /><testcase classname="invenio_communities.records.records.systemfields.communities.context" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.records.records.systemfields.communities.context" name="ISORT" time="0.008" /><testcase classname="invenio_communities.records.records.systemfields.communities.context" name="black" time="0.169" /><testcase classname="invenio_communities.records.records.systemfields.communities.field" name="PYDOCSTYLE" time="0.011" /><testcase classname="invenio_communities.records.records.systemfields.communities.field" name="ISORT" time="0.023" /><testcase classname="invenio_communities.records.records.systemfields.communities.field" name="black" time="0.187" /><testcase classname="invenio_communities.records.records.systemfields.communities.manager" name="PYDOCSTYLE" time="0.022" /><testcase classname="invenio_communities.records.records.systemfields.communities.manager" name="ISORT" time="0.035" /><testcase classname="invenio_communities.records.records.systemfields.communities.manager" name="black" time="0.206" /><testcase classname="invenio_communities.requests.user_moderation.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.requests.user_moderation.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_communities.requests.user_moderation.__init__" name="black" time="0.167" /><testcase classname="invenio_communities.requests.user_moderation.actions" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.requests.user_moderation.actions" name="ISORT" time="0.027" /><testcase classname="invenio_communities.requests.user_moderation.actions" name="black" time="0.187" /><testcase classname="invenio_communities.requests.user_moderation.tasks" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_communities.requests.user_moderation.tasks" name="ISORT" time="0.012" /><testcase classname="invenio_communities.requests.user_moderation.tasks" name="black" time="0.173" /><testcase classname="invenio_communities.roles" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.roles" name="ISORT" time="0.021" /><testcase classname="invenio_communities.roles" name="black" time="0.183" /><testcase classname="invenio_communities.searchapp" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.searchapp" name="ISORT" time="0.016" /><testcase classname="invenio_communities.searchapp" name="black" time="0.180" /><testcase classname="invenio_communities.subcommunities.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.subcommunities.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_communities.subcommunities.__init__" name="black" time="0.169" /><testcase classname="invenio_communities.subcommunities.resources.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.subcommunities.resources.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_communities.subcommunities.resources.__init__" name="black" time="0.167" /><testcase classname="invenio_communities.subcommunities.resources.config" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.subcommunities.resources.config" name="ISORT" time="0.018" /><testcase classname="invenio_communities.subcommunities.resources.config" name="black" time="0.173" /><testcase classname="invenio_communities.subcommunities.resources.resource" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.subcommunities.resources.resource" name="ISORT" time="0.014" /><testcase classname="invenio_communities.subcommunities.resources.resource" name="black" time="0.174" /><testcase classname="invenio_communities.subcommunities.services.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.subcommunities.services.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_communities.subcommunities.services.__init__" name="black" time="0.170" /><testcase classname="invenio_communities.subcommunities.services.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.subcommunities.services.config" name="ISORT" time="0.017" /><testcase classname="invenio_communities.subcommunities.services.config" name="black" time="0.175" /><testcase classname="invenio_communities.subcommunities.services.errors" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_communities.subcommunities.services.errors" name="ISORT" time="0.005" /><testcase classname="invenio_communities.subcommunities.services.errors" name="black" time="0.166" /><testcase classname="invenio_communities.subcommunities.services.request" name="PYDOCSTYLE" time="0.017" /><testcase classname="invenio_communities.subcommunities.services.request" name="ISORT" time="0.038" /><testcase classname="invenio_communities.subcommunities.services.request" name="black" time="0.198" /><testcase classname="invenio_communities.subcommunities.services.schema" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.subcommunities.services.schema" name="ISORT" time="0.013" /><testcase classname="invenio_communities.subcommunities.services.schema" name="black" time="0.168" /><testcase classname="invenio_communities.subcommunities.services.service" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_communities.subcommunities.services.service" name="ISORT" time="0.038" /><testcase classname="invenio_communities.subcommunities.services.service" name="black" time="0.196" /><testcase classname="invenio_communities.tasks" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.tasks" name="ISORT" time="0.008" /><testcase classname="invenio_communities.tasks" name="black" time="0.166" /><testcase classname="invenio_communities.utils" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_communities.utils" name="ISORT" time="0.024" /><testcase classname="invenio_communities.utils" name="black" time="0.184" /><testcase classname="invenio_communities.views.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_communities.views.__init__" name="ISORT" time="0.007" /><testcase classname="invenio_communities.views.__init__" name="black" time="0.163" /><testcase classname="invenio_communities.views.api" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_communities.views.api" name="ISORT" time="0.010" /><testcase classname="invenio_communities.views.api" name="black" time="0.171" /><testcase classname="invenio_communities.views.communities" name="PYDOCSTYLE" time="0.040" /><testcase classname="invenio_communities.views.communities" name="ISORT" time="0.092" /><testcase classname="invenio_communities.views.communities" name="black" time="0.264" /><testcase classname="invenio_communities.views.decorators" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_communities.views.decorators" name="ISORT" time="0.016" /><testcase classname="invenio_communities.views.decorators" name="black" time="0.171" /><testcase classname="invenio_communities.views.template_loader" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_communities.views.template_loader" name="ISORT" time="0.017" /><testcase classname="invenio_communities.views.template_loader" name="black" time="0.174" /><testcase classname="invenio_communities.views.ui" name="PYDOCSTYLE" time="0.019" /><testcase classname="invenio_communities.views.ui" name="ISORT" time="0.047" /><testcase classname="invenio_communities.views.ui" name="black" time="0.201" /><testcase classname="invenio_communities.webpack" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_communities.webpack" name="ISORT" time="0.019" /><testcase classname="invenio_communities.webpack" name="black" time="0.176" /><testcase classname="setup" name="PYDOCSTYLE" time="0.003" /><testcase classname="setup" name="ISORT" time="0.007" /><testcase classname="setup" name="black" time="0.160" /><testcase classname="tests.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.__init__" name="ISORT" time="0.004" /><testcase classname="tests.__init__" name="black" time="0.159" /><testcase classname="tests.cache.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.cache.__init__" name="ISORT" time="0.004" /><testcase classname="tests.cache.__init__" name="black" time="0.160" /><testcase classname="tests.cache.test_identity_redis_cache" name="ISORT" time="0.012" /><testcase classname="tests.cache.test_identity_redis_cache" name="black" time="0.167" /><testcase classname="tests.cache.test_identity_redis_cache" name="test_cache_deletion" time="4.213" /><testcase classname="tests.cache.test_identity_redis_cache" name="test_cache_flush" time="0.004" /><testcase classname="tests.cache.test_identity_redis_cache" name="test_default_prefix_for_redis" time="0.002" /><testcase classname="tests.cache.test_identity_redis_cache" name="test_timeout_config" time="3.520" /><testcase classname="tests.communities.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.communities.__init__" name="ISORT" time="0.004" /><testcase classname="tests.communities.__init__" name="black" time="0.157" /><testcase classname="tests.communities.conftest" name="PYDOCSTYLE" time="0.008" /><testcase classname="tests.communities.conftest" name="ISORT" time="0.020" /><testcase classname="tests.communities.conftest" name="black" time="0.177" /><testcase classname="tests.communities.test_alembic" name="ISORT" time="0.014" /><testcase classname="tests.communities.test_alembic" name="black" time="0.171" /><testcase classname="tests.communities.test_alembic" name="test_alembic" time="0.000"><skipped type="pytest.skip" message="Caused by mergepoint">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/communities/test_alembic.py:21: Caused by mergepoint</skipped></testcase><testcase classname="tests.communities.test_cli" name="ISORT" time="0.016" /><testcase classname="tests.communities.test_cli" name="black" time="0.175" /><testcase classname="tests.communities.test_cli" name="test_fake_demo_community_creation" time="5.829" /><testcase classname="tests.communities.test_cli" name="test_create_communities_custom_fields" time="2.403" /><testcase classname="tests.communities.test_community_ui_serializer" name="ISORT" time="0.017" /><testcase classname="tests.communities.test_community_ui_serializer" name="black" time="0.175" /><testcase classname="tests.communities.test_community_ui_serializer" name="test_ui_serializer" time="3.677" /><testcase classname="tests.communities.test_components" name="ISORT" time="0.042" /><testcase classname="tests.communities.test_components" name="black" time="0.210" /><testcase classname="tests.communities.test_components" name="test_oai_set_create_community" time="2.948" /><testcase classname="tests.communities.test_components" name="test_oai_set_delete_community" time="0.348" /><testcase classname="tests.communities.test_components" name="test_oai_set_renamed" time="0.572" /><testcase classname="tests.communities.test_components" name="test_oai_set_update" time="0.380" /><testcase classname="tests.communities.test_components" name="test_children_component" time="0.124" /><testcase classname="tests.communities.test_components" name="test_children_component_without_children" time="0.682" /><testcase classname="tests.communities.test_parent_community" name="ISORT" time="0.020" /><testcase classname="tests.communities.test_parent_community" name="black" time="0.181" /><testcase classname="tests.communities.test_parent_community" name="test_set_parent_community_with_comm_obj" time="3.039" /><testcase classname="tests.communities.test_parent_community" name="test_set_parent_community_with_comm_uuid" time="0.019" /><testcase classname="tests.communities.test_parent_community" name="test_set_parent_community_with_comm_uuid_string" time="0.019" /><testcase classname="tests.communities.test_parent_community" name="test_invalid_set_parent_community_with_comm_slug" time="0.003" /><testcase classname="tests.communities.test_parent_community" name="test_invalid_set_parent_community_with_random_object" time="0.002" /><testcase classname="tests.communities.test_parent_community" name="test_parent_community_dereferencing" time="0.485" /><testcase classname="tests.communities.test_permissions" name="ISORT" time="0.015" /><testcase classname="tests.communities.test_permissions" name="black" time="0.176" /><testcase classname="tests.communities.test_permissions" name="test_can_request_membership" time="3.499" /><testcase classname="tests.communities.test_relations_organizations" name="ISORT" time="0.028" /><testcase classname="tests.communities.test_relations_organizations" name="black" time="0.189" /><testcase classname="tests.communities.test_relations_organizations" name="test_organizations_field" time="2.523" /><testcase classname="tests.communities.test_relations_organizations" name="test_community_organizations_validation" time="0.295" /><testcase classname="tests.communities.test_relations_organizations" name="test_community_organizations_with_multiple_organizations" time="0.248" /><testcase classname="tests.communities.test_relations_organizations" name="test_community_organizations_with_name_cleanup_validation" time="0.190" /><testcase classname="tests.communities.test_relations_organizations" name="test_community_organizations_indexing" time="0.306" /><testcase classname="tests.communities.test_relations_organizations" name="test_community_organizations_invalid" time="0.672" /><testcase classname="tests.communities.test_relations_types" name="ISORT" time="0.016" /><testcase classname="tests.communities.test_relations_types" name="black" time="0.173" /><testcase classname="tests.communities.test_relations_types" name="test_valid_community_types[organization-organization]" time="2.737" /><testcase classname="tests.communities.test_relations_types" name="test_valid_community_types[event-event]" time="0.240" /><testcase classname="tests.communities.test_relations_types" name="test_valid_community_types[topic-topic]" time="0.260" /><testcase classname="tests.communities.test_relations_types" name="test_valid_community_types[project-project]" time="0.253" /><testcase classname="tests.communities.test_relations_types" name="test_invalid_community_type" time="0.249" /><testcase classname="tests.communities.test_relations_types" name="test_organizations_field" time="0.429" /><testcase classname="tests.communities.test_resources" name="ISORT" time="0.144" /><testcase classname="tests.communities.test_resources" name="black" time="0.375" /><testcase classname="tests.communities.test_resources" name="test_simple_flow" time="5.030" /><testcase classname="tests.communities.test_resources" name="test_post_schema_validation" time="1.756" /><testcase classname="tests.communities.test_resources" name="test_post_metadata_schema_validation" time="2.047" /><testcase classname="tests.communities.test_resources" name="test_post_community_with_existing_id" time="1.732" /><testcase classname="tests.communities.test_resources" name="test_post_community_with_deleted_id" time="1.706" /><testcase classname="tests.communities.test_resources" name="test_post_self_links" time="1.720" /><testcase classname="tests.communities.test_resources" name="test_simple_search_response" time="5.417" /><testcase classname="tests.communities.test_resources" name="test_simple_get_response" time="1.942" /><testcase classname="tests.communities.test_resources" name="test_simple_put_response" time="2.016" /><testcase classname="tests.communities.test_resources" name="test_update_renamed_record" time="1.675" /><testcase classname="tests.communities.test_resources" name="test_simple_delete_response" time="1.708" /><testcase classname="tests.communities.test_resources" name="test_logo_flow" time="1.902" /><testcase classname="tests.communities.test_resources" name="test_logo_max_content_length" time="1.616" /><testcase classname="tests.communities.test_resources" name="test_invalid_community_ids_create" time="1.426" /><testcase classname="tests.communities.test_resources" name="test_invalid_community_ids" time="1.699" /><testcase classname="tests.communities.test_resources" name="test_featured_communities" time="1.881" /><testcase classname="tests.communities.test_resources" name="test_simple_flow_restricted_community" time="0.242" /><testcase classname="tests.communities.test_resources" name="test_permissions_modify_community_visibility" time="0.299" /><testcase classname="tests.communities.test_resources" name="test_permissions_modify_community_to_public" time="0.613" /><testcase classname="tests.communities.test_services" name="ISORT" time="0.123" /><testcase classname="tests.communities.test_services" name="black" time="0.340" /><testcase classname="tests.communities.test_services" name="test_search_featured" time="4.558" /><testcase classname="tests.communities.test_services" name="test_reindex_featured_entries_task" time="3.691" /><testcase classname="tests.communities.test_services" name="test_create_featured" time="0.222" /><testcase classname="tests.communities.test_services" name="test_get_featured" time="0.166" /><testcase classname="tests.communities.test_services" name="test_delete_featured" time="0.233" /><testcase classname="tests.communities.test_services" name="test_update_featured" time="0.236" /><testcase classname="tests.communities.test_services" name="test_cleanup_pre_search" time="1.401" /><testcase classname="tests.communities.test_services" name="test_search_user" time="2.322" /><testcase classname="tests.communities.test_services" name="test_search_community_requests" time="1.386" /><testcase classname="tests.communities.test_services" name="test_community_deletion" time="0.179" /><testcase classname="tests.communities.test_services" name="test_invalid_community_deletion_workflows" time="0.129" /><testcase classname="tests.communities.test_services" name="test_get_cached_community_slug" time="1.462" /><testcase classname="tests.communities.test_services" name="test_theme_updates" time="2.010" /><testcase classname="tests.communities.test_services" name="test_children_updates" time="1.479" /><testcase classname="tests.communities.test_services" name="test_parent_create" time="0.179" /><testcase classname="tests.communities.test_services" name="test_parent_update" time="0.230" /><testcase classname="tests.communities.test_services" name="test_parent_remove" time="0.260" /><testcase classname="tests.communities.test_services" name="test_update_parent_community_not_exists" time="0.101" /><testcase classname="tests.communities.test_services" name="test_parent_update_parent_children_not_allowed" time="0.158" /><testcase classname="tests.communities.test_services" name="test_parent_update_child_children_are_allowed" time="0.271" /><testcase classname="tests.communities.test_services" name="test_bulk_update_parent" time="0.425" /><testcase classname="tests.communities.test_services" name="test_bulk_update_parent_overwrite" time="0.731" /><testcase classname="tests.communities.test_subcommunities" name="ISORT" time="0.069" /><testcase classname="tests.communities.test_subcommunities" name="black" time="0.244" /><testcase classname="tests.communities.test_subcommunities" name="test_service_join_already_existing" time="2.950" /><testcase classname="tests.communities.test_subcommunities" name="test_service_join_with_new_community" time="0.397" /><testcase classname="tests.communities.test_subcommunities" name="test_service_join_permissions" time="0.213" /><testcase classname="tests.communities.test_subcommunities" name="test_subcommunity_simple_flow" time="0.742" /><testcase classname="tests.communities.test_subcommunities" name="test_subcommunity_existing_child_flow" time="1.000" /><testcase classname="tests.communities.test_tombstone" name="ISORT" time="0.037" /><testcase classname="tests.communities.test_tombstone" name="black" time="0.192" /><testcase classname="tests.communities.test_tombstone" name="test_tombstone_creation" time="2.134" /><testcase classname="tests.communities.test_tombstone" name="test_tombstone_invalid_removed_by" time="0.002" /><testcase classname="tests.communities.test_tombstone" name="test_tombstone_valid_removed_by" time="0.200" /><testcase classname="tests.communities.test_tombstone" name="test_community_deletion_status_default" time="0.002" /><testcase classname="tests.communities.test_tombstone" name="test_community_deletion_status_valid_values" time="0.002" /><testcase classname="tests.communities.test_tombstone" name="test_community_deletion_status_invalid_values" time="0.002" /><testcase classname="tests.communities.test_tombstone" name="test_community_deletion_status" time="0.392" /><testcase classname="tests.communities.test_ui" name="ISORT" time="0.014" /><testcase classname="tests.communities.test_ui" name="black" time="0.167" /><testcase classname="tests.communities.test_ui" name="test_template_loader" time="2.647" /><testcase classname="tests.communities.tests_views" name="PYDOCSTYLE" time="0.010" /><testcase classname="tests.communities.tests_views" name="ISORT" time="0.022" /><testcase classname="tests.communities.tests_views" name="black" time="0.183" /><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.049" /><testcase classname="tests.conftest" name="ISORT" time="0.108" /><testcase classname="tests.conftest" name="black" time="0.272" /><testcase classname="tests.members.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.members.__init__" name="ISORT" time="0.004" /><testcase classname="tests.members.__init__" name="black" time="0.162" /><testcase classname="tests.members.conftest" name="PYDOCSTYLE" time="0.011" /><testcase classname="tests.members.conftest" name="ISORT" time="0.023" /><testcase classname="tests.members.conftest" name="black" time="0.180" /><testcase classname="tests.members.test_members_components" name="ISORT" time="0.031" /><testcase classname="tests.members.test_members_components" name="black" time="0.197" /><testcase classname="tests.members.test_members_components" name="test_accept_invite_cache_clear" time="3.136"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16edd23230&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16edbe2870&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16edde0680&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16edbe2b10&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 4, 127378, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_components" name="test_member_delete_cache_clear" time="1.430" /><testcase classname="tests.members.test_members_components" name="test_member_add_cache_clear" time="1.346" /><testcase classname="tests.members.test_members_components" name="test_member_update_cache_clear" time="1.464" /><testcase classname="tests.members.test_members_components" name="test_group_actions_cache_clear" time="1.979" /><testcase classname="tests.members.test_members_no_groups" name="ISORT" time="0.014" /><testcase classname="tests.members.test_members_no_groups" name="black" time="0.171" /><testcase classname="tests.members.test_members_no_groups" name="test_invite_member_with_groups_disabled" time="2.754"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16edce4500&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16f362c5c0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee7e6510&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee760a70&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
groups_disabled = None

    def test_invite_member_with_groups_disabled(
        member_service, community, owner, new_user, db, groups_disabled
    ):
        """Invite a user when the groups are disabled."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/test_members_no_groups.py:20: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 13, 898516, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[owner-owner]" time="0.082" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[owner-manager]" time="0.071" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[owner-curator]" time="0.070" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[owner-reader]" time="0.095" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[manager-manager]" time="0.083" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[manager-curator]" time="0.075" /><testcase classname="tests.members.test_members_no_groups" name="test_add_member_with_groups_disabled[manager-reader]" time="0.451" /><testcase classname="tests.members.test_members_notifications" name="ISORT" time="0.056" /><testcase classname="tests.members.test_members_notifications" name="black" time="0.227" /><testcase classname="tests.members.test_members_notifications" name="test_community_invitation_submit_notification" time="2.981"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16f38ec6e0&gt;
requests_service = &lt;invenio_requests.services.requests.service.RequestsService object at 0x7f16f2f42570&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ee3ac7d0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bdcd0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3ad3d0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x7f16ee3e1c10&gt;
app = &lt;Flask 'invenio'&gt;, clean_index = True

    def test_community_invitation_submit_notification(
        member_service,
        requests_service,
        community,
        owner,
        new_user,
        db,
        monkeypatch,
        app,
        clean_index,
    ):
        """Test notifcation being built on community invitation submit."""
    
        original_builder = CommunityInvitationSubmittedNotificationBuilder
    
        # mock build to observe calls
        mock_build = MagicMock()
        mock_build.side_effect = original_builder.build
        monkeypatch.setattr(original_builder, "build", mock_build)
        # setting specific builder for test case
        monkeypatch.setattr(
            current_notifications_manager,
            "builders",
            {
                **current_notifications_manager.builders,
                original_builder.type: original_builder,
            },
        )
        assert not mock_build.called
    
        mail = app.extensions.get("mail")
        assert mail
    
        with mail.record_messages() as outbox:
            # Validate that email was sent
            role = "reader"
            message = "&lt;p&gt;invitation message&lt;/p&gt;"
    
            data = {
                "members": [{"type": "user", "id": str(new_user.id)}],
                "role": role,
                "message": message,
            }
&gt;           member_service.invite(owner.identity, community.id, data)

tests/members/test_members_notifications.py:69: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 18, 142348, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_notifications" name="test_community_invitation_accept_notification" time="0.353"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16f38ec6e0&gt;
requests_service = &lt;invenio_requests.services.requests.service.RequestsService object at 0x7f16f2f42570&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ee3ac7d0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3ad3d0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x7f16ee3d0320&gt;
app = &lt;Flask 'invenio'&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee833380&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ee3bdcd0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee325910&gt;}
clean_index = True

    def test_community_invitation_accept_notification(
        member_service,
        requests_service,
        community,
        new_user,
        db,
        monkeypatch,
        app,
        members,
        clean_index,
    ):
        """Test notifcation sent on community invitation accept."""
    
        original_builder = CommunityInvitationAcceptNotificationBuilder
    
        owner = members["owner"]
        # mock build to observe calls
        mock_build = MagicMock()
        mock_build.side_effect = original_builder.build
        monkeypatch.setattr(original_builder, "build", mock_build)
        assert not mock_build.called
    
        mail = app.extensions.get("mail")
        assert mail
    
        role = "reader"
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": role,
        }
&gt;       member_service.invite(owner.identity, community.id, data)

tests/members/test_members_notifications.py:145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 18, 591189, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_notifications" name="test_community_invitation_cancel_notification" time="0.272"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16f38ec6e0&gt;
requests_service = &lt;invenio_requests.services.requests.service.RequestsService object at 0x7f16f2f42570&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ee3ac7d0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bdcd0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3ad3d0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x7f16ed9e8410&gt;
app = &lt;Flask 'invenio'&gt;, clean_index = True

    def test_community_invitation_cancel_notification(
        member_service,
        requests_service,
        community,
        owner,
        new_user,
        db,
        monkeypatch,
        app,
        clean_index,
    ):
        """Test notifcation sent on community invitation cancel."""
    
        original_builder = CommunityInvitationCancelNotificationBuilder
    
        # mock build to observe calls
        mock_build = MagicMock()
        mock_build.side_effect = original_builder.build
        monkeypatch.setattr(original_builder, "build", mock_build)
        assert not mock_build.called
    
        mail = app.extensions.get("mail")
        assert mail
    
        role = "reader"
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": role,
        }
    
&gt;       member_service.invite(owner.identity, community.id, data)

tests/members/test_members_notifications.py:202: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 18, 924573, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_notifications" name="test_community_invitation_decline_notification" time="0.363"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16f38ec6e0&gt;
requests_service = &lt;invenio_requests.services.requests.service.RequestsService object at 0x7f16f2f42570&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ee3ac7d0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3ad3d0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x7f16ed9ea060&gt;
app = &lt;Flask 'invenio'&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee833380&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ee3bdcd0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee325910&gt;}
clean_index = True

    def test_community_invitation_decline_notification(
        member_service,
        requests_service,
        community,
        new_user,
        db,
        monkeypatch,
        app,
        members,
        clean_index,
    ):
        """Test notifcation sent on community invitation decline."""
    
        owner = members["owner"]
        original_builder = CommunityInvitationDeclineNotificationBuilder
    
        # mock build to observe calls
        mock_build = MagicMock()
        mock_build.side_effect = original_builder.build
        monkeypatch.setattr(original_builder, "build", mock_build)
        assert not mock_build.called
    
        mail = app.extensions.get("mail")
        assert mail
    
        role = "reader"
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": role,
        }
&gt;       member_service.invite(owner.identity, community.id, data)

tests/members/test_members_notifications.py:257: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 19, 350595, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_notifications" name="test_community_invitation_expire_notification" time="0.801"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16f38ec6e0&gt;
requests_service = &lt;invenio_requests.services.requests.service.RequestsService object at 0x7f16f2f42570&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ee3ac7d0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3ad3d0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x7f16ed9c4e30&gt;
app = &lt;Flask 'invenio'&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee833380&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ee3bdcd0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee325910&gt;}
clean_index = True

    def test_community_invitation_expire_notification(
        member_service,
        requests_service,
        community,
        new_user,
        db,
        monkeypatch,
        app,
        members,
        clean_index,
    ):
        """Test notifcation sent on community invitation decline."""
    
        owner = members["owner"]
        original_builder = CommunityInvitationExpireNotificationBuilder
    
        # mock build to observe calls
        mock_build = MagicMock()
        mock_build.side_effect = original_builder.build
        monkeypatch.setattr(original_builder, "build", mock_build)
        assert not mock_build.called
    
        mail = app.extensions.get("mail")
        assert mail
    
        role = "reader"
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": role,
        }
&gt;       member_service.invite(owner.identity, community.id, data)

tests/members/test_members_notifications.py:315: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 19, 835014, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_resource" name="ISORT" time="0.066" /><testcase classname="tests.members.test_members_resource" name="black" time="0.249" /><testcase classname="tests.members.test_members_resource" name="test_add" time="2.672" /><testcase classname="tests.members.test_members_resource" name="test_add_denied" time="0.176" /><testcase classname="tests.members.test_members_resource" name="test_add_bad_data" time="0.043" /><testcase classname="tests.members.test_members_resource" name="test_add_invalid_member" time="0.061" /><testcase classname="tests.members.test_members_resource" name="test_add_duplicate" time="0.096" /><testcase classname="tests.members.test_members_resource" name="test_invite" time="0.112"><failure message="ValueError: Not naive datetime (tzinfo is already set)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
community_id = UUID('fbeaed06-67a1-4d5e-b46e-b889d683822b')
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed9e9bb0&gt;
new_user_data = {'members': [{'id': '5', 'type': 'user'}], 'message': 'Welcome to the club!', 'role': 'reader'}
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    def test_invite(client, headers, community_id, owner, new_user_data, db):
        """Test invite REST API."""
        client = owner.login(client)
&gt;       r = client.post(
            f"/communities/{community_id}/invitations",
            headers=headers,
            json=new_user_data,
        )

tests/members/test_members_resource.py:100: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/resources/resource.py:95: in invite
    self.service.invite(
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 23, 736285, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_resource" name="test_invite_deny" time="0.054" /><testcase classname="tests.members.test_members_resource" name="test_update" time="0.123" /><testcase classname="tests.members.test_members_resource" name="test_update_invite" time="0.080"><failure message="ValueError: Not naive datetime (tzinfo is already set)">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}
community_id = UUID('fbeaed06-67a1-4d5e-b46e-b889d683822b')
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed9e9bb0&gt;
new_user_data = {'members': [{'id': '5', 'type': 'user'}], 'role': 'reader'}
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    def test_update_invite(client, headers, community_id, owner, new_user_data, db):
        """Test update of members."""
        client = owner.login(client)
        new_user_data.pop("message")  # not accepted by update
&gt;       r = client.post(
            f"/communities/{community_id}/invitations",
            headers=headers,
            json=new_user_data,
        )

tests/members/test_members_resource.py:157: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/resources/resource.py:95: in invite
    self.service.invite(
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 24, 266876, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_resource" name="test_delete" time="0.110" /><testcase classname="tests.members.test_members_resource" name="test_search" time="0.703" /><testcase classname="tests.members.test_members_resource" name="test_search_public" time="0.396" /><testcase classname="tests.members.test_members_resource" name="test_search_invitation" time="0.067"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9ea240&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed686480&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed9e9bb0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed643c20&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 26, 80988, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_resource" name="test_post_membership_requests" time="0.364" /><testcase classname="tests.members.test_members_resource" name="test_put_membership_requests" time="0.003" /><testcase classname="tests.members.test_members_resource" name="test_error_handling_for_membership_requests" time="0.003" /><testcase classname="tests.members.test_members_resource" name="test_get_membership_requests" time="0.405" /><testcase classname="tests.members.test_members_services" name="ISORT" time="0.189" /><testcase classname="tests.members.test_members_services" name="black" time="0.408" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[owner-owner]" time="2.866" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[owner-manager]" time="0.100" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[owner-curator]" time="0.121" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[owner-reader]" time="0.117" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[manager-manager]" time="0.144" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[manager-curator]" time="0.099" /><testcase classname="tests.members.test_members_services" name="test_add_allowed[manager-reader]" time="0.115" /><testcase classname="tests.members.test_members_services" name="test_add_denied[manager-owner]" time="0.075" /><testcase classname="tests.members.test_members_services" name="test_add_denied[curator-owner]" time="0.085" /><testcase classname="tests.members.test_members_services" name="test_add_denied[curator-manager]" time="0.093" /><testcase classname="tests.members.test_members_services" name="test_add_denied[curator-curator]" time="0.077" /><testcase classname="tests.members.test_members_services" name="test_add_denied[curator-reader]" time="0.074" /><testcase classname="tests.members.test_members_services" name="test_add_denied[reader-owner]" time="0.100" /><testcase classname="tests.members.test_members_services" name="test_add_denied[reader-manager]" time="0.073" /><testcase classname="tests.members.test_members_services" name="test_add_denied[reader-curator]" time="0.076" /><testcase classname="tests.members.test_members_services" name="test_add_denied[reader-reader]" time="0.091" /><testcase classname="tests.members.test_members_services" name="test_add_duplicate" time="0.047" /><testcase classname="tests.members.test_members_services" name="test_add_invalid_member_type" time="0.134" /><testcase classname="tests.members.test_members_services" name="test_add_visible_property" time="0.045" /><testcase classname="tests.members.test_members_services" name="test_add_invalid_data" time="0.037" /><testcase classname="tests.members.test_members_services" name="test_invite" time="0.051"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    def test_invite(member_service, community, owner, new_user, db):
        """Invite a user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/test_members_services.py:189: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 32, 205357, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_invite_group_denied" time="0.044" /><testcase classname="tests.members.test_members_services" name="test_invite_already_member" time="2.196" /><testcase classname="tests.members.test_members_services" name="test_invite_with_message" time="0.069"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    def test_invite_with_message(member_service, community, owner, new_user, db):
        """Invite a user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       assert member_service.invite(owner.identity, community._record.id, data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/members/test_members_services.py:276: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 34, 577427, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_invite_view_request" time="0.065"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 34, 724346, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_search_members" time="0.652" /><testcase classname="tests.members.test_members_services" name="test_scan_members" time="0.366" /><testcase classname="tests.members.test_members_services" name="test_search_public_members" time="0.520" /><testcase classname="tests.members.test_members_services" name="test_search_members_restricted" time="0.419" /><testcase classname="tests.members.test_members_services" name="test_search_members_visibility_restricted" time="0.417" /><testcase classname="tests.members.test_members_services" name="test_search_members_restricted_as_group" time="0.420" /><testcase classname="tests.members.test_members_services" name="test_read_memberships" time="0.377" /><testcase classname="tests.members.test_members_services" name="test_search_invitations" time="0.080"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 38, 42176, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_invite_accept_flow" time="0.066"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 38, 185523, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_invite_decline_flow" time="0.065"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 38, 316484, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_invite_cancel_flow" time="0.064"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 38, 445428, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_invite_actions_permissions" time="0.158"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 38, 667783, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_leave_allowed[manager]" time="0.103" /><testcase classname="tests.members.test_members_services" name="test_leave_allowed[curator]" time="0.133" /><testcase classname="tests.members.test_members_services" name="test_leave_allowed[reader]" time="0.094"><failure message="invenio_records_resources.services.errors.PermissionDeniedError: members_delete">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
role = 'reader'

    @pytest.mark.parametrize("role", ["manager", "curator", "reader"])
    def test_leave_allowed(member_service, community, members, role):
        """Managers, curators and readers can leave."""
        user = members[role]
        data = {"members": [{"type": "user", "id": str(user.id)}]}
&gt;       assert member_service.delete(user.identity, community._record.id, data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/members/test_members_services.py:616: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/services/service.py:640: in delete
    self.require_permission(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
identity = &lt;Identity id="4" auth_type="None" provides={Need(method='id', value=4), Need(method='system_role', value='authenticate...ystem_role', value='any_user'), Need(method='community', value='2ae7c402-be97-47ca-a2fe-6582c24145dd', role='reader')}&gt;
action_name = 'members_delete'
kwargs = {'member': {}, 'record': {'files': {'enabled': True}, 'access': {'visibility': 'public', 'member_policy': 'open', 'rev... '$schema': 'local://communities/communities-v1.0.0.json', 'metadata': {'title': 'My Community'}, 'custom_fields': {}}}

    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy.
    
        Like `check_permission` but raises an error if not allowed.
        """
        if not self.check_permission(identity, action_name, **kwargs):
&gt;           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: members_delete

.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_leave_single_owner_denied" time="0.030" /><testcase classname="tests.members.test_members_services" name="test_leave_denied" time="0.067"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 39, 206556, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_leave_owner_allowed" time="0.066" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[manager-owner]" time="0.123" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[curator-owner]" time="0.146" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[curator-manager]" time="0.113" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[curator-curator]" time="0.133" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[curator-reader]" time="0.120" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[reader-owner]" time="0.135" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[reader-manager]" time="0.116" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[reader-curator]" time="0.148" /><testcase classname="tests.members.test_members_services" name="test_delete_denied[reader-reader]" time="0.142" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[owner-owner]" time="0.124" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[owner-manager]" time="0.144" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[owner-curator]" time="0.124" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[owner-reader]" time="0.144" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[manager-manager]" time="0.119" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[manager-curator]" time="0.139" /><testcase classname="tests.members.test_members_services" name="test_delete_allowed[manager-reader]" time="0.122" /><testcase classname="tests.members.test_members_services" name="test_delete_member_type_group" time="0.065" /><testcase classname="tests.members.test_members_services" name="test_delete_invalid_member" time="0.027" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_denied" time="0.018"><failure message="invenio_communities.members.errors.InvalidMemberError">db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;
member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
any_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed103020&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;

    def test_selfupdate_denied(db, member_service, community, any_user, new_user):
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "visible": False,
        }
        for u in [any_user, new_user]:
&gt;           pytest.raises(
                PermissionDeniedError,
                member_service.update,
                u.identity,
                community._record.id,
                data,
            )

tests/members/test_members_services.py:779: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
identity = &lt;Identity id="7" auth_type="None" provides={Need(method='system_role', value='authenticated_user'), Need(method='id', ...ystem_role', value='any_user'), Need(method='community', value='2ae7c402-be97-47ca-a2fe-6582c24145dd', role='reader')}&gt;
community_id = UUID('2ae7c402-be97-47ca-a2fe-6582c24145dd')
data = {'members': [{'id': '5', 'type': 'user'}], 'visible': False}
uow = &lt;invenio_db.uow.UnitOfWork object at 0x7f16ed1fbc80&gt;, refresh = False

    @unit_of_work()
    def update(self, identity, community_id, data, uow=None, refresh=False):
        """Bulk update.
    
        Used to update both active members and active invitations. Archived
        invitations cannot be updated.
        """
        community = self.community_cls.get_record(community_id)
    
        # Permission check - validates that:
        # - identity has permission to change any member at all (incl self)
        self.require_permission(
            identity,
            "members_bulk_update",
            record=community,
        )
    
        # Validate data (if there are errors, .load() raises)
        data, errors = self.update_schema.load(
            data,
            context={"identity": identity},
        )
    
        # Schema validates that role and/or visibility are defined.
        members = self.record_cls.get_members(community.id, members=data["members"])
        if len(members) != len(data["members"]):
&gt;           raise InvalidMemberError()
E           invenio_communities.members.errors.InvalidMemberError

invenio_communities/members/services/service.py:528: InvalidMemberError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_selfupdate_role_denied[owner]" time="0.111" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_role_denied[manager]" time="0.084" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_role_denied[curator]" time="0.079"><failure message="invenio_records_resources.services.errors.PermissionDeniedError: members_update">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'curator'

    @pytest.mark.parametrize(
        "actor",
        [
            "owner",
            "manager",
            "curator",
            "reader",
        ],
    )
    def test_selfupdate_role_denied(member_service, community, members, actor):
        """Nobody can change their own role."""
        user = members[actor]
        data = {
            "members": [{"type": "user", "id": str(user.id)}],
            "role": actor,
        }
&gt;       pytest.raises(
            ValidationError,
            member_service.update,
            user.identity,
            community._record.id,
            data,
        )

tests/members/test_members_services.py:804: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/services/service.py:534: in update
    self._update(identity, community, m, role, visible, uow)
invenio_communities/members/services/service.py:554: in _update
    self.require_permission(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
identity = &lt;Identity id="3" auth_type="None" provides={Need(method='system_role', value='authenticated_user'), Need(method='commu...97-47ca-a2fe-6582c24145dd', role='curator'), Need(method='system_role', value='any_user'), Need(method='id', value=3)}&gt;
action_name = 'members_update'
kwargs = {'member': {}, 'record': {'files': {'enabled': True}, 'access': {'visibility': 'public', 'member_policy': 'open', 'rev...//communities/communities-v1.0.0.json', 'metadata': {'title': 'My Community'}, 'custom_fields': {}}, 'role': 'curator'}

    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy.
    
        Like `check_permission` but raises an error if not allowed.
        """
        if not self.check_permission(identity, action_name, **kwargs):
&gt;           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: members_update

.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_selfupdate_role_denied[reader]" time="0.106"><failure message="invenio_records_resources.services.errors.PermissionDeniedError: members_update">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader'

    @pytest.mark.parametrize(
        "actor",
        [
            "owner",
            "manager",
            "curator",
            "reader",
        ],
    )
    def test_selfupdate_role_denied(member_service, community, members, actor):
        """Nobody can change their own role."""
        user = members[actor]
        data = {
            "members": [{"type": "user", "id": str(user.id)}],
            "role": actor,
        }
&gt;       pytest.raises(
            ValidationError,
            member_service.update,
            user.identity,
            community._record.id,
            data,
        )

tests/members/test_members_services.py:804: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/services/service.py:534: in update
    self._update(identity, community, m, role, visible, uow)
invenio_communities/members/services/service.py:554: in _update
    self.require_permission(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
identity = &lt;Identity id="4" auth_type="None" provides={Need(method='id', value=4), Need(method='system_role', value='authenticate...ystem_role', value='any_user'), Need(method='community', value='2ae7c402-be97-47ca-a2fe-6582c24145dd', role='reader')}&gt;
action_name = 'members_update'
kwargs = {'member': {}, 'record': {'files': {'enabled': True}, 'access': {'visibility': 'public', 'member_policy': 'open', 'rev...://communities/communities-v1.0.0.json', 'metadata': {'title': 'My Community'}, 'custom_fields': {}}, 'role': 'reader'}

    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy.
    
        Like `check_permission` but raises an error if not allowed.
        """
        if not self.check_permission(identity, action_name, **kwargs):
&gt;           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: members_update

.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_selfupdate_allow_visibility[owner]" time="0.123" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_allow_visibility[manager]" time="0.127" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_allow_visibility[curator]" time="0.145" /><testcase classname="tests.members.test_members_services" name="test_selfupdate_allow_visibility[reader]" time="0.082"><failure message="invenio_records_resources.services.errors.PermissionDeniedError: members_update">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader'
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor",
        [
            "owner",
            "manager",
            "curator",
            "reader",
        ],
    )
    def test_selfupdate_allow_visibility(member_service, community, members, actor, db):
        """All + system identity can change their own visibility to true."""
        user = members[actor]
        data = {
            "members": [{"type": "user", "id": str(user.id)}],
            "visible": True,
        }
&gt;       member_service.update(user.identity, community._record.id, data)

tests/members/test_members_services.py:829: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:251: in inner
    res = f(self, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_communities/members/services/service.py:534: in update
    self._update(identity, community, m, role, visible, uow)
invenio_communities/members/services/service.py:554: in _update
    self.require_permission(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
identity = &lt;Identity id="4" auth_type="None" provides={Need(method='id', value=4), Need(method='system_role', value='authenticate...ystem_role', value='any_user'), Need(method='community', value='2ae7c402-be97-47ca-a2fe-6582c24145dd', role='reader')}&gt;
action_name = 'members_update'
kwargs = {'member': {}, 'record': {'files': {'enabled': True}, 'access': {'visibility': 'public', 'member_policy': 'open', 'rev...ocal://communities/communities-v1.0.0.json', 'metadata': {'title': 'My Community'}, 'custom_fields': {}}, 'role': None}

    def require_permission(self, identity, action_name, **kwargs):
        """Require a specific permission from the permission policy.
    
        Like `check_permission` but raises an error if not allowed.
        """
        if not self.check_permission(identity, action_name, **kwargs):
&gt;           raise PermissionDeniedError(action_name)
E           invenio_records_resources.services.errors.PermissionDeniedError: members_update

.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/service.py:51: PermissionDeniedError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[owner-owner]" time="0.121" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[owner-manager]" time="0.156" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[owner-curator]" time="0.120" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[owner-reader]" time="0.139" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[manager-manager]" time="0.134" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[manager-curator]" time="0.164" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_denied[manager-reader]" time="0.154" /><testcase classname="tests.members.test_members_services" name="test_update_public_visibility_of_group_allowed" time="0.076" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[owner-owner]" time="0.175" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[owner-manager]" time="0.133" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[owner-curator]" time="0.128" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[owner-reader]" time="0.146" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[manager-manager]" time="0.138" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[manager-curator]" time="0.152" /><testcase classname="tests.members.test_members_services" name="test_update_hidden_visibility_allowed[manager-reader]" time="0.127" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[owner-owner-reader]" time="0.159" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[owner-manager-reader]" time="0.133" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[owner-curator-manager]" time="0.148" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[owner-reader-curator]" time="0.127" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[manager-manager-curator]" time="0.129" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[manager-curator-manager]" time="0.151" /><testcase classname="tests.members.test_members_services" name="test_update_role_allowed[manager-reader-curator]" time="0.131" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[manager-owner-reader]" time="0.139" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[curator-owner-reader]" time="0.123" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[curator-manager-curator]" time="0.155" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[curator-curator-manager]" time="0.138" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[curator-reader-owner]" time="0.136" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[reader-owner-owner]" time="0.114" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[reader-manager-manager]" time="0.162" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[reader-curator-curator]" time="0.182" /><testcase classname="tests.members.test_members_services" name="test_update_role_denied[reader-reader-manager]" time="0.117" /><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[owner-owner-reader]" time="0.127"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'owner', initial_role = 'owner', new_role = 'reader'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 47, 180293, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[owner-manager-reader]" time="0.100"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'owner', initial_role = 'manager', new_role = 'reader'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 47, 359371, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[owner-curator-manager]" time="0.103"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'owner', initial_role = 'curator', new_role = 'manager'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 47, 538668, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[owner-reader-curator]" time="0.130"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'owner', initial_role = 'reader', new_role = 'curator'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 47, 747915, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[manager-manager-curator]" time="0.105"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'manager', initial_role = 'manager', new_role = 'curator'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 47, 931048, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[manager-curator-manager]" time="0.102"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'manager', initial_role = 'curator', new_role = 'manager'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 48, 110396, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_allowed[manager-reader-curator]" time="0.129"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'manager', initial_role = 'reader', new_role = 'curator'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("owner", "owner", "reader"),
            ("owner", "manager", "reader"),
            ("owner", "curator", "manager"),
            ("owner", "reader", "curator"),
            ("manager", "manager", "curator"),
            ("manager", "curator", "manager"),
            ("manager", "reader", "curator"),
        ],
    )
    def test_update_invitation_role_allowed(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Owners can change role of all, managers all but owners."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members[actor].identity, community._record.id, data)

tests/members/test_members_services.py:1007: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 48, 315455, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[manager-owner-reader]" time="0.101"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'manager', initial_role = 'owner', new_role = 'reader'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 48, 495114, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[curator-owner-reader]" time="0.099"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'curator', initial_role = 'owner', new_role = 'reader'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 48, 671855, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[curator-manager-curator]" time="0.139"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'curator', initial_role = 'manager', new_role = 'curator'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 48, 878603, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[curator-curator-manager]" time="0.119"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'curator', initial_role = 'curator', new_role = 'manager'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 49, 78264, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[curator-reader-owner]" time="0.103"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'curator', initial_role = 'reader', new_role = 'owner'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 49, 606979, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[reader-owner-owner]" time="0.123"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader', initial_role = 'owner', new_role = 'owner'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 49, 809832, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[reader-manager-manager]" time="0.100"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader', initial_role = 'manager', new_role = 'manager'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 49, 988746, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[reader-curator-curator]" time="0.106"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader', initial_role = 'curator', new_role = 'curator'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 50, 174726, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_invitation_role_denied[reader-reader-manager]" time="0.127"><failure message="ValueError: Not naive datetime (tzinfo is already set)">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
members = {'curator': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ee3bd760&gt;, 'manager': &lt;pytest_invenio.user.UserFixtur...er.UserFixtureBase object at 0x7f16ed3d57f0&gt;, 'reader': &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ede9c860&gt;}
actor = 'reader', initial_role = 'reader', new_role = 'manager'
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.mark.parametrize(
        "actor,initial_role,new_role",
        [
            ("manager", "owner", "reader"),
            ("curator", "owner", "reader"),
            ("curator", "manager", "curator"),
            ("curator", "curator", "manager"),
            ("curator", "reader", "owner"),
            ("reader", "owner", "owner"),
            ("reader", "manager", "manager"),
            ("reader", "curator", "curator"),
            ("reader", "reader", "manager"),
        ],
    )
    def test_update_invitation_role_denied(
        member_service, community, members, actor, initial_role, new_role, new_user, db
    ):
        """Managers cannot change owner roles, curators/readers cannot change."""
        # Invite a new user with role
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": initial_role,
        }
&gt;       member_service.invite(members["owner"].identity, community._record.id, data)

tests/members/test_members_services.py:1040: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 50, 378079, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.members.test_members_services" name="test_update_declined_invitation[decline]" time="0.074"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 50, 512049, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_update_declined_invitation[cancel]" time="0.065"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 50, 650535, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_update_declined_invitation[expire]" time="0.067"><error message="failed on setup with &quot;ValueError: Not naive datetime (tzinfo is already set)&quot;">member_service = &lt;invenio_communities.members.services.service.MemberService object at 0x7f16ed9b5b80&gt;
community = &lt;invenio_communities.communities.services.results.CommunityItem object at 0x7f16ed0376b0&gt;
owner = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ed3d57f0&gt;
new_user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f16ecf15df0&gt;
db = &lt;SQLAlchemy postgresql+psycopg2://invenio:***@localhost:5432/invenio&gt;

    @pytest.fixture(scope="function")
    def invite_user(member_service, community, owner, new_user, db):
        """An invited user."""
        data = {
            "members": [{"type": "user", "id": str(new_user.id)}],
            "role": "reader",
            "message": "Welcome to the club!",
        }
&gt;       member_service.invite(owner.identity, community._record.id, data)

tests/members/conftest.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_db/uow.py:252: in inner
    uow.commit()
.venv/lib/python3.12/site-packages/invenio_db/uow.py:196: in commit
    op.on_commit(self)
.venv/lib/python3.12/site-packages/invenio_records_resources/services/uow.py:142: in on_commit
    self._indexer.index(self._record, arguments=arguments)
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_indexer/api.py:459: in _prepare_record
    return record.dumps(dumper=self.record_dumper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/api.py:250: in dumps
    data = dumper.dump(self, data)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:213: in dump
    self._dump_model_field(
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:148: in _dump_model_field
    dump[dump_key] = self._serialize(val, dump_type)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records/dumpers/search.py:99: in _serialize
    return pytz.utc.localize(value).isoformat()
           ^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 12, 18, 15, 58, 50, 781565, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</error></testcase><testcase classname="tests.members.test_members_services" name="test_update_role_must_have_owner" time="0.078" /><testcase classname="tests.members.test_members_services" name="test_update_invalid_data" time="0.068" /><testcase classname="tests.members.test_members_services" name="test_request_cancel_request_flow" time="1.722" /><testcase classname="tests.members.test_members_services" name="test_relation_update_propagation" time="0.841" /><testcase classname="tests.mock_module.__init__" name="PYDOCSTYLE" time="0.006" /><testcase classname="tests.mock_module.__init__" name="ISORT" time="0.012" /><testcase classname="tests.mock_module.__init__" name="black" time="0.166" /><testcase classname="tests.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.records.__init__" name="ISORT" time="0.004" /><testcase classname="tests.records.__init__" name="black" time="0.163" /><testcase classname="tests.records.conftest" name="PYDOCSTYLE" time="0.007" /><testcase classname="tests.records.conftest" name="ISORT" time="0.014" /><testcase classname="tests.records.conftest" name="black" time="0.167" /><testcase classname="tests.records.mock_module.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.records.mock_module.__init__" name="ISORT" time="0.003" /><testcase classname="tests.records.mock_module.__init__" name="black" time="0.160" /><testcase classname="tests.records.mock_module.api" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.records.mock_module.api" name="ISORT" time="0.011" /><testcase classname="tests.records.mock_module.api" name="black" time="0.164" /><testcase classname="tests.records.mock_module.jsonschemas.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.records.mock_module.jsonschemas.__init__" name="ISORT" time="0.004" /><testcase classname="tests.records.mock_module.jsonschemas.__init__" name="black" time="0.160" /><testcase classname="tests.records.mock_module.mappings.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.records.mock_module.mappings.__init__" name="ISORT" time="0.003" /><testcase classname="tests.records.mock_module.mappings.__init__" name="black" time="0.159" /><testcase classname="tests.records.mock_module.mappings.v6.__init__" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.records.mock_module.mappings.v6.__init__" name="ISORT" time="0.003" /><testcase classname="tests.records.mock_module.mappings.v6.__init__" name="black" time="0.158" /><testcase classname="tests.records.mock_module.mappings.v7.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.records.mock_module.mappings.v7.__init__" name="ISORT" time="0.004" /><testcase classname="tests.records.mock_module.mappings.v7.__init__" name="black" time="0.160" /><testcase classname="tests.records.mock_module.models" name="PYDOCSTYLE" time="0.004" /><testcase classname="tests.records.mock_module.models" name="ISORT" time="0.010" /><testcase classname="tests.records.mock_module.models" name="black" time="0.164" /><testcase classname="tests.records.test_mockrecords_api" name="ISORT" time="0.031" /><testcase classname="tests.records.test_mockrecords_api" name="black" time="0.196" /><testcase classname="tests.records.test_mockrecords_api" name="test_record_create_empty" time="2.328" /><testcase classname="tests.records.test_mockrecords_api" name="test_get" time="0.041" /><testcase classname="tests.records.test_mockrecords_api" name="test_add" time="0.037" /><testcase classname="tests.records.test_mockrecords_api" name="test_add_existing" time="0.022" /><testcase classname="tests.records.test_mockrecords_api" name="test_len_contains" time="0.038" /><testcase classname="tests.records.test_mockrecords_api" name="test_remove" time="0.034" /><testcase classname="tests.records.test_mockrecords_api" name="test_iter" time="0.030" /><testcase classname="tests.records.test_mockrecords_api" name="test_ids" time="0.028" /><testcase classname="tests.records.test_mockrecords_api" name="test_change_default" time="0.040" /><testcase classname="tests.records.test_mockrecords_api" name="test_clear" time="0.032" /><testcase classname="tests.records.test_mockrecords_api" name="test_refresh" time="0.432" /><testcase classname="tests.test_notifications" name="ISORT" time="0.011" /><testcase classname="tests.test_notifications" name="black" time="0.164" /><testcase classname="tests.test_notifications" name="test_user_recipient_generator" time="4.132" /></testsuite></testsuites>