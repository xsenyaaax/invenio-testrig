<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="5" skipped="0" tests="134" time="18.132" timestamp="2025-11-18T15:52:14.921196+00:00" hostname="runnervmg1sw1"><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.012" /><testcase classname="tests.conftest" name="ISORT" time="0.131" /><testcase classname="tests.conftest" name="black" time="0.307" /><testcase classname="tests.records.test_disable" name="ISORT" time="0.017" /><testcase classname="tests.records.test_disable" name="black" time="0.175" /><testcase classname="tests.records.test_disable" name="test_disable_expired" time="1.425" /><testcase classname="tests.records.test_models" name="ISORT" time="0.036" /><testcase classname="tests.records.test_models" name="black" time="0.200" /><testcase classname="tests.records.test_models" name="test_get_with_sub_path" time="0.682" /><testcase classname="tests.records.test_models" name="test_get_with_specific_path" time="0.010" /><testcase classname="tests.records.test_models" name="test_get_active_with_datetime" time="0.005" /><testcase classname="tests.records.test_models" name="test_get_active_future_datetime" time="0.014" /><testcase classname="tests.records.test_models" name="test_get_active_disabled" time="0.008" /><testcase classname="tests.records.test_models" name="test_create_banner" time="0.006" /><testcase classname="tests.records.test_models" name="test_update_banner" time="0.008" /><testcase classname="tests.records.test_models" name="test_delete_banner" time="0.007" /><testcase classname="tests.records.test_models" name="test_get_banner" time="0.004" /><testcase classname="tests.records.test_models" name="test_get_non_existing_banner" time="0.004" /><testcase classname="tests.records.test_models" name="test_category" time="0.052" /><testcase classname="tests.resources.conftest" name="PYDOCSTYLE" time="0.005" /><testcase classname="tests.resources.conftest" name="ISORT" time="0.009" /><testcase classname="tests.resources.conftest" name="black" time="0.162" /><testcase classname="tests.resources.test_resources" name="ISORT" time="0.070" /><testcase classname="tests.resources.test_resources" name="black" time="0.252" /><testcase classname="tests.resources.test_resources" name="test_create_is_forbidden" time="0.758" /><testcase classname="tests.resources.test_resources" name="test_create_banner" time="0.144" /><testcase classname="tests.resources.test_resources" name="test_disable_expired_after_create_action" time="0.119" /><testcase classname="tests.resources.test_resources" name="test_update_banner" time="0.109"><failure message="AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
admin = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f4ffb3f29c0&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}

    def test_update_banner(client, admin, headers):
        """Update a banner."""
        # create banner first
        banner = BannerModel.create(banners["banner1"])
    
        admin.login(client)
    
        new_data = {
            "start_datetime": datetime.now(timezone.utc).strftime("%Y-%m-%d %H:%M:%S"),
            "active": True,
            "message": "New banner message",
            "category": "info",
        }
    
&gt;       updated_banner = _update_banner(client, banner.id, new_data, headers, 200).json
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/resources/test_resources.py:89: in _update_banner
    result = client.put(f"/banners/{id}", headers=headers, json=data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1172: in put
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_banners/resources/resource.py:58: in update
    return banner.to_dict(), 200
           ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/results.py:106: in to_dict
    res = self.data
          ^^^^^^^^^
invenio_banners/services/results.py:42: in data
    self._data = self._schema.dump(
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: in dump
    return self.schema(context=context, **schema_args).dump(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:621: in dump
    result = self._serialize(processed_obj, many=many)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:589: in _serialize
    value = field_obj.serialize(attr_name, obj, accessor=self.get_attribute)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:348: in serialize
    return self._serialize(value, attr, obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:1322: in _serialize
    return format_func(value)
           ^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

datetime = '2022-07-20 00:00:00'

    def isoformat(datetime: dt.datetime) -&gt; str:
        """Return the ISO8601-formatted representation of a datetime object.
    
        :param datetime: The datetime.
        """
&gt;       return datetime.isoformat()
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?

.venv/lib/python3.12/site-packages/marshmallow/utils.py:239: AttributeError</failure></testcase><testcase classname="tests.resources.test_resources" name="test_disable_expired_after_update_action" time="0.109"><failure message="AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
admin = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f4ffaeed550&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}

    def test_disable_expired_after_update_action(client, admin, headers):
        """Disable expired banners after an update a banner action."""
        # create banner first
        banner0 = BannerModel.create(banners["banner0"])
        banner2 = BannerModel.create(banners["banner2"])
        assert banner0.active is True
    
        admin.login(client)
    
        new_data = {
            "start_datetime": datetime.now(timezone.utc).strftime("%Y-%m-%d %H:%M:%S"),
            "active": True,
            "message": "New banner message",
            "category": "info",
        }
    
&gt;       _update_banner(client, banner2.id, new_data, headers, 200).json
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources.py:189: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/resources/test_resources.py:89: in _update_banner
    result = client.put(f"/banners/{id}", headers=headers, json=data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1172: in put
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:90: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_banners/resources/resource.py:58: in update
    return banner.to_dict(), 200
           ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/results.py:106: in to_dict
    res = self.data
          ^^^^^^^^^
invenio_banners/services/results.py:42: in data
    self._data = self._schema.dump(
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: in dump
    return self.schema(context=context, **schema_args).dump(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:621: in dump
    result = self._serialize(processed_obj, many=many)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:589: in _serialize
    value = field_obj.serialize(attr_name, obj, accessor=self.get_attribute)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:348: in serialize
    return self._serialize(value, attr, obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:1322: in _serialize
    return format_func(value)
           ^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

datetime = '2022-12-15 00:00:00'

    def isoformat(datetime: dt.datetime) -&gt; str:
        """Return the ISO8601-formatted representation of a datetime object.
    
        :param datetime: The datetime.
        """
&gt;       return datetime.isoformat()
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?

.venv/lib/python3.12/site-packages/marshmallow/utils.py:239: AttributeError</failure></testcase><testcase classname="tests.resources.test_resources" name="test_update_is_forbidden" time="0.074" /><testcase classname="tests.resources.test_resources" name="test_update_non_existing_banner" time="0.083" /><testcase classname="tests.resources.test_resources" name="test_delete_banner" time="0.088"><failure message="AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
admin = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f4ff779a540&gt;
headers = {'accept': 'application/json', 'content-type': 'application/json'}

    def test_delete_banner(client, admin, headers):
        """Delete a banner."""
        # create banner first
        banner = BannerModel.create(banners["banner1"])
    
        admin.login(client)
    
&gt;       _delete_banner(client, banner.id, headers, 204)

tests/resources/test_resources.py:228: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/resources/test_resources.py:96: in _delete_banner
    result = client.delete(f"/banners/{id}", headers=headers)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1177: in delete
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
invenio_banners/resources/resource.py:107: in delete
    return banner.to_dict(), 204
           ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/results.py:106: in to_dict
    res = self.data
          ^^^^^^^^^
invenio_banners/services/results.py:42: in data
    self._data = self._schema.dump(
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: in dump
    return self.schema(context=context, **schema_args).dump(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:621: in dump
    result = self._serialize(processed_obj, many=many)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:589: in _serialize
    value = field_obj.serialize(attr_name, obj, accessor=self.get_attribute)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:348: in serialize
    return self._serialize(value, attr, obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:1322: in _serialize
    return format_func(value)
           ^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

datetime = '2022-07-20 00:00:00'

    def isoformat(datetime: dt.datetime) -&gt; str:
        """Return the ISO8601-formatted representation of a datetime object.
    
        :param datetime: The datetime.
        """
&gt;       return datetime.isoformat()
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?

.venv/lib/python3.12/site-packages/marshmallow/utils.py:239: AttributeError</failure></testcase><testcase classname="tests.resources.test_resources" name="test_delete_is_forbidden" time="0.074" /><testcase classname="tests.resources.test_resources" name="test_delete_non_existing_banner" time="0.083" /><testcase classname="tests.resources.test_resources" name="test_read_banner" time="0.069"><failure message="AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?">client = &lt;FlaskClient &lt;Flask 'invenio'&gt;&gt;
user = &lt;pytest_invenio.user.UserFixtureBase object at 0x7f4ff775d5b0&gt;

    def test_read_banner(client, user):
        """Read a banner by id."""
        # create banner first
        banner = BannerModel.create(banners["banner1"])
    
        user.login(client)
    
&gt;       banner_result = _get_banner(client, banner.id, 200).json
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/resources/test_resources.py:263: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/resources/test_resources.py:103: in _get_banner
    result = client.get(f"/banners/{id}")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/resources.py:65: in view
    return view_meth()
           ^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/content_negotiation.py:116: in inner_content_negotiation
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/parsers/decorators.py:51: in inner
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/flask_resources/responses.py:39: in inner
    res = f(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^
invenio_banners/resources/resource.py:70: in read
    return banner.to_dict(), 200
           ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/results.py:106: in to_dict
    res = self.data
          ^^^^^^^^^
invenio_banners/services/results.py:42: in data
    self._data = self._schema.dump(
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: in dump
    return self.schema(context=context, **schema_args).dump(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:621: in dump
    result = self._serialize(processed_obj, many=many)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:589: in _serialize
    value = field_obj.serialize(attr_name, obj, accessor=self.get_attribute)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:348: in serialize
    return self._serialize(value, attr, obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:1322: in _serialize
    return format_func(value)
           ^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

datetime = '2022-07-20 00:00:00'

    def isoformat(datetime: dt.datetime) -&gt; str:
        """Return the ISO8601-formatted representation of a datetime object.
    
        :param datetime: The datetime.
        """
&gt;       return datetime.isoformat()
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?

.venv/lib/python3.12/site-packages/marshmallow/utils.py:239: AttributeError</failure></testcase><testcase classname="tests.resources.test_resources" name="test_read_non_existing_banner" time="0.081" /><testcase classname="tests.resources.test_resources" name="test_search_banner" time="0.094" /><testcase classname="tests.resources.test_resources" name="test_search_banner_with_query_string" time="0.254" /><testcase classname="tests.resources.test_resources" name="test_search_banner_with_query_params" time="0.139" /><testcase classname="tests.resources.test_resources" name="test_search_banner_empty_list" time="0.067" /><testcase classname="tests.resources.test_resources" name="test_html_banner" time="0.153" /><testcase classname="tests.services.conftest" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.services.conftest" name="ISORT" time="0.008" /><testcase classname="tests.services.conftest" name="black" time="0.163" /><testcase classname="tests.services.test_services" name="ISORT" time="0.045" /><testcase classname="tests.services.test_services" name="black" time="0.212" /><testcase classname="tests.services.test_services" name="test_banner_creation" time="0.728" /><testcase classname="tests.services.test_services" name="test_create_is_forbidden" time="0.039" /><testcase classname="tests.services.test_services" name="test_update_banner" time="0.057"><failure message="AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?">app = &lt;Flask 'invenio'&gt;
superuser_identity = &lt;Identity id="3" auth_type="None" provides={Need(method='id', value=3), Need(method='system_role', value='authenticated_user'), Need(method='role', value='administration-access'), Need(method='system_role', value='any_user')}&gt;

    def test_update_banner(app, superuser_identity):
        """Update a banner."""
        # create banner first
        banner = BannerModel.create(banners["active"])
    
        new_data = {
            "active": True,
            "start_datetime": datetime.now(timezone.utc).strftime("%Y-%m-%d %H:%M:%S"),
            "message": "New banner message",
            "category": "info",
        }
    
        updated_banner = service.update(superuser_identity, banner.id, new_data)
    
&gt;       assert updated_banner["message"] == new_data["message"]
               ^^^^^^^^^^^^^^^^^^^^^^^^^

tests/services/test_services.py:101: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/results.py:60: in __getitem__
    return self.data[key]
           ^^^^^^^^^
invenio_banners/services/results.py:42: in data
    self._data = self._schema.dump(
.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: in dump
    return self.schema(context=context, **schema_args).dump(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:621: in dump
    result = self._serialize(processed_obj, many=many)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/schema.py:589: in _serialize
    value = field_obj.serialize(attr_name, obj, accessor=self.get_attribute)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:348: in serialize
    return self._serialize(value, attr, obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/marshmallow/fields.py:1322: in _serialize
    return format_func(value)
           ^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

datetime = '2025-11-19 15:52:17'

    def isoformat(datetime: dt.datetime) -&gt; str:
        """Return the ISO8601-formatted representation of a datetime object.
    
        :param datetime: The datetime.
        """
&gt;       return datetime.isoformat()
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'str' object has no attribute 'isoformat'. Did you mean: 'format'?

.venv/lib/python3.12/site-packages/marshmallow/utils.py:239: AttributeError</failure></testcase><testcase classname="tests.services.test_services" name="test_update_is_forbidden" time="0.043" /><testcase classname="tests.services.test_services" name="test_update_non_existing_banner" time="0.053" /><testcase classname="tests.services.test_services" name="test_delete_banner" time="0.058" /><testcase classname="tests.services.test_services" name="test_delete_is_forbidden" time="0.040" /><testcase classname="tests.services.test_services" name="test_delete_non_existing_banner" time="0.053" /><testcase classname="tests.services.test_services" name="test_read_banner" time="0.040" /><testcase classname="tests.services.test_services" name="test_read_non_existing_banner" time="0.037" /><testcase classname="tests.services.test_services" name="test_search_banner_with_query_string" time="0.065" /><testcase classname="tests.services.test_services" name="test_search_banner_with_query_params" time="0.046" /><testcase classname="tests.services.test_services" name="test_search_banner_empty_list" time="0.043" /><testcase classname="tests.services.test_services" name="test_disable_expired_banners" time="0.066" /><testcase classname="tests.services.test_services" name="test_disable_expired_is_forbidden" time="0.086" /><testcase classname="tests.test_invenio_banners" name="ISORT" time="0.012" /><testcase classname="tests.test_invenio_banners" name="black" time="0.162" /><testcase classname="tests.test_invenio_banners" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_banners" name="test_init" time="0.006" /><testcase classname="tests.test_macro" name="ISORT" time="0.019" /><testcase classname="tests.test_macro" name="black" time="0.170" /><testcase classname="tests.test_macro" name="test_jinja_macro" time="0.751" /><testcase classname="invenio_banners.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_banners.__init__" name="black" time="0.156" /><testcase classname="invenio_banners.administration.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_banners.administration.__init__" name="ISORT" time="0.004" /><testcase classname="invenio_banners.administration.__init__" name="black" time="0.156" /><testcase classname="invenio_banners.administration.banners" name="PYDOCSTYLE" time="0.012" /><testcase classname="invenio_banners.administration.banners" name="ISORT" time="0.035" /><testcase classname="invenio_banners.administration.banners" name="black" time="0.192" /><testcase classname="invenio_banners.alembic.5e02314da32e_create_invenio_banners_db_table" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_banners.alembic.5e02314da32e_create_invenio_banners_db_table" name="ISORT" time="0.012" /><testcase classname="invenio_banners.alembic.5e02314da32e_create_invenio_banners_db_table" name="black" time="0.168" /><testcase classname="invenio_banners.alembic.e40d93d99040_create_invenio_banners_branch" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.alembic.e40d93d99040_create_invenio_banners_branch" name="ISORT" time="0.009" /><testcase classname="invenio_banners.alembic.e40d93d99040_create_invenio_banners_branch" name="black" time="0.158" /><testcase classname="invenio_banners.config" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_banners.config" name="ISORT" time="0.014" /><testcase classname="invenio_banners.config" name="black" time="0.165" /><testcase classname="invenio_banners.ext" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_banners.ext" name="ISORT" time="0.014" /><testcase classname="invenio_banners.ext" name="black" time="0.171" /><testcase classname="invenio_banners.proxies" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.proxies" name="ISORT" time="0.009" /><testcase classname="invenio_banners.proxies" name="black" time="0.161" /><testcase classname="invenio_banners.records.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.records.__init__" name="ISORT" time="0.005" /><testcase classname="invenio_banners.records.__init__" name="black" time="0.165" /><testcase classname="invenio_banners.records.models" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_banners.records.models" name="ISORT" time="0.029" /><testcase classname="invenio_banners.records.models" name="black" time="0.194" /><testcase classname="invenio_banners.resources.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.resources.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_banners.resources.__init__" name="black" time="0.159" /><testcase classname="invenio_banners.resources.config" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_banners.resources.config" name="ISORT" time="0.013" /><testcase classname="invenio_banners.resources.config" name="black" time="0.168" /><testcase classname="invenio_banners.resources.errors" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_banners.resources.errors" name="ISORT" time="0.015" /><testcase classname="invenio_banners.resources.errors" name="black" time="0.167" /><testcase classname="invenio_banners.resources.resource" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_banners.resources.resource" name="ISORT" time="0.023" /><testcase classname="invenio_banners.resources.resource" name="black" time="0.176" /><testcase classname="invenio_banners.services.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.services.__init__" name="ISORT" time="0.009" /><testcase classname="invenio_banners.services.__init__" name="black" time="0.168" /><testcase classname="invenio_banners.services.config" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_banners.services.config" name="ISORT" time="0.022" /><testcase classname="invenio_banners.services.config" name="black" time="0.175" /><testcase classname="invenio_banners.services.permissions" name="PYDOCSTYLE" time="0.004" /><testcase classname="invenio_banners.services.permissions" name="ISORT" time="0.010" /><testcase classname="invenio_banners.services.permissions" name="black" time="0.163" /><testcase classname="invenio_banners.services.results" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_banners.services.results" name="ISORT" time="0.029" /><testcase classname="invenio_banners.services.results" name="black" time="0.180" /><testcase classname="invenio_banners.services.schemas" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_banners.services.schemas" name="ISORT" time="0.013" /><testcase classname="invenio_banners.services.schemas" name="black" time="0.169" /><testcase classname="invenio_banners.services.service" name="PYDOCSTYLE" time="0.015" /><testcase classname="invenio_banners.services.service" name="ISORT" time="0.037" /><testcase classname="invenio_banners.services.service" name="black" time="0.189" /><testcase classname="invenio_banners.utils" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_banners.utils" name="ISORT" time="0.012" /><testcase classname="invenio_banners.utils" name="black" time="0.168" /><testcase classname="invenio_banners.views" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_banners.views" name="ISORT" time="0.004" /><testcase classname="invenio_banners.views" name="black" time="0.159" /></testsuite></testsuites>